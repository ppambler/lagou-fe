### âœï¸ Tangxt â³ 2021-08-13 ğŸ·ï¸ Vue

# 06-7-èº«ä»½è®¤è¯

## â˜…æŠŠç™»å½•çŠ¶æ€å­˜å‚¨åˆ° Vuex å®¹å™¨ä¸­

ç›®å‰çš„ç™»å½•åŠŸèƒ½æ¯«æ— æ„ä¹‰ï¼Œæˆ‘ä»¬è¦åšç™»å½•æ˜¯ä¸ºäº†è¿›å…¥åå°é¡µé¢ï¼Œè€Œç°åœ¨å³ä¾¿ä¸ç”¨ç™»å½•ä¹Ÿèƒ½ç›´æ¥è¾“å…¥åœ°å€è¿›å…¥åå°é¡µé¢ -> è¿™æ˜¾ç„¶æ˜¯æœ‰é—®é¢˜çš„

æˆ‘ä»¬è¦åšçš„ï¼šç”¨æˆ·æ²¡æœ‰ç™»å½•æ˜¯ä¸èƒ½è®¿é—®åå°é¡µé¢çš„

![åå°é¡µé¢](assets/img/2021-08-13-10-48-04.png)

æ€è·¯ï¼š

1. ç™»å½•æˆåŠŸï¼Œè®°å½•ç™»å½•çŠ¶æ€ -> çŠ¶æ€éœ€è¦èƒ½å¤Ÿè¢«å…¨å±€è®¿é—®ï¼ˆæ”¾åˆ° Vuex å®¹å™¨ä¸­ï¼‰
  - æ³¨æ„ï¼šè¿™ä¸æ˜¯åƒå…¨å±€å˜é‡ä¸€æ ·å…¨å±€è®¿é—®ï¼Œè€Œæ˜¯è®©è¿™ä¸ªçŠ¶æ€å¯ä»¥åœ¨åº”ç”¨çš„ä»»ä½•æ¨¡å—ã€ä»»ä½•ç»„ä»¶ä¸­èƒ½å¤Ÿè®¿é—®åˆ°è¿™ä¸ªç™»å½•çŠ¶æ€ï¼Œç®€å•æ¥è¯´ï¼Œæ— è®ºæ˜¯åœ¨ç»„ä»¶çš„`index.vue`è¿˜æ˜¯`.ts`æ–‡ä»¶æˆ‘éƒ½èƒ½æ‹¿åˆ°è¿™ä¸ªç™»å½•çŠ¶æ€
2. åœ¨è®¿é—®éœ€è¦ç™»å½•çš„é¡µé¢çš„æ—¶å€™ -> åˆ¤æ–­æœ‰æ²¡æœ‰ç™»å½•çŠ¶æ€ -> åˆ©ç”¨è·¯ç”±çš„æ‹¦æˆªå™¨æ¥åš
  - æœ‰ -> è®©ä½ è¿›æ¥è¿™ä¸ªé¡µé¢
  - æ²¡æœ‰ -> ä¸è®©ä½ è¿›æ¥

æ€ä¹ˆåšï¼Ÿ -> å…ˆæŠŠç¬¬ä¸€æ­¥å¤„ç†å¥½ï¼Œå†æ¥åšç¬¬äºŒæ­¥

1ï¼‰ç™»å½•æˆåŠŸï¼Œè®°å½•ç™»å½•çŠ¶æ€

1. å®šä½åˆ°`store/index.ts`ï¼Œåœ¨`state`é‡Œè¾¹å­˜å‚¨å…¨å±€å…±äº«æ•°æ®`user`ï¼ˆå®ƒå­˜æœ‰ç”¨æˆ· IDã€ç”¨æˆ·æ˜µç§°ã€ç”¨æˆ· token ç­‰è¡¨ç¤ºç”¨æˆ·èº«ä»½çš„ç›¸å…³æ•°æ®ï¼‰ -> é»˜è®¤æ˜¯`null`
2. ä»€ä¹ˆæ—¶å€™è®©`user`æœ‰å€¼ï¼Ÿ -> è®©`user`å€¼ï¼Œæ˜¯`mutation`å¹²çš„æ´»å„¿ -> `payload`è½½è·æ•°æ®ï¼Œå³ç”¨æˆ·ä¼ é€’çš„æ•°æ®ï¼Œç®€å•æ¥è¯´ï¼Œå°±æ˜¯ç”¨æˆ·ä¼ ä»€ä¹ˆ`playload`ï¼Œé‚£ä¹ˆä½ å°±ç»™`user`èµ‹å€¼ä»€ä¹ˆæ•°æ®
   1. æ³¨æ„ï¼šä¼ é€’çš„`content`æ˜¯å­—ç¬¦ä¸²ï¼Œéœ€è¦`JSON.parse`ä¸€ä¸‹
3. ä»€ä¹ˆæ—¶å€™è°ƒç”¨`mutation`ï¼Ÿ -> å½“ç”¨æˆ·ç™»å½•æˆåŠŸä»¥åï¼Œå°±è°ƒç”¨`setUser`æ–¹æ³•
4. é¡µé¢åˆ·æ–°æˆ–å…³é—­å†æ‰“å¼€é¡µé¢ï¼Œå®¹å™¨çŠ¶æ€ä¸è§äº†ï¼Ÿ
   1. å®¹å™¨çš„çŠ¶æ€å®ç°äº†æ•°æ®å…±äº«ï¼Œåœ¨ç»„ä»¶é‡Œé¢è®¿é—®æ–¹ä¾¿ï¼Œä½†æ˜¯æ²¡æœ‰æŒä¹…åŒ–çš„åŠŸèƒ½
5. è®©ç™»å½•çŠ¶æ€è¿™ç§æ•°æ®æŒä¹…åŒ– -> æ”¾åˆ°æœ¬åœ°å­˜å‚¨å½“ä¸­æ¥è¿›è¡ŒæŒä¹…åŒ–ï¼Œè®©æ•°æ®ä¸ä¸¢å¤±
   1. æ³¨æ„ï¼šæœ¬åœ°å­˜å‚¨åªèƒ½å­˜å­—ç¬¦ä¸²

ä½¿ç”¨ï¼š

![ä½¿ç”¨](assets/img/2021-08-13-11-33-16.png)

Vuex æ•°æ®å®¹å™¨ï¼š

![æ•°æ®å®¹å™¨](assets/img/2021-08-13-11-32-02.png)

ğŸ’¡ï¼š`localStorage`ï¼Ÿ

![localStorage](assets/img/2021-08-13-11-24-34.png)

ğŸ’¡ï¼š`JSON.parser('null')`ï¼Ÿ

å¾—åˆ°æ˜¯`null`ï¼Œå®ƒçš„æ•°æ®ç±»å‹æ˜¯`Null`

## â˜…æ ¡éªŒé¡µé¢è®¿é—®æƒé™

> è·¯ç”±æ‹¦æˆªå™¨ç»“åˆ`meta`æ¥åšè®¿é—®é™å®š

è¦åšçš„åŠŸèƒ½ï¼š

- æ ¡éªŒé¡µé¢æ˜¯å¦éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®
  - å¦‚æœéœ€è¦ç™»å½•ï¼Œé‚£å°±æ ¡éªŒé€šè¿‡åæ‰èƒ½è®¿é—®
    - å¦‚æœæ ¡éªŒä¸é€šè¿‡ï¼Œé‚£å°±è¿”å›ç™»å½•é¡µé¢

ä½¿ç”¨è·¯ç”±æ‹¦æˆªå™¨å®ç°è¿™ä¸ªåŠŸèƒ½

æ–‡æ¡£ï¼š[å¯¼èˆªå®ˆå« - å…¨å±€å‰ç½®å®ˆå« - Vue Router](https://router.vuejs.org/zh/guide/advanced/navigation-guards.html#%E5%85%A8%E5%B1%80%E5%89%8D%E7%BD%AE%E5%AE%88%E5%8D%AB)

åœ¨æ•´ä¸ªå¯¼èˆªæµç¨‹é‡Œè¾¹ä¼šè§¦å‘å¾ˆå¤šé’©å­ï¼Œæˆ‘ä»¬è¦åšçš„è·¯ç”±æ‹¦æˆªå™¨ï¼Œå°±éœ€è¦ç”¨åˆ°`router.beforeEach()`è¿™ä¸ªé’©å­

1ï¼‰`router.beforeEach()`

æµ‹è¯•ä»£ç ï¼š

``` js
// router/index.ts

// å…¨å±€å‰ç½®å®ˆå«ï¼šä»»ä½•é¡µé¢çš„è®¿é—®éƒ½è¦ç»è¿‡è¿™é‡Œ
// toï¼šè¦å»å“ªé‡Œçš„è·¯ç”±ä¿¡æ¯
// fromï¼šä»å“ªé‡Œæ¥çš„è·¯ç”±ä¿¡æ¯
// nextï¼šé€šè¡Œçš„æ ‡å¿—
router.beforeEach((to, from, next) => {
  console.log('è¿›å…¥äº†è·¯ç”±å…¨å±€å®ˆå«')
  console.log('to => ', to)
  console.log('from => ', from)
})
```

æµ‹è¯•æ•ˆæœï¼š

![è·¯ç”±æ‹¦æˆªå™¨](assets/img/2021-08-13-16-59-53.png)

æˆ‘ä»¬æ˜¯ç›´æ¥ä»åœ°å€æ è¾“å…¥åœ°å€è®¿é—®`user`é¡µé¢çš„ï¼Œæ‰€ä»¥å®ƒçš„`from`è·¯ç”±ä¿¡æ¯æ˜¯`null`æˆ–ç€è¯´æ˜¯ä»æ ¹è·¯å¾„`/`è¿›å…¥`user`é¡µé¢çš„ï¼ˆé»˜è®¤æ˜¯è¿™ä¸ªï¼‰

ä¸ºäº†æ›´å¥½åœ°æµ‹è¯•`from`æ•ˆæœï¼Œæˆ‘ä»¬æ·»åŠ äº†`next`ï¼š

``` js
router.beforeEach((to, from, next) => {
  console.log('è¿›å…¥äº†è·¯ç”±å…¨å±€å®ˆå«')
  console.log('to => ', to)
  console.log('from => ', from)
  // è·¯ç”±å®ˆå«ä¸­ä¸€å®šè¦è°ƒç”¨ nextï¼Œå¦åˆ™é¡µé¢æ— æ³•å±•ç¤º
  next()
})
```

![next](assets/img/2021-08-13-17-09-11.png)

å½“ä½ ç‚¹å‡»è·³è½¬ï¼Œä¹Ÿå°±æ˜¯è®¿é—®å…¶å®ƒè·¯ç”±é¡µé¢ï¼Œé‚£ä¹ˆä½ èƒ½å¦æ­£å¸¸è·³è¿‡å»å‘¢ï¼Ÿä¹Ÿå°±æ˜¯èƒ½å¦`next`è¿‡å»ï¼Ÿ

å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦åˆ¤æ–­èƒ½å¦è·³è¿‡å»ï¼Ÿ

ğŸ’¡ï¼šç¬¬ä¸€ç§åšæ³•

``` js
if (to.path !== '/login') {
  // æ ¡éªŒç™»å½•çŠ¶æ€
}
```

è¿™ç§åšæ³•å¾ˆä¸çµæ´»ï¼Œå› ä¸ºå®ƒæŠŠæ‰€æœ‰ä¸æ˜¯`login`çš„é¡µé¢éƒ½ç»™æ ¡éªŒä¸€ç•ªäº†â€¦â€¦ -> è¿™æ ·åšå¡çš„æ­»æ­»çš„ï¼Œä¸çµæ´»

ğŸ’¡ï¼šç¬¬äºŒç§åšæ³•

ä½¿ç”¨`meta`å…ƒä¿¡æ¯ï¼Œä¸ºè·¯ç”±è‡ªå®šä¹‰ä¸€äº›æ•°æ®ï¼Œä»¥æ­¤æ¥åšé€»è¾‘å¤„ç† -> ç›¸å½“äºæ˜¯ä¸€ä¸ª**æ ¡éªŒæ ‡å¿—**

å“ªä¸ªè·¯ç”±éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®ï¼Œé‚£ä¹ˆä½ å°±ä¸ºå“ªä¸ªè·¯ç”±æ·»åŠ `meta`ï¼ˆ**è¿™æ˜¯ä¸€ç§æ›´çµæ´»çš„é…ç½®**ï¼‰ï¼š

``` js
{
  path: '/user',
  name: 'user',
  component: () => import(/* webpackChunkName: 'user' */ '@/views/user/index.vue')
  meta: {
    requiresAuth: true // è‡ªå®šä¹‰æ•°æ®
  } // meta é»˜è®¤å°±æ˜¯ä¸€ä¸ªç©ºå¯¹è±¡
}
```

`meta`çš„å€¼åœ¨`to`é‡Œè¾¹å°±å¯ä»¥è·å–åˆ°ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±èƒ½å¾ˆçµæ´»çš„é…ç½®å“ªäº›è·¯ç”±éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®äº†ï¼ -> æœ‰`requiresAuth: true`æ„å‘³ç€è¯¥è·¯ç”±éœ€è¦ç™»å½•æ‰èƒ½è®¿é—®ï¼Œæ²¡æœ‰ï¼ˆ`404`é¡µé¢ï¼‰ï¼Œåˆ™ä¸éœ€è¦ç™»å½•ï¼Œå¯ä»¥ç›´æ¥è®¿é—®

æ›´å¼ºåˆ¶çš„æ·»åŠ `meta`ï¼šä¸éœ€è¦æ¯ä¸€ä¸ªå­è·¯ç”±éƒ½æ·»åŠ `requiresAuth: true`ï¼Œæˆ‘ä»¬åªè¦å¯¹çˆ¶è·¯ç”±æ·»åŠ å°±å¥½äº†

![ä¼˜åŒ–](assets/img/2021-08-13-17-36-51.png)

---

ğŸ’¡ï¼šåœ¨è·¯ç”±è·³è½¬å‰çš„é€»è¾‘å¤„ç†ä»£ç ï¼Ÿ

![beforeEach](assets/img/2021-08-13-17-41-51.png)

## â˜…æµ‹è¯•è·å–å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯æ¥å£

![ç”¨æˆ·ä¿¡æ¯](assets/img/2021-08-13-19-43-57.png)

å…ˆå®Œæˆã€Œå±•ç¤ºå½“å‰ç”¨æˆ·ç™»å½•ä¿¡æ¯ã€è¿™ä¸ªåŠŸèƒ½

è¿™ä¸ªåŠŸèƒ½çš„å®ç°æ€è·¯ï¼š

1. æ‰¾åˆ°æ•°æ®æ¥å£
2. å‘é€è¯·æ±‚æ‹¿åˆ°æ•°æ®
3. ç»‘å®šæ•°æ®å±•ç¤ºåˆ°é¡µé¢ä¸­å»

ğŸ’¡ï¼šç”¨æˆ·æ¥å£â€”â€”ç”¨æˆ·åŸºæœ¬ä¿¡æ¯ï¼Ÿ

æ–‡æ¡£ï¼š[edu-front-boot API Documents](http://113.31.105.128/front/doc.html#/edu-front-boot/%E7%94%A8%E6%88%B7%E6%8E%A5%E5%8F%A3/getInfoUsingGET)

æµ‹è¯•æ¥å£ï¼š

> éœ€è¦èº«ä»½æ ‡è¯†`token`ï¼ˆè¯·æ±‚ç±»å‹æ˜¯`header`ï¼Œæ„å‘³ç€è¦æŠŠ`token`å†™åœ¨è¯·æ±‚å¤´`Authorization`ï¼‰ï¼Œç±»ä¼¼ä½ è¦æœ‰ä¼šå‘˜å¡æ‰èƒ½åˆ°è¿™ä¸ªåº—æ¶ˆè´¹

![æ¥å£æµ‹è¯•](assets/img/2021-08-13-19-57-56.png)

ä¹‹åå¾ˆå¤šçš„æ¥å£éƒ½éœ€è¦æä¾›ç”¨æˆ·çš„èº«ä»½ï¼Œä¹Ÿå°±æ˜¯`token`ï¼Œä¸ç„¶ï¼Œè¿™æ¥å£å°±æ‹¿ä¸åˆ°æˆ‘ä»¬æ‰€æœŸæœ›çš„æ•°æ®äº†

æ‰€æœ‰æµ‹è¯•æ¥å£éƒ½è‡ªåŠ¨è®¾ç½®`Authorization`ï¼š

![Authorization](assets/img/2021-08-13-20-03-40.png)

> `Ctrl + s`ä¿å­˜

![ä¸å†™ Authorization ](assets/img/2021-08-13-20-06-03.png)

## â˜…ç™»å½•æˆåŠŸè·³è½¬å›åŸæ¥é¡µé¢



