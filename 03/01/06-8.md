### âœï¸ Tangxt â³ 2021-08-16 ğŸ·ï¸ Vue

# 06-8-èº«ä»½è®¤è¯-å¤„ç† Token è¿‡æœŸ-æ¦‚å¿µä»‹ç»ã€åˆ†æå“åº”æ‹¦æˆªå™¨ã€axios é”™è¯¯å¤„ç†ã€é”™è¯¯æ¶ˆæ¯æç¤º

## â˜…æ¦‚å¿µä»‹ç»

é—®é¢˜ï¼šå…³äº Token è¿‡æœŸ

ç”¨æˆ·ç™»å½•æˆåŠŸè¿‡åï¼Œæˆ‘ä»¬æ”¶åˆ°äº†è¿™ä¹ˆä¸€ä¸ªå¯¹è±¡ï¼š

![user](assets/img/2021-09-03-13-44-57.png)

è¿™ä¸ªæ•°æ®å¯¹è±¡é‡Œè¾¹æœ‰ä¸€ä¸ª`access_token`å±æ€§ï¼Œæˆ‘ä»¬é€è¿‡è¿™ä¸ªå±æ€§å»è¯·æ±‚éœ€è¦æˆæƒçš„æ¥å£ï¼Œè¿™æ ·æ‰èƒ½æ‹¿åˆ°å¯¹åº”çš„æ•°æ® -> å®ƒè¡¨ç¤ºç”¨æˆ·çš„èº«ä»½

ç„¶è€Œï¼Œè¿™ä¸ª`token`å®ƒæ˜¯æœ‰è¿‡æœŸæ—¶é—´çš„ï¼Œæ³¨æ„ï¼Œè¿™ä¸ªè¿‡æœŸæ—¶é—´æ˜¯åç«¯è®¾ç½®çš„ï¼Œè€Œå‰ç«¯æ˜¯è®¾ç½®ä¸äº†çš„

åœ¨è¿™é‡Œåç«¯é»˜è®¤è®¾ç½®çš„è¿‡æœŸæ—¶é—´æ˜¯`24`ä¸ªå°æ—¶ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œä¸€å¤©ä»¥åä½ è¿™ä¸ª`token`å°±è¿‡æœŸäº†ï¼Œè€Œè¿™æ„å‘³ç€`token`æ— æ•ˆäº†ï¼Œä½ ä¹Ÿå°±æ— æ³•åˆ©ç”¨è¿™ä¸ª`token`æ¥è·å–æ•°æ®äº†

> æˆ‘æµ‹è¯•äº†ä¸€ä¸‹ -> `express_in`çš„å€¼æ˜¯éšæœºçš„ï¼ˆé‡æ–°ç™»å½•å±…ç„¶å˜æˆäº†`6205`ï¼‰ï¼Œæˆ‘ä¹Ÿä¸å¤ªç¡®å®šå®ƒçš„å•ä½æ˜¯ä¸æ˜¯`s`ï¼ˆæˆ–è®¸æ˜¯å§ï¼Œå¦‚æœæ˜¯ï¼Œé‚£å°±æ˜¯`1.5~2`å°æ—¶äº†ï¼‰ï¼Œå½“ç„¶ï¼Œæˆ‘åªéœ€è¦çŸ¥é“`token`æ˜¯ä¼šå¤±æ•ˆçš„å°±å¥½äº†ï¼Œè€Œä¸”è¿™ä¸ªæ—¶é—´æ˜¯æ¯”è¾ƒçŸ­çš„ï¼

å¦‚æœä½ éå¾—ç”¨è¿™å·²ç»è¿‡æœŸçš„`token`å»è¯·æ±‚ï¼Œé‚£ä¹ˆå°±ä¼šå¾—åˆ°ä¸€ä¸ª`401`çš„å“åº”ï¼ˆæ— ä¹±æ˜¯`token`è¿‡æœŸï¼Œè¿˜æ˜¯éªŒè¯å¤±è´¥éƒ½ä¼šè¿”å›`401`ï¼‰

æµ‹è¯•`token`è¿‡æœŸ -> æ— é¡»ç­‰`24`å°æ—¶ï¼Œç›´æ¥ä¿®æ”¹æœ¬åœ°å­˜å‚¨çš„`token`å°±å¥½äº†

![ä¿®æ”¹ token](assets/img/2021-09-03-13-52-38.png)

æ•ˆæœï¼š

![token æ— æ•ˆ](assets/img/2021-09-03-13-55-00.png)

æ— æ•ˆçš„`token`æˆ–è¿‡æœŸçš„`token`éƒ½ä¼šå—åˆ°`401`å“åº”

![çŠ¶æ€ç ](assets/img/2021-09-03-13-56-59.png)

æ‰€ä»¥åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯¥å’‹åŠå‘¢ï¼Ÿ

æœ€ç®€å•çš„å¤„ç†æ–¹å¼å°±æ˜¯ -> é‡åˆ°`401`è®©ç”¨æˆ·é‡æ–°ç™»å½•ä¸€ä¸‹å‘—ï¼

è¿™æ ·åšæ˜¯å¯ä»¥çš„ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬æ˜¯è®¾ç½®äº†`24`å°æ—¶çš„è¿‡æœŸæ—¶é—´ -> ä½†æ˜¯ï¼Œæœ‰äº›ç½‘ç«™ï¼Œå®ƒæ˜¯`3`åˆ†é’Ÿã€`5`åˆ†é’Ÿã€`10`åˆ†é’Ÿè¿™æ ·`token`å°±è¿‡æœŸäº†ï¼Œè¿‡æœŸäº†å°±å«ç”¨æˆ·ç™»å½•ï¼Œè¿™æ ·ä¼š**è®©ç”¨æˆ·é¢‘ç¹ç™»å½•**çš„ï¼Œè€Œè¿™æ˜¾ç„¶ç”¨æˆ·ä½“éªŒå¾ˆä¸å¥½ï¼

ğŸ’¡ï¼šèƒ½ä¸èƒ½åœ¨`token`è¿‡æœŸåï¼Œç”¨æˆ·ä¸ç”¨é‡æ–°ç™»å½•ï¼Œä¹Ÿèƒ½è§£å†³`token`è¿‡æœŸçš„é—®é¢˜å‘¢ï¼Ÿ

ğŸ’¡ï¼š`access_token`ã€`expires_in`ã€`refresh_token`çš„ä½œç”¨ï¼Ÿ

1. è·å–éœ€è¦æˆæƒçš„æ¥å£æ•°æ®
2. è®¾ç½®`access_token`çš„è¿‡æœŸæ—¶é—´
3. åˆ·æ–°è·å–æ–°çš„`access_token`

ğŸ’¡ï¼šä¸ºä»€ä¹ˆ`access_token`è¦æœ‰è¿‡æœŸæ—¶é—´ä»¥åŠä¸ºå•¥è¦æŠŠå®ƒè®¾ç½®çš„æ¯”è¾ƒçŸ­ï¼Ÿ

ä¸ºäº†å®‰å…¨ -> å®ƒä»£è¡¨ç€ç”¨æˆ·çš„èº«ä»½ï¼Œä¸€æ—¦è¿™ä¸ªèº«ä»½æ ‡è¯†é­åˆ°äº†æ³„æ¼ï¼Œé‚£ä¸æ€€å¥½æ„çš„äººå°±å¯ä»¥æ‹¿è¿™ä¸ª`access_token`æ¥å†’å……ç”¨æˆ·çš„èº«ä»½æ¥è¿›è¡Œä¸€äº›æ“ä½œäº†

è®¾ç½®è¿‡æœŸæ—¶é—´ä»¥åŠè®¾ç½®å¾—æ¯”è¾ƒçŸ­ï¼Œå¯ä»¥é™ä½é£é™©

ğŸ’¡ï¼šç”¨æˆ·åœ¨è®¿é—®ç½‘ç«™æœŸé—´ï¼Œ`access_token`è¿‡æœŸäº†ï¼Ÿ

åˆ©ç”¨`refresh_token`æ¥åˆ·æ–°è·å–ä¸€ä¸ªæ–°çš„`access_token`ï¼Œè€Œæ—§çš„è¿‡æœŸçš„`token`ä¹Ÿå°±æ²¡å•¥ç”¨äº†

è·å–äº†æ–°çš„`token`ï¼Œå°±å¯ä»¥è¿›è¡Œåç»­çš„æ“ä½œäº†

ğŸ’¡ï¼šè·å–æ–°`access_token`çš„å¤„ç†æµç¨‹ï¼Ÿ

æœ‰ä¸¤ç§å§¿åŠ¿ï¼š

1. åœ¨è¯·æ±‚å‘èµ·å‰æ‹¦æˆªæ¯ä¸ªè¯·æ±‚ï¼Œåˆ¤æ–­`token`çš„æœ‰æ•ˆæ—¶é—´æ˜¯å¦å·²ç»è¿‡æœŸäº†ï¼Œè‹¥å·²è¿‡æœŸï¼Œåˆ™å°†è¯·æ±‚æŒ‚èµ·ï¼Œå…ˆåˆ·æ–°`token`åå†ç»§ç»­è¯·æ±‚
   1. åšæ³•ï¼š`axios`æ‹¦æˆªå™¨ã€`express_in`ã€`refresh_token`
2. ä¸åœ¨è¯·æ±‚å‰æ‹¦æˆªï¼Œè€Œæ˜¯æ‹¦æˆªè¿”å›åçš„æ•°æ®ã€‚å…ˆå‘èµ·è¯·æ±‚ï¼Œæ¥å£è¿”å›è¿‡æœŸåï¼Œå…ˆåˆ·æ–°`token`ï¼Œå†è¿›è¡Œä¸€æ¬¡é‡è¯•
   1. åšæ³•ï¼šè¿‡æœŸçš„è¯ï¼Œåç«¯ä¼šè¿”å›`401`ï¼Œåˆ¤æ–­è¿™ä¸ªç ï¼Œç„¶åå†`refresh_token`

é€‰æ‹©å“ªç§æ–¹å¼å‘¢ï¼Ÿ

å§¿åŠ¿ä¸€ï¼š

- ä¼˜ç‚¹ï¼šåœ¨è¯·æ±‚å‰æ‹¦æˆªï¼Œèƒ½èŠ‚çœè¯·æ±‚ã€çœæµé‡
- ç¼ºç‚¹ï¼šéœ€è¦åç«¯é¢å¤–æä¾›ä¸€ä¸ª`token`è¿‡æœŸæ—¶é—´çš„å­—æ®µï¼Œä½¿ç”¨äº†æœ¬åœ°æ—¶é—´åˆ¤æ–­ï¼Œè‹¥æœ¬åœ°æ—¶é—´è¢«ç¯¡æ”¹ï¼Œç‰¹åˆ«æ˜¯æœ¬åœ°æ—¶é—´æ¯”æœåŠ¡å™¨æ—¶é—´æ…¢æ—¶ï¼Œæ‹¦æˆªå°±ä¼šå¤±è´¥

å§¿åŠ¿äºŒï¼š

- ä¼˜ç‚¹ï¼šä¸éœ€é¢å¤–çš„`token`è¿‡æœŸå­—æ®µï¼Œä¸éœ€åˆ¤æ–­æ—¶é—´
- ç¼ºç‚¹ï¼šä¼šæ¶ˆè€—å¤šä¸€æ¬¡è¯·æ±‚ï¼Œè€—æµé‡

ä¸ç®¡è¿‡æœŸä¸å¦ï¼Œå…ˆè¯•ä¸€ä¸‹å‘—ï¼ä¸è¡Œï¼Œé‚£å°±`refresh`ä¸€ä¸‹å†æå‘—ï¼

---

æ‰€ä»¥é€‰æ‹©å“ªç§ï¼Ÿ

æˆ‘ä»¬ä»ä¸­å¯ä»¥çœ‹åˆ°ï¼Œå§¿åŠ¿ä¸€ã€äºŒçš„ä¼˜ç¼ºç‚¹éƒ½æ˜¯äº’è¡¥çš„ï¼Œå§¿åŠ¿ä¸€æœ‰æ ¡éªŒå¤±è´¥çš„é£é™©ï¼ˆæœ¬åœ°æ—¶é—´è¢«ç¯¡æ”¹æ—¶ï¼Œå½“ç„¶ï¼Œä¸€èˆ¬æ²¡æœ‰ç”¨æˆ·é—²çš„è›‹ç–¼çš„å»æ”¹æœ¬åœ°æ—¶é—´ï¼‰ï¼Œå§¿åŠ¿äºŒæ›´ç®€å•ç²—æš´ï¼Œç­‰çŸ¥é“æœåŠ¡å™¨å·²ç»è¿‡æœŸäº†å†é‡è¯•ä¸€æ¬¡ï¼Œåªæ˜¯ä¼šè€—å¤šä¸€ä¸ªè¯·æ±‚ï¼Œå…¶å®è¿™ä¸ªæµé‡å¯ä»¥å¿½ç•¥ä¸è®¡

**é€‰æ‹©å§¿åŠ¿äºŒæ¥å¤„ç†åˆ·æ–°`token`çš„æ“ä½œ** -> æ¨èè¿™ç§åšæ³•ï¼Œå› ä¸ºå®ƒæ˜¯ç»å¯¹æ²¡æœ‰é—®é¢˜çš„ï¼Œå½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥ç§ä¸‹å°è¯•ä¸€ä¸‹å§¿åŠ¿ä¸€çš„åšæ³•ï¼

---

ä»¥ä¸Šå°±æ˜¯å…³äº`token`è¿‡æœŸçš„ä¸€ä¸ªåŸºæœ¬é€»è¾‘äº†ï¼

## â˜…åˆ†æå“åº”æ‹¦æˆªå™¨

> å¦‚ä½•ç”¨å§¿åŠ¿äºŒå¤„ç†`token`è¿‡æœŸé—®é¢˜ï¼Ÿ

ç”±äºæ¯ä¸€ä¸ªéœ€è¦æˆæƒçš„æ¥å£ -> å®ƒéƒ½å¯èƒ½ä¼šè¿”å›`401`ï¼ˆ`token`è¿‡æœŸçš„ç¼˜æ•…ï¼‰

æ‰€ä»¥æˆ‘ä»¬åœ¨è¿™é‡Œæœ€å¥½æ˜¯é€šè¿‡æ‹¦æˆªå™¨æ¥å¯¹è¿™äº›æ¥å£è¿›è¡Œç»Ÿä¸€å¤„ç†

å®šä½åˆ°`utils/request.ts`ï¼Œæ·»åŠ ä¸€ä¸ªã€Œå“åº”æ‹¦æˆªå™¨ã€

å¦‚ä½•æ·»åŠ å‘¢ï¼Ÿ -> æŸ¥çœ‹`axios`[æ–‡æ¡£](https://github.com/axios/axios#interceptors) å‘—ï¼

![å“åº”æ‹¦æˆªå™¨](assets/img/2021-09-03-19-17-21.png)

CRM å¤§æ³• -> æ‹·è´åï¼š

1. æ ¼å¼å¤„ç†ï¼Œå»æ‰åˆ†å·ï¼Œæ— ç”¨æ³¨é‡Š
2. æŠŠ`axios`æ”¹ä¸ºæˆ‘ä»¬åˆ›å»ºçš„`axios`å®ä¾‹`request`

![ä»£ç ](assets/img/2021-09-03-20-13-37.png)

ğŸ’¡ï¼šå“åº”æ‹¦æˆªå™¨çš„æ„ä¹‰ï¼Ÿ

- é¡¾åæ€ä¹‰ -> æ”¶åˆ°å“åº”åä¼˜å…ˆè¿›å…¥è¿™ä¸ªæ‹¦æˆªå™¨ï¼Œç»è¿‡æ‹¦æˆªå™¨åï¼Œæ‰ä¼šçœŸæ­£èµ°åˆ°å‘è¯·æ±‚çš„é‚£ä¸ªå“åº”é‡Œè¾¹ -> å°±æ˜¯è¿™ä¹ˆä¸€ä¸ªæµç¨‹å“ˆï¼

ğŸ’¡ï¼šè¿™`use`æ–¹æ³•æœ‰ä¸¤ä¸ªå‡½æ•°ï¼Œå®ƒä»¬çš„ä½œç”¨éƒ½æ˜¯å•¥ï¼Ÿ

æ³¨é‡Šå·²ç»è¯´å¾—å¾ˆæ¸…æ¥šäº†

- æ‰€æœ‰ HTTP çŠ¶æ€ç ä¸º `2xx` éƒ½ä¼šè¿›å…¥ç¬¬ä¸€ä¸ªå‡½æ•°`onFulfilled`
- è€Œå‡º `2xx` çŠ¶æ€ç éƒ½éƒ½æ‰§è¡Œç¬¬äºŒä¸ªå‡½æ•°`onRejected`

è¯´ç™½äº†ï¼Œå“åº”æˆåŠŸèµ°ç¬¬ä¸€ä¸ªï¼Œå“åº”å¤±è´¥èµ°ç¬¬äºŒä¸ªå‘—ï¼

è¯è¯´ï¼Œè¯·æ±‚å“åº”æˆåŠŸï¼Œä¼ ç»™ç¬¬ä¸€ä¸ªå‡½æ•°çš„å‚æ•°`response`æ˜¯å•¥ï¼Ÿ

![response](assets/img/2021-09-03-19-31-13.png)

åªè¦æœ‰è¯·æ±‚å°±ä¼šæœ‰å“åº”ï¼Œæœ‰å“åº”å°±ä¼šè¿›å…¥åˆ°è¿™ä¸ªå“åº”æ‹¦æˆªå™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¼šçœ‹åˆ°ä»£ç çš„æ‰§è¡Œä¼šç»è¿‡è¿™ä¸ªæ‹¦æˆªå™¨

`response`çš„å†…å®¹ï¼š

- `data`æ˜¯æˆ‘ä»¬çœŸæ­£è·å–çš„æ•°æ®
- `config`æ˜¯è¯·æ±‚çš„é…ç½®å¯¹è±¡ï¼Œå¦‚è¯·æ±‚åœ°å€æ˜¯å•¥ï¼Œè¯·æ±‚æ–¹æ³•æ˜¯å•¥ï¼Œè¯·æ±‚å¤´æ˜¯å•¥ï¼Œè¯·æ±‚å‚æ•°åˆæ˜¯å•¥ç­‰â€¦â€¦
- `headers`åˆ™æ˜¯å“åº”å¤´
- `status`å“åº”çŠ¶æ€ç 
- `statusText`ä¸çŠ¶æ€ç ç›¸å¯¹åº”çš„çŠ¶æ€ä¿¡æ¯ï¼Œå¦‚`200`å°±æ˜¯`OK`

æ¼”ç¤ºèµ°å¤±è´¥çš„å›è°ƒ -> åœ¨`localStorage`é‡Œè¾¹æŠŠ`access_token`æ”¹ä¸ºæ— æ•ˆçš„ç„¶ååˆ·æ–°é¡µé¢å°±å¥½äº†

![error](assets/img/2021-09-03-19-43-42.png)

è¿”å›çš„æ˜¯`401` -> è¶…å‡º`2xx`èŒƒå›´ï¼Œæ‰€ä»¥ä¼šèµ°å¤±è´¥å›è°ƒ

è¿™ä¸ª`error`å¯¹è±¡é‡Œè¾¹éƒ½æ˜¯æœ¬æ¬¡è¯·æ±‚å¤±è´¥ç›¸å…³çš„é”™è¯¯å¯¹è±¡

- `config`ï¼šæœ¬æ¬¡å¤±è´¥çš„è¯·æ±‚é…ç½®å¯¹è±¡
- `isAxiosError`ï¼šä¸º`true`ï¼Œè¿™æ˜¯ä¸€ä¸ª`Axios`é”™è¯¯
- `request`ï¼šå‘è¯·æ±‚çš„å¯¹è±¡`XMLHttpRequest`
- `response`ï¼šæœ¬æ¬¡è¯·æ±‚çš„å“åº”å¯¹è±¡ -> å¾ˆæ˜æ˜¾å“åº”æ˜¯å¤±è´¥çš„ï¼Œæ‰€ä»¥ä¼šæœ‰`401`ã€`"Unauthorized"`ç­‰ä¿¡æ¯
- `message`ï¼šé”™è¯¯æ¶ˆæ¯ -> `Promise`æŠ›å‡ºçš„é”™è¯¯ä¿¡æ¯æç¤º
- `stack`ï¼šå­é”™è¯¯å †æ ˆ

ğŸ’¡ï¼šåœ¨å®é™…å¼€å‘ä¸­ï¼Œåç«¯è¿”å›çš„é”™è¯¯çŠ¶æ€ç æœ‰çš„æ˜¯ç”¨è‡ªå®šä¹‰é”™è¯¯çŠ¶æ€ç ï¼Œä¹Ÿå°±æ˜¯æŠŠä»»ä½•è¯·æ±‚éƒ½å½“æˆæ˜¯æˆåŠŸçš„ï¼Œé€šè¿‡åœ¨å“åº”ä½“æ•°æ®é‡Œè¾¹æ”¾ä¸€äº›è‡ªå®šä¹‰çŠ¶æ€ç ç»™å®¢æˆ·ç«¯å»ä½¿ç”¨ç„¶åè¿›è¡Œåˆ¤æ–­

é¢å¯¹è¿™ç§æƒ…å†µï¼Œåœ¨ç¬¬ä¸€ä¸ªå›è°ƒé‡Œè¾¹ï¼Œä½ å°±å¾—æ ¹æ®è‡ªå®šä¹‰é”™è¯¯çŠ¶æ€ç å»ä½œå‡ºç›¸åº”çš„é”™è¯¯å¤„ç†

æ€»ä¹‹ï¼ŒæˆåŠŸ/å¤±è´¥ä¸æ˜¯ç»å¯¹çš„æ”¾åœ¨ç¬¬ä¸€ä¸ª/ç¬¬äºŒä¸ªè¿™æ ·å»å¤„ç†çš„ï¼Œä½ å¾—æ ¹æ®é¡¹ç›®çš„æ¥å£æƒ…å†µæ¥è¿›è¡Œå¤„ç†ï¼

ç®€è€Œè¨€ä¹‹ï¼Œé¡¹ç›®æ¥å£ç”¨çš„æ˜¯ HTTP çŠ¶æ€ç ï¼Œé‚£é”™è¯¯å¤„ç†å°±å†™åˆ°å¤±è´¥å›è°ƒ

åœ¨ä¸Šè¾¹çš„`log`é‡Œè¾¹ï¼Œå¯ä»¥çœ‹åˆ°`getInfo`è¿™ä¸ªæ¥å£ç”¨çš„æ˜¯ HTTP çŠ¶æ€ç çš„ï¼ï¼ˆä¹‹å‰çš„ç”¨æˆ·ç™»å½•æ¥å£ï¼Œåƒéæ³•çš„æ‰‹æœºåç­‰ç”¨æ˜¯`2xx`è‡ªå®šä¹‰çŠ¶æ€ç ï¼‰

## â˜…`axios`é”™è¯¯å¤„ç†

> æŠŠ HTTP ç›¸å…³çš„å…¬å…±é”™è¯¯å¤„ç†æ‰”åˆ°å¤±è´¥å›è°ƒé‡Œè¾¹å»

æ€ä¹ˆåšå‘¢ï¼Ÿ -> è¿˜æ˜¯çœ‹æ–‡æ¡£çš„å¤„ç†é”™è¯¯ç¤ºä¾‹

![é”™è¯¯å¤„ç†](assets/img/2021-09-03-20-52-10.png)

æŠŠè¿™åˆ¤æ–­æ‰”åˆ°é”™è¯¯å›è°ƒé‡Œè¾¹å»ï¼Œä½ å¯ä»¥åˆ°å®ƒæœ‰ä¸‰ç§ä¸åŒçš„æƒ…å†µï¼š

1. è¯·æ±‚å‘å‡ºå»æ”¶åˆ°å“åº”äº†ï¼Œä½†æ˜¯çŠ¶æ€ç è¶…å‡ºäº† `2xx` èŒƒå›´ -> æ‹¿åˆ°æœ¬æ¬¡å“åº”çš„ã€Œå“åº”æ•°æ®ã€å“åº”çŠ¶æ€ç ã€å“åº”å¤´ã€
2. è¯·æ±‚å‘å‡ºå»æ²¡æœ‰æ”¶åˆ°å“åº” -> å¦‚æœ`error.response`ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆçœ‹çœ‹`error.request`æ˜¯å¦å­˜åœ¨ï¼Ÿ -> è¯·æ±‚è¶…æ—¶ã€ç½‘ç»œæ–­å¼€ä¼šå‡ºç°è¿™ç§æƒ…å†µ
3. åœ¨è®¾ç½®è¯·æ±‚æ—¶å‘ç”Ÿäº†ä¸€äº›äº‹æƒ…ï¼Œè§¦å‘äº†ä¸€ä¸ªé”™è¯¯ -> è¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯æœªçŸ¥çš„ï¼Œæ‰€ä»¥ç›´æ¥ç»™ä¸ªæ¶ˆæ¯æç¤ºæ¡†å°±å¥½äº†

![ä¸‰ç§é”™è¯¯æƒ…å†µ](assets/img/2021-09-03-21-00-26.png)

é’ˆå¯¹è¿™ä¸‰ç§æƒ…å†µï¼Œæˆ‘ä»¬åˆ†åˆ«å¯¹è¿™ä¸ª`error`è¿›è¡Œå¤„ç†

![é”™è¯¯æƒ…å†µ](assets/img/2021-09-03-21-15-42.png)

ğŸ’¡ï¼šè¿™ä¸ªé”™è¯¯å›è°ƒçš„è¿”å›å€¼`return Promise.reject(error)`ï¼Ÿ

è¿™æ˜¯åœ¨æŠŠè¯·æ±‚å¤±è´¥çš„é”™è¯¯å¯¹è±¡ç»§ç»­æŠ›å‡ºï¼Œæ‰”ç»™ä¸Šä¸€ä¸ªè°ƒç”¨è€…ï¼Œä¹Ÿå°±æ˜¯çœŸæ­£å‘è¯·æ±‚çš„é‚£ä¸ªåœ°æ–¹è¿˜æƒ³æ‹¿åˆ°è¿™ä¸ªé”™è¯¯ä¿¡æ¯

![catch error message](assets/img/2021-09-04-08-17-56.png)

å½“ç„¶ï¼Œè¿™æ˜¯é»˜è®¤å†™å¥½çš„ç¤ºä¾‹ä»£ç 

--- 

ä»å®˜æ–¹æ–‡æ¡£æ‹¿åˆ°åŸºæœ¬çš„é”™è¯¯é€»è¾‘åˆ¤æ–­åï¼Œé‚£æˆ‘ä»¬ä¸‹ä¸€æ­¥è¯¥åœ¨`if...else`çš„`{}`é‡Œè¾¹åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ

## â˜…é”™è¯¯æ¶ˆå¤±æç¤º

å¤„ç†å¤±è´¥å›è°ƒé‡Œè¾¹`if...else`çš„`{}`é€»è¾‘ï¼Œå…ˆä»ç®€å•çš„å¼€å§‹å¤„ç†

![é”™è¯¯å›è°ƒ](assets/img/2021-09-04-08-29-53.png)

`error.response`ä¸º`true`çš„å¤„ç†é€»è¾‘å°±æ¯”è¾ƒå¤šäº†ï¼Œå¸¸è§çš„ HTTP ç›¸å…³é”™è¯¯å¦‚`400ã€401ã€403ã€404ã€500`ï¼Œæ³¨æ„ï¼Œè¿™ä¸æ˜¯ä¹±å†™çš„ï¼Œè€Œæ˜¯åç«¯ä¸å‰ç«¯çº¦å®šå¥½çš„ï¼ˆä¹Ÿæ˜¯å®˜æ–¹çº¦å®šçš„ï¼‰ï¼š

![HTTP çŠ¶æ€ç ](assets/img/2021-09-04-08-35-06.png)

æ ¹æ®ä¸åŒçš„é”™è¯¯ï¼Œç»™å‡ºä¸åŒçš„æ¶ˆæ¯æç¤º -> è®©ç”¨æˆ·çŸ¥é“æˆ‘ç°åœ¨åˆ°åº•æ€ä¹ˆäº†ï¼Œç„¶åæˆ‘åº”è¯¥æ€ä¹ˆåšï¼Ÿ

![å“åº”é”™è¯¯å¤„ç†](assets/img/2021-09-04-08-47-20.png)

> 400 Bad Request -> æŒ‡å‡ºæœåŠ¡å™¨ä¸èƒ½æˆ–ä¸ä¼šå¤„ç†è¯·æ±‚ï¼Œå› ä¸ºå®ƒè¢«è®¤ä¸ºæ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯é”™è¯¯ï¼ˆä¾‹å¦‚ï¼Œé”™è¯¯çš„è¯·æ±‚è¯­æ³•ï¼Œæ— æ•ˆçš„è¯·æ±‚æ¶ˆæ¯æ„é€ ã€Œ invalid request message framingã€ï¼Œæˆ–æ¬ºéª—æ€§çš„è¯·æ±‚è·¯ç”±ï¼‰ã€‚

ğŸ’¡ï¼šå•ç‹¬åŠ è½½ä¸€ä¸ª`Message`ï¼Ÿ

ä¹‹å‰ç”¨çš„æ˜¯`this.$message`ï¼Œå½“ç„¶ï¼Œè¿™é‡Œçš„`this`æ˜¯`Vue`å®ä¾‹å“ˆï¼

è€Œæˆ‘ä»¬çš„`request.ts`å¯æ²¡æœ‰`Vue`å®ä¾‹

ğŸ’¡ï¼šHTTP response status codesï¼Ÿ

å“åº”çŠ¶æ€ç è¡¨ç¤ºçš„ä¿¡æ¯ -> åœ¨ HTTP è§„èŒƒé‡Œè¾¹æ˜¯æœ‰çº¦å®šçš„ï¼

![å“åº”ç ](assets/img/2021-09-04-08-38-40.png)

â¹ï¼š[401 Unauthorized - HTTP - MDN](https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status/401)
