### ✍️ Tangxt ⏳ 2021-09-08 🏷️ Vue

# 06-11-资源管理

### <mark>1）布局</mark>

![效果](assets/img/2021-09-08-12-15-35.png)

做法：

1. 创建`src/views/resource/components/List.vue` -> 你写的内容都在这儿，`index.vue`是它的容器
2. 用到的第三方组件：卡片、表单、按钮、Layout
3. 样式调整

💡：如何在父组件这个单文件里边修改子组件里边的样式？

![修改样式](assets/img/2021-09-08-12-16-52.png)

`el-card`组件用到了`el-card__header`和`el-card__body`

➹：[Element UI 怎么样修改组件样式](https://blog.csdn.net/mini_1251861209/article/details/112350480)

### <mark>2）展示资源列表</mark>

接口文档：[按条件分页查询资源 - getResourcePages](http://eduboss.lagou.com/boss/doc.html#/edu-boss-boot/%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/getResourcePagesUsingPOST)

接口测试：

![接口测试](assets/img/2021-09-08-13-44-34.png)

![数据解释](assets/img/2021-09-08-14-16-14.png)

做法：

1. 定位到`src/services/resource.ts`，创建一个`getResourcePages`请求
2. 定位到`src/views/resource/components/List.vue`，在`created`阶段发送`getResourcePages`请求，拿到表格所需要的数据`resources`
3. 用`formatter`格式化`添加时间`这个字段的数据

效果：

![效果](assets/img/2021-09-08-15-14-11.png)

💡：格式化日期？

![格式化](assets/img/2021-09-08-14-17-35.png)

安装：

``` bash
yarn add dayjs
```

使用：

``` js
import dayjs from 'dayjs'
console.log(dayjs('2021-06-25T10:40:03.000+0800').format('YYYY-MM-DD HH:mm:ss')) // 2021-06-25 10:40:03
```

➹：[Typescript · Day.js](https://dayjs.gitee.io/docs/zh-CN/installation/typescript)

➹：[Vue 如何使用 Day.js 计算常用日期详解 - 简书](https://www.jianshu.com/p/ed20fb23e658)

➹：[Day.js ：一个非常好用的轻量的处理时间和日期库_Helloweba](https://www.helloweba.net/javascript/641.html)

### <mark>3）资源列表分页处理</mark>

效果：

![效果](assets/img/2021-09-08-15-44-01.png)

接口测试：

![5 条/页](assets/img/2021-09-08-15-46-33.png)

![10 条/页](assets/img/2021-09-08-15-49-48.png)

发请求带的参数，都是`current`和`size`，不管你点击了分页组件里边的哪个按钮……

分页组件代码：

![分页组件](assets/img/2021-09-08-19-17-45.png)

整个处理流程：

1. 用户点击分页组件里边的按钮，从中可以得到用户点击的`current`或`size`
2. 点击意味着触发回调函数 -> 回调函数更改`data`的`form.size/form.current`，然后调用`loadResources`，发送`getResourcePages`请求
3. 把拿到的数据交给`resources`和`totalCount`

![处理流程](assets/img/2021-09-08-19-32-02.png)

用户点击按钮就是在给查询条件发送请求，然后表格 UI 和分页 UI 就会局部刷新……

这是什么查询条件都没带的情况：默认就是要第一页的数据，而且最多`10`条

![数据展示控制](assets/img/2021-09-08-19-36-42.png)

💡：`:current-page.sync="form.current"`这个`.sync`？

你点击了子组件映射的按钮，子组件触发事件把当前点击的按钮值，传给了`form.current`，而子组件的`current-page`也同步更新了值

说白了，这是子组件和父组件关于`props`的双向绑定

💡：`size-change`和`current-change`这两个事件的触发？

![事件触发](assets/img/2021-09-08-19-25-21.png)

`prev-click`和`next-click`这两个事件不用写，我们点击`<`和`>`触发的都是`current`啊！

💡：用户在页面的前往第几页输入的值超过边界了？

如`-1`，那就`1`，`100`，那就`11`

![边界](assets/img/2021-09-08-19-42-17.png)

➹：[Pagination 分页](https://element.eleme.cn/#/zh-CN/component/pagination)

### <mark>4）列表数据筛选</mark>

接口文档：[查询资源分类列表](http://eduboss.lagou.com/boss/doc.html#/edu-boss-boot/%E8%B5%84%E6%BA%90%E7%AE%A1%E7%90%86/getCategoriesUsingGET)

接口测试：

![接口测试](assets/img/2021-09-08-20-03-14.png)

做法：

1. 定位到`src/services/resource-category.ts`，定义一个`getResourceCategories`函数，用来发送`GET`请求：`/boss/resource/category/getAll`
2. 定位到`src/views/resource/components/List.vue`，确定一下`data`最终会有什么数据
   1. `form`里边的数据都是查询条件
   2. `totalCount`和`resourceCategories`，一个是分页组件里边显示的总记录数，一个则是那个「资源分类」下拉菜单的
3. 在`created`里边加载资源列表和资源目录数据 -> 把得到数据交给`data`
4. 点击「查询搜索」按钮，触发`click`事件执行`onSubmit`方法 -> 把查询从第一页开始，加载资源列表

> 一个请求就是一个资源

效果：

![效果](assets/img/2021-09-08-20-39-03.png)

💡：关于在`async`函数里边写`try...catch`？

我突然想起我们之前在响应拦截器里边是写了的……

### <mark>5）重置数据筛选</mark>

效果：

![效果](assets/img/2021-09-08-21-16-28.png)

做法：

1. 用到了表单组件的`resetField`方法，它需要配合`Form-Item`的`prop`属性（必填项），`prop`的值，是传给`Form`组件的`model`中的字段

### <mark>6）加载中 loading 和按钮禁用</mark>

> 加载 loading 是为了给用户一个反馈啊！

效果：

![效果](assets/img/2021-09-08-21-35-07.png)

做法：

- 用到了`Loading`组件的`v-loading`指令

➹：[Loading 加载](https://element.eleme.cn/#/zh-CN/component/loading)

### <mark>7）小结</mark>

- 视频看第一遍，记录这样做的缘由，以及一些你不是很懂的知识点
- 开始看提交代码，把功能给实现了，记录整个怎么做的过程，并且记录遇到的问题
- 视频是否看第二遍？ -> 带着在做的过程中所遇到的问题去看老师是怎么解决的……