### âœï¸ Tangxt â³ 2021-11-17 ğŸ·ï¸ Webpack

# 10-Webpack

> å…³äºå·¥å…·ç±»çš„çŸ¥è¯†ï¼Œæˆ‘çœ‹ä¸€éå°±è·³è¿‡äº† -> åŸºäº [å¤§å‰ç«¯å­¦ä¹ --æ¨¡å—åŒ–å¼€å‘ å­¦ä¹ ç¬”è®°_çˆ±ç²å§å§çš„åšå®¢-CSDN åšå®¢](https://blog.csdn.net/jal517486222/article/details/107287751) è¿™ç¯‡æ–‡ç« çš„åŠ å·¥ -> è¿™ç¯‡æ–‡ç« æ²¡æœ‰å†™åˆ°æ‰“åŒ…ç»“æœçš„è¿è¡ŒåŸç† -> è‡ªå·±åœ¨æµè§ˆå™¨è°ƒè¯•ä¸€ä¸‹é‚£ä¸ªæ‰“åŒ…ç»“æœ`bundle.js`æ–‡ä»¶ -> webpack æ‰“åŒ…å‡ºæ¥çš„`bundle.js`ï¼Œå…¶é‡Œè¾¹çš„ä»£ç å¹¶ä¸ä¼šç‰¹åˆ«å¤æ‚ï¼ˆç®€å•æ¥è¯´ï¼Œæ•´ä¸ª `bundle.js` å°±æ˜¯ä¸€ä¸ª IIFEï¼Œä¼ ç»™è¿™ä¸ª IIFE çš„å®å‚æ˜¯ä¸€ä¸ªä¸ªæ¨¡å—æ–‡ä»¶ï¼Œä¼šæŠŠä¸€ä¸ªä¸ª ESM æ¨¡å—çš„å¯¼å…¥å’Œå¯¼å‡ºæ•´æˆæ˜¯ `require`ã€`module.exports`è¿™ç§ç±»ä¼¼ CommonJS è§„èŒƒçš„ APIï¼Œé€šè¿‡ `id` æ ‡è¯†æ¯ä¸ªæ¨¡å—ï¼Œä¸€ä¸ªæ¨¡å—ç”¨å…¶å®ƒæ¨¡å—æ—¶ï¼Œå°±é€šè¿‡ id å»æ‰¾å°±å¥½äº†ï¼‰ -> æŠŠæ‰€æœ‰æ¨¡å—çš„æ”¾åˆ°åŒä¸€ä¸ªæ–‡ä»¶å½“ä¸­ï¼Œä»¥åŠæä¾›äº†ä¸€äº›åŸºç¡€ä»£ç ï¼Œè®©è¿™äº›ä»£ç ä¿æŒåŸæœ‰çš„ä¾èµ–å…³ç³» -> å¯ä»¥çœ‹ä¸€ä¸‹è¿™ç¯‡ï¼š[webpack æ‰“åŒ…åŸç† ? çœ‹å®Œè¿™ç¯‡ä½ å°±æ‡‚äº† ! - SegmentFault æ€å¦](https://segmentfault.com/a/1190000021494964)

æ¨¡å—åŒ–æ‰“åŒ…å·¥å…·çš„ç”±æ¥ï¼šES Modules å­˜åœ¨ç¯å¢ƒå…¼å®¹é—®é¢˜ã€æ¨¡å—æ–‡ä»¶è¿‡å¤šï¼Œç½‘ç»œè¯·æ±‚é¢‘ç¹ï¼Œè€Œä¸”æ‰€æœ‰çš„å‰ç«¯èµ„æºéƒ½éœ€è¦æ¨¡å—åŒ–ã€‚

æ‰“åŒ…å·¥å…·è§£å†³çš„æ˜¯å‰ç«¯æ•´ä½“çš„æ¨¡å—åŒ–ï¼Œå¹¶ä¸å•æŒ‡ JavaScript æ¨¡å—åŒ–

webpack -> æ¨¡å—æ‰“åŒ…å™¨ã€æ¨¡å—åŠ è½½å™¨ã€ä»£ç æ‹†åˆ†ã€è½½å…¥èµ„æºæ¨¡å—

### <mark>1) webpack çš„åŸºæœ¬ä½¿ç”¨</mark>

+ å…ˆåœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ‰§è¡Œ`yarn init -y`, åˆ›å»º`package.json`
+ å®‰è£… webpack ç›¸å…³ä¾èµ–ï¼š`yarn add webpack webpack-cli --dev`
+ æŸ¥çœ‹ webpack ç‰ˆæœ¬ï¼š`yarn webpack --version` -> `4.43.0`
+ æ‰§è¡Œ`yarn webpack`è¿›è¡Œæ‰“åŒ…ï¼Œç”Ÿæˆäº†`dist`ç›®å½•ï¼Œé‡Œé¢æœ‰`main.js`æ–‡ä»¶
+ ä¿®æ”¹`index.html`ä¸­çš„`index.js`çš„è·¯å¾„ä¸º`dist/main.js`, å¹¶ä¸”å»æ‰`script`æ ‡ç­¾çš„`type=module`çš„å±æ€§
+ å» `package.json` çš„ `scripts` ä¸­å®šä¹‰ä¸€ä¸ª `build` ä»»åŠ¡ï¼š`"build": "webpack"`, ä»¥åæ‰§è¡Œ`yarn build`è¿›è¡Œæ‰“åŒ…

### <mark>2) webpack çš„é…ç½®æ–‡ä»¶</mark>

`webpack.config.js`æ–‡ä»¶æ˜¯è¿è¡Œåœ¨ nodejs æ–‡ä»¶ä¸‹çš„ js æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦æŒ‰ç…§ CommonJS çš„æ–¹å¼ç¼–å†™ä»£ç ã€‚è¿™ä¸ªæ–‡ä»¶éœ€è¦å¯¼å‡ºä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å®Œæˆå¯¹åº”çš„é…ç½®é€‰é¡¹ã€‚

`webpack.config.js`æ–‡ä»¶å†…å®¹ï¼š

```js
const path = require('path')

module.exports = {
  entry: './src/index.js', // æŒ‡å®šæ‰“åŒ…å…¥å£æ–‡ä»¶ï¼Œå¦‚æœæ˜¯ç›¸å¯¹è·¯å¾„ï¼Œå‰é¢çš„ç‚¹ä¸èƒ½å°‘
  output: {
    filename: 'bundle.js', // è¾“å‡ºæ–‡ä»¶çš„åç§°
    path: path.join(__dirname, 'output'), // è¾“å‡ºè·¯å¾„ï¼Œä¸ºç»å¯¹è·¯å¾„
  }
}
```

### <mark>3) webpack å·¥ä½œæ¨¡å¼</mark>

ç›´æ¥æ‰§è¡Œ webpack æ‰“åŒ…çš„æ—¶å€™ï¼Œæ§åˆ¶å°ä¼šæœ‰è­¦å‘Šï¼š

> WARNING in configuration
> 
> The 'mode' option has not been set, webpack will fallback to 'production' for this value. Set 'mode' option to 'development' or 'production' to enable defaults for each environment.
> 
> You can also set it to 'none' to disable any default behavior. Learn more: https://webpack.js.org/configuration/mode/

è¯´æ²¡æœ‰æŒ‡å®šå·¥ä½œæ¨¡å¼ï¼Œé»˜è®¤ä»¥ç”Ÿäº§æ¨¡å¼æ‰“åŒ…ï¼Œä¼šè¿›è¡Œä»£ç çš„å‹ç¼©ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡ cli å‘½ä»¤æŒ‡å®šå·¥ä½œæ¨¡å¼ï¼Œå°±æ˜¯å¢åŠ ä¸€ä¸ª`--mode`çš„å‚æ•°ï¼Œå±æ€§æœ‰ä¸‰ç§é€‰æ‹©ï¼Œproductionã€developmentã€none

+ productionï¼šç”Ÿäº§æ¨¡å¼ä¼šé»˜è®¤å¯åŠ¨ä¼˜åŒ–ï¼Œä¼˜åŒ–æˆ‘ä»¬çš„æ‰“åŒ…ç»“æœ
+ developmentï¼šå¼€å‘æ¨¡å¼ï¼Œä¼šè‡ªåŠ¨ä¼˜åŒ–æ‰“åŒ…çš„é€Ÿåº¦ï¼Œæ·»åŠ ä¸€äº›è°ƒè¯•è¿‡ç¨‹ä¸­çš„è¾…åŠ©åˆ°ä»£ç ä¸­
+ noneï¼šåŸå§‹çŠ¶æ€çš„æ‰“åŒ…ï¼Œä¸ä¼šåšä»»ä½•å¤„ç†

å¯ä»¥é€šè¿‡`yarn webpack --mode development`æ¥æ‰§è¡Œã€‚

æ­¤å¤–ï¼Œè¿˜å¯ä»¥åœ¨ webpack çš„é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå·¥ä½œæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯å¢åŠ ä¸€ä¸ª mode å±æ€§ï¼Œä¾‹å¦‚ï¼š`mode: "development"`

### <mark>4) webpack èµ„æºæ¨¡å—åŠ è½½</mark>

å°†é…ç½®æ–‡ä»¶ä¸­çš„`entry`å±æ€§çš„å€¼æ”¹ä¸º`./src/main.css`, ç„¶åæ‰§è¡Œæ‰“åŒ…å‘½ä»¤`yarn webpack`, ä¼šæŠ¥é”™ï¼š

``` js
ERROR in ./src/main.css 1:5
Module parse failed: Unexpected token (1:5)
You may need an appropriate loader to handle this file type, currently no loaders are configured to process this file. See https://webpack.js.org/concepts#loaders
  body {
  |   margin: 0 auto;
  |   padding: 0 20px;
  error Command failed with exit code 2.
```

å› ä¸º webpack é»˜è®¤ä¼šæŠŠæ–‡ä»¶å½“åš js è§£æï¼š

![JS](assets/img/2021-11-17-19-29-21.png)

æ‰€ä»¥æ‰“åŒ… css æ–‡ä»¶æ—¶ï¼Œæ–‡ä»¶å†…å®¹ä¸ç¬¦åˆ JS è¯­æ³•åˆ™æŠ¥é”™äº†ï¼ŒæŠ¥é”™ä¸­æç¤ºæˆ‘ä»¬å¯ä»¥å¯»æ‰¾æ­£ç¡®çš„ loader å»è§£æä»£ç ã€‚webpack å†…éƒ¨çš„ loader åªèƒ½è§£æ jsï¼Œæ‰€ä»¥æˆ‘ä»¬è¦æ‰‹åŠ¨å®‰è£… css-loader å»å¤„ç† css ä»£ç ã€‚

![å¤„ç†å…¶å®ƒèµ„æº](assets/img/2021-11-17-19-30-44.png)

æ‰§è¡Œå‘½ä»¤ï¼š`yarn add css-loader --dev`

ç„¶ååœ¨ webpack çš„é…ç½®æ–‡ä»¶ä¸­å¢åŠ å±æ€§ï¼š

```js
module: {
  rules: [
    {
      test: /.css$/,
      use: 'css-loader'
    }
  ]
}
```

æˆ‘ä»¬å¢åŠ å¤–éƒ¨çš„ loader éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­å¢åŠ èµ„æºæ¨¡å— `module` å±æ€§ï¼Œå±æ€§å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­æœ‰ä¸€ä¸ª `rules` æ•°ç»„ï¼Œæ•°ç»„é‡Œæ¯ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­çš„ `test` å±æ€§æ˜¯æ­£åˆ™å¼ï¼ŒæŒ‡æ˜è¦å¤„ç†çš„èµ„æºæ–‡ä»¶ï¼Œ`use` å±æ€§æ˜¯å¯¹è¯¥èµ„æºè¿›è¡Œå¤„ç†çš„ loader åç§°ã€‚

å†æ¬¡æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼Œå‘ç° css æ²¡æœ‰ä½œç”¨ï¼Œæ˜¯å› ä¸ºæˆ‘ä»¬ä½¿ç”¨ css-loader åªæ˜¯å¯¹ css æ–‡ä»¶è¿›è¡Œäº†æ‰“åŒ…ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰ä½œç”¨åˆ°é¡µé¢ä¸Šï¼Œæ¥ä¸‹æ¥è¿˜è¦å®‰è£…ä¸€ä¸ª`style-loader`, æ‰§è¡Œå‘½ä»¤ï¼š`yarn add style-loader --dev`

`style-loader`æ˜¯å°†`css-loader`å¤„ç†åçš„ç»“æœï¼Œé€šè¿‡ style çš„å½¢å¼è¿½åŠ åˆ°é¡µé¢ä¸Š

ç„¶åå°†é…ç½®æ–‡ä»¶ä¸­çš„`rules`å¯¹åº”çš„å¤„ç† css èµ„æºæ¨¡å—çš„ `use` å±æ€§ç”±`'css-loader'`æ”¹ä¸º`['style-loader', 'css-loader']`,`use`é…ç½®äº†å¤šä¸ª`loader`ï¼Œæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œé‡Œé¢çš„`loader`æ˜¯**ä»å³å¾€å·¦**æ‰§è¡Œï¼Œæ‰€ä»¥è¦å°†`css-loader`å†™åœ¨åé¢ï¼Œæˆ‘ä»¬è¦å…ˆç”¨`css-loader`å°†`css`ä»£ç è½¬åŒ–æˆ`js`æ¨¡å—ï¼Œæ‰å¯ä»¥æ­£å¸¸æ‰“åŒ…ã€‚

### <mark>5) webpack å¯¼å…¥èµ„æºæ¨¡å—</mark>

![å¯¼å…¥èµ„æºæ¨¡å—](assets/img/2021-11-17-19-33-52.png)

è™½ç„¶ webpack çš„å…¥å£æ–‡ä»¶å¯ä»¥æ˜¯åˆ«çš„ç±»å‹æ–‡ä»¶ï¼Œä½†ç”±äº**å‰ç«¯é¡¹ç›®æ˜¯ç”± JS é©±åŠ¨**ï¼Œæ‰€ä»¥æˆ‘ä»¬**å¼€å‘æ—¶ä¸€èˆ¬å°†å…¥å£æ–‡ä»¶è®¾ç½®ä¸º JS æ–‡ä»¶ï¼Œéœ€è¦ç”¨åˆ° CSS æ—¶ï¼Œå°±ç›´æ¥åœ¨ JS æ–‡ä»¶ä¸­é€šè¿‡ import å¯¼å…¥å³å¯**ï¼Œå¦‚ï¼š`import './main.css'`

webpack å»ºè®®æˆ‘ä»¬æ ¹æ®ä»£ç çš„éœ€è¦åœ¨ JS ä¸­åŠ¨æ€å¯¼å…¥èµ„æºæ–‡ä»¶ï¼Œå› ä¸º**éœ€è¦èµ„æºçš„ä¸æ˜¯åº”ç”¨ï¼Œè€Œæ˜¯ä»£ç **ã€‚å› ä¸ºæ˜¯ JavaScript é©±åŠ¨äº†æ•´ä¸ªå‰ç«¯åº”ç”¨ï¼Œè¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼š

+ é€»è¾‘åˆç†ï¼ŒJS ç¡®å®éœ€è¦è¿™äº›èµ„æºæ–‡ä»¶
+ ç¡®ä¿ä¸Šçº¿èµ„æºä¸ç¼ºå¤±ï¼Œéƒ½æ˜¯å¿…è¦çš„

### <mark>6) webpack æ–‡ä»¶èµ„æºåŠ è½½å™¨</mark>

![æ–‡ä»¶èµ„æºåŠ è½½å™¨](assets/img/2021-11-17-19-37-31.png)

å®‰è£…æ–‡ä»¶èµ„æºåŠ è½½å™¨ï¼š`yarn add file-loader --dev`, ç›¸å½“äºç›´æ¥æ‹·è´ç‰©ç†æ–‡ä»¶ã€‚ä¸è¿‡æ­¤æ—¶èµ„æºæ–‡ä»¶è·¯å¾„ä¼šå‡ºç°é—®é¢˜ï¼Œwebpack é»˜è®¤è®¤ä¸ºå®ƒæ‰“åŒ…è¿‡åçš„æ–‡ä»¶ä¼šæ”¾åœ¨ç½‘ç«™çš„æ ¹ç›®å½•ä¸‹é¢ï¼Œæ­¤æ—¶éœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­çš„`output`å±æ€§ä¸­æŒ‡å®š`publicPath`å±æ€§å€¼ä¸º`dist/`, å³ï¼š`publicPath: 'dist/'`, è¿™æ ·åœ¨æ‰“åŒ…æ—¶ï¼Œæ–‡ä»¶çš„è¾“å‡ºè·¯å¾„å‰é¢ä¼šæ‹¼æ¥ä¸Š`publicPath`çš„å€¼ã€‚

### <mark>7) webpack URL åŠ è½½å™¨</mark>

æ ¼å¼ï¼šåè®® + åª’ä½“ç±»å‹å’Œç¼–ç  + æ–‡ä»¶å†…å®¹

æ ¼å¼ï¼š`data:[<mediatype>][;base64],<data>`

![æ ¼å¼](assets/img/2021-11-17-19-38-18.png)

ä¾‹å¦‚ï¼šHTML

`data:text/html;charset=UTF-8,<h1>html content</h1>`

![ä¾‹å­](assets/img/2021-11-17-19-39-38.png)

![æ•ˆæœ](assets/img/2021-11-17-19-41-00.png)

ä¾‹å¦‚ï¼šå›¾ç‰‡

![å›¾ç‰‡](assets/img/2021-11-17-19-43-24.png)

![æ•ˆæœ](assets/img/2021-11-17-19-43-55.png)

+ å…ˆå®‰è£… url-loader:`yarn add url-loader --dev`

+ ä¿®æ”¹ png æ–‡ä»¶çš„ loader ä¸º url-loader

```js
{
  test: /.png$/,
    // use: 'file-loader',
  use: 'url-loader'
}
```

+ æ‰§è¡Œ`yarn webpack`, æ­¤æ—¶çš„ png æ–‡ä»¶çš„ URL åˆ™ä¸º data åè®®çš„äº†ã€‚

æœ€ä½³ä½¿ç”¨æ–¹å¼ï¼š

+ å°æ–‡ä»¶ä½¿ç”¨ Data URLs, å‡å°‘è¯·æ±‚æ¬¡æ•°
+ å¤§æ–‡ä»¶ç‹¬ç«‹æå–å­˜æ”¾ï¼Œæé«˜åŠ è½½é€Ÿåº¦

é…ç½®æ–¹å¼ï¼š

```js
{
  test: /.png$/,
  // use: 'file-loader',
  use: {
    loader: 'url-loader',
    options: {
      limit: 10 * 1024, // å•ä½æ˜¯å­—èŠ‚ 10KB
    }
  }
}
```

+ è¶…è¿‡ 10KB çš„æ–‡ä»¶å•ç‹¬æå–å­˜æ”¾
+ å°äº 10KB æ–‡ä»¶è½¬æ¢ä¸º Data URLs åµŒå…¥ä»£ç ä¸­

> æ³¨æ„ï¼šè¿™ç§æ–¹å¼è¿˜æ˜¯è¦å®‰è£…`file-loader`ï¼Œå› ä¸ºå¯¹è¶…å‡ºå¤§å°çš„æ–‡ä»¶è¿˜æ˜¯ä¼šè°ƒç”¨`file-loader`ï¼Œå¦‚æœæ²¡æœ‰ file-loader ä¼šæŠ¥é”™ã€‚

### <mark>8) webpack å¸¸ç”¨åŠ è½½å™¨åˆ†ç±»</mark>

1. ç¼–è¯‘è½¬æ¢ç±»ï¼Œè½¬æ¢ä¸º JS ä»£ç ï¼Œå¦‚`css-loader`
2. æ–‡ä»¶æ“ä½œç±»ï¼Œå°†èµ„æºæ–‡ä»¶æ‹·è´åˆ°è¾“å‡ºç›®å½•ï¼Œå°†æ–‡ä»¶è®¿é—®è·¯å¾„å‘å¤–å¯¼å‡ºï¼Œå¦‚ï¼š`file-loader`
3. ä»£ç æ£€æŸ¥å™¨ï¼Œç»Ÿä¸€ä»£ç é£æ ¼ï¼Œæé«˜ä»£ç è´¨é‡ï¼Œå¦‚ï¼š`es-loader`

ç¼–è¯‘è½¬æ¢ç±»ï¼š

![ç¼–è¯‘è½¬æ¢ç±»](assets/img/2021-11-17-19-45-06.png)

æ–‡ä»¶æ“ä½œç±»ï¼š

![æ‹·è´](assets/img/2021-11-17-19-46-31.png)

![å¯¼å‡ºèµ„æº](assets/img/2021-11-17-19-47-26.png)

ä»£ç æ£€æŸ¥å™¨ï¼š

![ä»£ç æ£€æŸ¥å™¨](assets/img/2021-11-17-19-48-23.png)

### <mark>9) webpack å¤„ç† ES2015</mark>

å› ä¸ºæ¨¡å—æ‰“åŒ…éœ€è¦ï¼Œæ‰€ä»¥å¤„ç†`import`å’Œ`export`ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå¹¶ä¸èƒ½è½¬æ¢å…¶ä»–çš„ ES6 ç‰¹æ€§ã€‚å¦‚æœæƒ³è¦å¤„ç† ES6ï¼Œéœ€è¦å®‰è£…è½¬åŒ– ES6 çš„ç¼–è¯‘å‹ loaderï¼Œæœ€å¸¸ç”¨çš„å°±æ˜¯`babel-loader`ï¼Œ`babel-loader`ä¾èµ–äº`babel`çš„æ ¸å¿ƒæ¨¡å—ï¼Œ`@babel/core`å’Œ`@babel/preset-env`

+ æ‰§è¡Œå‘½ä»¤ï¼š`yarn add babel-loader @babel/core @babel/preset-env --dev`
+ ä¿®æ”¹ js çš„ loader

```js
{
  test: /.js$/,
  use: {
    loader: 'babel-loader',
    options: {
      presets: ['@babel/preset-env']
    }
  },
  exclude: /node_modules/, // è¿™é‡Œå¾ˆé‡è¦ï¼Œåƒä¸‡åˆ«å¿˜äº†ï¼Œå¦åˆ™ä¼šå‡ºé”™çš„ã€‚
}
```

> æ³¨æ„ï¼š
>
> Webpack åªæ˜¯æ‰“åŒ…å·¥å…·ï¼Œ
>
> åŠ è½½å™¨å¯ä»¥ç”¨æ¥ç¼–è¯‘è½¬åŒ–ä»£ç 

### <mark>10) webpack çš„æ¨¡å—åŠ è½½æ–¹å¼</mark>

ğŸ’¡ï¼šéµå¾ª ES Modules æ ‡å‡†çš„ import å£°æ˜

![import](assets/img/2021-11-17-19-52-45.png)

ğŸ’¡ï¼šéµå¾ª CommonJS æ ‡å‡†çš„ require å‡½æ•°ã€‚å¯¹äº ES çš„é»˜è®¤å¯¼å‡ºï¼Œè¦é€šè¿‡`require('./XXX').default`çš„å½¢å¼è·å–

![require](assets/img/2021-11-17-19-54-54.png)

ğŸ’¡ï¼šéµå¾ª AMD æ ‡å‡†çš„ define å‡½æ•°å’Œ require å‡½æ•°

![AMD](assets/img/2021-11-17-19-55-50.png)

ğŸ’¡ï¼šLoader åŠ è½½çš„é JavaScript ä¹Ÿä¼šè§¦å‘èµ„æºåŠ è½½

æ ·å¼ä»£ç ä¸­çš„@import æŒ‡ä»¤å’Œ url å‡½æ•°

```css
@import url(reset.css);

body {
  margin: 0 auto;
  padding: 0 20px;
  max-width: 800px;
  background: url(1.png);
  background-size: cover;
}
```

â€‹css-loader åœ¨å¤„ç† css ä»£ç æ—¶ï¼Œé‡åˆ°äº† background å±æ€§ä¸­çš„ url å‡½æ•°ï¼Œå‘ç°æ˜¯å¼•å…¥çš„èµ„æºæ–‡ä»¶æ˜¯ png æ ¼å¼çš„æ–‡ä»¶ï¼Œåˆ™å°†è¿™ä¸ªèµ„æºæ–‡ä»¶ äº¤ç»™ url-loader å¤„ç†

HTML ä»£ç ä¸­çš„å›¾ç‰‡æ ‡ç­¾çš„ `src` å±æ€§

```js
{
  test: /.html$/,
  use: {
    loader: 'html-loader',
    options: {
        // html-loader é»˜è®¤åªå¤„ç†é¡µé¢ä¸­çš„ img æ ‡ç­¾çš„ src å±æ€§çš„èµ„æºæ–‡ä»¶ï¼Œæ‰€ä»¥æŒ‡å®šå…¶ä»–æ ‡ç­¾çš„èµ„æºæ–‡ä»¶ä¹Ÿè¦å¤„ç†
      attributes: {
        list: [
          {
            tag: 'img',
            attribute: 'src',
            type: 'src'
          },
          {
            tag: 'a',
            attribute: 'href',
            type: 'src'
          }
        ]
      }
    }
  }
}
```

ğŸ’¡ï¼šå°ç»“

![å°ç»“](assets/img/2021-11-17-20-00-34.png)

### <mark>11) webpack çš„æ ¸å¿ƒå·¥ä½œåŸç†</mark>

![å·¥ä½œåŸç†](assets/img/2021-11-17-20-01-50.png)

æ‰¾åˆ°æ‰“åŒ…å…¥å£ï¼š

![å…¥å£](assets/img/2021-11-17-20-11-08.png)

æ‰¾åˆ°æ‰€æœ‰æ–‡ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»æ ‘ï¼š

![ä¾èµ–æ ‘](assets/img/2021-11-17-20-13-15.png)

webpack éå†ï¼Œæˆ–è€…æ›´å‡†ç¡®åœ°è¯´æ˜¯é€’å½’è¿™é¢—ä¾èµ–æ ‘ï¼Œæ‰¾åˆ°æ¯ä¸ªèŠ‚ç‚¹æ‰€å¯¹åº”çš„èµ„æºæ–‡ä»¶ï¼Œæœ€åå†æ ¹æ®é…ç½®æ–‡ä»¶å½“ä¸­çš„`use`å±æ€§å»æ‰¾åˆ°è¿™ä¸ªæ¨¡å—æ‰€å¯¹åº”çš„åŠ è½½å™¨å»åŠ è½½è¿™ä¸ªæ¨¡å—

![æ”¾å…¥å†…å®¹](assets/img/2021-11-17-20-17-42.png)

æœ€åä¼šå°†åŠ è½½åˆ°çš„ç»“æœæ”¾å…¥åˆ°`bundle.js`å½“ä¸­ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬çš„æ‰“åŒ…ç»“æœå½“ä¸­ï¼Œä»è€Œå»å®ç°æˆ‘ä»¬æ•´ä¸ªé¡¹ç›®çš„æ‰“åŒ…

![æ‰“åŒ…ç»“æœ](assets/img/2021-11-17-20-18-17.png)

åœ¨æ•´ä¸ªæ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œloader å…¶å®èµ·äº†ä¸€ä¸ªå¾ˆé‡è¦çš„ä½œç”¨ -> æ²¡æœ‰ loader å°±æ— æ³•å®ç°å„ç§å„æ ·çš„èµ„æºæ–‡ä»¶çš„åŠ è½½ï¼Œæ²¡æœ‰ loaderï¼Œwebpack åªèƒ½ç®—æ˜¯ä¸€ä¸ªç”¨æ¥å»æ‰“åŒ…æˆ–è€…åˆå¹¶ JS æ¨¡å—ä»£ç çš„ä¸€ä¸ªå·¥å…·äº†

![loader](assets/img/2021-11-17-20-21-01.png)

### <mark>12)  webpack Loader çš„å·¥ä½œåŸç†</mark>

å®ç°ä¸€ä¸ª markdown çš„æ–‡ä»¶åŠ è½½å™¨ã€‚

`Loader`ä½œä¸º`webpack`çš„æ ¸å¿ƒæœºåˆ¶ï¼Œå†…éƒ¨çš„å·¥ä½œåŸç†ä¹Ÿéå¸¸ç®€å•ï¼Œæˆ‘ä»¬é€šè¿‡å¼€å‘ä¸€ä¸ªè‡ªå·±çš„`loader`ï¼Œæ¥æ·±å…¥äº†è§£`loader`çš„å·¥ä½œåŸç†ã€‚

![åŠ è½½å™¨](assets/img/2021-11-17-20-22-12.png)

æˆ‘ä»¬çš„éœ€æ±‚æ˜¯å®ç°ä¸€ä¸ª`markdown`æ–‡ä»¶çš„åŠ è½½å™¨ï¼Œè¿™ä¸ªåŠ è½½å™¨å¯ä»¥åœ¨ä»£ç å½“ä¸­ç›´æ¥å¯¼å…¥`markdown`æ–‡ä»¶ã€‚`markdown`æ–‡ä»¶ä¸€èˆ¬æ˜¯è¢«è½¬æ¢ä¸º`html`è¿‡åå†å»å‘ˆç°åˆ°é¡µé¢ä¸Šçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¼å…¥çš„`markdown`æ–‡ä»¶å¾—åˆ°çš„ç»“æœå°±æ˜¯è½¬æ¢è¿‡åçš„ html å­—ç¬¦ä¸²ã€‚

åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª`markdown-loader.js`æ–‡ä»¶ï¼Œæ¯ä¸€ä¸ª`webpack`çš„`loader`éƒ½éœ€è¦å»å¯¼å‡ºä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å°±æ˜¯æˆ‘ä»¬è¿™ä¸ª`loader`çš„å¯¹æˆ‘ä»¬æ‰€åŠ è½½åˆ°çš„èµ„æºçš„ä¸€ä¸ªå¤„ç†è¿‡ç¨‹ï¼Œå®ƒçš„è¾“å…¥å°±æ˜¯æˆ‘ä»¬èµ„æºæ–‡ä»¶çš„å†…å®¹ï¼Œè¾“å‡ºå°±æ˜¯æˆ‘ä»¬æ­¤æ¬¡åŠ å·¥è¿‡åçš„ä¸€ä¸ªç»“æœã€‚

é‚£æˆ‘ä»¬é€šè¿‡`source`å‚æ•°å»æ¥æ”¶è¾“å…¥ï¼Œç„¶åé€šè¿‡æˆ‘ä»¬çš„è¿”å›å€¼å»è¾“å‡ºï¼Œæˆ‘ä»¬å…ˆå°è¯•æ‰“å°ä¸€ä¸‹è¿™ä¸ª`source`ï¼Œç„¶åç›´æ¥å»è¿”å›ä¸€ä¸ª`hello`ï¼Œæˆ‘ä»¬å»çœ‹ä¸€ä¸‹ç»“æœï¼Œæˆ‘ä»¬å›åˆ°`webpack`é…ç½®æ–‡ä»¶ä¸­å»æ·»åŠ ä¸€ä¸ªåŠ è½½æ–°çš„è§„åˆ™é…ç½®ï¼Œæˆ‘ä»¬åŒ¹é…åˆ°çš„æ‰©å±•åå°±æ˜¯`.md`ï¼Œå°±æ˜¯æˆ‘ä»¬åˆšåˆšæ‰€ç¼–å†™çš„`markdown-loader`çš„æ¨¡å—ï¼Œæˆ‘ä»¬çš„`use`å±æ€§ä¸ä»…ä»…åªå¯ä»¥ä½¿ç”¨æ¨¡å—çš„åç§°ï¼Œå…¶å®å¯¹äºæ¨¡å—çš„æ–‡ä»¶è·¯å¾„ä¹Ÿæ˜¯å¯ä»¥çš„ï¼Œè¿™ä¸€ç‚¹å…¶å®ä¸`node`å½“ä¸­çš„`require`å‡½æ•°æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ç›´æ¥ä½¿ç”¨ç›¸å¯¹è·¯å¾„å»æ‰¾åˆ°è¿™ä¸ª`markdown-loader`ï¼Œé…ç½®å¥½è¿‡åï¼Œè¿è¡Œæ‰“åŒ…å‘½ä»¤ï¼Œæ‰“åŒ…è¿‡ç¨‹å½“ä¸­å‘½ä»¤è¡Œç¡®å®æ‰“å°å‡ºæ¥äº†æˆ‘ä»¬æ‰€å¯¼å…¥çš„ markdown çš„å†…å®¹ï¼Œé‚£è¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬çš„`source`ç¡®å®æ˜¯æ‰€å¯¼å…¥çš„æ–‡ä»¶å†…å®¹ï¼Œä½†æ˜¯å®ƒåŒæ—¶ä¹Ÿçˆ†å‡ºä¸€ä¸ªè§£æé”™è¯¯ï¼Œè¯´çš„æ˜¯`you many need additional load to handle the result of this loader`ï¼Œå°±æ˜¯æˆ‘ä»¬è¿˜éœ€è¦ä¸€ä¸ªé¢å¤–çš„åŠ è½½å™¨æ¥å»å¤„ç†æˆ‘ä»¬å½“å‰çš„åŠ è½½ç»“æœï¼Œé‚£è¿™ç©¶ç«Ÿæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

```js
module.exports = source => {
  console.log(source)
  return 'hello'
}
```

å…¶å®`webpack`çš„åŠ è½½èµ„æºçš„è¿‡ç¨‹æœ‰ç‚¹ç±»ä¼¼äºä¸€ä¸ªå·¥ä½œç®¡é“ï¼Œä½ å¯ä»¥åœ¨è¿™ä¸ªè¿‡ç¨‹å½“ä¸­ä¸€æ¬¡å»ä½¿ç”¨å¤šä¸ª`loader`ï¼š

![ç®¡é“](assets/img/2021-11-17-20-24-14.png)

ä½†æ˜¯ï¼Œè¿˜è¦æ±‚æˆ‘ä»¬æœ€ç»ˆè¿™ä¸ªç®¡é“å·¥ä½œè¿‡åçš„ç»“æœå¿…é¡»æ˜¯ä¸€æ®µ`JavaScript`ä»£ç ï¼Œå› ä¸ºæˆ‘ä»¬è¿™è¿”å›çš„å†…å®¹æ˜¯ä¸€ä¸ª`hello`ï¼Œå®ƒä¸æ˜¯ä¸€ä¸ªæ ‡å‡†çš„`JavaScript`ä»£ç ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™æ‰ä¼šå‡ºç°è¿™æ ·çš„é”™è¯¯æç¤ºï¼Œé‚£çŸ¥é“è¿™ä¸ªé”™è¯¯çš„åŸå› è¿‡åï¼Œè§£å†³çš„åŠæ³•å…¶å®ä¹Ÿå°±å¾ˆæ˜æ˜¾äº†ï¼Œé‚£è¦ä¹ˆå°±æ˜¯æˆ‘ä»¬è¿™ä¸ª`loader`çš„ç›´æ¥å»è¿”å›ä¸€æ®µæ ‡å‡†çš„`JavaScript`ä»£ç ï¼Œè¦ä¹ˆå°±æ˜¯æˆ‘ä»¬å†å»æ‰¾ä¸€ä¸ªåˆé€‚çš„åŠ è½½å™¨ï¼Œæ¥ç€å»å¤„ç†æˆ‘ä»¬è¿™é‡Œè¿”å›çš„ç»“æœã€‚

![JS ä»£ç ](assets/img/2021-11-17-20-25-19.png)

æˆ‘ä»¬å…ˆæ¥å°è¯•ç¬¬ä¸€ç§åŠæ³•ã€‚å›åˆ°æˆ‘ä»¬`markdown-loader.js`çš„å½“ä¸­ï¼Œæˆ‘ä»¬å°†è¿”å›çš„è¿™ä¸ªå†…å®¹ä¿®æ”¹ä¸º`'console.log("hello")'`ï¼Œé‚£è¿™å°±æ˜¯ä¸€æ®µæ ‡å‡†çš„ JavaScript ä»£ç ï¼Œç„¶åæˆ‘ä»¬å†ä¸€æ¬¡è¿è¡Œæ‰“åŒ…ï¼Œé‚£æ­¤æ—¶æ‰“åŒ…è¿‡ç¨‹å½“ä¸­å°±ä¸å†ä¼šæŠ¥é”™äº†ã€‚

```js
module.exports = source => {
  console.log(source)
  return 'console.log("hello")'
}
```

æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·æ¥çœ‹ä¸€ä¸‹æ‰“åŒ…è¿‡åçš„ç»“æœç©¶ç«Ÿæ˜¯ä»€ä¹ˆæ ·çš„ï¼Œæˆ‘ä»¬æ‰“å¼€`bundle.js`å½“ä¸­ï¼Œç„¶åæˆ‘ä»¬æ‰¾åˆ°æœ€åä¸€ä¸ªæ¨¡å—ï¼Œå¯ä»¥çœ‹åˆ°ï¼Œ`webpack`æ‰“åŒ…çš„æ—¶å€™å°±æ˜¯æŠŠæˆ‘ä»¬åˆšåˆš`loader`åŠ è½½è¿‡åçš„ç»“æœä¹Ÿå°±æ˜¯è¿”å›çš„é‚£ä¸ªå­—ç¬¦ä¸²ç›´æ¥æ‹¼æ¥åˆ°æˆ‘ä»¬è¿™ä¸ªæ¨¡å—å½“ä¸­äº†ï¼Œé‚£è¿™ä¹Ÿå°±è§£é‡Šäº†åˆšåˆšä¸ºä»€ä¹ˆè¯´`loader`çš„ç®¡é“æœ€åå¿…é¡»è¦å»è¿”å›`JavaScript`ä»£ç çš„åŸå› ï¼Œå› ä¸ºå¦‚æœè¯´ä½ éšä¾¿å»è¿”å›ä¸€ä¸ªå†…å®¹çš„è¯ï¼Œé‚£æ”¾åˆ°è¿™é‡Œè¯­æ³•å°±æœ‰å¯èƒ½ä¸é€šè¿‡ã€‚

é‚£çŸ¥é“äº†è¿™äº›è¿‡åï¼Œæˆ‘ä»¬å†å›åˆ°`markdown-loader.js`çš„å½“ä¸­ï¼Œç„¶åæ¥ç€å»å®Œæˆæˆ‘ä»¬åˆšåˆšçš„éœ€æ±‚ï¼Œæˆ‘ä»¬å…ˆå»å®‰è£…ä¸€ä¸ª`markdown`è§£æçš„æ¨¡å—å«åš`marked`ï¼Œå®‰è£…å‘½ä»¤ä¸ºï¼š`yarn add marked --dev`

å®‰è£…å®Œæˆè¿‡åï¼Œæˆ‘ä»¬å†å›åˆ°ä»£ç å½“ä¸­å»å¯¼å…¥è¿™ä¸ªæ¨¡å—ã€‚ç„¶ååœ¨æˆ‘ä»¬çš„åŠ è½½å™¨å½“ä¸­å»ä½¿ç”¨è¿™ä¸ªæ¨¡å—ï¼Œå»è§£ææ¥è‡ªå‚æ•°å½“ä¸­çš„è¿™ä¸ª`source`ï¼Œæˆ‘ä»¬çš„è¿”å›å€¼å°±æ˜¯ä¸€æ®µ`html`å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯è½¬æ¢è¿‡åçš„ç»“æœï¼Œä½†æ˜¯å¦‚æœç›´æ¥è¿”å›è¿™ä¸ª`html`çš„è¯ï¼Œé‚£å°±ä¼šé¢ä¸´åˆšåˆšåŒæ ·çš„é—®é¢˜ï¼Œæ­£ç¡®çš„åšæ³•å°±æ˜¯æŠŠè¿™æ®µ`html`å˜æˆä¸€æ®µ`JavaScript`ä»£ç ï¼Œå…¶å®æˆ‘ä»¬å¸Œæœ›æ˜¯æŠŠè¿™ä¸€æ®µ`html`ä½œä¸ºæˆ‘ä»¬å½“å‰è¿™ä¸ªæ¨¡å—å¯¼å‡ºçš„å­—ç¬¦ä¸²ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸Œæœ›é€šè¿‡`export`å¯¼å‡ºè¿™æ ·ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œä½†æ˜¯å¦‚æœè¯´æˆ‘ä»¬åªæ˜¯ç®€å•çš„æ‹¼æ¥çš„è¯ï¼Œé‚£æˆ‘ä»¬`html`å½“ä¸­å­˜åœ¨çš„æ¢è¡Œç¬¦è¿˜æœ‰å®ƒå†…éƒ¨çš„ä¸€äº›å¼•å·ï¼Œæ‹¼æ¥åˆ°ä¸€èµ·å°±æœ‰å¯èƒ½é€ æˆè¯­æ³•ä¸Šçš„é”™è¯¯ï¼Œæ‰€ä»¥è¯´è¿™é‡Œæˆ‘ä½¿ç”¨ä¸€ä¸ªå°æŠ€å·§ï¼Œå°±æ˜¯é€šè¿‡`JSON.stringify`å…ˆå°†è¿™ä¸ªå­—ç¬¦ä¸²è½¬æ¢ä¸ºä¸€ä¸ªæ ‡å‡†çš„`JavaScript`æ ¼å¼å­—ç¬¦ä¸²ï¼Œé‚£æ­¤æ—¶å†…éƒ¨çš„å¼•å·ä»¥åŠæ¢æ–¹ç¬¦éƒ½ä¼šè¢«è½¬ä¹‰è¿‡æ¥ï¼Œç„¶åæˆ‘ä»¬å†å‚ä¸æ‹¼æ¥ï¼Œé‚£è¿™æ ·çš„è¯å°±ä¸ä¼šæœ‰é—®é¢˜äº†ï¼Œæˆ‘ä»¬å†æ¬¡è¿è¡Œæ‰“åŒ…ï¼Œçœ‹ä¸€ä¸‹æ‰“åŒ…çš„ç»“æœï¼Œé‚£æ­¤æ—¶æˆ‘ä»¬æ‰€çœ‹åˆ°çš„ç»“æœå°±æ˜¯æˆ‘ä»¬æ‰€éœ€è¦çš„äº†ï¼Œå½“ç„¶äº†ï¼Œé™¤äº†`module.exports`è¿™ç§æ–¹å¼æœ‰å¤–ï¼Œ`webpack`çš„è¿˜å…è®¸æˆ‘ä»¬åœ¨è¿”å›çš„ä»£ç å½“ä¸­ç›´æ¥å»ä½¿ç”¨`ES Modules`çš„æ–¹å¼å»å¯¼å‡ºã€‚

```js
const marked = require('marked')

module.exports = source => {
  // console.log(source)
  // return 'console.log("hello")'
  const html = marked(source)
  console.log(html)
  // ä¸¤ç§å¯¼å‡ºæ–¹å¼ï¼š
  // return `module.exports=${JSON.stringify(html)}`
  // return `export default ${JSON.stringify(html)}`
  // ä¸ç”¨è‡ªå·±å†™ä¸Šè¾¹ä¸¤ç§çš„å…¶ä¸­ä¹‹ä¸€çš„æ–¹å¼ï¼Œç›´æ¥äº¤ç»™ä¸‹ä¸€ä¸ª loader å¤„ç†
  // è¿”å› html å­—ç¬¦ä¸²äº¤ç»™ä¸‹ä¸€ä¸ª loader å¤„ç†
  return html
}
```

é€šè¿‡ç¬¬ä¸€ç§æ–¹å¼è§£å†³äº†æˆ‘ä»¬åˆšåˆšæ‰€çœ‹åˆ°çš„é‚£æ ·ä¸€ä¸ªé”™è¯¯ï¼Œæˆ‘ä»¬å†æ¥å°è¯•ä¸€ä¸‹åˆšåˆšæ‰€è¯´çš„ç¬¬äºŒç§æ–¹æ³•ï¼Œé‚£å°±æ˜¯åœ¨æˆ‘ä»¬`markdown-loader`çš„å½“ä¸­å»è¿”å›ä¸€ä¸ª`html`çš„å­—ç¬¦ä¸²ï¼Œç„¶åæˆ‘ä»¬äº¤ç»™ä¸‹ä¸€ä¸ª`loader`å¤„ç†è¿™ä¸ª`html`çš„å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬ç›´æ¥å»è¿”å›`marked`çš„è§£æè¿‡åçš„`html`ï¼Œç„¶åæˆ‘ä»¬å†å»å®‰è£…ä¸€ä¸ªç”¨äºå»å¤„ç†`html`åŠ è½½çš„`loader`, å«åš`html-loader`ï¼Œå®Œæˆè¿‡åï¼Œæˆ‘ä»¬å›åˆ°é…ç½®æ–‡ä»¶å½“ä¸­ï¼Œæˆ‘ä»¬æŠŠ`use`å±æ€§ä¿®æ”¹ä¸ºä¸€ä¸ªæ•°ç»„ï¼Œé‚£è¿™æ ·çš„è¯æˆ‘ä»¬çš„`loader`å·¥ä½œè¿‡ç¨‹å½“ä¸­å°±ä¼šä¾æ¬¡å»ä½¿ç”¨å¤šä¸ª`loader`ï¼Œé‚£ä¸è¿‡è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œå°±æ˜¯å®ƒçš„æ‰§è¡Œé¡ºåºæ˜¯ä»æ•°ç»„çš„åé¢å¾€å‰é¢ï¼Œé‚£ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åº”è¯¥æŠŠå…ˆæ‰§è¡Œçš„`loader`æ”¾åˆ°åé¢ï¼Œåæ‰§è¡Œçš„`loader`æ”¾åˆ°å‰é¢ã€‚

![loader é¡ºåº](assets/img/2021-11-17-20-27-31.png)

```js
const marked = require('marked')

module.exports = source => {
  // console.log(source)
  // return 'console.log("hello")'
  const html = marked(source)
  console.log(html)
  return html
}
```

```js
module: {
  rules: [
    {
      test: /.md$/,
      use: ['html-loader', './markdown-loader.js']
    }
  ]
}
```

å›åˆ°å‘½ä»¤è¡Œè¿›è¡Œæ‰“åŒ…ï¼Œæ­¤æ—¶æˆ‘ä»¬æ‰“åŒ…çš„ç»“æœä»ç„¶æ˜¯å¯ä»¥çš„ï¼Œæˆ‘ä»¬`marked`å¤„ç†å®Œçš„ç»“æœæ˜¯ä¸€ä¸ª`html`çš„å­—ç¬¦ä¸²ï¼Œç„¶åè¿™ä¸ª`html`å­—ç¬¦ä¸²äº¤ç»™äº†ä¸‹ä¸€ä¸ª`loader`ï¼Œä¹Ÿå°±æ˜¯`html-loader`ï¼Œé‚£è¿™ä¸ª`loader`åˆæŠŠå®ƒè½¬æ¢æˆäº†ä¸€ä¸ªå¯¼å‡ºè¿™ä¸ªå­—ç¬¦ä¸²çš„ä¸€ä¸ª`JavaScript`ä»£ç ï¼Œé‚£è¿™æ ·çš„è¯æˆ‘ä»¬ webpack å†å»æ‰“åŒ…çš„æ—¶å€™å°±å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚

![å¤„ç†ç»“æœ](assets/img/2021-11-17-20-28-14.png)

`bundle.js`å°±æ˜¯è¿™ä¸ªç»“æœï¼š

![å¤„ç†ç»“æœ](assets/img/2021-11-17-20-32-59.png)

è¿”å› ESM æ¨¡å—å¯¼å‡ºçš„å¤„ç†ç»“æœï¼š

![ESM](assets/img/2021-11-17-20-34-39.png)

ç”¨ html-loader å¤„ç†çš„åï¼Œè¾“å‡ºåˆ°`bundle`çš„ç»“æœï¼š

![html-loader](assets/img/2021-11-17-20-39-46.png)

æ•´ä½“ä¸Šå°±æ˜¯è¿™æ ·ï¼š

![æ•´ä½“ç»“æœ](assets/img/2021-11-17-20-46-10.png)

> markdown-loader çš„ç»“æœæ˜¯ html å­—ç¬¦ä¸²

é‚£é€šè¿‡ä»¥ä¸Šçš„è¿™äº›å°è¯•æˆ‘ä»¬å°±å‘ç°äº† loader å®ƒå†…éƒ¨çš„ä¸€ä¸ªå·¥ä½œåŸç†å…¶å®éå¸¸ç®€å•ï¼Œå°±æ˜¯ä¸€ä¸ª**ä»è¾“å…¥åˆ°è¾“å‡ºä¹‹é—´çš„ä¸€ä¸ªè½¬æ¢**ï¼š

![è½¬æ¢](assets/img/2021-11-17-20-49-12.png)

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜äº†è§£äº† loaderï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ç§ç®¡é“çš„æ¦‚å¿µï¼Œæˆ‘ä»¬å¯ä»¥å°†æˆ‘ä»¬æ­¤æ¬¡çš„è¿™ä¸ª`loader`çš„ç»“æœäº¤ç»™ä¸‹ä¸€ä¸ª`loader`å»å¤„ç†ï¼Œç„¶åæˆ‘ä»¬é€šè¿‡å¤šä¸ª`loader`å»å®Œæˆä¸€ä¸ªåŠŸèƒ½

![å¤šä¸ª loader](assets/img/2021-11-17-20-50-03.png)

ä¾‹å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€ä½¿ç”¨çš„`css-loader`å’Œ`style-loader`ä¹‹é—´çš„ä¸€ä¸ªé…åˆï¼ŒåŒ…æ‹¬æˆ‘ä»¬åé¢è¿˜ä¼šä½¿ç”¨åˆ°çš„ï¼Œåƒ`sass`æˆ–è€…`less`è¿™ç§`loader`ä»–ä»¬ä¹Ÿéœ€è¦å»é…åˆæˆ‘ä»¬åˆšæ‰æ‰€è¯´åˆ°çš„è¿™ä¸¤ç§`loader`ï¼Œè¿™å°±æ˜¯`loader`çš„å·¥ä½œç®¡é“è¿™æ ·ä¸€ä¸ªç‰¹æ€§ã€‚

![loader ä¹‹é—´çš„é…åˆ](assets/img/2021-11-17-20-50-44.png)

### <mark>13) Webpack æ’ä»¶æœºåˆ¶</mark>

æ’ä»¶æœºåˆ¶çš„æ˜¯`webpack`ä¸€ä¸ªæ ¸å¿ƒç‰¹æ€§ï¼Œç›®çš„æ˜¯ä¸ºäº†å¢å¼º`webpack`è‡ªåŠ¨åŒ–æ–¹é¢çš„èƒ½åŠ›ã€‚

Loader ä¸“æ³¨å®ç°èµ„æºæ¨¡å—çš„åŠ è½½ï¼Œä»è€Œå»å®ç°æ•´ä½“é¡¹ç›®çš„æ‰“åŒ…ã€‚

Plugin è§£å†³é™¤äº†èµ„æºåŠ è½½ä»¥å¤–çš„å…¶ä»–çš„ä¸€äº›è‡ªåŠ¨åŒ–å·¥ä½œï¼š

+ è‡ªåŠ¨åœ¨æ‰“åŒ…ä¹‹å‰å»æ¸…é™¤ dist ç›®å½•

  + å®‰è£…ï¼š`yarn add clean-webpack-plugin --dev`

  + webpack.config.js:

    ```js
    const {CleanWebpackPlugin} = require('clean-webpack-plugin')
    plugins: [
      new CleanWebpackPlugin()
    ]
    ```

+ è‡ªåŠ¨ç”Ÿæˆ HTML æ’ä»¶

  + å®‰è£…ï¼š`yarn add html-webpack-plugin --dev`

    ```js
    const HtmlWebpackPlugin = require('html-webpack-plugin')
    plugins: [
      new CleanWebpackPlugin(),
      new HtmlWebpackPlugin()
    ]
    ```

  + è‡ªåŠ¨ç”Ÿæˆ`HTML`æ–‡ä»¶åˆ°`dist`ç›®å½•ä¸­ï¼Œæ ¹ç›®å½•ä¸‹çš„ index.html åˆ™ä¸å†éœ€è¦äº†

  + HTML ä¸­è‡ªåŠ¨æ³¨å…¥äº†`bundle.js`çš„å¼•ç”¨åˆ°`HTML`æ–‡ä»¶ä¸­

  + å¢åŠ é…ç½®å‚æ•°ç”Ÿæˆ HTML æ–‡ä»¶ï¼š

    ```js
    new HtmlWebpackPlugin({
      title: 'Webpack Plugin Sample',
      meta: {
        viewport: 'width=device-width'
      }
    })
    ```

  + é€šè¿‡æ¨¡æ¿æ–‡ä»¶ç”Ÿæˆ HTML æ–‡ä»¶ï¼Œwebpack.config.js ä¸­æŒ‡å®š HtmlWebpackPlugin çš„ template å‚æ•°

    ```html
    <!DOCTYPE html>
    <html lang="en">
    <head>
      <meta charset="UTF-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <title>webpack</title>
    </head>
    <body>
      <div class="container">
        <h1><%= htmlWebpackPlugin.options.title %></h1>
      </div>
    </body>
    </html>
    ```

    ```js
    plugins: [
      new CleanWebpackPlugin(),
      new HtmlWebpackPlugin({
        title: 'Webpack Plugin Sample',
        meta: {
          viewport: 'width=device-width'
        },
        template: './src/index.html'
      })
    ]
    ```

  + ç”Ÿæˆå¤šä¸ª HTML é¡µé¢

    ```js
     plugins: [
        new CleanWebpackPlugin(),
        // ç”¨äºç”Ÿæˆ index.html 
        new HtmlWebpackPlugin({
          title: 'Webpack Plugin Sample',
          meta: {
            viewport: 'width=device-width'
          },
          template: './src/index.html'
        }),
        // ç”¨äºç”Ÿæˆ about.html 
        new HtmlWebpackPlugin({
          filename: 'about.html'
        })
      ]
    ```

+ æ‹·è´é‚£äº›ä¸éœ€è¦å‚ä¸æ‰“åŒ…çš„èµ„æºæ–‡ä»¶åˆ°è¾“å‡ºç›®å½•

  + å®‰è£…ï¼š`yarn add copy-webpack-plugin --dev`

    ```js
    const CopyWebpackPlugin = require('copy-webpack-plugin')
    
    new CopyWebpackPlugin({
      patterns: ['public']
    })
    ```

+ å‹ç¼©æˆ‘ä»¬æ‰“åŒ…ç»“æœè¾“å‡ºçš„ä»£ç 

### <mark>14) webpack å¼€å‘æ’ä»¶</mark>

ç›¸æ¯”äº Loaderï¼ŒPlugin æ‹¥æœ‰æ›´å®½çš„èƒ½åŠ›èŒƒå›´ï¼ŒPlugin é€šè¿‡é’©å­æœºåˆ¶å®ç°ã€‚

![é’©å­](assets/img/2021-11-17-20-53-02.png)

Webpack è¦æ±‚æ’ä»¶å¿…é¡»æ˜¯ä¸€ä¸ªå‡½æ•°æˆ–è€…æ˜¯ä¸€ä¸ªåŒ…å« `apply` æ–¹æ³•çš„å¯¹è±¡ã€‚é€šè¿‡åœ¨ç”Ÿå‘½å‘¨æœŸçš„é’©å­ä¸­æŒ‚è½½å‡½æ•°å®ç°æ‰©å±•ã€‚

```js
class MyPlugin {
  apply (compiler) {
    console.log('MyPlugin å¯åŠ¨')
    compiler.hooks.emit.tap('MyPlugin', compilation => {
      // compilation å¯ä»¥ç†è§£ä¸ºæ­¤æ¬¡æ‰“åŒ…çš„ä¸Šä¸‹æ–‡
      for (const name in compilation.assets) {
        // console.log(name) // æ–‡ä»¶å
        console.log(compilation.assets[name].source())
        if(name.endsWith('.js')) {
          const contents = compilation.assets[name].source()
          const withoutComments = contents.replace(/\/\*\*+\//g, '')
          compilation.assets[name] = {
            source: () => withoutComments,
            size: () => withoutComments.length
          }
        }
      }
    })
  }
}
```

```js
plugins: [
  new MyPlugin()
]
```

### <mark>15) webpack å¼€å‘ä½“éªŒé—®é¢˜</mark>

![å¼€å‘ä½“éªŒ](assets/img/2021-11-17-20-57-04.png)

+ è‡ªåŠ¨è¿›è¡Œç¼–è¯‘ï¼šæ‰§è¡Œ`yarn webpack --watch`ä¼šç›‘è§†æ–‡ä»¶çš„å˜åŒ–è‡ªåŠ¨è¿›è¡Œæ‰“åŒ…
+ è‡ªåŠ¨åˆ·æ–°æµè§ˆå™¨ï¼šwebpack-dev-serverï¼Œå®‰è£…ï¼š`yarn add webpack-dev-server`, æ‰§è¡Œï¼š`yarn webpack-dev-server --open`

### <mark>16) webpack dev server é™æ€èµ„æºè®¿é—®</mark>

Dev Server é»˜è®¤åªä¼š serve æ‰“åŒ…å¥½çš„è¾“å‡ºæ–‡ä»¶ï¼Œåªè¦æ˜¯ webpack æ‰“åŒ…è¾“å‡ºçš„æ–‡ä»¶éƒ½ä¼šè¢«è®¿é—®åˆ°ï¼Œå…¶ä»–é™æ€èµ„æºä¹Ÿéœ€è¦è¢« server

```js
devServer: {
    contentBase: './public'
  }
```

`contentBase` é¢å¤–ä¸ºå¼€å‘æœåŠ¡å™¨æŒ‡å®šæŸ¥æ‰¾èµ„æºç›®å½•

### <mark>17) webpack Dev server ä»£ç† API</mark>

é—®é¢˜ï¼š

![é—®é¢˜](assets/img/2021-11-17-21-01-48.png)

è§£å†³ï¼š

![è§£å†³](assets/img/2021-11-17-21-04-57.png)

webpack-dev-server æ”¯æŒé…ç½®ä»£ç†

```js
  devServer: {
    contentBase: './public',
    proxy: {
      '/api': {
        // ä»¥ /api å¼€å¤´çš„åœ°å€éƒ½ä¼šè¢«ä»£ç†åˆ°æ¥å£å½“ä¸­ï¼Œä¹Ÿå°±æ˜¯æŠŠåè®®åŸŸåç«¯å£ç»™æ›¿æ¢äº†
        // http://localhost:8080/api/users -> https://api.github.com/api/users
        target: 'https://api.github.com',
        // http://localhost:8080/api/users -> https://api.github.com/users
        // æŠŠè·¯å¾„ä»¥ /api å¼€å¤´çš„æ›¿æ¢æˆç©ºå­—ç¬¦ä¸²
        pathRewrite: {
          '^/api': ''
        },
        // ä¸èƒ½ä½¿ç”¨ localhost:8080 ä½œä¸ºè¯·æ±‚ GitHub çš„ä¸»æœºå
        changeOrigin: true, // ä»¥å®é™…ä»£ç†çš„ä¸»æœºåå»è¯·æ±‚
      }
    }
  } 
```

â¹ï¼š[webpack é…ç½® changeOrigin æ— æ•ˆçš„è¯´æ˜](https://blog.csdn.net/qq_39291919/article/details/108807111)

### <mark>18) Source Map</mark>

è¿è¡Œä»£ç ä¸æºä»£ç ä¹‹é—´å®Œå…¨ä¸åŒï¼Œå¦‚æœéœ€è¦è°ƒè¯•åº”ç”¨ï¼Œé”™è¯¯ä¿¡æ¯æ— æ³•å®šä½ï¼Œè°ƒè¯•å’ŒæŠ¥é”™éƒ½æ˜¯åŸºäºè¿è¡Œä»£ç ï¼ŒSourceMap å°±æ˜¯è§£å†³è¿™ç§é—®é¢˜çš„æœ€å¥½åŠæ³•ã€‚

Source Map è§£å†³äº†æºä»£ç ä¸è¿è¡Œä»£ç ä¸ä¸€è‡´æ‰€äº§ç”Ÿçš„é—®é¢˜ã€‚

Webpack æ”¯æŒ sourceMap 12 ç§ä¸åŒçš„æ–¹å¼ï¼Œæ¯ç§æ–¹å¼çš„æ•ˆç‡å’Œæ•ˆæœå„ä¸ç›¸åŒã€‚æ•ˆæœæœ€å¥½çš„é€Ÿåº¦æœ€æ…¢ï¼Œé€Ÿåº¦æœ€å¿«çš„æ•ˆæœæœ€å·®

eval å‡½æ•°å¯ä»¥è¿è¡Œå­—ç¬¦ä¸²å½“ä¸­çš„ js ä»£ç ï¼š`eval("console.log(123)")`

å½“ DevTool çš„å€¼ä¸º evalï¼Œæ‰“åŒ…åçš„æŠ¥é”™ä¿¡æ¯åªæœ‰æºä»£ç æ–‡ä»¶åç§°ï¼Œæ²¡æœ‰è¡Œåˆ—ä¿¡æ¯

æ¯ä¸ªå…³é”®è¯çš„ç‰¹ç‚¹ç»„åˆï¼š

+ eval- æ˜¯å¦ä½¿ç”¨ eval æ‰§è¡Œä»£ç æ¨¡å—
+ cheap- Source map æ˜¯å¦åŒ…å«è¡Œä¿¡æ¯
+ module-æ˜¯å¦èƒ½å¤Ÿå¾—åˆ° Loader å¤„ç†ä¹‹å‰çš„æºä»£ç 
+ inline- SourceMap  ä¸æ˜¯ç‰©ç†æ–‡ä»¶ï¼Œè€Œæ˜¯ä»¥ URL å½¢å¼åµŒå…¥åˆ°ä»£ç ä¸­
+ hidden- çœ‹ä¸åˆ° SourceMap æ–‡ä»¶ï¼Œä½†ç¡®å®æ˜¯ç”Ÿæˆäº†è¯¥æ–‡ä»¶
+ nosources- æ²¡æœ‰æºä»£ç ï¼Œä½†æ˜¯æœ‰è¡Œåˆ—ä¿¡æ¯ã€‚ä¸ºäº†åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹ä¿æŠ¤æºä»£ç ä¸è¢«æš´éœ²

**å¼€å‘æ¨¡å¼æ¨èä½¿ç”¨ï¼š`eval-cheap-module-source-map`**ï¼Œå› ä¸ºï¼š

+ ä»£ç æ¯è¡Œä¸ä¼šå¤ªé•¿ï¼Œæ²¡æœ‰åˆ—ä¹Ÿæ²¡é—®é¢˜
+ ä»£ç ç»è¿‡ Loader è½¬æ¢åçš„å·®å¼‚è¾ƒå¤§
+ é¦–æ¬¡æ‰“åŒ…é€Ÿåº¦æ…¢æ— æ‰€è°“ï¼Œé‡æ–°æ‰“åŒ…ç›¸å¯¹è¾ƒå¿«

**ç”Ÿäº§æ¨¡å¼æ¨èä½¿ç”¨ï¼š`none`**ï¼ŒåŸå› 

+ Source Map ä¼šæš´éœ²æºä»£ç 
+ è°ƒè¯•æ˜¯å¼€å‘é˜¶æ®µçš„äº‹æƒ…
+ å¯¹ä»£ç å®åœ¨æ²¡æœ‰ä¿¡å¿ƒå¯ä»¥ä½¿ç”¨`nosources-source-map`

![source map](assets/img/2021-11-17-21-19-47.png)

### <mark>19) webpack HMR</mark>

HMR(Hot Module Replacement) æ¨¡å—çƒ­æ›¿æ¢ï¼Œåº”ç”¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå®æ—¶æ›¿æ¢æŸä¸ªæ¨¡å—ï¼Œåº”ç”¨è¿è¡ŒçŠ¶æ€ä¸å—å½±å“ã€‚

webpack-dev-server è‡ªåŠ¨åˆ·æ–°å¯¼è‡´çš„é¡µé¢çŠ¶æ€ä¸¢å¤±ã€‚æˆ‘ä»¬å¸Œæœ›åœ¨é¡µé¢ä¸åˆ·æ–°çš„å‰æä¸‹ï¼Œæ¨¡å—ä¹Ÿå¯ä»¥å³ä½¿æ›´æ–°ã€‚çƒ­æ›¿æ¢åªå°†ä¿®æ”¹çš„æ¨¡å—å®æ—¶æ›¿æ¢è‡³åº”ç”¨ä¸­ã€‚

HMR æ˜¯ webpack ä¸­æœ€å¼ºå¤§çš„åŠŸèƒ½ä¹‹ä¸€ï¼Œæå¤§ç¨‹åº¦çš„æé«˜äº†å¼€å‘è€…çš„å·¥ä½œæ•ˆç‡ã€‚

HMR å·²ç»é›†æˆåœ¨äº† webpack-dev-server ä¸­ï¼Œè¿è¡Œ`webpack-dev-server --hot`ï¼Œä¹Ÿå¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶å¼€å¯ã€‚

Webpack ä¸­çš„ HMR å¹¶ä¸æ˜¯å¯¹æ‰€æœ‰æ–‡ä»¶å¼€ç®±å³ç”¨ï¼Œæ ·å¼æ–‡ä»¶æ”¯æŒçƒ­æ›´æ–°ï¼Œè„šæœ¬æ–‡ä»¶éœ€è¦æ‰‹åŠ¨å¤„ç†æ¨¡å—çƒ­æ›¿æ¢é€»è¾‘ã€‚è€Œé€šè¿‡è„šæ‰‹æ¶åˆ›å»ºçš„é¡¹ç›®å†…éƒ¨éƒ½é›†æˆäº† HMR æ–¹æ¡ˆã€‚

HMR æ³¨æ„äº‹é¡¹ï¼š

+ å¤„ç† HMR çš„ä»£ç æŠ¥é”™ä¼šå¯¼è‡´è‡ªåŠ¨åˆ·æ–°
+ æ²¡å¯åŠ¨ HMR çš„æƒ…å†µä¸‹ï¼ŒHMR API æŠ¥é”™
+ ä»£ç ä¸­å¤šäº†å¾ˆå¤šä¸ä¸šåŠ¡æ— å…³çš„ä»£ç 

### <mark>20) webpack ç”Ÿäº§ç¯å¢ƒä¼˜åŒ–</mark>

æˆ‘ä»¬åœ¨å¼€å‘ç¯å¢ƒä¸­ï¼Œæ›´æ³¨é‡å¼€å‘æ•ˆç‡ã€‚

æ¨¡å¼ (mode)

webpack å»ºè®®æˆ‘ä»¬ä¸ºä¸åŒçš„ç¯å¢ƒåˆ›å»ºä¸åŒçš„é…ç½®ï¼Œä¸¤ç§æ–¹æ¡ˆï¼š

é…ç½®æ–‡ä»¶æ ¹æ®ç¯å¢ƒä¸åŒå¯¼å‡ºä¸åŒé…ç½®ï¼š

```js
const path = require('path')
const webpack = require('webpack')
const {CleanWebpackPlugin} = require('clean-webpack-plugin')
const HtmlWebpackPlugin = require('html-webpack-plugin')
const CopyWebpackPlugin = require('copy-webpack-plugin')

module.exports = (env, argv) => {
  const config = {
    mode: 'none',
    entry: './src/main.js',
    output: {
      filename: 'bundle.js',
      path: path.join(__dirname, 'dist'),
      // publicPath: 'dist/'
    },
    module: {
      rules: [
        {
          test: /.md$/,
          use: ['html-loader', './markdown-loader.js']
        }
      ]
    },
    plugins: [
      new CleanWebpackPlugin(),
      // ç”¨äºç”Ÿæˆ index.html 
      new HtmlWebpackPlugin({
        title: 'Webpack Plugin Sample',
        meta: {
          viewport: 'width=device-width'
        },
        template: './src/index.html'
      }),
      // ç”¨äºç”Ÿæˆ about.html 
      new HtmlWebpackPlugin({
        filename: 'about.html'
      }),
      // å¼€å‘è¿‡ç¨‹æœ€å¥½ä¸è¦ä½¿ç”¨è¿™ä¸ªæ’ä»¶
      // new CopyWebpackPlugin({
      //   patterns: ['public']
      // }),
      // new MyPlugin(),
      new webpack.HotModuleReplacementPlugin()
    ],
    devServer: {
      contentBase: './public',
      proxy: {
        '/api': {// ä»¥/api å¼€å¤´çš„åœ°å€éƒ½ä¼šè¢«ä»£ç†åˆ°æ¥å£å½“ä¸­
          // http://localhost:8080/api/users -> https://api.github.com/api/users
          target: 'https://api.github.com',
          // http://localhost:8080/api/users -> https://api.github.com/users
          pathRewrite: {
            '^/api': ''
          },
          // ä¸èƒ½ä½¿ç”¨ localhost:8080 ä½œä¸ºè¯·æ±‚ GitHub çš„ä¸»æœºå
          changeOrigin: true, // ä»¥å®é™…ä»£ç†çš„ä¸»æœºåå»è¯·æ±‚
        }
      },
      // hot: true
      hotOnly: true, // å¦‚æœçƒ­æ›¿æ¢ä»£ç æŠ¥é”™äº†ï¼Œåˆ™ä¸åˆ·æ–°
    },
    devtool: 'eval-cheap-module-source-map'
  }
  
  if (env === 'production') {
    config.mode = 'production'
    config.devtool = false
    config.plugins = [
      ...config.plugins,
      new CleanWebpackPlugin(),
      new CopyWebpackPlugin({
        patterns: ['public']
      })
    ]
  }
  return config
}
```

ä¸€ä¸ªç¯å¢ƒå¯¹åº”ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼š

Webpack.common.js

```js
const HtmlWebpackPlugin = require('html-webpack-plugin')

module.exports = {
  entry: './src/main.js',
  output: {
    filename: `bundle.js`
  },
  module: {
    rules: [
      {
        test: /\.js$/,
        use: {
          loader: 'babel-loader',
          options: {
            presets: ['@babel/preset-env']
          }
        }
      }
    ]
  },
  plugins: [
    new HtmlWebpackPlugin({
      filename: `index.html`
    })
  ]
}
```

Webpack.dev.js

```js
const common = require('./webpack.common')
const merge = require('webpack-merge')

module.export = merge(common, {
  mode: 'development',
})
```

Webpack.prod.js

```js
const common = require('./webpack.common')
const merge = require('webpack-merge')
const { CleanWebpackPlugin } = require('clean-webpack-plugin')
const CopyWebpackPlugin = require('copy-webpack-plugin')

module.exports = merge(common, {
  mode: 'production',
  plugins: [
    new CleanWebpackPlugin(),
    new CopyWebpackPlugin({
        patterns: ['public']
    })
  ]
})
```

package.json

```json
{
  "scripts": {
    "build": "webpack --config webpack.prod.js"
  }
}
```

æ‰§è¡Œæ‰“åŒ…å‘½ä»¤ï¼š`yarn build`

### <mark>21) webpack ä¼˜åŒ–é…ç½®</mark>

DefinePlugin ä¸ºä»£ç æ³¨å…¥å…¨å±€æˆå‘˜ï¼Œè¿™ä¸ªå†…ç½®æ’ä»¶é»˜è®¤å°±ä¼šå¯åŠ¨ï¼Œå¾€æ¯ä¸ªä»£ç ä¸­æ³¨å…¥ä¸€ä¸ªå…¨å±€å˜é‡`process.env.NODE_ENV`

```js
const webpack = require('webpack')

plugins: [
    new HtmlWebpackPlugin({
      filename: `index.html`
    }),
    new webpack.DefinePlugin({
      // ä¸åŒçš„ç¯å¢ƒ API æ¥å£æ˜¯ä¸ä¸€æ ·çš„ï¼Œæ³¨æ„ value æ˜¯ä¸€æ®µ JS ä»£ç ï¼Œç›´æ¥å†™å­—ç¬¦ä¸²çš„è¯ï¼Œé‚£å¤„ç†å®Œè¿‡åå°±æ˜¯ä¸€ä¸ªå˜é‡äº†
      API_BASE_URL: JSON.stringify('http://api.example.com')
    })
  ]
```

Tree-Shaking æ‘‡æ‰ä»£ç ä¸­æœªå¼•ç”¨åˆ°çš„ä»£ç  (dead-code), è¿™ä¸ªåŠŸèƒ½åœ¨ç”Ÿäº§æ¨¡å¼ä¸‹è‡ªåŠ¨è¢«å¼€å¯ã€‚Tree-Shaking å¹¶ä¸æ˜¯ webpack ä¸­çš„æŸä¸€ä¸ªé…ç½®é€‰é¡¹ï¼Œè€Œæ˜¯ä¸€ç»„åŠŸèƒ½æ­é…ä½¿ç”¨åçš„æ•ˆæœã€‚

```js
optimization: {
    // æ ‡è®°æ¯æ ‘æ  
    usedExports: true,
    // æŠŠæ¯æ ‘ææ‘‡æ‰
    minimize: true
  }
```

åˆå¹¶æ¨¡å—å‡½æ•° `concatenateModules`, åˆè¢«æˆä¸º Scope Hoistingï¼Œä½œç”¨åŸŸæå‡

```js
optimization: {
    usedExports: true,
    minimize: true,
    // æ²¡æœ‰è¿™ä¸ª key çš„æ—¶å€™ï¼Œæ‰“åŒ…æ—¶ä¼šç»™æ¯ä¸ªæ¨¡å—éƒ½ç»™åˆ†é…äº†ä¸€ä¸ª IIFEï¼Œè€Œç°åœ¨å¼€å¯äº†å®ƒï¼Œé‚£ä¹ˆæ‰€æœ‰çš„ ES æ¨¡å—éƒ½è¢«æ”¾åˆ°ä¸€ä¸ª IIFE é‡Œè¾¹ -> èŠ‚çœä»£ç ä½“ç§¯ï¼Œæå‡è¿è¡Œæ•ˆç‡
    concatenateModules: true
  }
```

+ å¾ˆå¤šèµ„æ–™ä¸­è¯´å¦‚æœä½¿ç”¨ Babel-Loaderï¼Œä¼šå¯¼è‡´ Tree-Shaking å¤±æ•ˆï¼Œå› ä¸º Tree-Shaking å‰ææ˜¯ ES Modulesï¼Œç”± Webpack æ‰“åŒ…çš„ä»£ç å¿…é¡»ä½¿ç”¨ ESMï¼Œä¸ºäº†è½¬åŒ– ES ä¸­çš„æ–°ç‰¹æ€§ï¼Œä¼šä½¿ç”¨ babel å¤„ç†æ–°ç‰¹æ€§ï¼Œå°±æœ‰å¯èƒ½å°† ESM è½¬åŒ– CommonJSï¼Œè€Œæˆ‘ä»¬ä½¿ç”¨çš„`@babel/preset-env`è¿™ä¸ªæ’ä»¶é›†åˆå°±ä¼šè½¬åŒ– ESM ä¸º CommonJSï¼Œæ‰€ä»¥ Tree-Shaking ä¼šä¸ç”Ÿæ•ˆã€‚**ä½†æ˜¯åœ¨æœ€æ–°ç‰ˆ babel-loader å…³é—­äº†è½¬æ¢ ESM çš„æ’ä»¶ï¼Œæ‰€ä»¥ä½¿ç”¨ babel-loader ä¸ä¼šå¯¼è‡´ Tree-Shaking å¤±æ•ˆ** -> **æ ‡è®°æ¯æ ‘æå¤±æ•ˆäº†ï¼Œè¿™æ˜¯å› ä¸ºä½ æŠŠ ESM ææˆæ˜¯ CommonJS äº†**

+ sideEffects å‰¯ä½œç”¨ï¼ŒæŒ‡çš„æ˜¯æ¨¡å—æ‰§è¡Œæ—¶é™¤äº†å¯¼å‡ºæˆå‘˜ä¹‹å¤–æ‰€åšçš„äº‹æƒ…ï¼ŒsideEffects ä¸€èˆ¬ç”¨äº npm åŒ…æ ‡è®°æ˜¯å¦æœ‰å‰¯ä½œç”¨ã€‚å¦‚æœæ²¡æœ‰å‰¯ä½œç”¨ï¼Œåˆ™æ²¡æœ‰ç”¨åˆ°çš„æ¨¡å—åˆ™ä¸ä¼šè¢«æ‰“åŒ…ã€‚

åœ¨ webpack.config.js ä¸­å¼€å¯è¿™ä¸ªåŠŸèƒ½ï¼š

```js
optimization: {
  usedExports: true,
  minimize: true,
  concatenateModules: true,
  sideEffects: true
}
```

åœ¨ package.json é‡Œé¢å¢åŠ ä¸€ä¸ªå±æ€§ sideEffects, å€¼ä¸º falseï¼Œè¡¨ç¤ºæ²¡æœ‰å‰¯ä½œç”¨ï¼Œæ²¡æœ‰ç”¨åˆ°çš„ä»£ç åˆ™ä¸è¿›è¡Œæ‰“åŒ…ã€‚ç¡®ä¿ä½ çš„ä»£ç çœŸçš„æ²¡æœ‰å‰¯ä½œç”¨ï¼Œå¦åˆ™åœ¨ webpack æ‰“åŒ…æ—¶å°±ä¼šè¯¯åˆ æ‰æœ‰å‰¯ä½œç”¨çš„ä»£ç ï¼Œæ¯”å¦‚è¯´åœ¨åŸå‹ä¸Šæ·»åŠ æ–¹æ³•ï¼Œåˆ™æ˜¯å‰¯ä½œç”¨ä»£ç ï¼›è¿˜æœ‰ CSS ä»£ç ä¹Ÿå±äºå‰¯ä½œç”¨ä»£ç ã€‚

```json
{
  "sideEffects": false
}
```

  ä¹Ÿå¯ä»¥å¿½ç•¥æ‰æœ‰å‰¯ä½œç”¨çš„ä»£ç ï¼š

```json
// è™½ç„¶è¿™äº›æ¨¡å—æ²¡æœ‰å¯¼å‡ºï¼Œä½†å®ƒä»¬çš„åŠ è½½è¿˜æ˜¯èµ·åˆ°äº†ä½œç”¨ï¼Œå½“ä½ åœ¨ package.json é‡Œè¾¹å£°æ˜äº†æ²¡æœ‰å‰¯ä½œç”¨
// é‚£ä¹ˆå¯¹äºé‚£äº›äº§ç”Ÿäº†å‰¯ä½œç”¨çš„æ¨¡å—ï¼Œä½ å°±åº”è¯¥å¿½ç•¥æ‰å®ƒä»¬
{
  "sizeEffects": [
    "./src/extend.js",
    "*.css"
  ]
}
```

### <mark>22) Code Splitting ä»£ç åˆ†åŒ…/ä»£ç åˆ†å‰²</mark>

webpack çš„ä¸€ä¸ªå¼Šç«¯ï¼šæ‰€æœ‰çš„ä»£ç éƒ½ä¼šè¢«æ‰“åŒ…åˆ°ä¸€èµ·ï¼Œå¦‚æœåº”ç”¨å¤æ‚ï¼Œbundle ä¼šéå¸¸å¤§ã€‚è€Œå¹¶ä¸æ˜¯æ¯ä¸ªæ¨¡å—åœ¨å¯åŠ¨æ—¶éƒ½æ˜¯å¿…è¦çš„ï¼Œæ‰€ä»¥éœ€è¦åˆ†åŒ…ã€æŒ‰éœ€åŠ è½½ã€‚ç‰©æå¿…åï¼Œèµ„æºå¤ªå¤§äº†ä¸è¡Œï¼Œå¤ªç¢äº†ä¹Ÿä¸è¡Œã€‚å¤ªå¤§äº†ä¼šå½±å“åŠ è½½é€Ÿåº¦ï¼›å¤ªç¢äº†ä¼šå¯¼è‡´è¯·æ±‚æ¬¡æ•°è¿‡å¤šï¼Œå› ä¸ºåœ¨ç›®å‰ä¸»æµçš„ HTTP1.1 æœ‰å¾ˆå¤šç¼ºé™·ï¼Œå¦‚åŒåŸŸå¹¶è¡Œè¯·æ±‚é™åˆ¶ã€æ¯æ¬¡è¯·æ±‚éƒ½ä¼šæœ‰ä¸€å®šçš„å»¶è¿Ÿï¼Œè¯·æ±‚çš„ Header æµªè´¹å¸¦å®½æµé‡ã€‚æ‰€ä»¥æ¨¡å—æ‰“åŒ…æ—¶æœ‰å¿…è¦çš„ã€‚

> æœ‰äº›æ¨¡å—å¦‚ä¸€ä¸ªå°å°çš„åŠŸèƒ½å‡½æ•°ä¹Ÿä¼šè¢«åˆ’åˆ†æˆæ¨¡å—ï¼Œå¾ˆå¤šå°æ¨¡å—è¢«è¯·æ±‚ï¼Œé‚£æ¯ä¸€ä¸ªè¯·æ±‚çš„è¯·æ±‚å¤´è‚¯å®šæ˜¯æœ‰é‡å¤çš„

ç›®å‰çš„ webpack åˆ†åŒ…æ–¹å¼æœ‰ä¸¤ç§ï¼š

ğŸ’¡ï¼šå¤šå…¥å£æ‰“åŒ…ï¼Ÿ

é€‚ç”¨äºå¤šé¡µåº”ç”¨ç¨‹åºï¼Œä¸€ä¸ªé¡µé¢å¯¹åº”ä¸€ä¸ªæ‰“åŒ…å…¥å£ï¼Œå…¬å…±éƒ¨åˆ†å•ç‹¬æŠ½å–ã€‚

```js
entry: {
  index: './src/index.js',
    album: './src/album.js'
},
output: {
    filename: '[name].bundle.js'
},
// æ¯ä¸ªæ‰“åŒ…å…¥å£å½¢æˆä¸€ä¸ªç‹¬ç«‹çš„ chunk
// ä¹Ÿå°±æ˜¯è¯´æŠŠæ‰“åŒ…å‡ºæ¥çš„ bundle.js å„è‡ªæ³¨å…¥åˆ°å®ƒä»¬çš„ HTML ä¸­
// å¦‚æœä¸å†™ chunks çš„è¯ï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªæ‰“åŒ…ç»“é»˜è®¤éƒ½ä¼šæ³¨å…¥åˆ° index.html ä¸­
plugins: [
    new HtmlWebpackPlugin({
      title: 'Multi Entry',
      template: './src/index.html',
      filename: 'index.html',
      chunks: ['index']
    }),
    new HtmlWebpackPlugin({
      title: 'Nulti Entry',
      template: './src/album.html',
      filename: 'album.html',
      chunks: ['album']
    })
  ],
// ä¸åŒçš„æ‰“åŒ…å…¥å£è‚¯å®šä¼šæœ‰å…¬å…±æ¨¡å—ï¼Œå¦‚æ¯”è¾ƒå¤§çš„ jQueryï¼Œæˆ‘ä»¬éœ€è¦æå–å…¬å…±æ¨¡å—ï¼š
  optimization: {
    splitChunks: {
      chunks: 'all'
    }
  }
```

ğŸ’¡ï¼šåŠ¨æ€å¯¼å…¥ï¼Ÿ

éœ€è¦ç”¨åˆ°æŸä¸ªæ¨¡å—æ—¶ï¼Œå†åŠ è½½è¿™ä¸ªæ¨¡å—ï¼ŒåŠ¨æ€å¯¼å…¥çš„æ¨¡å—ä¼šè¢«è‡ªåŠ¨åˆ†åŒ…ã€‚é€šè¿‡åŠ¨æ€å¯¼å…¥ç”Ÿæˆçš„æ–‡ä»¶åªæ˜¯ä¸€ä¸ªåºå·ï¼Œå¯ä»¥ä½¿ç”¨**é­”æ³•æ³¨é‡Š**æŒ‡å®šåˆ†åŒ…äº§ç”Ÿ bundle çš„åç§°ã€‚ç›¸åŒçš„ chunk åä¼šè¢«æ‰“åŒ…åˆ°ä¸€èµ·ã€‚ -> åŠ¨æ€å¯¼å…¥ï¼ŒæŒ‰éœ€åŠ è½½ï¼Œä¸€èˆ¬é’ˆå¯¹ç»„ä»¶ -> åˆ†åŒ…æ˜¯æŒ‡ 1 ä¸ªæ¨¡å— æˆ–å¤šä¸ªæ¨¡å—è¢«æ‰“åŒ…å‡ºæ¥çš„ bundleï¼Œä¸€ä¸ª bundle å°±æ˜¯ä¸€ä¸ªåŒ…ï¼Œè¿™ä¸ªåŒ…å¯èƒ½æ˜¯ç”±å¤šä¸ªæ¨¡å—ç»„æˆçš„ï¼Œä¹Ÿæœ‰å¯èƒ½åªæ˜¯ç”±ä¸€ä¸ªæ¨¡å—æ‰€ç»„æˆçš„ï¼ -> ç”¨åˆ°äº† ESM æä¾›çš„ `import`å‡½æ•°

```js
import(/* webpackChunkName: 'posts' */'./post/posts').then({default: posts}) => {
  mainElement.appendChild(posts())
}
```

### <mark>23) MiniCssExtractPlugin å¯ä»¥æå– CSS åˆ°å•ä¸ªæ–‡ä»¶</mark>

å½“ css ä»£ç è¶…è¿‡ **150kb** å·¦å³æ‰å»ºè®®ä½¿ç”¨ã€‚è€Œä½äº 150kbï¼Œé‚£è¿˜æ˜¯ç”¨ `style` æ ‡ç­¾å§ï¼Œå› ä¸ºæ­¤æ—¶å‡å°‘ä¸€æ¬¡è¯·æ±‚æ›´åˆ’ç®—ï¼

```js
const MiniCssExtracPlugin = require('mini-css-extract-plugin')

module: {
  rules: [
    {
      test: /\.css$/,
      use: [
        // 'style-loader',
        MiniCssExtracPlugin.loader,
        'css-loader'
      ]
    }
  ]
},
```

### <mark>24) OptimizeCssAssetsWebpackPlugin å‹ç¼©è¾“å‡ºçš„ CSS æ–‡ä»¶</mark>

webpack ä»…æ”¯æŒå¯¹ js çš„å‹ç¼©ï¼Œå…¶ä»–æ–‡ä»¶çš„å‹ç¼©éœ€è¦ä½¿ç”¨æ’ä»¶ã€‚

å¯ä»¥ä½¿ç”¨ `optimize-css-assets-webpack-plugin` å‹ç¼© CSS ä»£ç ã€‚æ”¾åˆ° minimizer ä¸­ï¼Œåœ¨ç”Ÿäº§æ¨¡å¼ä¸‹å°±ä¼šè‡ªåŠ¨å‹ç¼© -> ç”Ÿæˆæ¨¡å¼ä¸‹ä¼šè‡ªåŠ¨å¼€å¯å‹ç¼©å‘½ä»¤ï¼Œè€Œå¼€å‘æ¨¡å¼åˆ™ä¸ä¼šï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥åœ¨å¼€å‘æ¨¡å¼ä¸‹é…ç½®å…³äº CSS çš„å‹ç¼©æ’ä»¶

```js
optimization: {
  minimizer: [
    new TerseWebpackPlugin(), // æŒ‡å®šäº† minimizer è¯´æ˜è¦è‡ªå®šä¹‰å‹ç¼©å™¨ï¼Œæ‰€ä»¥è¦æŠŠ JS çš„å‹ç¼©å™¨æŒ‡æŒ‡æ˜ï¼Œå¦åˆ™æ— æ³•å‹ç¼©
    new OptimizeCssAssetWebpackPlugin()
  ]
}
```

### <mark>25) è¾“å‡ºæ–‡ä»¶å hash</mark>

> substitutions

ç”Ÿäº§æ¨¡å¼ä¸‹ï¼Œæ–‡ä»¶åä½¿ç”¨ Hash

é¡¹ç›®çº§åˆ«çš„ hash -> ä¸€ä¸ªæ¨¡å—æ–‡ä»¶å˜åŒ–ï¼Œæ‰€æœ‰çš„ bundle éƒ½ä¼šå˜

```js
output: {
  filename: '[name]-[hash].bundle.js'
},
```

chunk çº§åˆ«çš„ hash -> åŒä¸€è·¯çš„éƒ½ä¼šå˜ï¼Œå…¥å£æ–‡ä»¶å› ä¸ºè·¯å¾„å˜åŒ–ï¼Œè€Œè¢«åŠ¨å˜åŒ–

```js
output: {
  filename: '[name]-[chunkhash].bundle.js'
},
```

æ–‡ä»¶çº§åˆ«çš„ hashï¼Œ`:8`æ˜¯æŒ‡å®š hash é•¿åº¦ ï¼ˆ**æ¨è**ï¼‰ -> ä¸€ä¸ªæ¨¡å—æ–‡ä»¶å˜äº†ï¼Œé‚£å…³äºè¿™ä¸ªæ–‡ä»¶çš„ bundle ä¼šå˜ï¼Œå½“ç„¶å…¥å£æ–‡ä»¶ä¹Ÿä¼šå› ä¸ºè·¯å¾„è€Œå‘ç”Ÿå˜åŒ–

```js
output: {
  filename: '[name]-[contenthash:8].bundle.js'
},
```
