### âœï¸ Tangxt â³ 2021-10-30 ğŸ·ï¸ å·¥ç¨‹åŒ–

# 11-Gulp æ¡ˆä¾‹ - æ–‡ä»¶å‹ç¼©ã€Gulp æ¡ˆä¾‹ - é‡æ–°è§„åˆ’æ„å»ºè¿‡ç¨‹ã€Gulp æ¡ˆä¾‹ - è¡¥å……

## â˜…Gulp æ¡ˆä¾‹ - æ–‡ä»¶å‹ç¼©

![æ–‡ä»¶å‹ç¼©](assets/img/2021-10-30-21-08-39.png)

æœ‰äº† `useref` è¿‡åï¼Œå®ƒå°±è‡ªåŠ¨çš„å¸®æˆ‘ä»¬æŠŠå¯¹åº”çš„é‚£äº›ä¾èµ–çš„æ–‡ä»¶å…¨éƒ¨æ‹¿è¿‡æ¥äº†

ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯éœ€è¦å†å»åšä¸€ä¸ªé¢å¤–çš„æ“ä½œ -> å°±æ˜¯å¯¹è¿™äº›ç”Ÿæˆçš„æ–‡ä»¶åšä¸€ä¸ªå‹ç¼©çš„è¿‡ç¨‹ã€‚

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å‹ç¼©çš„æ–‡ä»¶æœ‰ä¸‰ç§ï¼š

- ä¸€ä¸ªæ˜¯ HTML
- ä¸€ä¸ªæ˜¯ JS 
- ä¸€ä¸ªæ˜¯ CSS

HTML æˆ‘ä»¬ç›´æ¥é€šè¿‡ `src` è¿™ä¸ªè¯»å–æµåˆ›å»ºå‡ºæ¥çš„ï¼Œè€Œ JS æ–‡ä»¶å’Œ CSS æ–‡ä»¶æ˜¯ `useref` åœ¨å·¥ä½œçš„è¿‡ç¨‹å½“ä¸­åˆ›å»ºå‡ºæ¥çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬åœ¨è¿™ä¸ªç®¡é“æ¥ç€å¾€ä¸‹å»èµ°çš„æ—¶å€™ï¼Œæ­¤å¤„ä¼šæœ‰ä¸‰ç§æ–‡ä»¶ç±»å‹`html js css`

![å‹ç¼©](assets/img/2021-10-30-21-32-39.png)

è¿™ä¸‰ç§æ–‡ä»¶ç±»å‹æˆ‘ä»¬éœ€è¦åˆ†åˆ«å»åšä¸åŒçš„å‹ç¼©å·¥ä½œã€‚

æˆ‘ä»¬éœ€è¦å»ä¸ºå®ƒä»¬å®‰è£…ä¸åŒçš„å‹ç¼©æ’ä»¶ï¼š

``` bash
yarn add gulp-htmlmin gulp-uglify gulp-clean-css --dev
```

è¿™ä¸ªä¸‰ä¸ªæ¨¡å—åˆ†åˆ«å‹ç¼© -> `html js css`

æœ‰äº†è¿™ä¸‰ä¸ªæ¨¡å—å„¿è¿‡åï¼Œæˆ‘ä»¬å°±å¯ä»¥å›åˆ°`gulpfile`é‡Œè¾¹å»ä½¿ç”¨äº†ã€‚

ä½†æ˜¯ï¼Œæ­¤æ—¶å°±ä¼šé‡åˆ°ä¸€ä¸ªå°é—®é¢˜ï¼Œå› ä¸ºåœ¨æˆ‘ä»¬ä¹‹å‰çš„æ„å»ºä»»åŠ¡å½“ä¸­ï¼Œæ¯ä¸€æ¬¡æˆ‘ä»¬çš„è¯»å–æµå½“ä¸­éƒ½æ˜¯åŒç±»å‹çš„æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯¹å®ƒåšç›¸åŒçš„æ“ä½œæ˜¯åˆç†çš„ã€‚

ä½†æ˜¯æˆ‘ä»¬è¿™ä¸ªæ—¶å€™è¯»å–æµå½“ä¸­æœ‰ä¸‰ç§ç±»å‹çš„æ–‡ä»¶ï¼Œé‚£æˆ‘ä»¬å°±éœ€è¦åˆ†åˆ«å¯¹å®ƒä»¬åšä¸åŒçš„æ“ä½œã€‚

é‚£è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªé¢å¤–çš„æ“ä½œ -> è¿™ä¸ªæ“ä½œå°±æ˜¯ã€Œåˆ¤æ–­ä¸€ä¸‹è¿™ä¸ªè¯»å–æµå½“ä¸­æ˜¯ä»€ä¹ˆæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±åšä»€ä¹ˆæ“ä½œã€ã€‚ -> è¿™éœ€è¦ä¸€ä¸ª`gulp-if`æ’ä»¶ï¼Œæˆ‘ä»¬å•ç‹¬å®‰è£…ä¸€ä¸‹å®ƒ

``` bash
yarn add gulp-if --dev
```

æœ‰äº†è¿™ä¸ªæ’ä»¶è¿‡åï¼Œæˆ‘ä»¬å°±å¯ä»¥å›åˆ°`gulpfile`é‡Œè¾¹å»å°è¯•ä½¿ç”¨å®ƒäº†ã€‚

é¦–å…ˆç¬¬ä¸€ä¸ªæˆ‘ä»¬å…ˆ `pipe` -> `pipe` åˆ°ä»€ä¹ˆå‘¢ï¼Ÿ -> `plugins.if()`

è¿™ä¸ª`if`å®ƒä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªè½¬æ¢æµï¼Œåªä¸è¿‡åœ¨è¿™ä¸ªè½¬åŒ–æµåŠ¨å†…éƒ¨ï¼Œå®ƒä¼šæ ¹æ®æˆ‘ä»¬ç»™`if` æŒ‡å®šçš„è¿™ä¸ªæ¡ä»¶å»å†³å®šæ˜¯å¦è¦å»æ‰§è¡Œå…·ä½“çš„è½¬æ¢æµã€‚

![if](assets/img/2021-10-30-21-44-36.png)

ç¬¬ä¸€ä¸ªå‚æ•°æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªæ­£åˆ™ -> è¿™ä¸ªæ­£åˆ™ä¼šè‡ªåŠ¨å»åŒ¹é…æˆ‘ä»¬è¿™ä¸ªæ–‡ä»¶è¯»å–æµå½“ä¸­çš„æ–‡ä»¶è·¯å¾„ï¼Œæˆ‘ä»¬æ ¹æ®æ–‡ä»¶çš„æ‰©å±•åå»åˆ¤æ–­ -> åˆ¤æ–­æ‰©å±•åçš„æ–¹å¼ï¼Œå°±æ˜¯åˆ¤æ–­å®ƒæ˜¯å¦ä»¥`.js`ç»“å°¾ -> `$`ç¬¦å°±æ˜¯æ­£åˆ™å½“ä¸­ç»“å°¾çš„ä¸€ä¸ªå¼ºåˆ¶åŒ¹é…ç¬¦ã€‚

é‚£è¿™æ ·çš„è¯ï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬çš„è¿™ä¸€ä¸ªè·¯å¾„ä¸€æ—¦è¦æ˜¯åŒ¹é…`.js`ç»“å°¾çš„è¯ï¼Œå®ƒå°±ä¼šæ‰§è¡Œæˆ‘ä»¬åé¢æ‰€æŒ‡å®šçš„è½¬æ¢æµã€‚

ç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯æŒ‡å®šæˆ‘ä»¬éœ€è¦å»å·¥ä½œçš„è½¬åŒ–æµ `plugins.uglily`

è‡³æ­¤ï¼Œè¿™ä¸ª`uglily`å°±å¯ä»¥å·¥ä½œäº† -> å®ƒä¼šè‡ªåŠ¨çš„å»åˆ¤æ–­å¯¹åº”çš„è¿™ä¸ªæ–‡ä»¶çš„è·¯å¾„ï¼Œç„¶åå»å†³å®šæ˜¯å¦è¦æ‰§è¡Œè¿™ä¸ªè½¬åŒ–æµã€‚

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å»é‡æ–°è¿è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬å°è¯•ç€è¿è¡Œä¸€ä¸‹ã€‚ 

``` bash
yarn gulp useref
```

æ‰§è¡Œå®Œäº†è¿‡åï¼Œæˆ‘ä»¬å›åˆ°è¿™ä¸ªä»£ç å½“ä¸­ï¼Œæˆ‘ä»¬æ¥çœ‹ `dist` çš„ä¸‹é¢ç”Ÿæˆçš„è¿™ä¸ª scriptsï¼ˆ`vendor.js`ï¼‰ï¼š

![å‹ç¼©](assets/img/2021-10-31-00-08-32.png)

ä½ ä¼šå‘ç°å®ƒå¹¶æ²¡æœ‰è¢«å‹ç¼©ã€‚

æ‰€ä»¥è¿™ä¸ªé“ç†æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªé“ç†å¾ˆç®€å•ï¼Œä½ æŠŠè¿™ä¸ª`vendor.js`åˆ äº†ï¼Œä½ å¯èƒ½å°±èƒ½æ˜ç™½äº†

æˆ‘ä»¬å†æ‰§è¡Œä¸€ä¸‹ `useref`ï¼š

``` bash
yarn gulp useref
```

ä½ ä¼šå‘ç°æ­¤æ¬¡æˆ‘ä»¬å·¥ä½œå®Œäº†è¿‡åï¼Œå®ƒå¹¶ä¸ä¼šç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ï¼š

![vendor.js](assets/img/2021-10-31-00-13-40.png)

è¿™ä¸ªé“ç†å¾ˆç®€å•ï¼Œå› ä¸ºæˆ‘ä»¬ç¬¬ä¸€æ¬¡å»æ‰§è¡Œè¿™ä¸ª `useref` çš„æ—¶å€™ï¼Œå®ƒå·²ç»æŠŠ HTML é‡Œé¢çš„é‚£äº›æ„å»ºæ³¨é‡Šéƒ½å·²ç»åˆ é™¤æ‰äº†ï¼Œä½ å†å»æ„å»ºçš„æ—¶å€™ï¼Œæ­¤æ—¶ï¼Œå®ƒé‡Œé¢æ²¡æœ‰é‚£äº›æ„å»ºæ³¨é‡Š -> é‚£`useref` å°±ä¸ä¼šäº§ç”Ÿ JS æ–‡ä»¶ï¼Œæ‰€ä»¥ä½ å°±ä¸ä¼šæœ‰è¿™ç§æ‰€è°“çš„å‹ç¼©çš„ä¸€ä¸ªè½¬æ¢äº†ã€‚

![å‹ç¼©ä¸èµ·ä½œç”¨](assets/img/2021-10-31-00-16-04.png)

æ‰€ä»¥æˆ‘ä»¬ä¸èƒ½å•çº¯çš„å»æ‰§è¡Œè¿™ä¸ª `useref`ï¼Œæˆ‘ä»¬éœ€è¦å…ˆå»æ‰§è¡Œä¸€ä¸‹ `compile`ï¼Œç„¶åå†å»æ‰§è¡Œè¿™ä¸ª `useref`

å…ˆæ‰§è¡Œä¸€ä¸‹ `compile`ï¼š

``` bash
yarn gulp compile
```

`compile` æ‰§è¡Œå®Œäº†è¿‡åå†å»æ‰§è¡Œ`useref`ï¼š

``` bash
yarn gulp useref
```

æˆ‘ä»¬éœ€è¦ç­‰ä¸€ä¼šå„¿ï¼Œå› ä¸ºè¿™ä¸ªå‹ç¼©è¿‡ç¨‹çš„æ—¶é—´ä¼šç›¸å¯¹é•¿ä¸€äº› -> **è¿™ä¸ªå‹ç¼©ä¸€å®šæ˜¯æ”¾åœ¨ä¸Šçº¿ä¹‹å‰çš„é‚£ä¸ªæ„å»ºä»»åŠ¡ï¼Œå®ƒä¸èƒ½åœ¨å¼€å‘é˜¶æ®µç”¨ï¼Œä¸ç„¶ï¼Œä½ åœ¨å¼€å‘é˜¶æ®µç”¨çš„è¯ï¼Œé‚£å°±ä¼šç‰¹åˆ«æ…¢**ã€‚

![å‹ç¼© js](assets/img/2021-10-31-00-21-51.png)

æ­¤æ—¶æˆ‘ä»¬ä¼šå‘ç° `vendor.js` å½“ä¸­ï¼Œè¿˜æœ‰æˆ‘ä»¬çš„ `main.js`å½“ä¸­éƒ½æ˜¯å‹ç¼©è¿‡åçš„ä»£ç äº† -> è¿™ä¸ªå°±æ˜¯å¯¹äº JS çš„å‹ç¼© -> å¯¹äº CSS å’Œ HTML çš„å‹ç¼©éƒ½æ˜¯ä»¥æ­¤ç±»æ¨ã€‚

`.css`ç»“å°¾çš„ -> æˆ‘ä»¬æ‰§è¡Œ`cleanCss`

å¯¹äº`.html`ç»“å°¾çš„ -> æˆ‘ä»¬å°±æ‰§è¡Œ`htmlmin`

![å‹ç¼© css å’Œ html](assets/img/2021-10-31-00-26-45.png)

ä¿å­˜ä¸€ä¸‹ã€‚

æœ‰äº†è¿™ä¸‰ä¸ªè¿‡åï¼Œæˆ‘ä»¬å†æ¥å»é‡æ–°è¿è¡Œä¸€ä¸‹ `compile`ï¼Œç„¶åå†å»è¿è¡Œè¿™ä¸ª `useref` 

æ­¤æ—¶è¿™ä¸ªæ—¶é—´ç›¸å¯¹æ¥è®²ä¼šæ›´é•¿ä¸€äº› -> ç­‰å¾…ä¸€ä¸‹ã€‚

![å‹ç¼© css](assets/img/2021-10-31-00-55-18.png)

å®Œæˆè¿‡åï¼Œæˆ‘ä»¬å†å»çœ‹ä¸€ä¸‹è¿™ä¸ª CSS æ–‡ä»¶æœ‰æ²¡æœ‰å‹ç¼© -> è¿™ä¸ª`main.css`å½“ä¸­æ ¹æœ¬å°±æ²¡æœ‰ä»»ä½•çš„å†…å®¹ï¼Œè€Œ`vendor.css`å½“ä¸­åˆå¥½åƒæ˜¯æ­£å¸¸çš„ã€‚

`useref`è¿™ä¸ªä»»åŠ¡ï¼Œå…¶å®è¿™å°±æš´éœ²å‡ºæ¥æˆ‘ä»¬è¿™æ ·å»ç”¨çš„ä¸€ä¸ªå°é—®é¢˜äº† -> `src`æ˜¯è¯»å–æµ `dist` çš„ä¸‹é¢çš„è¿™äº›æ–‡ä»¶ï¼Œç„¶åæˆ‘ä»¬åˆæŠŠè¿™ä¸ªæ–‡ä»¶å†™å…¥åˆ°å†™å…¥æµå½“ä¸­ -> æ­¤æ—¶å…¶å®å°±äº§ç”Ÿäº†ä¸€ä¸ª**æ–‡ä»¶è¯»å†™çš„å†²çª** -> è¿™å°±å¥½æ¯”æ¥è¯´ï¼Œä½ ä¸€è¾¹åœ¨è¯»ä¸€è¾¹åœ¨å†™ï¼Œè¿™ä¸¤ä¸ªè¯»å†™å¦‚æœæ²¡æœ‰åˆ†ç¦»å¼€çš„è¯ï¼Œå®ƒå¾ˆæœ‰å¯èƒ½äº§ç”Ÿè¿™ä¸ªè¯»å†™æ–‡ä»¶å†™ä¸è¿›å»çš„è¿™ç§æƒ…å†µã€‚

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦å†é¢å¤–åšä¸€ä¸ªå°æ“ä½œäº† -> ä»€ä¹ˆæ“ä½œå‘¢ï¼Ÿ

å¾ˆç®€å•ï¼Œæˆ‘ä»¬å°† `dist` æœ€ç»ˆè½¬æ¢è¿‡åçš„ç»“æœï¼Œä¸è¦æ”¾åˆ°`dist`è¿™ä¸ªç›®å½•ä¸‹é¢äº†ï¼Œæˆ‘ä»¬æ”¾åœ¨å¦å¤–ä¸€ä¸ªç›®å½•ä¸‹é¢ï¼Œä½ å«åš `release`ï¼ˆé‡Šæ”¾ã€ç‰ˆæœ¬ï¼‰

![release](assets/img/2021-10-31-01-01-45.png)

æˆ‘ä»¬å†æ¥é‡æ–°å»è¿è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡ï¼Œ`compile` ä¸€ä¸‹ï¼Œç„¶å `useref`

``` bash
yarn gulp compile
yarn gulp useref
```

ç¨ç­‰ä¸€ä¸‹ï¼Œå®Œæˆè¿‡åæˆ‘ä»¬å¯ä»¥çœ‹åˆ° `release` è¿™ä¸ªç›®å½•ä¸‹é¢ HTML æ–‡ä»¶å·²ç»æœ‰äº†ï¼Œä½†æ˜¯å®ƒè¿˜æ²¡æœ‰è¢«å‹ç¼©ï¼š

![html å‹ç¼©](assets/img/2021-10-31-01-04-09.png)

è¿™ä¸ªæ²¡æœ‰å‹ç¼©æ˜¯æˆ‘ä»¬éœ€è¦å†å»æŒ‡å®šä¸€äº›é¢å¤–çš„é€‰é¡¹ -> æ­¤æ—¶ï¼Œæˆ‘ä»¬é‡ç‚¹å»çœ‹çš„æ˜¯è¿™ä¸ª `styles`é‡Œè¾¹çš„`main.css`æœ‰æ²¡æœ‰å‹ç¼©ã€‚

![å‹ç¼© css](assets/img/2021-10-31-01-05-05.png)

è¿™ä¸ªæ—¶å€™ä½ ä¼šå‘ç° `styles`ä¸‹çš„æ–‡ä»¶å·²ç»æ­£å¸¸è¢«å‹ç¼©äº†ï¼Œè€Œä¸”æˆ‘ä»¬çš„ JS æ–‡ä»¶ä¹Ÿéƒ½æ­£å¸¸å·¥ä½œäº†ã€‚

![å‹ç¼© js](assets/img/2021-10-31-01-06-53.png)

ä»¥ä¸Šè¿™ä¸ªå°±æ˜¯æˆ‘ä»¬é’ˆå¯¹äºä¸åŒçš„æ–‡ä»¶å•ç‹¬å»å¤„ç†å‹ç¼©

ä¸è¿‡ï¼Œè¿™ä¸ªæ—¶å€™ HTML å¹¶æ²¡æœ‰å‹ç¼© -> HTML éœ€è¦å•ç‹¬å»å¤„ç†ï¼Œå› ä¸º`htmlmin`å®ƒé»˜è®¤åªæ˜¯å»å‹ç¼©ä½ å±æ€§å½“ä¸­çš„ä¸€äº›ç©ºç™½å­—ç¬¦ï¼Œä¾‹å¦‚ï¼š

![ç©ºæ ¼](assets/img/2021-10-31-00-37-00.png)

å…ˆå›¾ä¸­è¿™äº›ç©ºæ ¼ï¼Œ`htmlmin`å®ƒä¼šè‡ªåŠ¨å¸®æˆ‘ä»¬åˆ é™¤æ‰ã€‚ä½†æ˜¯é’ˆå¯¹äºå…¶å®ƒçš„ä¸€äº›ï¼Œæ¯”å¦‚è¯´æˆ‘ä»¬æ¢è¡Œç¬¦è¿™äº›ï¼Œå®ƒé»˜è®¤ä¸å¸®ä½ åˆ é™¤ -> ä½ è¦æƒ³å»åˆ é™¤å®ƒä»¬çš„è¯ï¼Œä½ å¯ä»¥å»æŒ‡å®šä¸€ä¸ªé€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹çš„åå­—å«åš`collapseWhitespace`ï¼Œå®ƒå¯ä»¥æŠ˜å æ‰æˆ‘ä»¬æ‰€æœ‰çš„ç©ºç™½å­—ç¬¦ï¼ŒæŠŠå®ƒè®¾ç½®ä¸º`true`å³å¯ï¼

![ä¸è¦æ¢è¡Œ](assets/img/2021-10-31-01-08-21.png)

é‚£è¿™æ ·çš„è¯ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨çš„å»å‹ç¼©ä½ çš„ HTML é‡Œé¢çš„é‚£äº›ç©ºç™½å­—ç¬¦å’Œæ¢è¡Œç¬¦

æˆ‘ä»¬å†å»æ‰§è¡Œä¸€ä¸‹è¿™ä¸ª `useref` -> æ­¤æ—¶æˆ‘ä»¬é‡æ–°ç›´æ¥å»æ‰§è¡Œ `useref` å°±å¯ä»¥äº†ï¼Œå› ä¸ºæˆ‘ä»¬ `useref` ç”Ÿæˆè¿‡åçš„ç»“æœæˆ‘ä»¬æ˜¯æ”¾åˆ° `release` å½“ä¸­çš„ï¼Œç„¶å`dist`ç›®å½•ä¸‹è¿˜æ˜¯åŸå…ˆ`compile`çš„ç»“æœï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç›´æ¥æ‰§è¡Œ `useref`

![useref](assets/img/2021-10-31-00-41-32.png)

å®Œæˆè¿‡åï¼Œæˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹ HTML æ–‡ä»¶ã€‚

![å‹ç¼© html](assets/img/2021-10-31-01-11-25.png)

æ­¤æ—¶ HTML æ–‡ä»¶å½“ä¸­é‚£äº› HTML ä»£ç å°±å·²ç»è¢«å‹ç¼©æ‰äº†ã€‚

ä½†æ˜¯è¿˜æœ‰ä¸€äº›è¡Œå†…çš„æˆ–è€…è¯´å« `style` æ ‡ç­¾å†…éƒ¨çš„è¿™äº›æ ·å¼ -> å®ƒä»¬é»˜è®¤æ²¡æœ‰è¢«å‹ç¼©

![å‹ç¼©é…ç½®](assets/img/2021-10-31-00-49-45.png)

å¯¹äºè¿™ä¸ªæˆ‘ä»¬ä¹Ÿå¯ä»¥å†å•ç‹¬å»æŒ‡å®šä¸€äº›å…¶å®ƒçš„é€‰é¡¹å»æŠŠå®ƒä»¬å‹ç¼©ä¸€ä¸‹ -> è¿™ä¸ªé€‰é¡¹çš„åå­—å«åš `minifyCSS`ï¼ŒåŒæ ·ä¸€ä¸ªé“ç†ï¼Œè¿™è‚¯å®šæœ‰`minifyJS` -> æŠŠè¿™ä¸¤ä¸ªé€‰é¡¹éƒ½è®¾ç½®ä¸º`true` -> è¿™ä¸ªæ—¶å€™å®ƒä¼šè‡ªåŠ¨å¸®ä½ æŠŠé¡µé¢å½“ä¸­ `style` æ ‡ç­¾å’Œ `script` æ ‡ç­¾å†…éƒ¨çš„ä¸€äº›è„šæœ¬ç»™å®ƒå‹ç¼©æ‰ã€‚

ä»¥ä¸Šè¿™ä¸ªå°±å®Œæˆäº†æˆ‘ä»¬å¼•ç”¨å›æ¥çš„æ–‡ä»¶çš„ä¸€ä¸ªå‹ç¼©ï¼Œæˆ‘ä»¬å›è¿‡æ¥å†æ¥å»è¯•ç”¨ä¸€ä¸‹ -> ç›´æ¥å¯åŠ¨`useref`

ç¨ç­‰ä¸€ä¸‹ã€‚

![å‹ç¼©æƒ…å†µ](assets/img/2021-10-31-00-51-21.png)

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†æ¥çœ‹ HTML æ–‡ä»¶ï¼Œè¿™æ•´ä¸ª HTML æ–‡ä»¶å°±ä¼šè¢«å‹ç¼©åˆ°åŒä¸€è¡Œå½“ä¸­äº† -> è¿™ä¸ªæ˜¯é’ˆå¯¹äº `htmlmin` -> å®ƒéœ€è¦æŒ‡å®šå•ç‹¬å‡ ä¸ªå‚æ•°çš„ä¸€ä¸ªå°çŸ¥è¯†ç‚¹

`htmlmin`å®ƒè¿˜æœ‰ä¸€äº›å…¶å®ƒçš„å‚æ•°ã€‚æ¯”å¦‚è¯´æˆ‘ä»¬å¯ä»¥å» remove æ‰ comments  -> å°±ä¼šæŠŠæ‰€æœ‰çš„æ³¨é‡Šå…¨éƒ¨åˆ é™¤æ‰ã€‚

è¿˜æœ‰æ¯”å¦‚è¯´ä¸€äº›ç©ºå±æ€§ï¼Œå®ƒä¹Ÿå¯ä»¥è‡ªåŠ¨å¸®ä½ åˆ é™¤ã€‚

å¯¹äºè¿™äº›ï¼Œä½ å¯ä»¥å†å•ç‹¬æ ¹æ®å®ƒçš„æ–‡æ¡£ï¼Œç„¶åå•ç‹¬å»ä½¿ç”¨å°±è¡Œäº† -> è¿™ä¸€èˆ¬å°±æ ¹æ®è‡ªå·±çš„æƒ…å†µå»å†³å®šéœ€ä¸éœ€è¦å»åšé¢å¤–çš„è¿™äº›æ“ä½œã€‚

è‡³æ­¤ï¼Œæˆ‘ä»¬è¿™ä¸ª `useref` å°±å·²ç»å¯ä»¥äº† -> æ­¤æ—¶æˆ‘ä»¬çš„è¿™ä¸ªæ„å»ºç»“æ„ï¼ˆæ— ç«¯ç«¯å¤šå‡ºäº†ä¸€ä¸ª`release`ç›®å½•ï¼‰å¥½åƒå°±è¢«æ‰“ç ´äº†ï¼Œæˆ‘ä»¬å¾…ä¼šå†å…·ä½“æ¥çœ‹ã€‚

## â˜…Gulp æ¡ˆä¾‹ - é‡æ–°è§„åˆ’æ„å»ºè¿‡ç¨‹

![é‡æ–°è§„åˆ’æ„å»ºè¿‡ç¨‹](assets/img/2021-10-31-01-13-39.png)

æ­¤æ—¶ï¼Œè¿™ä¸ª`useref`ä»»åŠ¡å®ƒæ‰“ç ´äº†æˆ‘ä»¬çš„è¿™ä¸ªæ„å»ºçš„ç›®å½•ç»“æ„ã€‚

ä¸ºä»€ä¹ˆè¿™æ ·è¯´å‘¢ï¼Ÿ

å› ä¸ºæˆ‘ä»¬ä¹‹å‰çº¦å®šçš„æ˜¯æˆ‘ä»¬åœ¨å¼€å‘é˜¶æ®µå†™çš„ä»£ç æ˜¯æ”¾åœ¨ `src` è¿™ä¸ªç›®å½•ä¸‹é¢ã€‚ç„¶åæˆ‘ä»¬åœ¨ç¼–è¯‘å®Œè¿‡åçš„ç»“æœä¹Ÿå°±æ˜¯æ‰“åŒ…ä¸Šçº¿çš„é‚£ä¸ªç›®å½•æ˜¯ `dist` ç›®å½•ã€‚

![useref](assets/img/2021-10-31-13-15-02.png)

ä½†æ˜¯æ­¤æ—¶åœ¨è¿™ä¸ª`useref`ä»»åŠ¡é‡Œè¾¹ï¼Œå› ä¸ºæˆ‘ä»¬åˆšåˆšä» `dist` å½“ä¸­è¯»å‡ºæ¥ï¼Œå†å¾€ `dist` å½“ä¸­å»å†™çš„æ—¶å€™ï¼Œäº§ç”Ÿäº†ä¸€ä¸ªæ–‡ä»¶å†²çªï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¾—å·²æŠŠå®ƒæ”¾åˆ°äº†å¦å¤–ä¸€ä¸ªç›®å½•

å…¶å®è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åº”è¯¥çœŸæ­£ä¸Šçº¿çš„åº”è¯¥æ˜¯ `release` è¿™ä¸ªç›®å½•å½“ä¸­çš„æ–‡ä»¶ï¼Œè€Œ `release` å½“ä¸­åˆæ²¡æœ‰é‚£äº›å›¾ç‰‡å’Œå­—ä½“æ–‡ä»¶ã€‚æ‰€ä»¥è¯´è¿™ä¸ªç›®å½•ç»“æ„è¢«å®ƒæ‰“ç ´äº†ï¼Œé‚£æˆ‘ä»¬éœ€è¦å†é‡æ–°å»è§„æ•´ä¸€ä¸‹å®ƒ -> è¿™å…·ä½“æ€ä¹ˆæ ·å»åšå‘¢ï¼Ÿ

å¾ˆç®€å•ã€‚

å…¶å®åœ¨ `useref` ä¹‹å‰ï¼Œæˆ‘ä»¬æ‰€æœ‰çš„é‚£äº›ç”Ÿæˆçš„æ–‡ä»¶ï¼Œå®ƒå®é™…ä¸Šç®—æ˜¯ä¸€ä¸ªä¸­é—´äº§ç‰©ã€‚

ä»€ä¹ˆæ„æ€ï¼Ÿ

å°±æ˜¯æˆ‘ä»¬é€šè¿‡ `src` ä¸‹é¢çš„è¿™äº›æ–‡ä»¶å»ç¼–è¯‘ï¼Œç¼–è¯‘è¿‡åçš„ç»“æœï¼Œæˆ‘ä»¬æ˜¯æ”¾åˆ° `dist` ä¸‹é¢äº†ã€‚ä½†æ˜¯åç»­æˆ‘ä»¬åœ¨ä¸Šçº¿ä¹‹å‰æˆ‘ä»¬è¿˜åšäº†ä¸€ä¸ªæ“ä½œï¼Œå°±æ˜¯ `build` ä»»åŠ¡å½“ä¸­åº”è¯¥è¿˜åšä¸€ä¸ªæ“ä½œï¼Œå°±æ˜¯ `useref` è¿™ä¸ªä»»åŠ¡

![useref](assets/img/2021-10-31-11-51-09.png)

è€Œ`useref` åˆåšäº†ä¸€ä¸ªè½¬æ¢çš„è¿‡ç¨‹ã€‚æ‰€ä»¥è¯´æˆ‘ä»¬ç›´æ¥æŠŠ `script`ã€`style` è¿˜æœ‰`page`è¿™äº›ç”Ÿæˆç›´æ¥æ”¾åˆ° `dist` é‡Œé¢æ˜¯ä¸åˆç†çš„ã€‚

æˆ‘ä»¬åº”è¯¥æŠŠå®ƒæ”¾åˆ°ä¸€ä¸ªä¸´æ—¶çš„ç›®å½•å½“ä¸­ã€‚ç„¶åæˆ‘ä»¬åœ¨ `useref` çš„æ—¶å€™ï¼Œæˆ‘ä»¬é€šè¿‡ä¸´æ—¶ç›®å½•æŠŠæ–‡ä»¶æ‹¿å‡ºæ¥ï¼Œç„¶ååšä¸€äº›è½¬æ¢çš„æ“ä½œï¼Œæœ€åå†æ”¾åˆ° `dist` é‡Œé¢æ˜¯ä¼šæ›´åˆé€‚ä¸€ç‚¹ã€‚

æ‰€ä»¥æˆ‘ä»¬å¾—å»ä¿®æ”¹ä¸€ä¸‹æˆ‘ä»¬ä¹‹å‰çš„è¿™äº›ä»»åŠ¡ã€‚

ä»ä¸Šåˆ°ä¸‹ä¸€ä¸ªæ¥çœ‹ã€‚

![ä»»åŠ¡](assets/img/2021-10-31-11-53-51.png)

é¦–å…ˆ `clean` è¿™ä¸ªä»»åŠ¡ -> æˆ‘ä»¬å¯ä»¥å†å»åŠ ä¸€ä¸ªéœ€è¦æ¸…ç©ºçš„ç›®å½• -> è¿™ä¸ªç›®å½•æˆ‘ä»¬å«åš `temp` -> æˆ‘ä»¬æŠŠç”Ÿæˆçš„ä¸´æ—¶çš„é‚£ä¸ªæ–‡ä»¶å°±æ”¾åˆ° `temp` è¿™ä¸ªç›®å½•ä¸‹é¢

ç„¶å `style` è¿™ä¸ªä»»åŠ¡ -> æˆ‘ä»¬ä» `src` ä¸‹é¢æ‹¿å‡ºæ¥è¿‡å -> ç»è¿‡ sass ç¼–è¯‘ -> ç¼–è¯‘è¿‡åçš„ç»“æœï¼Œæˆ‘ä»¬ä¸è¦æ”¾åˆ° `dist` ä¸‹é¢ï¼Œæˆ‘ä»¬æ”¾åˆ° `temp` å½“ä¸­ -> ä¹Ÿå°±æ˜¯æŠŠè¿™ä¸ªæ–‡ä»¶æ”¾åˆ°ä¸´æ—¶ç›®å½•å½“ä¸­

ç„¶åä»¥æ­¤ç±»æ¨ï¼Œä¸‹é¢çš„è¿™ä¸ª `script` ä¹Ÿæ˜¯æ”¾åˆ°ä¸´æ—¶ç›®å½•ï¼Œ`page`ä¹Ÿæ˜¯æ”¾åˆ°ä¸´æ—¶ç›®å½•ã€‚

![ä¸´æ—¶ç›®å½•](assets/img/2021-10-31-11-57-45.png)

`image`ã€`font` è¿˜æœ‰è¿™ä¸ª `extra` -> å®ƒä»¬å¹¶ä¸éœ€è¦æ”¾åˆ°ä¸´æ—¶ç›®å½•ã€‚

è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å› ä¸ºè¿™ä¸‰ä¸ªè½¬æ¢çš„è¿‡ç¨‹æˆ‘ä»¬åªæ˜¯åœ¨ `build` æ—¶å€™å»åš -> åªæ˜¯åœ¨ `build` ä¹Ÿå°±æ˜¯æ„å‘³ç€ä¸Šçº¿ä¹‹å‰çš„é‚£ä¸ªæ„å»ºçš„è¿‡ç¨‹å»åš -> è¿™ä¸ªåœ¨å¼€å‘é˜¶æ®µæˆ‘ä»¬æ ¹æœ¬ä¸éœ€è¦å»è½¬æ¢å®ƒï¼Œæ‰€ä»¥è¯´å®ƒä»¬ä¸éœ€è¦å†å•ç‹¬æ”¾åˆ°`temp`åº•ä¸‹ -> åªæœ‰é‚£äº›ä¼šè¢« `useref`å¤„ç†çš„é‚£äº›æ“ä½œï¼Œæˆ‘ä»¬æ‰éœ€è¦å»ä¿®æ”¹ã€‚

æ‰€ä»¥ï¼Œè¿™ä¸‰ä¸ªä»»åŠ¡æˆ‘ä»¬å°±ä¸æ”¹äº†ã€‚

ç„¶åå†åˆ°åº•ä¸‹çš„è¿™ä¸ª `serve`ï¼Œ`serve` å‘½ä»¤å½“ä¸­éœ€è¦å»ä¿®æ”¹çš„åœ°æ–¹å°±æ¯”è¾ƒå¤šäº†ã€‚

é¦–å…ˆç¬¬ä¸€ä¸ªï¼Œæˆ‘ä»¬è¿™ä¸ª `bs.init` çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¿™ä¸ª `baseDir` å°±ä¸èƒ½å†ä» `dist` å½“ä¸­å»æ‹¿æ–‡ä»¶äº† -> æˆ‘ä»¬è¦å–çš„æ˜¯ `temp` å½“ä¸­çš„æ–‡ä»¶ -> å¦‚æœ `temp` æ‰¾ä¸åˆ°ï¼Œé‚£æˆ‘ä»¬å°±æ‰¾ `src`ï¼Œç„¶åå†æ‰¾ `public` -> `dist`ç›®å½•ï¼Œè·Ÿè¿™ä¸ªè¿‡ç¨‹æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œ`dist`åªæ˜¯æˆ‘ä»¬æœ€ç»ˆæ„å»ºã€éœ€è¦ä¸Šçº¿æ‰“åŒ…çš„é‚£ä¸ªç›®å½•

æ‰€ä»¥æˆ‘ä»¬æŠŠè¿™ä¸ª `dist` æ”¹æˆ `temp`

![temp](assets/img/2021-10-31-12-03-52.png)

æœ€åçš„è¿™ä¸ª `useref` é‡Œé¢ï¼Œæˆ‘ä»¬ä» `temp` å½“ä¸­å»å–æ–‡ä»¶ï¼Œç„¶åæŠŠæœ€ç»ˆçš„ç»“æœæ”¾åˆ° `dist` é‡Œé¢ï¼Œé‚£è¿™æ ·çš„è¯ï¼Œè¿™åŸºæœ¬ä¸Šå°± OK äº†ã€‚

![temp](assets/img/2021-10-31-12-51-44.png)

æˆ‘ä»¬åœ¨å†é‡æ–°æ£€æŸ¥ä¸€éï¼Œä»ä¸Šåˆ°ä¸‹å†çœ‹ä¸€ä¸‹ï¼š

`style`ã€`script`ã€`page`è¿™ä¸‰ä¸ªä»»åŠ¡éƒ½ä¿®æ”¹ äº†ï¼Œæ²¡é—®é¢˜ã€‚

æ£€æŸ¥å®Œäº†è¿‡åï¼Œæˆ‘ä»¬å†æ¥æµ‹è¯•ä¸€ä¸‹ã€‚åœ¨æµ‹è¯•ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆæ‰‹åŠ¨çš„æŠŠæˆ‘ä»¬åˆšåˆšæµ‹è¯•`release`è¿™ä¸ªè¿‡ç¨‹æ‰€äº§ç”Ÿçš„æ–‡ä»¶å…ˆç»™å®ƒåˆ æ‰ -> é¡ºä¾¿æŠŠ`dist`ä¹Ÿåˆ äº†

![åˆ æ‰ release dist](assets/img/2021-10-31-12-08-03.png)

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å»æ‰§è¡Œè¿™ä¸ª `useref`

å¯¹äº†ï¼Œè¿™ä¸ª`useref` åº”è¯¥æ”¾åˆ°æˆ‘ä»¬çš„ç»„åˆä»»åŠ¡å½“ä¸­ -> è¿™ä¸ªç»„åˆä»»åŠ¡å°±æ˜¯åœ¨ `build` è¿™ä¸ªä»»åŠ¡å½“ä¸­ï¼Œç„¶åæˆ‘ä»¬å»ä½¿ç”¨è¿™ä¸ª `useref`

é‚£è¿™ä¸ª `useref` åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™æ‰§è¡Œå‘¢ï¼Ÿ

æˆ‘ä»¬å…ˆæ¥çœ‹ä¸€ä¸‹è¿™ä¸ª `build` -> `build`å½“ä¸­æ˜¯å…ˆå»æ‰§è¡Œ `clean`ï¼Œå®Œäº†è¿‡åï¼Œå»æ‰§è¡Œäº†ä¸€ä¸ªå¹¶è¡Œçš„ä»»åŠ¡ -> è¿™ä¸ªå¹¶è¡Œä»»åŠ¡æ˜¯ `compile`ã€`image` `font` å’Œ `extra` 

å¦‚æœæˆ‘æŠŠ `useref` æ”¾åœ¨è¿™ä¸ªé‡Œé¢çš„è¯ï¼š

![useref æ”¾å“ªå„¿](assets/img/2021-10-31-12-14-40.png)

å…¶å®æ˜¯ä¸åˆç†çš„ -> ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å› ä¸ºä½ çš„ `compile` å’Œ `useref` å®ƒä»¬ä¹‹é—´æœ‰ä¾èµ–å…³ç³»ï¼Œå°±æ˜¯ `useref` å¿…é¡»è¦æ±‚ä½  `compile` å…ˆæ‰§è¡Œï¼Œç„¶åæ‰å»æ‰§è¡Œå¯¹åº”çš„è¿™ä¸ª `useref` æ“ä½œ -> æ‰€ä»¥è¯´å®ƒä¿©åº”è¯¥åšä¸€ä¸ªä¸²è¡Œçš„ç»“æ„

![ç»„åˆä»»åŠ¡](assets/img/2021-10-31-12-16-59.png)

æˆ‘ä»¬å¯ä»¥å†æŠŠå®ƒä¿©æå‡ºæ¥æ”¾åˆ° `series` å½“ä¸­ã€‚é‚£è¿™ä¸ªæ—¶å€™è¿™ä¸ªç»„åˆä»»åŠ¡å°±ç›¸å¯¹æ¯”è¾ƒå¤æ‚ä¸€ç‚¹äº†ï¼Œæˆ‘ä»¬æŠŠå®ƒæŠ˜ï¼ˆæ¢è¡Œï¼‰å‡ºæ¥ï¼Œè®©å¤§å®¶å¯ä»¥çœ‹å¾—æ›´æ¸…æ¥šä¸€ç‚¹ã€‚

![ä¸²è¡Œã€å¹¶è¡Œ](assets/img/2021-10-31-12-18-23.png)

é¦–å…ˆæ•´ä¸ªè¿™ä¸ªä»»åŠ¡å®ƒæ˜¯ä¸€ä¸ªä¸²è¡Œçš„ä»»åŠ¡ï¼Œç„¶åä¸²è¡Œçš„ä»»åŠ¡å½“ä¸­æœ‰ä¸¤ä¸ªä»»åŠ¡ï¼Œç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯`clean`ï¼Œ`clean`å®Œäº†è¿‡åæˆ‘ä»¬å†æ‰§è¡Œä¸€ä¸ªå¹¶è¡Œçš„ä»»åŠ¡ -> è¿™ä¸ªå¹¶è¡Œä»»åŠ¡å½“ä¸­æœ‰å››ä¸ªä»»åŠ¡ï¼Œç¬¬ä¸€ä¸ªä»»åŠ¡æ˜¯ä¸€ä¸ªä¸²è¡Œä»»åŠ¡ï¼Œå…¶ä½™ä¸‰ä¸ªä»»åŠ¡æ˜¯åŒæ­¥æ‰§è¡Œçš„ã€‚åªä¸è¿‡ç¬¬ä¸€ä¸ªä¸²è¡Œä»»åŠ¡æ˜¯å…ˆæ‰§è¡Œ `compile` ç„¶åå†æ‰§è¡Œè¿™ä¸ª `useref`

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ç›´æ¥å»è¿è¡Œä¸€ä¸‹è¿™ä¸ª`build` ã€‚

> å…¶å®è¿™ä¹Ÿèƒ½çœ‹å‡ºæ¥ -> å¹³æ—¶æˆ‘ä»¬åšçš„ä¸€äº›å°æ¡ˆä¾‹ï¼Œè·Ÿæˆ‘ä»¬å®é™…é¡¹ç›®å½“ä¸­çš„è¿™ä¸ªå¤æ‚ç¨‹åº¦çš„ä¸€ä¸ªå¯¹æ¯”ã€‚

``` bash
yarn gulp build
```

æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™ä¸ªæ‰§è¡Œé¡ºåºæ˜¯ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚

![æ‰§è¡Œé¡ºåº](assets/img/2021-10-31-12-29-00.png)

é¦–å…ˆå®ƒå¯åŠ¨äº† `build` ä»»åŠ¡ï¼Œè¿™ä¸ªå¾ˆæ­£å¸¸ã€‚

ç„¶åç´§æ¥ç€å¼€å§‹è¿™ä¸ª `clean` ï¼Œæ¥ç€ç»“æŸè¿™ä¸ª`clean`ï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬è¦æ±‚çš„ -> å³æœ€å¼€å§‹å…ˆæŠŠè¿™ä¸ª`clean`ä»»åŠ¡ç»™å®Œæˆæ‰

ç„¶åå®Œäº†è¿‡åå†ç´§æ¥ç€å»æ‰§è¡Œäº† `image`ã€`font`ã€`extra`ã€`style`ã€`script`ã€`page`

è¿™äº›ä»»åŠ¡éƒ½æ˜¯æˆ‘ä»¬å¯ä»¥åŒæ—¶å»æ‰§è¡Œçš„ä»»åŠ¡ã€‚

ç„¶åè¿™å‡ ä¸ªä»»åŠ¡éƒ½ç»“æŸäº†è¿‡åï¼Œæˆ‘ä»¬æ‰æ‰§è¡Œè¿™ä¸ª `useref` -> è¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯åˆç†çš„ -> è¿™ä¸ª `font` è·Ÿ `useref` å®ƒæ²¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥è¯´å®ƒå•ç‹¬çš„åœ¨åé¢ç»“æŸäº†ï¼Œè¿™ä¹Ÿå¾ˆæ­£å¸¸ã€‚

æ‰€ä»¥æ•´ä½“çš„è¿™ä¸ªæ‰§è¡Œé¡ºåºæ˜¯æ»¡è¶³æˆ‘ä»¬è¦æ±‚çš„ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬è¦å»çœ‹ä¸€ä¸‹`dist`ã€`temp`è¿™ä¸¤ä¸ªç›®å½•é‡Œé¢æ˜¯ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„é‚£ä¸ªæƒ…å†µã€‚

è¿™ä¸ªæ—¶å€™`temp`ç›®å½•é‡Œé¢åº”è¯¥åªæœ‰`htmlã€cssã€js`è¿™äº›æ–‡ä»¶ã€‚

![æ£€æŸ¥ temp](assets/img/2021-10-31-12-30-57.png)

åªæœ‰è¿™ä¸‰ç§ç±»å‹çš„æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™ä¸ªå¤„ç†æ˜¯æ²¡é—®é¢˜çš„ï¼å› ä¸ºå®ƒåªæ˜¯è¿™ä¸ªè¯­æ³•ç¼–è¯‘çš„ä¸€ä¸ªä¸­é—´çš„ä¸´æ—¶ç›®å½•

æˆ‘ä»¬çœ‹çœ‹æœ€ç»ˆçš„è¿™ä¸ªç”Ÿæˆç»“æœï¼š

![dist](assets/img/2021-10-31-12-33-15.png)

HTMLã€è„šæœ¬æ–‡ä»¶ã€æ ·å¼æ–‡ä»¶ã€å›¾ç‰‡æ–‡ä»¶è¿™äº›éƒ½æ˜¯ OK çš„ã€‚é‚£è¿™æ ·çš„è¯ï¼Œè¿™ä¸ª `dist` ç›®å½•å°±æ˜¯æ­£å¸¸çš„äº†ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å»æµ‹è¯•ä¸€ä¸‹è¿™ä¸ª `develop` å‘½ä»¤ã€‚

![develop](assets/img/2021-10-31-12-34-30.png)

è¿™ä¸ª `develop` å‘½ä»¤ï¼Œæˆ‘ä»¬çœ‹å®ƒå…ˆå¯åŠ¨çš„æ˜¯ `style` `script` å’Œ`page`ï¼Œä¹Ÿå°±æ˜¯æ‰§è¡Œäº†æˆ‘ä»¬çš„ `compile` é‚£ä¸ªä»»åŠ¡ -> æ‰§è¡Œè¿™ä¸ª `compile` ä»»åŠ¡å®Œæˆè¿‡åå†å»å¯åŠ¨è¿™ä¸ª`serve`è¿™ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

![æ•ˆæœ](assets/img/2021-10-31-12-46-10.png)

å› ä¸ºè¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯åŠ¨çš„è¿™ä¸ª `serve` å®ƒè·Ÿ `dist` æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œå®ƒåªæ˜¯å»æ‰¾äº† `temp` ä¸‹é¢çš„é‚£äº›ä¸´æ—¶çš„æ–‡ä»¶ï¼Œç„¶åæ‰¾ä¸åˆ°çš„æ–‡ä»¶æˆ‘ä»¬å°±å»æºç›®å½•`src`é‡Œé¢å»æ‰¾ã€‚å› ä¸ºè¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¸éœ€è¦ `dist` -> æ‰€ä»¥è¯´`develop`è¿™ä¸ªä»»åŠ¡æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ã€‚

![develop](assets/img/2021-10-31-12-44-33.png)

è‡³æ­¤ï¼Œæˆ‘ä»¬è¿™æ ·ä¸€ä¸ªå®Œæ•´çš„æ„å»ºè¿‡ç¨‹å°±ç®—æ˜¯å…¨éƒ¨ç»“æŸäº†ã€‚

å½“ç„¶ï¼Œä½ åœ¨æˆ‘ä»¬è¿™ä¸ªé‡Œé¢ä½¿ç”¨åˆ°çš„ä¸€äº›æ’ä»¶ï¼Œå®ƒå¯èƒ½è¿˜ä¼šæœ‰ä¸€äº›é¢å¤–çš„é€‰é¡¹ã€‚é‚£ä½ å†å»æŒç»­å»å­¦ä¹ è¿™å—å†…å®¹çš„æ—¶å€™ï¼Œä½ å¯ä»¥å†å»å•ç‹¬é’ˆå¯¹äºä¸åŒçš„æ’ä»¶ï¼Œå†å»çœ‹ä¸€ä¸‹å®ƒå®˜æ–¹æ‰‹å†Œé‡Œé¢ä¸€äº›å…¶ä»–çš„é€‰é¡¹å„è‡ªæ˜¯ä»€ä¹ˆæ ·çš„ä¸€äº›ç”¨é€”ã€‚

æˆ‘ä»¬è¿™é‡Œåªæ˜¯æŠŠä¸€äº›æˆ‘ä»¬åœ¨å®é™…å¼€å‘å½“ä¸­ç»å¸¸ä¼šç”¨åˆ°çš„ä¸€äº›ä¸»è¦çš„é€‰é¡¹æ‹¿å‡ºæ¥è·Ÿå¤§å®¶åšäº†ä¸€ä¸ªåˆ†äº«ï¼Œå…¶ä»–çš„è¿™äº›ä¸œè¥¿éœ€è¦å¤§å®¶è‡ªå·±å†å»åšä¸€ä¸ªè¡¥å…… -> å½“ç„¶ï¼Œè¿™å¾—æ ¹æ®ä½ æœ‰éœ€è¦çš„æƒ…å†µã€‚

è‡³æ­¤ï¼Œæˆ‘ä»¬è¿™ä¸ªæ„å»ºçš„è¿‡ç¨‹å°±ç»“æŸäº†ã€‚æˆ‘ä»¬å¾€åï¼Œå†æ¥çœ‹ä¸€ä¸ªæé«˜å±‚é¢çš„å°ä¸œè¥¿ã€‚

## â˜…Gulp æ¡ˆä¾‹ - è¡¥å……

![è¡¥å……](assets/img/2021-10-31-12-53-09.png)

æ¥ä¸‹æ¥æˆ‘ä»¬éœ€è¦å»é‡ç‚¹è§£å†³ä¸¤ä¸ªå°é—®é¢˜ã€‚

ä¸€èˆ¬æ¥è®²çš„è¯å»å†™è¿™ä¸ªæ„å»ºä»»åŠ¡çš„äººå¤§éƒ¨åˆ†æ˜¯è¿™ä¸ªé¡¹ç›®çš„ leader 

ä»–æŠŠè¿™ä¸ªæ„å»ºè¿‡ç¨‹è®¾è®¡å®Œäº†è¿‡åï¼Œä»–ä¼šäº¤ç»™ä»–ç»„å†…çš„è¿™äº›æˆå‘˜å»å®Œæˆåç»­çš„è¿™äº›å¼€å‘å·¥ä½œã€‚

ç¬¬ä¸€ä¸ªé—®é¢˜å°±æ˜¯å¯¹äºæˆ‘ä»¬è¿™ä¸ªæ„å»ºä»»åŠ¡å®Œæˆè¿‡åï¼Œé‚£è¿™ä¸ªæ—¶å€™ï¼Œä½ æŠŠæ„å»ºä»»åŠ¡è®¾è®¡å®Œäº†è¿‡åï¼Œå¦‚æœä½ ä¸æƒ³å»é…æ–‡æ¡£ã€é…è¯´æ˜çš„è¯ï¼Œä¹Ÿå°±æ˜¯å‘Šè¯‰åˆ«äººæ€ä¹ˆå»ç”¨å®ƒçš„è¯ï¼Œé‚£ä½ æœ€å¥½éœ€è¦å»è§„æ•´ä¸€ä¸‹ä½ å¯¼å‡ºçš„è¿™äº›ä»»åŠ¡ã€‚

å› ä¸ºè¿™é‡Œé¢ä¸æ˜¯æ¯ä¸ªä»»åŠ¡éƒ½éœ€è¦åœ¨å¤–ç•Œé€šè¿‡ gulp å»æ‰§è¡Œçš„ã€‚

æ‰€ä»¥ï¼Œåœ¨è¿™ä¸ª`gulpfile`é‡Œè¾¹ï¼Œæˆ‘ä»¬ä¹‹å‰å°±æŠŠè¿™äº›ä»»åŠ¡éƒ½å®šä¹‰æˆäº†ç§æœ‰ä»»åŠ¡ï¼Œç„¶åæœ€åå»å¯¼å‡ºã€‚

æ­¤æ—¶æˆ‘ä»¬è¦å»é‡æ–°çœ‹ä¸€ä¸‹ -> åˆ°åº•å“ªäº›ä»»åŠ¡éœ€è¦å¯¼å‡ºï¼Œå“ªäº›ä»»åŠ¡ä¸éœ€è¦å¯¼å‡ºã€‚

æˆ‘ä»¬å¯¹è¿™ä¸ª`gulpfile`æŠ˜å åˆ°æœ€é«˜å±‚çº§ã€‚

![æŠ˜å ](assets/img/2021-10-31-14-11-11.png)

åœ¨è¿™ä¸ª`gulpfile`é‡Œè¾¹ï¼Œæˆ‘ä»¬ä»ä¸Šåˆ°ä¸‹å¯ä»¥çœ‹åˆ°ï¼Œä¾æ¬¡éƒ½æ˜¯ä¸€äº›ä»»åŠ¡ã€‚

é¦–å…ˆ `clean` è¿™ä¸ªä»»åŠ¡å…¶å®å¯ä»¥å¯¹å¤–æš´éœ²å‡ºå»ï¼Œå› ä¸ºè¿™ä¸ªæ¶‰åŠåˆ°å¼€å‘è€…åœ¨å·¥ä½œè¿‡ç¨‹å½“ä¸­å¯ä»¥è‡ªåŠ¨çš„å»æ¸…é™¤æ‰é‚£äº›ç”Ÿæˆçš„ç›®å½•ï¼Œè¿™ä¸ªæ˜¯è‚¯å®šçš„ã€‚

ç„¶å `style`ã€`script` å’Œ`page`è¿™ä¸‰ä¸ªä»»åŠ¡å…¶å®æ²¡å¿…è¦å¯¼å‡ºå»ï¼Œå› ä¸ºä»–ä»¬åˆ†åˆ«ç¼–è¯‘ä¸åŒçš„ç±»å‹çš„æ–‡ä»¶ -> å¯¹äºç¼–è¯‘ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ¥è®²çš„è¯å°±æ˜¯**éƒ½ç¼–è¯‘**ï¼ˆä¹Ÿå°±æ˜¯å¯¼å‡ºä¸€ä¸ªç»„åˆä»»åŠ¡`compile`å‘—ï¼‰

ç„¶å `image` `font` `extra` è¿™äº›ä¹Ÿæ˜¯ç›¸åŒçš„é“ç†ã€‚

æ‰€ä»¥è¿™å…­ä¸ªä»»åŠ¡æ˜¯ä¸éœ€è¦å¯¼å‡ºå‡ºå»çš„ã€‚

é‚£åƒ `serve` è¿™ä¸ªå‘½ä»¤å‘¢ï¼Ÿ

å…¶å®å®ƒä¹Ÿä¸éœ€è¦å¯¼å‡ºå‡ºå» -> ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å› ä¸ºæˆ‘ä»¬éœ€è¦ä½¿ç”¨ `serve` çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¿…é¡»è¦å…ˆ `compile` ä¸€ä¸‹ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬ä¼šç”¨ `develop` è¿™ä¸ªç»„åˆä»»åŠ¡

ç„¶å `useref` ä¹Ÿæ˜¯åŒæ ·ä¸€ä¸ªé“ç†ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªç»„åˆä»»åŠ¡å½“ä¸­çš„ä¸€ä¸ªæˆå‘˜ã€‚æ‰€ä»¥è¯´å®ƒä¹Ÿä¸éœ€è¦å¯¼å‡ºå‡ºå»ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬æœ€ç»ˆéœ€è¦å¯¼å‡ºå‡ºå»çš„åº”è¯¥å°±æ˜¯ `compile`ã€`build` å’Œ `develop`

å½“ç„¶ï¼Œ`compile` ç”šè‡³ä½ éƒ½å¯ä»¥ä¸ç”¨å¯¼å‡ºå‡ºå»ã€‚

å› ä¸ºä½ è¦æ˜¯å¼€å‘çš„è¯ï¼Œé‚£ä½ è¿™ä¸ª `compile` ä¹Ÿæ˜¯è‡ªåŠ¨è¢«æ‰§è¡Œçš„ï¼Œå½“ç„¶ï¼Œ`serve` ä¹Ÿæ˜¯è‡ªåŠ¨è¢«æ‰§è¡Œçš„ã€‚

![å¯¼å‡ºå»](assets/img/2021-10-31-14-29-46.png)

æ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆç•™ä¸‹æ¥çš„å¯ä»¥æ˜¯ `clean`ã€`build` å’Œ `develop`

è¿™æ ·ä¸€æ¥å°±åªå‰©ä¸‰ä¸ªä»»åŠ¡æ¥äº† -> ä½ çš„è¿™ä¸ªç»„å†…çš„è¿™äº›å°ä¼™ä¼´ï¼Œè¯´ä¸ªä¸å¤ªå¥½å¬çš„ï¼Œåªè¦æ˜¯è„‘å­æ²¡æœ‰æ³¡ï¼ˆbingï¼‰çš„è¯ï¼Œéƒ½åº”è¯¥çŸ¥é“ä»–ä»¬æ˜¯å¹²ä»€ä¹ˆçš„ã€‚

æ‰€ä»¥æˆ‘ä»¬è¿™ä¸ªå¯¼å‡ºä»€ä¹ˆï¼ŒåŸºæœ¬ä¸Šå°± OK äº†ã€‚

é‚£æˆ‘ä»¬è¿˜å¯ä»¥å†å¹²ä»€ä¹ˆå‘¢ï¼Ÿ

è¿˜å¯ä»¥æŠŠè¿™ä¸‰ä¸ªä»»åŠ¡éƒ½æ”¾åˆ°ä½ çš„è¿™ä¸ª`package.json` å½“ä¸­ -> å»å®šä¹‰åˆ° `scripts` å½“ä¸­ï¼Œè¿™æ ·çš„è¯ï¼Œè¿™å¯ä»¥æ›´å®¹æ˜“è®©åˆ«äººç†è§£è¿™ä¸€ç‚¹ã€‚

å› ä¸ºä¸€èˆ¬æ¥è®²çš„è¯ï¼Œæˆ‘ä»¬å»æ‰“å¼€ä¸€ä¸ªé¡¹ç›®ï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³è¦å»äº†è§£ä»–è¿™ä¸ªé¡¹ç›®çš„ä¸€ä¸ªæ„å»ºè¿‡ç¨‹çš„è¯ï¼Œæˆ‘ä»¬ä¸€èˆ¬ä¼šä» `scripts` é‡Œé¢å»ç€æ‰‹ï¼Œé‚£ä½ æŠŠå®ƒæ”¾åˆ° `scripts` å½“ä¸­ï¼š

- ç¬¬ä¸€ä¸ªç”¨èµ·æ¥æ–¹ä¾¿
- ç¬¬äºŒä¸ªåˆ«äººæ›´å®¹æ˜“çœ‹æ˜ç™½

æ‰€ä»¥æˆ‘ä»¬åœ¨`package.json`é‡Œè¾¹åŠ ä¸Š `scripts` -> `scripts` å½“ä¸­æœ‰ä¸‰ä¸ªä»»åŠ¡

![ä¸‰ä¸ªä»»åŠ¡](assets/img/2021-10-31-14-45-36.png)

ç¬¬ä¸€ä¸ªæ˜¯ `clean`ï¼Œä¸è¿‡è¿™ä¸ª`clean`å¯ä»¥æ ¹æ®ä½ çš„æƒ…å†µï¼Œå¦‚æœä½ è§‰å¾—ä¸éœ€è¦å®ƒçš„è¯ï¼Œè¿™ä¹Ÿæ˜¯å¯ä»¥çš„ -> è¿™ä¸ª `clean` ä»»åŠ¡å®ƒåº”è¯¥æ˜¯é€šè¿‡ gulp å»è¿è¡Œ `clean` ç›¸å½“äºé€šè¿‡ npm çš„ `scripts` æŠŠæˆ‘ä»¬çš„è¿™äº›ä»»åŠ¡éƒ½ç»™å®ƒåŒ…èµ·æ¥ã€‚

ç„¶åå°±æ˜¯ `build` ä»»åŠ¡ -> è¿™ä¸ªå°±æ˜¯ `gulp build` 

æœ€åä¸€ä¸ª`gulp develop` ã€‚

è¿™é‡Œéœ€è¦æ³¨æ„ä¸€ä¸ªå°ç‚¹ï¼Œå°±æ˜¯æˆ‘ä»¬åœ¨ npm çš„ `scripts` å½“ä¸­ï¼Œå®ƒä¼šè‡ªåŠ¨å»æ‰¾ä½ è¿™ä¸ªæ‰€æ‰§è¡Œçš„å‘½ä»¤åœ¨ `node_modules` å½“ä¸­çš„å¯æ‰§è¡Œçš„å‘½ä»¤æ–‡ä»¶ -> æ‰€ä»¥è¯´æˆ‘ä»¬ä¸ç”¨å†é€šè¿‡ `yarn` å»å¯åŠ¨å®ƒ

å½“ç„¶ï¼Œä½ ä½¿ç”¨ `npm`ï¼ˆ`yarn`ï¼Ÿï¼‰ çš„è¯ï¼Œä¹Ÿæ˜¯ä¸ç”¨å†å»ä½¿ç”¨ä»€ä¹ˆ `npm run` è¿™ç§æ–¹å¼äº†ã€‚

é‚£è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å†å»åç»­å»ä½¿ç”¨çš„è¯ï¼Œæˆ‘ä»¬å°±ç›´æ¥é€šè¿‡ `yarn` å»è¿è¡Œ `clean` è¿™æ ·çš„ä»»åŠ¡å°±å¯ä»¥äº† -> è¿™ç›¸å¯¹æ¥è®²ä¼šæ›´æ–¹ä¾¿ä¸€äº›ã€‚ 

è¿™ä¸ªæ˜¯ä¸€ä¸ªè¡¥å…… -> å°±æ˜¯é’ˆå¯¹äºæŠŠæˆ‘ä»¬å¯ç”¨çš„è¿™äº›æ„å»ºä»»åŠ¡ï¼Œæˆ–è€…è¯´å¯¹å¤–éœ€è¦å¤–éƒ¨æ‰§è¡Œçš„è¿™äº›æ„å»ºä»»åŠ¡ï¼Œç»™å®ƒæš´éœ²å‡ºæ¥çš„ä¸€ä¸ªæœ€å¥½çš„æ–¹å¼ã€‚

ç„¶åè¿˜æœ‰ä¸€ä¸ªå°ç‚¹ï¼Œå°±æ˜¯åœ¨`gitignore`å½“ä¸­ï¼Œéœ€è¦å»å¿½ç•¥ä¸€ä¸‹ç”Ÿæˆçš„è¿™äº›ç›®å½•ï¼š

![gitignore](assets/img/2021-10-31-14-48-03.png)

é¦–å…ˆè¿™ä¸ª `dist` ç›®å½•è‚¯å®šæ˜¯è¦å¿½ç•¥æ‰ï¼Œç„¶å `temp` ç›®å½•è‚¯å®šä¹Ÿæ˜¯å¿½ç•¥æ‰ï¼Œè¿™æ ·çš„è¯ï¼Œè¿™åŸºæœ¬ä¸Šå°± OK äº†ã€‚

è¿™æ˜¯æˆ‘ä»¬è§£å†³çš„ç¬¬ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å°±ç›´æ¥ç»™å®ƒè§£å†³äº† -> æ¯”è¾ƒç®€å•ã€‚

---

ç„¶åç¬¬äºŒä¸ªé—®é¢˜æ˜¯ä»€ä¹ˆé—®é¢˜å‘¢ï¼Ÿ

ç¬¬äºŒä¸ªé—®é¢˜æ˜¯æˆ‘ä»¬åœ¨è¿™ä¸ªå¼€å‘è¿‡ç¨‹å½“ä¸­åˆ›å»ºçš„è¿™ä¸ªæ„å»ºçš„è‡ªåŠ¨åŒ–å·¥ä½œæµï¼ˆ`gulpfile.js`ï¼‰ã€‚

![è‡ªåŠ¨åŒ–å·¥ä½œæµ](assets/img/2021-10-31-14-56-34.png)

è¿™ä¸ªå·¥ä½œæµåªè¦æ˜¯åœ¨ç›¸åŒç±»å‹çš„é¡¹ç›®å½“ä¸­ï¼Œæˆ‘ä»¬éƒ½ä¼šé‡å¤è¢«ä½¿ç”¨åˆ° -> å¯¹äºå¸¸è§çš„å¼€å‘è€…æ¥è®²çš„è¯ï¼Œä¹Ÿå°±æ˜¯å¯¹äºå¸¸è§„çš„å¼€å‘è€…æ¥è®²ï¼Œä»–ä»¬å¤§éƒ¨åˆ†æƒ…å†µéƒ½æ˜¯æŠŠå®ƒæ”¾åˆ°ä¸€ä¸ªä»£ç æ®µå½“ä¸­ï¼Œæˆ–è€…æ˜¯æ”¾åˆ°ç¬”è®°å½“ä¸­è®°ä¸‹æ¥ï¼Œåç»­ç”¨åˆ°çš„æ—¶å€™å†ç²˜è¿‡æ¥å°±å¯ä»¥äº†ã€‚

è¿™ç§æ–¹å¼å¯ä»¥è¿™ä¹ˆå»æï¼Œä½†æ˜¯ä¸æ¨èã€‚

ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

å› ä¸ºä½ è¿™é‡Œé¢çš„ä¸œè¥¿æ˜¯æˆ‘ä»¬ä¸€æ¬¡æ€§å†™æˆçš„ï¼Œè€Œå†™æˆçš„éš¾å…ä¼šæœ‰ä¸€äº› bug æˆ–è€…è¯´åœ¨è¿™ä¸ªè¿‡ç¨‹å½“ä¸­ï¼Œæœ‰ä¸€äº›æ’ä»¶ã€æœ‰ä¸€äº›æ¨¡å—å®ƒæ›´æ–°äº†ï¼Œå®ƒæœ‰ä¸€äº›é€‰é¡¹ä¸ä¸€æ ·äº† -> é‚£ä½ å¦‚æœè¯´æŠŠè¿™æ ·ä¸€æ®µä»£ç å¤åˆ¶åˆ° 10 ä¸ªé¡¹ç›®ï¼Œé‚£ä½ è¿˜éœ€è¦å»ä¿®æ”¹ 10 ä¸ªé¡¹ç›®çš„ä»£ç  

æ€»ä¹‹ï¼Œè¿™ç§æ–¹å¼å®é™…ä¸Šæ˜¯ä¸æ¨èçš„ï¼Œå°±å¦‚é‚£å¥è¯æ‰€è¨€ï¼š

> Don't repeat yourselfï¼ˆä¸è¦é‡å¤ä½ è‡ªå·±ï¼Œç®€ç§° DRYï¼‰

æ‰€ä»¥ï¼Œå¯¹äºè¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬è¿˜åº”è¯¥æœ‰ä¸€ä¸ªæ›´å¥½çš„åŠæ³•å»è§£å†³å®ƒã€‚

é‚£æ¥ä¸‹æ¥æˆ‘ä»¬å°±è¦é‡ç‚¹å»çœ‹è¿™æ ·ä¸€ä¸ªé—®é¢˜ -> å°±æ˜¯å¦‚ä½•å»æå–å¤šä¸ªé¡¹ç›®å½“ä¸­å…±åŒçš„è‡ªåŠ¨åŒ–æ„å»ºè¿‡ç¨‹ã€‚

## â˜…ä»£ç 

`package.json`ï¼š

``` json
{
  "name": "zce-gulp-demo",
  "version": "0.1.0",
  "main": "index.js",
  "repository": "https://github.com/zce/zce-gulp-demo.git",
  "author": "zce <w@zce.me> (https://zce.me)",
  "license": "MIT",
  "scripts": {
    "clean": "gulp clean",
    "build": "gulp build",
    "develop": "gulp develop"
  },
  "dependencies": {
    "bootstrap": "^4.3.1",
    "jquery": "^3.4.1",
    "popper.js": "^1.15.0"
  },
  "devDependencies": {
    "@babel/core": "^7.5.5",
    "@babel/preset-env": "^7.5.5",
    "browser-sync": "^2.26.7",
    "del": "^5.1.0",
    "gulp": "^4.0.2",
    "gulp-babel": "^8.0.0",
    "gulp-clean-css": "^4.2.0",
    "gulp-htmlmin": "^5.0.1",
    "gulp-if": "^3.0.0",
    "gulp-imagemin": "^6.1.0",
    "gulp-load-plugins": "^2.0.1",
    "gulp-sass": "^4.0.2",
    "gulp-swig": "^0.9.1",
    "gulp-uglify": "^3.0.2",
    "gulp-useref": "^3.1.6"
  }
}

```

---

`gulpfile.js`ï¼š

``` js
const { src, dest, parallel, series, watch } = require('gulp')

const del = require('del')
const browserSync = require('browser-sync')

const loadPlugins = require('gulp-load-plugins')

const plugins = loadPlugins()
const bs = browserSync.create()

const data = {
  menus: [
    {
      name: 'Home',
      icon: 'aperture',
      link: 'index.html'
    },
    {
      name: 'Features',
      link: 'features.html'
    },
    {
      name: 'About',
      link: 'about.html'
    },
    {
      name: 'Contact',
      link: '#',
      children: [
        {
          name: 'Twitter',
          link: 'https://twitter.com/w_zce'
        },
        {
          name: 'About',
          link: 'https://weibo.com/zceme'
        },
        {
          name: 'divider'
        },
        {
          name: 'About',
          link: 'https://github.com/zce'
        }
      ]
    }
  ],
  pkg: require('./package.json'),
  date: new Date()
}

const clean = () => {
  return del(['dist', 'temp'])
}

const style = () => {
  return src('src/assets/styles/*.scss', { base: 'src' })
    .pipe(plugins.sass({ outputStyle: 'expanded' }))
    .pipe(dest('temp'))
    .pipe(bs.reload({ stream: true }))
}

const script = () => {
  return src('src/assets/scripts/*.js', { base: 'src' })
    .pipe(plugins.babel({ presets: ['@babel/preset-env'] }))
    .pipe(dest('temp'))
    .pipe(bs.reload({ stream: true }))
}

const page = () => {
  return src('src/*.html', { base: 'src' })
    .pipe(plugins.swig({ data, defaults: { cache: false } })) // é˜²æ­¢æ¨¡æ¿ç¼“å­˜å¯¼è‡´é¡µé¢ä¸èƒ½åŠæ—¶æ›´æ–°
    .pipe(dest('temp'))
    .pipe(bs.reload({ stream: true }))
}

const image = () => {
  return src('src/assets/images/**', { base: 'src' })
    .pipe(plugins.imagemin())
    .pipe(dest('dist'))
}

const font = () => {
  return src('src/assets/fonts/**', { base: 'src' })
    .pipe(plugins.imagemin())
    .pipe(dest('dist'))
}

const extra = () => {
  return src('public/**', { base: 'public' })
    .pipe(dest('dist'))
}

const serve = () => {
  watch('src/assets/styles/*.scss', style)
  watch('src/assets/scripts/*.js', script)
  watch('src/*.html', page)
  // watch('src/assets/images/**', image)
  // watch('src/assets/fonts/**', font)
  // watch('public/**', extra)
  watch([
    'src/assets/images/**',
    'src/assets/fonts/**',
    'public/**'
  ], bs.reload)

  bs.init({
    notify: false,
    port: 2080,
    // open: false,
    // files: 'dist/**',
    server: {
      baseDir: ['temp', 'src', 'public'],
      routes: {
        '/node_modules': 'node_modules'
      }
    }
  })
}

const useref = () => {
  return src('temp/*.html', { base: 'temp' })
    .pipe(plugins.useref({ searchPath: ['temp', '.'] }))
    // html js css
    .pipe(plugins.if(/\.js$/, plugins.uglify()))
    .pipe(plugins.if(/\.css$/, plugins.cleanCss()))
    .pipe(plugins.if(/\.html$/, plugins.htmlmin({
      collapseWhitespace: true,
      minifyCSS: true,
      minifyJS: true
    })))
    .pipe(dest('dist'))
}

const compile = parallel(style, script, page)

// ä¸Šçº¿ä¹‹å‰æ‰§è¡Œçš„ä»»åŠ¡
const build =  series(
  clean,
  parallel(
    series(compile, useref),
    image,
    font,
    extra
  )
)

const develop = series(compile, serve)

module.exports = {
  clean,
  build,
  develop
}
```



