### âœï¸ Tangxt â³ 2021-11-02 ğŸ·ï¸ å·¥ç¨‹åŒ–

# 15-å°è£…å·¥ä½œæµ - åŒ…è£… Gulp CLIã€å°è£…å·¥ä½œæµ

## â˜…å°è£…å·¥ä½œæµ - åŒ…è£… Gulp CLI

![åŒ…è£… Gulp CLI](assets/img/2021-11-02-11-49-27.png)

è‡³æ­¤ï¼Œ`zce-pages`è¿™ä¸ªè‡ªåŠ¨åŒ–æ„å»ºå·¥ä½œæµæ¨¡å—å°±ç®—æ˜¯å®Œæˆäº†ï¼Œä½†æ˜¯æˆ‘ä»¬å…¶å®è¿˜å¯ä»¥åšä¸€äº›æ›´å¤šçš„æ“ä½œï¼Œè®©æˆ‘ä»¬åœ¨ä½¿ç”¨å®ƒçš„æ—¶å€™æ›´åŠ æ–¹ä¾¿ä¸€äº›ã€‚

è¿™å…·ä½“éœ€è¦åšå“ªäº›æ“ä½œå‘¢ï¼Ÿ -> æˆ‘ä»¬å…·ä½“æ¥çœ‹

åœ¨ä½¿ç”¨è¿™ä¸ª`zce-gulp-demo`é¡¹ç›®çš„æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³è¦å»ä½¿ç”¨æˆ‘ä»¬`zce-pages`é‡Œé¢æä¾›çš„è¿™ä¸ªè‡ªåŠ¨åŒ–æ„å»ºçš„å·¥ä½œæµçš„è¯ -> æˆ‘ä»¬é¦–å…ˆéœ€è¦æŠŠå®ƒå®‰è£…åˆ°æˆ‘ä»¬çš„é¡¹ç›®å½“ä¸­ï¼Œç„¶åå®Œäº†è¿‡åï¼Œåœ¨æˆ‘ä»¬é¡¹ç›®å½“ä¸­å»æ·»åŠ é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªé…ç½®æ–‡ä»¶æ˜¯å¿…è¦çš„ï¼Œå¯¹å§ï¼Ÿç„¶åå†å¾€åï¼Œæˆ‘ä»¬éœ€è¦åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹å»æ·»åŠ ä¸€ä¸ª `gulpfile` å»æŠŠæˆ‘ä»¬åœ¨`zce-pages`é‡Œé¢æä¾›çš„è¿™äº›å·¥ä½œæµçš„ä»»åŠ¡ç»™å®ƒå¯¼å‡ºå‡ºå»ï¼Œç„¶åæˆ‘ä»¬æ‰å¯ä»¥é€šè¿‡ gulp å»è¿è¡Œå®ƒã€‚

å…¶å®è¿™ä¸ª `gulpfile` ï¼Œå¯¹äºæˆ‘ä»¬è¿™ä¸ªé¡¹ç›®æ¥è®²è¯ï¼Œä½ å­˜åœ¨çš„ä»·å€¼å°±æ˜¯æŠŠæˆ‘ä»¬æä¾›çš„è¿™ä¸ªæ¨¡å—é‡Œé¢çš„æˆå‘˜ç»™å®ƒå¯¼å‡ºå» -> è¿™ä¸ªå…¶å®å°±æ˜¾å¾—æœ‰äº›å†—ä½™äº†ï¼Œæ¯æ¬¡è¦å»åšä¸€ä¸ªé‡å¤çš„æ“ä½œæ²¡æœ‰ä»€ä¹ˆå¤ªå¤§æ„ä¹‰ -> æˆ‘ä»¬å°±å¸Œæœ›åœ¨é¡¹ç›®çš„æ ¹ç›®ä¸‹æ²¡æœ‰è¿™ä¸ª `gulpfile` å®ƒä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œã€‚

![gulpfile](assets/img/2021-11-02-11-59-09.png)

æ‰€ä»¥è¿™ä¸ªåœ°æ–¹å¯ä»¥æ€ä¹ˆå»æ“ä½œå‘¢ï¼Ÿ

æˆ‘ä»¬åˆ é™¤ä¸€ä¸‹è¿™ä¸ª `gulpfile`ï¼Œåˆ é™¤åæˆ‘ä»¬å›åˆ°å‘½ä»¤è¡Œå½“ä¸­ï¼Œ`yarn gulp`ä¸€ä¸‹ï¼š

![gulp](assets/img/2021-11-02-12-00-56.png)

å®ƒä¼šå‘Šè¯‰æˆ‘ä»¬æ‰¾ä¸åˆ° `gulpfile` æ–‡ä»¶ï¼Œé‚£è¿™ä¸ªæ—¶å€™å®ƒå°±æ²¡æœ‰åŠæ³•æ­£å¸¸å·¥ä½œäº†ã€‚ä½†æ˜¯ gulp çš„ CLI å®ƒæä¾›äº†ä¸€ä¸ªå‘½ä»¤è¡Œå‚æ•°ï¼Œå¯ä»¥è®©æˆ‘ä»¬å»æŒ‡å®šè¿™ä¸ª `gulpfile` æ‰€åœ¨çš„è·¯å¾„ã€‚

``` bash
yarn gulp --gulpfile ./node_modules/zce-pages/lib/index.js
```

![gulpfile](assets/img/2021-11-02-12-04-51.png)

å¯ä»¥çœ‹åˆ°ï¼Œå®ƒä»ç„¶æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ï¼Œåªä¸è¿‡æ‰¾ä¸åˆ°ä¸€ä¸ªå« `default` çš„ä»»åŠ¡ç½¢äº†ã€‚é‚£æˆ‘ä»¬å¯ä»¥å»è¿è¡Œä¸€ä¸ª `build` çš„ä»»åŠ¡æ¥åšä¸€ä¸ªå°è¯•ã€‚

![build](assets/img/2021-11-02-12-08-34.png)

å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä»ç„¶æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™å®ƒä¼šæœ‰ä¸€ä¸ªå°å°çš„é—®é¢˜ -> é‚£è¿™æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ

å®ƒè¿™ä¸ªæ—¶å€™çš„å·¥ä½œç›®å½•å·²ç»å˜åˆ°äº†`lib`è¿™ä¸ªç›®å½•ä¸‹é¢ï¼Œå› ä¸ºä½ çš„ `gulpfile` åœ¨`lib`ç›®å½•ï¼Œå®ƒä¼šè®¤ä¸ºä½ çš„å·¥ä½œç›®å½•ä¹Ÿåœ¨`lib`ç›®å½• -> æ­¤æ—¶å®ƒå°±ä¸ä¼šæŠŠä½ é¡¹ç›®æ‰€åœ¨çš„æ ¹ç›®å½•å»ä½œä¸ºå½“å‰çš„è¿™ä¸ªå·¥ä½œç›®å½•äº†ã€‚

ä½ è¦æƒ³å»æŒ‡å®šä¸€ä¸‹å½“å‰é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œä½œä¸ºå·¥ä½œç›®å½•çš„è¯ï¼Œä½ å¯ä»¥å†æŒ‡å®šä¸€ä¸‹`--cwd .`ï¼ˆç‚¹å°±æ˜¯å½“å‰ç›®å½•ï¼‰ã€‚

![å½“å‰ç›®å½•](assets/img/2021-11-02-12-14-28.png)

æ­¤æ—¶ä½ çš„å·¥ä½œç›®å½•å°±æ˜¯å½“å‰ç›®å½• -> ä½ å¯ä»¥ä»ç„¶æ­£å¸¸çš„å»ä½¿ç”¨è¿™ä¸ªå·¥ä½œæµã€‚åªä¸è¿‡è¿™ä¸ªä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹æˆ‘ä»¬éœ€è¦ä¼ å‚æ•° -> è¿™å°±æ¯”è¾ƒå¤æ‚äº†ã€‚

å¯¹äºè¿™ä¸ªåœ°æ–¹æˆ‘å°±äº§ç”Ÿäº†ä¸€ä¸ªæƒ³æ³•ï¼Œä»€ä¹ˆæƒ³æ³•å‘¢ï¼Ÿå°±æ˜¯åœ¨æˆ‘ä»¬çš„è¿™ä¸ª`zce-pages`å½“ä¸­ä¹Ÿæä¾›ä¸€ä¸ª CLIï¼Œé‚£è¿™ä¸ª CLI é‡Œé¢æˆ‘ä»¬è‡ªåŠ¨çš„å»ä¼ è¿™äº›å‚æ•°ï¼Œç„¶ååœ¨å†…éƒ¨å»è°ƒ gulp CLI æä¾›çš„è¿™ä¸ªå¯æ‰§è¡Œç¨‹åºã€‚

é‚£è¿™æ ·çš„è¯æˆ‘ä»¬åœ¨å¤–ç•Œä½¿ç”¨çš„æ—¶å€™å°±ä¸ç”¨å†å»ä½¿ç”¨ gulp äº†ï¼Œæˆ‘ä»¬å°±ç›¸å½“äºæŠŠ gulp å®Œå…¨åŒ…è£…åˆ°æˆ‘ä»¬è¿™ä¸ª `zce-pages` è¿™ä¸ªæ¨¡å—å½“ä¸­ã€‚

è¿™å…·ä½“æ€ä¹ˆæ“ä½œå‘¢ï¼Ÿ -> å½“ç„¶ï¼Œå¯¹äºè¿™ä¸€ç‚¹ä½ è‚¯å®šè¿˜æœ‰è¿˜ä¼šæœ‰ä¸€äº›ç–‘æƒ‘ï¼Œä½†ä¸ç”¨ç€æ€¥ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥èµ°ï¼Œèµ°åˆ°åé¢ä½ å°±åº”è¯¥æ˜ç™½äº†ã€‚

æˆ‘ä»¬å…ˆåœ¨æˆ‘ä»¬çš„è¿™ä¸ª`zce-pages`ä¸‹é¢å»æ·»åŠ  CLI çš„ç¨‹åº

æˆ‘ä»¬åœ¨`zce-pages`æ——ä¸‹æ–°å»ºä¸€ä¸ªç›®å½•ã€‚ä¸€èˆ¬æ¥è®²çš„è¯ï¼Œä½ çš„é¡¹ç›®çš„æ¨¡å—ä»£ç æ”¾åœ¨`lib`ä¸‹é¢ï¼Œç„¶åä½ å¯¹ä½ é¡¹ç›®å½“ä¸­ CLI çš„ä»£ç ä¸€èˆ¬æ”¾åœ¨`bin`ç›®å½•

![bin](assets/img/2021-11-02-12-24-25.png)

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ª`bin`ç›®å½•ã€‚ç„¶åè¿™ä¸ª`bin`ç›®å½•ä¸‹é¢æˆ‘ä»¬æ–°å»ºä¸€ä¸ª`zce-pages.js`æ–‡ä»¶ -> è¿™ä¸ªæ–‡ä»¶ä¼šä½œä¸º CLI çš„ä¸€ä¸ªæ‰§è¡Œå…¥å£ -> æ—¢ç„¶å®ƒæ˜¯ CLI çš„æ‰§è¡Œå…¥å£ï¼Œä¹‹å‰æˆ‘ä»¬ä¹Ÿè¯´è¿‡ï¼Œå®ƒå¿…é¡»è¦å‡ºç°åœ¨æˆ‘ä»¬è¿™ä¸ª `package.json` å½“ä¸­çš„`bin`å­—æ®µé‡Œè¾¹ï¼Œæˆ‘ä»¬è¦åœ¨`package.json`é‡Œè¾¹æ·»åŠ ä¸€ä¸ª`bin`å­—æ®µ

![åå­—](assets/img/2021-11-02-12-27-02.png)

å…³äº`zce-pages.js`è¿™ä¸ªæ–‡ä»¶çš„åå­—ï¼Œå®ƒå«ä»€ä¹ˆï¼Ÿå…¶å®æ— æ‰€è°“ã€‚ä¸€èˆ¬æ¥è®²çš„è¯ï¼Œæˆ‘ä¼šå°†è¿™ä¸ªåå­—èµ·åä¸ºè·Ÿæˆ‘ä»¬è¿™ä¸ªæœ€ç»ˆ CLI å‘½ä»¤çš„é‚£ä¸ªåå­—ä¿æŒä¸€è‡´ã€‚ä½ è¦æ˜¯æƒ³æŒ‡å®šé‚£ä¸ª CLI å‘½ä»¤çš„åå­—çš„è¯ï¼Œä½ å¯ä»¥æŠŠ `ban` å­—æ®µé…ç½®æˆä¸€ä¸ªå¯¹è±¡ï¼Œé‚£å¯¹è±¡çš„è¯ï¼Œé‚£ä½ è¿™ä¸ªé”®å°±å¯ä»¥éšä¾¿å†™äº†ã€‚

æ¯”å¦‚è¯´æˆ‘ä»¬å« `zp` è¿™ä¸ªç®€å†™ï¼Œç„¶åè·¯å¾„çš„è¯è¿˜æ˜¯åˆšåˆšè¿™ä¸ªè·¯å¾„ã€‚

![zp](assets/img/2021-11-02-12-28-24.png)

é‚£è¿™ä¸ªæ—¶å€™å®ƒæœ€ç»ˆç”Ÿæˆçš„é‚£ä¸ª CLI å‘½ä»¤çš„åå­—å°±æ˜¯ `zp` ï¼Œåªä¸è¿‡è¿™ä¸ªå®¹æ˜“äº§ç”Ÿå†²çªï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬è¿˜æ˜¯ä½¿ç”¨æ¨¡å—çš„åå­—ä¼šä¿é™©ä¸€ç‚¹

ä¿å­˜ä¸€ä¸‹è¿‡åï¼Œé‚£è¿™ä¸ªæ—¶å€™ï¼Œ`bin/zce-pages.js`å®ƒå°±ä¼šä½œä¸ºæˆ‘ä»¬çš„è¿™ä¸ª CLI çš„ä¸€ä¸ªå…¥å£ã€‚

é‚£ CLI å…¥å£å®ƒå°±éœ€è¦æœ‰ä¸€ä¸ªå£°æ˜çš„æ³¨é‡Š

![t9o](assets/img/2021-11-02-12-32-37.png)

è¿™æ˜¯å¿…è¦çš„ä¸€ä¸ªæ¡ä»¶ã€‚å½“ç„¶ï¼Œä¹‹å‰ä¹Ÿè¯´è¿‡ï¼Œåœ¨ Mac ä¸‹çš„è¯ï¼Œä½ éœ€è¦å°†è¿™ä¸ªæ–‡ä»¶çš„é‚£ä¸ªè¯»å†™æƒé™ä¿®æ”¹ä¸º `775`ï¼Œè¿™æ ·å®ƒæ‰ä¼šåšä¸€ä¸ª CLI

æˆ‘ä»¬æµ‹è¯•ä¸€ä¸ªæ‰“å° -> ä¿å­˜ä¸€ä¸‹ã€‚è¿™ä¸ªæ—¶å€™`bin`ä¸‹çš„`zce-pages.js`å°±ä¼šä½œä¸ºä¸€ä¸ª CLI çš„ä¸€ä¸ªå…¥å£å‡ºç°ã€‚

æœ‰äº†è¿™ä¸ª CLI å…¥å£è¿‡åï¼Œæˆ‘ä»¬å°±å¯ä»¥å›åˆ°æˆ‘ä»¬è¿™ä¸ª`zce-pages-demo`é¡¹ç›®å½“ä¸­å»ä½¿ç”¨è¿™ä¸ª`zce-cli`äº†ã€‚

åœ¨ä½¿ç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å®šä½åˆ°`zce-pages`è¿™ä¸ªç›®å½•ï¼Œæˆ‘ä»¬éœ€è¦é‡æ–°`link`ä¸€ä¸‹`zce-pages` -> å› ä¸ºä½ åªæœ‰é‡æ–°å» `link` äº†ï¼Œé‚£å®ƒæ‰å¯ä»¥æŠŠé‚£ä¸ª CLI æ³¨å†Œåˆ°å…¨å±€ï¼Œæˆ‘ä»¬æ‰å¯ä»¥å»ä½¿ç”¨å®ƒ

![link](assets/img/2021-11-02-12-36-39.png)

`link` å®Œäº†è¿‡åï¼Œæˆ‘ä»¬å…¶å®å°±å¯ä»¥åœ¨å‘½ä»¤è¡Œé‡Œé¢å»è¿è¡Œä¸€ä¸‹è¿™ä¸ª`zce-pages` -> å›è½¦è¿™æ—¶å€™ï¼Œå®ƒå°±ä¼šæ‰§è¡Œ`zce-pages.js`é‡Œé¢å¯¹åº”çš„ä¸€äº›ä»£ç ï¼š

![t9o-pages](assets/img/2021-11-02-12-38-14.png)

æˆ‘åªéœ€è¦æŠŠå¯¹ Gulp CLI çš„è°ƒç”¨ä»¥åŠæˆ‘ä»¬åˆšåˆšä¼ çš„é‚£äº›å¤æ‚çš„å‚æ•°æ”¾åœ¨å½“å‰è¿™ä¸ª`zce-pages.js`æ–‡ä»¶å½“ä¸­å°±å¯ä»¥äº†ã€‚

é‚£æˆ‘ä»¬è¿™ä¸ªåœ°æ–¹åº”è¯¥æ€ä¹ˆæ ·å»ç”¨å‘¢ï¼Ÿ

æˆ‘ä»¬å¯ä»¥å…ˆçœ‹ä¸€ä¸‹é‚£ä¸ª Gulp CLI å®ƒæ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Œæˆ‘ä»¬åœ¨é¡¹ç›®çš„ç›®å½•ä¸‹é¢å»æ‰¾åˆ°`node_modules/.bin/gulp.cmd`

`gulp`å®ƒåœ¨ Windows ä¸Šæ‰§è¡Œçš„åº”è¯¥æ˜¯ä¸€ä¸ª `cmd` æ–‡ä»¶ -> å®ƒæ‰§è¡Œçš„æ˜¯ä¸€ä¸ª `cmd` æ–‡ä»¶ã€‚

åœ¨è¿™ä¸ª `cmd` æ–‡ä»¶å½“ä¸­ï¼Œå®é™…ä¸ŠæŒ‰ç…§å‘½ä»¤è¡Œçš„é‚£ä¸ªè¯­æ³•å»å†™çš„ä¸€æ®µä»£ç ï¼š

![gulp.cmd](assets/img/2021-11-02-12-59-09.png)

è¿™ä¸ªä»£ç ï¼Œå…¶å®ä½ å¯ä»¥è¯´ä½ ä¸ä¼šå†™ï¼Œä½†æ˜¯ä½ çœ‹æ‡‚å®ƒåº”è¯¥æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§é—®é¢˜ã€‚

å®ƒå¾ˆå¾ˆç®€å•ã€‚é¦–å…ˆ `if` æŒ‡ä»¤å°±æ˜¯ç”¨æ¥åˆ¤æ–­ `exit` æ˜¯å¦å­˜åœ¨ã€‚

è¿™ä¸ª`%~dp0`æŒ‡çš„æ˜¯å½“å‰è¿™ä¸ª cmd æ‰€åœ¨çš„è¿™ä¸ªç›®å½•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿™ä¸ª`.bin`ç›®å½•ï¼Œå®ƒåˆ¤æ–­ä½ è¿™ä¸ª`.bin`ç›®å½•ä¸‹é¢æœ‰æ²¡æœ‰ä¸€ä¸ª`node.exe` -> å¦‚æœæœ‰ï¼Œé‚£å°±èµ°è¿™ä¸ªï¼Œå¦åˆ™å°±èµ°ä¸‹é¢è¿™ä¸ªã€‚

é¦–å…ˆæˆ‘ä»¬è¿™ä¸ª`.bin`ç›®å½•ä¸‹è‚¯å®šæ˜¯æ²¡æœ‰`node.exe`ã€‚æˆ‘ä»¬çš„ `node.exe` æ˜¯å®‰è£…åœ¨å…¨å±€ç¯å¢ƒçš„ï¼Œæ‰€ä»¥è¯´è¿™è‚¯å®šæ˜¯èµ°ä¸‹é¢çš„ã€‚

![æ‰¾æ–¹æ³•æ‰§è¡Œ](assets/img/2021-11-02-13-10-33.png)

è€Œä¸‹é¢ä¸€å—å„¿ï¼Œå¯¹äºä¸Šé¢è¿™ä¸¤ä¸ªæ“ä½œï¼Œå…¶å®å°±æ˜¯é…ç½®äº†ä¸€ä¸‹ç¯å¢ƒå˜é‡ï¼Œè®©æˆ‘ä»¬çš„é‚£ä¸ªå¯æ‰§è¡Œæ–‡ä»¶åå­—åŠ äº†ä¸€ä¸ªå°±æ˜¯`.js`è¿™ç§æ‰©å±•åï¼Œè¿™ä¸ªå…¶å®ä¸ç”¨ç®¡å®ƒï¼Œé‡ç‚¹è¦ç®¡çš„æ˜¯ä¸‹é¢è¿™ä¸ª -> ä¸‹é¢è¿™ä¸ªå®é™…ä¸Šæ˜¯é€šè¿‡`node`å»æ‰§è¡Œäº†ä¸€ä¸‹å½“å‰è¿™ä¸ªç›®å½•ä¸‹ï¼Œä¹Ÿå°±æ˜¯`.bin`ç›®å½•ï¼Œç„¶å`..`å°±æ˜¯ä¸Šä¸€å±‚ç›®å½•ä¹Ÿå°±æ˜¯`node_modules`ï¼Œç„¶åå°±æ˜¯`gulp`æ¨¡å—ä¸‹çš„`bin/gulp.js`æ–‡ä»¶ -> è¿™ä¸ª JS æ–‡ä»¶é‡Œé¢å®é™…ä¸Šæ˜¯ `require` äº†ä¸€ä¸‹è¿™ä¸ª`gulp-cli`ï¼Œå®ƒè¿”å›äº†ä¸€æ–¹æ³•ï¼Œç„¶åè°ƒç”¨äº†ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚

å…¶å®æˆ‘ä»¬è¦æƒ³åœ¨è¿™ä¸ª`zce-pages.js`é‡Œé¢å»è¿è¡Œ gulp çš„è¯ -> è¿™å¾ˆç®€å•ï¼Œæˆ‘åªéœ€è¦å»æ‰§è¡Œä¸€ä¸‹è¿™ä¸ª`gulp.js`æ–‡ä»¶å°±å¥½äº† -> è½½å…¥äº†è¿™ä¸ª`gulp.js` -> é‚£å®ƒå°±ä¼šè‡ªåŠ¨å»è½½å…¥`gulp-cli`

![gulp-cli](assets/img/2021-11-02-13-19-17.png)

é’ˆå¯¹äºå‘½ä»¤è¡Œçš„å‚æ•°ï¼Œé‚£è¯¥æ€ä¹ˆå»ä¼ é€’å‘¢ï¼Ÿå¾…ä¼šæˆ‘ä»¬å†æ¥çœ‹

æˆ‘ä»¬ç°åœ¨çœ‹ä¸€ä¸‹å®ƒèƒ½ä¸èƒ½å»è¿è¡Œ gulp ï¼š

![zce-pages](assets/img/2021-11-02-13-20-17.png)

å¯ä»¥çœ‹åˆ°ï¼Œå®ƒè¿™æ—¶å€™æŠ¥äº† `gulpfile not found` -> è¿™ä¹Ÿå°±æ„å‘³ç€è¿™ç¡®å®æ˜¯è®© gulp CLI å·¥ä½œäº†

é‚£å‰©ä¸‹çš„å°±æ˜¯æˆ‘ä»¬æ€ä¹ˆæ ·å»æŒ‡å®šé‚£ä¸ª `gulpfile` çš„è·¯å¾„ä»¥åŠ `cwd` è·¯å¾„ã€‚

ä½ è¦çŸ¥é“æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œå½“ä¸­ä¼ é€’çš„å‚æ•°ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `process.argv` å»æ‹¿åˆ°ã€‚`argv`å®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç€å†æ¥èµ°ä¸€ä¸‹ã€‚

![argv](assets/img/2021-11-02-13-25-06.png)

æ¯”å¦‚è¯´åœ¨æ‰§è¡Œ`zce-pages`æ—¶éšä¾¿ä¼ ä¸€äº›ä¸œè¥¿åœ¨é‡Œé¢ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ª `argv` å‰ä¸¤ä¸ªï¼š

- ç¬¬ä¸€ä¸ªæ˜¯ `node.exe` è¿™æ˜¯å›ºå®šçš„
- ç¬¬äºŒä¸ªæ˜¯è¿™ä¸ªå½“å‰æ–‡ä»¶çš„è·¯å¾„ï¼Œè¿™ä¹Ÿæ˜¯å›ºå®šçš„
- ç„¶ååé¢å°±æ˜¯æˆ‘ä»¬æ‰€æœ‰çš„å‚æ•°

é‚£ä¹Ÿå°±æ˜¯è¯´åœ¨ gulp-cli å½“ä¸­ï¼Œå®ƒå®é™…ä¸Šæ˜¯é€šè¿‡ `process.argv` å»æ‹¿åˆ°æ‰€æœ‰çš„å‚æ•°çš„ã€‚

æ‰€ä»¥ï¼Œæˆ‘å¯ä»¥åœ¨`zce-pages.js`ä»£ç è¿è¡Œä¹‹å‰ï¼Œæˆ‘å…ˆå¾€è¿™ä¸ª `argv` å½“ä¸­å» `push` ->  `push` æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ `push` æˆ‘ä»¬åˆšåˆšéœ€è¦ä¼ é€’è¿›å»çš„å‚æ•°ã€‚

![æ‹¿åˆ°å‘½ä»¤è¡Œå‚æ•°](assets/img/2021-11-02-13-46-15.png)

é¦–å…ˆç¬¬ä¸€ä¸ª`cwd` -> å¯¹è¿™ä¸ª`cwd`æˆ‘ä»¬æŒ‡å®šçš„ä¸€ä¸ªè·¯å¾„æ˜¯ -> å› ä¸º`argv`æ˜¯æ•°ç»„ï¼Œæ¯ä¸ªå‚æ•°åº”è¯¥æ˜¯æ•°ç»„å½“ä¸­ç‹¬ç«‹çš„æˆå‘˜ï¼Œæˆ‘ä»¬åº”è¯¥å•ç‹¬å» `push` -> æ‰€ä»¥ï¼Œè¿™ä¸ªå·¥ä½œç›®å½•åº”è¯¥æ˜¯å½“å‰å‘½ä»¤è¡Œæ‰€åœ¨çš„ç›®å½•

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜è¦å»`push`ä¸€ä¸‹é‚£ä¸ª `gulpfile` æ‰€åœ¨è·¯å¾„ã€‚

`require`è½½å…¥è¿™ä¸ªæ¨¡å—ï¼Œ`resolve`æ˜¯æ‰¾åˆ°è¿™ä¸ªæ¨¡å—æ‰€å¯¹åº”çš„è·¯å¾„ï¼Œå®ƒé‡Œé¢ä¼ é€’çš„è¿™ä¸ªå­—ç¬¦ä¸²å‚æ•°æ˜¯ç›¸åŒçš„ï¼Œéƒ½æ˜¯é€šè¿‡ç›¸å¯¹è·¯å¾„çš„æ–¹å¼å»ä¼  -> æˆ‘ä»¬è¿™å„¿è¦æ‰¾çš„å°±æ˜¯`..`ä¸Šä¸€å±‚ç›®å½•ä¸‹çš„ `lib` ä¸‹é¢çš„ `index`

å®é™…ä¸Šå¯¹äºæˆ‘ä»¬è¿™ä¸ª`zce-pages`é¡¹ç›®æ¥è®²çš„è¯ï¼Œå…¶å®ç›´æ¥ä¼ `..`å°±è¡Œäº†ï¼Œå› ä¸ºä½ æ‰¾åˆ°ä¸Šä¸€å±‚ç›®å½•ï¼Œæ‰¾çš„å°±æ˜¯æˆ‘ä»¬è¿™ä¸ª`zce-pages`æ‰€åœ¨çš„ä¸€ä¸ªç›®å½•ï¼Œé‚£å®ƒä¼šè‡ªåŠ¨å»æ‰¾`package.json`å½“ä¸­ `main` å­—æ®µé‡Œé¢å¯¹åº”çš„é‚£ä¸ªæ–‡ä»¶ï¼Œæ‰€ä»¥è¿™åŒæ ·ä¹Ÿæ˜¯ç›¸å¯¹äºé‚£ä¸ª`bin/index.js`æ–‡ä»¶çš„è·¯å¾„ï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬`resolve('..')`å°±å¯ä»¥äº†ã€‚

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬ä¸ç€æ€¥å» `require` `gulp-cli`ï¼Œæˆ‘ä»¬æ‰“å°ä¸€ä¸‹`argv`

å¯ä»¥çœ‹åˆ°ï¼Œå®ƒå°±ä¼šè·Ÿä½ ä¼ é€’è¿›å»çš„é‚£ç§å‚æ•°æ–¹å¼æ˜¯ä¸€æ ·çš„äº†ã€‚ä½ çœ‹æˆ‘ä»¬ä¼ è¿›å»çš„å‚æ•° -> ç›¸å½“äºæ˜¯é”®`--xxx`æ˜¯ä¸€ä¸ªæ•°ç»„å½“ä¸­çš„æˆå‘˜ï¼Œå€¼`yyy`ä¹Ÿæ˜¯æ•°ç»„å½“ä¸­æˆå‘˜ã€‚

ä½ è‡ªå·±é€šè¿‡ `push` çš„æ–¹å¼ `push` è¿›å»çš„ä¹Ÿæ˜¯ä¸€æ ·çš„ã€‚æ‰€ä»¥è¯´è¿™ç§æ–¹å¼å°±å¯ä»¥å·¥ä½œäº†ï¼Œæˆ‘ä»¬æ¥è¯•ä¸€ä¸‹æ¥ã€‚

æˆ‘ä»¬è¦å·¥ä½œçš„ç›®å½•ä¸æ˜¯åœ¨å½“å‰è¿™ä¸ª`zce-pages`é¡¹ç›®ç›®å½•

æˆ‘ä»¬åº”è¯¥æ˜¯è¿›å…¥åˆ°æˆ‘ä»¬çœŸæ­£çš„é™æ€é¡µçš„é¡¹ç›®é‡Œé¢ã€‚

åœ¨è¿™ä¸ª`zce-gulp-demo`ç›®å½•ä¸‹é¢çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥é€šè¿‡`zce-pages build`å»æ„å»º

![zce-pages](assets/img/2021-11-02-13-51-44.png)

å¯ä»¥çœ‹åˆ°ï¼Œ`zce-pages`ä¼šè‡ªåŠ¨æ‰¾åˆ°`lib`ç›®å½•ä¸‹çš„`index.js`é‚£ä¸ªé…ç½®

è€Œå·¥ä½œç›®å½•å°±æ˜¯å½“å‰è¿™ä¸ª`zce-gulp-demo`ç›®å½•ï¼Œæ‰€ä»¥è¿™ä»æ˜¯å¯ä»¥æ­£å¸¸çš„å» `build` çš„

æˆ‘ä»¬å†å»æ‰§è¡Œä¸€ä¸‹ `clean` -> è¿™åŒæ ·ä¹Ÿæ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ã€‚

![clean](assets/img/2021-11-02-13-55-19.png)

è‡³æ­¤ï¼Œå°±ä¸å†è¦æ±‚ä½ é¡¹ç›®`zce-pages-demo`çš„æ ¹ç›®å½•ä¸‹å¿…é¡»è¦æœ‰`gulpfile.js`äº†

è€Œä¸”ï¼Œå¦‚æœä½ æŠŠè¿™ä¸ª`zce-pages`æ¨¡å—ä½œä¸ºå…¨å±€çš„æ¨¡å—å®‰è£…è¯ï¼Œé‚£ä½ ç”šè‡³éƒ½ä¸éœ€è¦ä¸ºè¿™ä¸ª`zce-pages-demo`é¡¹ç›®å»å®‰è£…è¿™ä¸ª`zce-pages`ä¾èµ–ï¼Œé‚£è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬åœ¨åç»­ä½¿ç”¨çš„æ—¶å€™å°±ä¼šæ›´åŠ æ–¹ä¾¿ä¸€ç‚¹ã€‚

æ‰€ä»¥é’ˆå¯¹äºè¿™ä¸ªæ“ä½œï¼Œå…¶å®æ˜¯ä¸€ä¸ª Y æ“ä½œï¼Œä½†æ˜¯è¿™ä¼šè®©ä½¿ç”¨çš„æ—¶å€™æ›´åŠ æ–¹ä¾¿ -> è¿™ä¸ªç›¸å½“äºæˆ‘ä»¬å½»åº•æŠŠ gulp ç»™å®ƒå®Œå…¨é›†æˆåˆ°æˆ‘ä»¬è¿™ä¸ª`zce-pages`æ¨¡å—å½“ä¸­ï¼Œé‚£æˆ‘ä»¬å°±ä¸éœ€è¦å†å»å®‰è£… `gulp`ã€`gulp-cli`é‚£äº›ä¸œè¥¿äº†ï¼Œæˆ‘ä»¬æŠŠè¿™äº›å…¨éƒ¨éƒ½åŒ…è£…åˆ°æˆ‘ä»¬`zce-pages`è¿™ä¸ªæ¨¡å—å½“ä¸­äº†ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬ä¼šæŠŠè¿™ä¸ªæ¨¡å—å‘å¸ƒä¸€ä¸‹ï¼Œå‘å¸ƒè¿‡åæˆ‘ä»¬å†åˆ°æˆ‘ä»¬çš„é¡¹ç›®å½“ä¸­å»çœ‹ä¸€ä¸‹æ€ä¹ˆæ ·å»å…·ä½“ä½¿ç”¨å®ƒã€‚

ç„¶åæˆ‘å†æ¢³ç†ä¸€ä¸‹åˆšåˆšæˆ‘ä»¬è¿™ä¸ª CLI çš„ä¸€ä¸ªå·¥ä½œçš„åŸç†ã€‚

---

è¿è¡Œ`t9o-pages build` -> `node.exe` æ‰§è¡Œ `t9o-pages` è¿™ä¸ªæ¨¡å—ä¸‹çš„`bin`ç›®å½•ä¸‹çš„`t9o-pages.js` -> ä¼šå¾—åˆ°å‡ ä¸ªå‚æ•°

![å‚æ•°](assets/img/2021-11-02-14-16-45.png)

`require('gulp/bin/gulp')`ä¼šå»æ‰§è¡Œ`gulp.js`ï¼š

![gulp](assets/img/2021-11-02-14-17-40.png)

è€Œ`gulp-cli`çš„è¿”å›å€¼ï¼š

![gulp-cli](assets/img/2021-11-02-14-20-57.png)

æ‰€ä»¥ï¼Œ`t9o-pages build`å°±æ˜¯`yarn gulp build --cwd . --gulpfile æ¨¡å—çš„libç›®å½•ä¸‹çš„index.js` -> æ‰§è¡Œè¯¥æ¨¡å—ä¸‹`bin`ç›®å½•ä¸‹çš„`t9o-pages.js` -> æ‰¾åˆ°`gulp`æ¨¡å—ä¸‹`bin`ç›®å½•ä¸‹çš„`gulp.js`ï¼Œæ‰§è¡Œè¿™ä¸ª`gulp.js` -> `gulp.js`é‡Œè¾¹ä¼šè°ƒç”¨`gulp-cli`å¯¼å‡ºçš„`run`æ–¹æ³• -> `run`æ–¹æ³•ä¼šæ‹¿åˆ°å‚æ•°é…ç½®ï¼ˆæ¯”å¦‚æ­¤æ—¶è¿è¡Œ`t9o-pagse`çš„é¡¹ç›®ç›®å½•ã€`t9o-pages`çš„`gulpfile`é…ç½®ï¼Œè¿™ä¸ªåœ¨å®ƒçš„`lib/index.js`é‡Œã€è¦æ‰§è¡Œçš„ä»»åŠ¡`build`ï¼‰ -> å¾—åˆ°äº†ä½ æƒ³è¦çš„ç»“æœ

![ä½ æƒ³è¦çš„ç»“æœ](assets/img/2021-11-02-14-41-06.png)

---

â¹ï¼š[node çš„è·¯å¾„è§£æ require.resolve - æ˜é‡‘](https://juejin.cn/post/6844904055806885895)