### âœï¸ Tangxt â³ 2021-10-26 ğŸ·ï¸ å·¥ç¨‹åŒ–

# 07-Grunt çš„åŸºæœ¬ä½¿ç”¨ã€Grunt æ ‡è®°ä»»åŠ¡å¤±è´¥ã€Grunt çš„é…ç½®æ–¹æ³•ã€Grunt å¤šç›®æ ‡ä»»åŠ¡ã€Grunt æ’ä»¶çš„ä½¿ç”¨ã€Grunt å¸¸ç”¨æ’ä»¶åŠæ€»ç»“

> Grunt åŸºæœ¬æ˜¯å·²ç»å‡‰å‡‰äº†ï¼Œåœ¨è¿™é‡Œæˆ‘å°±ç®€å•äº†è§£ä¸‹ Gruntï¼Œèƒ½çœ‹æ‡‚`gruntfile.js`å°±å¥½äº†ï¼ -> è¿™å…¶ä¸­æåˆ°ä¸€ä¸ª`done`çš„ç”¨æ³•ï¼Œè®©æˆ‘æƒ³åˆ°å•å…ƒæµ‹è¯•å…³äºå¼‚æ­¥çš„æµ‹è¯•ä¹Ÿæ˜¯è¿™æ ·åšçš„ï¼ -> è¿˜æœ‰å¯¹`preset-env`çš„è§£é‡Š

## â˜…Grunt çš„åŸºæœ¬ä½¿ç”¨

![åŸºæœ¬ä½¿ç”¨](assets/img/2021-10-26-19-27-47.png)

æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨ä¸€ä¸ªç©ºé¡¹ç›®å½“ä¸­å»çœ‹ä¸€ä¸‹ Grunt çš„å…·ä½“ç”¨æ³•ã€‚

æˆ‘ä»¬è¿™å„¿æ˜¯ä¸€ä¸ªå…¨æ–°çš„ç©ºé¡¹ç›®ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªé¡¹ç›®å½“ä¸­æƒ³è¦å»ä½¿ç”¨ Grunt çš„è¯ï¼Œé¦–å…ˆå…ˆéœ€è¦å» `init` ä¸€ä¸ª `package.json`ã€‚

æœ‰äº†è¿™ä¸ªæ–‡ä»¶è¿‡åï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ `add` æ–¹å¼å»æ·»åŠ ä¸€ä¸‹ Grunt è¿™ä¸ªæ¨¡å—ï¼š

``` bash
yarn add grunt --dev
```

> è§†é¢‘é‡Œæ²¡æœ‰åŠ `--dev`

å®‰è£…å®Œè¿™ä¸ªæ¨¡å—è¿‡åï¼Œæˆ‘ä»¬è¿˜éœ€è¦åœ¨è¿™ä¸ªé¡¹ç›®çš„æ ¹ç›®å½•ä¸‹å»æ·»åŠ ä¸€ä¸ª`gruntfile.js`æ–‡ä»¶ -> è¿™ä¸ªæ–‡ä»¶æ˜¯ Grunt çš„å…¥å£æ–‡ä»¶ï¼Œç”¨äºå»å®šä¹‰ä¸€äº›éœ€è¦ Grunt è‡ªåŠ¨å»æ‰§è¡Œçš„ä»»åŠ¡ã€‚

æˆ‘ä»¬åœ¨è¿™ä¸ªæ–‡ä»¶å½“ä¸­éœ€è¦å»å¯¼å‡ºä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°å»æ¥æ”¶ä¸€ä¸ªå«åš `grunt` çš„å½¢å¼å‚æ•° -> è¿™ä¸ª `grunt` å®ƒæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡å½“ä¸­å°±æ˜¯ grunt æä¾›çš„ä¸€äº› APIï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©äºè¿™äº› API å»å¿«é€Ÿåˆ›å»ºä¸€äº›æ„å»ºä»»åŠ¡ã€‚

å…·ä½“æ¥åšå°±æ˜¯æˆ‘ä»¬é€šè¿‡`module.exports`å»å¯¼å‡ºè¿™æ ·ä¸€ä¸ªå‡½æ•°ã€‚

åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œæˆ‘ä»¬å€ŸåŠ©äº `grunt` çš„`registerTask`æ–¹æ³•å»æ³¨å†Œä¸€ä¸ªä»»åŠ¡ã€‚

è¿™ä¸ªæ–¹æ³•ç¬¬ä¸€ä¸ªå‚æ•°å»æŒ‡å®šä¸€ä¸‹æˆ‘ä»¬è¿™ä¸ªä»»åŠ¡çš„åå­—ã€‚ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥å»æŒ‡å®šä¸€ä¸ªä»»åŠ¡å‡½æ•°ï¼Œä¹Ÿå°±æ˜¯å½“è¿™ä¸ªä»»åŠ¡å‘ç”Ÿæ—¶è‡ªåŠ¨å»æ‰§è¡Œçš„è¿™ä¸ªå‡½æ•°ã€‚

é‚£æˆ‘ä»¬åœ¨è¿™ä¸ªå‡½æ•°é‡Œé¢æ‰“å°ä¸€ä¸ª `hello Grunt` 

æˆ‘ä»¬å›åˆ°å‘½ä»¤è¡Œå½“ä¸­ã€‚

ä¸ºäº†å¯ä»¥æ›´æ¸…æ¥šçš„çœ‹åˆ°æˆ‘ä»¬çš„ä»£ç ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ªé¢æ¿ç§»åˆ°å±å¹•çš„å³ä¾§ï¼Œç„¶åè¿è¡Œ `yarn grunt`

`yarn`å®ƒä¼šè‡ªåŠ¨çš„å»å¸®æˆ‘ä»¬æ‰¾åˆ° `node_modules`å½“ä¸­æä¾›çš„ä¸€äº›å‘½ä»¤ -> æˆ‘ä»¬ç´§æ¥ç€è·Ÿä¸Š `foo` -> `foo`å°±æ˜¯æˆ‘ä»¬åˆšåˆšæ³¨å†Œçš„è¿™ä¸ªä»»åŠ¡çš„åå­—ã€‚

é‚£è¿™æ ·çš„è¯ï¼ŒGrunt å°±ä¼šè‡ªåŠ¨çš„å»å¸®æˆ‘ä»¬å»æ‰§è¡Œ `foo` è¿™ä¸ªä»»åŠ¡ã€‚å½“ç„¶ï¼Œä½ ä¸ä»…ä»…å¯ä»¥æ·»åŠ ä¸€ä¸ªä»»åŠ¡ï¼Œä½ è¿˜å¯ä»¥å»æ·»åŠ æ›´å¤šçš„ä»»åŠ¡ã€‚

å¦‚æœä½ åœ¨æ·»åŠ ä»»åŠ¡çš„æ—¶å€™ï¼Œä½ çš„ç¬¬äºŒä¸ªå‚æ•°æŒ‡å®šçš„æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²çš„è¯ï¼Œé‚£è¿™ä¸ªå­—ç¬¦ä¸²å°†ä¼šæˆä¸ºè¿™ä¸ªä»»åŠ¡çš„æè¿°ï¼Œå®ƒä¼šå‡ºç°åœ¨ Grunt çš„å¸®åŠ©ä¿¡æ¯å½“ä¸­ã€‚
æˆ‘ä»¬å¯ä»¥åœ¨å‘½ä»¤è¡Œå½“ä¸­ï¼Œé€šè¿‡ `grunt --help` å»å¾—åˆ° Grunt çš„å¸®åŠ©ä¿¡æ¯ã€‚

åœ¨è¿™ä¸ªå¸®åŠ©ä¿¡æ¯å½“ä¸­ï¼Œæœ‰ä¸€ä¸ª `Available tasks`ï¼Œåœ¨è¿™ä¸ª `task` å½“ä¸­ï¼Œä½ çš„ä»»åŠ¡æè¿°å°±æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ä¸€ä¸ªä»»åŠ¡æè¿°äº†ã€‚

å½“ç„¶ï¼Œä½ åŒæ ·å¯ä»¥é€šè¿‡ `grunt` å»è¿è¡Œ `bar` è¿™ä¸ªä»»åŠ¡ -> å…·ä½“çš„è¿è¡Œæ–¹å¼å°±æ˜¯é€šè¿‡ `grunt bar`

é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœè¯´ä½ åœ¨æ³¨å†Œä»»åŠ¡çš„æ—¶å€™ï¼Œä½ ä»»åŠ¡çš„åç§°å«åš `default` çš„è¯ï¼Œé‚£è¿™ä¸ªä»»åŠ¡å°†ä¼šæˆä¸º Grunt çš„é»˜è®¤ä»»åŠ¡ -> ä½ åœ¨è¿è¡Œè¿™ä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œå°±ä¸éœ€è¦å†å»æŒ‡å®šä»»åŠ¡çš„åç§°ï¼ŒGrunt å°†è‡ªåŠ¨è°ƒç”¨ `default` -> ä¸€èˆ¬æˆ‘ä»¬ä¼šç”¨ `default` å»æ˜ å°„ä¸€äº›å…¶ä»–çš„ä»»åŠ¡ã€‚

é‚£å…·ä½“çš„åšæ³•å°±æ˜¯åœ¨`registerTask`è¿™æ ·ä¸€ä¸ªæ–¹æ³•å½“ä¸­ï¼Œç¬¬äºŒä¸ªå‚æ•°ä¼ å…¥ä¸€ä¸ªæ•°ç»„ -> è¿™ä¸ªæ•°ç»„å½“ä¸­æˆ‘ä»¬å¯ä»¥å»æŒ‡å®šä¸€äº›ä»»åŠ¡çš„åå­—ï¼Œé‚£è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å»æ‰§è¡Œ `default` çš„æ—¶å€™ï¼ŒGrunt å°±ä¼šä¾æ¬¡æ‰§è¡Œæˆ‘ä»¬æ•°ç»„å½“ä¸­è¿™äº›ä»»åŠ¡ã€‚

æˆ‘ä»¬å›åˆ°å‘½ä»¤è¡Œå½“ä¸­ï¼Œé€šè¿‡ Grunt å»æ‰§è¡Œé»˜è®¤ä»»åŠ¡ã€‚é‚£æ­¤æ—¶ä½ ä¼šå‘ç° Grunt å…ˆæ‰§è¡Œäº† `foo` è¿™ä¸ªä»»åŠ¡ï¼Œç„¶åå»æ‰§è¡Œäº† `bar` è¿™ä¸ªä»»åŠ¡ã€‚é‚£è¿™æ ·çš„è¯ï¼Œ`default` å°±ç›¸å½“äºæ˜¯æŠŠ `foo` å’Œ `bar` ä¸²è”åˆ°äº†ä¸€èµ·ã€‚

æœ€åæˆ‘ä»¬å†æ¥å°è¯•äº†ä¸€ä¸‹ Grunt å½“ä¸­å¯¹å¼‚æ­¥ä»»åŠ¡çš„æ”¯æŒã€‚

æˆ‘ä»¬åœ¨è¿™ä¸ª`async-task`ä»»åŠ¡å½“ä¸­å»é€šè¿‡`setTimeout`å»æ¨¡æ‹Ÿä¸€ä¸‹å¼‚æ­¥æ“ä½œã€‚

åœ¨å¼‚æ­¥ä»»åŠ¡å®Œæˆè¿‡åï¼Œæˆ‘ä»¬æ‰“å°ä¸€ä¸ªæ¶ˆæ¯åˆ°æ§åˆ¶å°å½“ä¸­ã€‚

å®Œæˆè¿‡åæˆ‘ä»¬å›åˆ°å‘½ä»¤è¡Œ -> é€šè¿‡ Grunt å»æ‰§è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡ã€‚

é€šè¿‡æ‰§è¡Œï¼Œæˆ‘ä»¬å‘ç°`console.log()`å¹¶æ²¡æœ‰ç›´æ¥æ‰§è¡Œ -> è¿™ä¸ªæ˜¯ Grunt å½“ä¸­ä¸€ä¸ªç‰¹ç‚¹ -> Grunt çš„ä»£ç ï¼Œå®ƒé»˜è®¤æ”¯æŒåŒæ­¥æ¨¡å¼ã€‚

å¦‚æœè¯´ä½ éœ€è¦å¼‚æ­¥æ“ä½œçš„è¯ï¼Œä½ å¿…é¡»è¦ä½¿ç”¨`this.async`æ–¹æ³•å¾—åˆ°ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåœ¨ä½ çš„å¼‚æ­¥æ“ä½œå®Œæˆè¿‡åï¼Œå»è°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ï¼Œæ ‡è¯†ä¸€ä¸‹è¿™ä¸ªä»»åŠ¡å·²ç»è¢«å®Œæˆã€‚

å¦‚æœè¯´æˆ‘ä»¬è¦åœ¨å‡½æ•°å½“ä¸­ä½¿ç”¨ `this` çš„è¯ï¼Œé‚£æˆ‘ä»¬çš„å‡½æ•°å°±ä¸èƒ½æ˜¯ç®­å¤´å‡½æ•°äº†ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ™®é€šçš„å‡½æ•°ã€‚åœ¨è¿™å‡½æ•°å½“ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨`this.async`å¾—åˆ°ä¸€ä¸ªå›è°ƒå‡½æ•° -> è¿™ä¸€æ¬¡æˆ‘ä»¬åœ¨ `setTimeout` å®Œæˆè¿‡åï¼Œé™¤äº†æ‰“å°æ¶ˆæ¯ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å»è°ƒç”¨ä¸€ä¸‹è¿™ä¸ª `done` å›è°ƒå‡½æ•° -> æ ‡è¯†ä¸€ä¸‹æˆ‘ä»¬è¿™ä¸ªä»»åŠ¡å·²ç»å®Œæˆäº† -> æ­¤æ—¶ Grunt å°±çŸ¥é“è¿™æ˜¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡ï¼Œå®ƒä¼šç­‰å¾… `done` çš„æ‰§è¡Œï¼Œç›´åˆ° `done` è¢«æ‰§è¡Œï¼ŒGrunt æ‰ä¼šç»“æŸè¿™ä¸ªä»»åŠ¡çš„æ‰§è¡Œã€‚

ğŸ’¡ï¼šä»£ç ï¼Ÿ

åªå®‰è£…ä¸€ä¸ªå¼€å‘ä¾èµ–ï¼š`grunt`

``` js
// Grunt çš„å…¥å£æ–‡ä»¶
// ç”¨äºå®šä¹‰ä¸€äº›éœ€è¦ Grunt è‡ªåŠ¨æ‰§è¡Œçš„ä»»åŠ¡
// éœ€è¦å¯¼å‡ºä¸€ä¸ªå‡½æ•°
// æ­¤å‡½æ•°æ¥æ”¶ä¸€ä¸ª grunt çš„å¯¹è±¡ç±»å‹çš„å½¢å‚
// grunt å¯¹è±¡ä¸­æä¾›ä¸€äº›åˆ›å»ºä»»åŠ¡æ—¶ä¼šç”¨åˆ°çš„ API

module.exports = grunt => {
  grunt.registerTask('foo', 'a sample task', () => {
    console.log('hello grunt')
  })

  grunt.registerTask('bar', () => {
    console.log('other task')
  })

  // // default æ˜¯é»˜è®¤ä»»åŠ¡åç§°
  // // é€šè¿‡ grunt æ‰§è¡Œæ—¶å¯ä»¥çœç•¥
  // grunt.registerTask('default', () => {
  //   console.log('default task')
  // })

  // ç¬¬äºŒä¸ªå‚æ•°å¯ä»¥æŒ‡å®šæ­¤ä»»åŠ¡çš„æ˜ å°„ä»»åŠ¡ï¼Œ
  // è¿™æ ·æ‰§è¡Œ default å°±ç›¸å½“äºæ‰§è¡Œå¯¹åº”çš„ä»»åŠ¡
  // è¿™é‡Œæ˜ å°„çš„ä»»åŠ¡ä¼šæŒ‰é¡ºåºä¾æ¬¡æ‰§è¡Œï¼Œä¸ä¼šåŒæ­¥æ‰§è¡Œ
  grunt.registerTask('default', ['foo', 'bar'])

  // ä¹Ÿå¯ä»¥åœ¨ä»»åŠ¡å‡½æ•°ä¸­æ‰§è¡Œå…¶ä»–ä»»åŠ¡
  grunt.registerTask('run-other', () => {
    // foo å’Œ bar ä¼šåœ¨å½“å‰ä»»åŠ¡æ‰§è¡Œå®Œæˆè¿‡åè‡ªåŠ¨ä¾æ¬¡æ‰§è¡Œ
    grunt.task.run('foo', 'bar')
    console.log('current task runing~')
  })

  // é»˜è®¤ grunt é‡‡ç”¨åŒæ­¥æ¨¡å¼ç¼–ç 
  // å¦‚æœéœ€è¦å¼‚æ­¥å¯ä»¥ä½¿ç”¨ this.async() æ–¹æ³•åˆ›å»ºå›è°ƒå‡½æ•°
  // grunt.registerTask('async-task', () => {
  //   setTimeout(() => {
  //     console.log('async task working~')
  //   }, 1000)
  // })

  // ç”±äºå‡½æ•°ä½“ä¸­éœ€è¦ä½¿ç”¨ thisï¼Œæ‰€ä»¥è¿™é‡Œä¸èƒ½ä½¿ç”¨ç®­å¤´å‡½æ•°
  grunt.registerTask('async-task', function () {
    const done = this.async()
    setTimeout(() => {
      console.log('async task working~')
      done()
    }, 1000)
  })
}
```

## â˜…Grunt æ ‡è®°ä»»åŠ¡å¤±è´¥

å¦‚æœä½ åœ¨æ„å»ºä»»åŠ¡çš„é€»è¾‘ä»£ç å½“ä¸­å‘ç”Ÿé”™è¯¯ï¼Œä¾‹å¦‚æˆ‘ä»¬éœ€è¦çš„æ–‡ä»¶æ‰¾ä¸åˆ°äº†ï¼Œé‚£æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥å°†è¿™ä¸ªä»»åŠ¡æ ‡è®°ä¸ºä¸€ä¸ªå¤±è´¥çš„ä»»åŠ¡ã€‚

å…·ä½“çš„å®è·µæ–¹å¼ -> æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å‡½æ•°ä½“å½“ä¸­å» `return false` æ¥å®ç°ã€‚

ä¾‹å¦‚åœ¨æˆ‘ä»¬è¿™ä¸ª`bad`ä»»åŠ¡å½“ä¸­ï¼Œæˆ‘ä»¬åœ¨æœ€ä¸‹é¢ `return`äº†`false`

é‚£æ­¤æ—¶æˆ‘ä»¬å›åˆ°ç»ˆç«¯ï¼Œæˆ‘ä»¬å°è¯•ç€è¿è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡ã€‚

é‚£ä½ ä¼šå‘ç°ç»ˆç«¯å½“ä¸­æç¤ºæˆ‘ä»¬ `bad` è¿™ä¸ªä»»åŠ¡å®ƒæ‰§è¡Œå¤±è´¥äº† -> å¦‚æœè¯´ä½ è¿™ä¸ªä»»åŠ¡æ˜¯åœ¨ä¸€ä¸ªä»»åŠ¡åˆ—è¡¨å½“ä¸­çš„è¯ï¼Œé‚£è¿™ä¸ªä»»åŠ¡çš„å¤±è´¥ä¼šå¯¼è‡´åç»­æ‰€æœ‰çš„ä»»åŠ¡ä¸å†è¢«æ‰§è¡Œã€‚

ä¾‹å¦‚æˆ‘ä»¬è¿™å„¿æœ‰å¤šä¸ªä»»åŠ¡ã€‚

ç„¶åæˆ‘ä»¬é€šè¿‡ä¸€ä¸ª `default` ä»»åŠ¡æŠŠä»–ä»¬è¿æ¥åˆ°ä¸€èµ·ã€‚é‚£ä¹ˆåœ¨æ­£å¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å»è¿è¡Œ `default` -> å®ƒä¼šä¾æ¬¡å»æ‰§è¡Œ `foo`ã€`bad`ä»¥åŠ`bar`ï¼Œä½†æ˜¯æˆ‘ä»¬è¿™é‡Œçš„ `bad` å®ƒæ‰§è¡Œå¤±è´¥äº† -> é‚£è¿™æ ·çš„è¯ï¼Œ`bar` ä»»åŠ¡å°±ä¸ä¼šè¢«æ‰§è¡Œäº†ã€‚

æˆ‘ä»¬å›åˆ°ç»ˆç«¯å½“ä¸­ï¼Œæˆ‘ä»¬å°è¯•ç€å»è¿è¡Œä¸€ä¸‹è¿™ä¸ª `default`ï¼š

é‚£æ­¤æ—¶ä½ ä¼šå‘ç° `foo` ä»»åŠ¡å’Œ `bad` ä»»åŠ¡éƒ½æ‰§è¡Œäº†ï¼Œç„¶è€Œ`bad` ä»»åŠ¡æ‰§è¡Œå¤±è´¥äº†ï¼Œè€Œæœ€åè¿™ä¸ª `bar` ä¹Ÿå°±ä¸ä¼šè¢«æ‰§è¡Œäº† -> è€Œä¸”æ­¤æ—¶å‘½ä»¤è¡Œå½“ä¸­ä¹Ÿç»™äº†æˆ‘ä»¬ä¸€ä¸ªæç¤ºï¼Œå¦‚æœè¯´ä½ è¦å»æŒ‡å®šäº†ä¸€ä¸ª`--force`çš„å‚æ•°è¯ï¼Œé‚£æ­¤æ—¶ä¼šé‡‡ç”¨ä¸€ç§å¼ºåˆ¶æ–¹å¼å»æ‰§è¡Œæ‰€æœ‰çš„ä»»åŠ¡ï¼Œæˆ‘ä»¬å°è¯•ä¸€ä¸‹ï¼š

æœ‰äº†`--force`è¿‡åï¼Œæˆ‘ä»¬ `bad` ä»»åŠ¡å³ä½¿è¿è¡Œå¤±è´¥äº†ï¼Œåç»­çš„ `bar` ä»»åŠ¡ä¹Ÿæ˜¯ä¼šæ­£å¸¸å»æ‰§è¡Œçš„ã€‚

é‚£è¿™å°±æ˜¯æˆ‘ä»¬å¦‚ä½•å»æ ‡è®°ä¸€ä¸ªä»»åŠ¡å¤±è´¥ä»¥åŠæ ‡è®°ä»»åŠ¡å¤±è´¥è¿‡åçš„ä¸€äº›å½±å“ã€‚

ä½†æ˜¯å¦‚æœè¯´ä½ çš„ä»»åŠ¡æ˜¯ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„è¯ï¼Œé‚£å¼‚æ­¥ä»»åŠ¡å½“ä¸­æˆ‘ä»¬å°±æ²¡æœ‰åŠæ³•ç›´æ¥é€šè¿‡`return false` å»æ ‡è®°è¿™ä¸ªä»»åŠ¡å¤±è´¥ã€‚

é‚£æ­¤æ—¶æˆ‘ä»¬éœ€è¦ç»™å¼‚æ­¥çš„å›è°ƒå‡½æ•°æŒ‡å®šä¸€ä¸ª`false`çš„å®å‚å°±å¯ä»¥æ ‡è®°ä¸ºè¿™ä¸ªä»»åŠ¡å¤±è´¥äº†ã€‚

æˆ‘ä»¬å°è¯•ä¸€ä¸‹ï¼š

å¯ä»¥çœ‹åˆ°ï¼Œæ­¤æ—¶æˆ‘ä»¬è¿™ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡å°±ä¼šè¢«æ ‡è®°ä¸ºä¸€ä¸ªå¤±è´¥çš„ä»»åŠ¡ã€‚

æˆ‘ä»¬å›åˆ°ç»ˆç«¯å½“ä¸­å°è¯•ç€å»è¿è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡ï¼š

``` bash
yarn grunt bad-async
```

è¿™æ—¶å€™ä½ ä¼šå‘ç°è¿™ä¸ª`bad-async`ä»»åŠ¡ä¹Ÿæ˜¯æ‰§è¡Œå¤±è´¥çš„ -> è¿™å°±æ˜¯æˆ‘ä»¬åœ¨ Grunt çš„ä»»åŠ¡å½“ä¸­å¦‚ä½•å»æ ‡è®°æ­¤ä»»åŠ¡ä¸ºä¸€ä¸ªå¤±è´¥çš„ä»»åŠ¡ï¼Œä»¥åŠæ ‡è®°ä¸ºå¤±è´¥ä»»åŠ¡è¿‡åçš„ä¸€ä¸ªå½±å“ã€‚

ğŸ’¡ï¼šä»£ç ï¼Ÿ

``` js
module.exports = grunt => {
  // ä»»åŠ¡å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­å¦‚æœè¿”å› false
  // åˆ™æ„å‘³ç€æ­¤ä»»åŠ¡æ‰§è¡Œå¤±è´¥
  grunt.registerTask('bad', () => {
    console.log('bad working~')
    return false
  })

  grunt.registerTask('foo', () => {
    console.log('foo working~')
  })

  grunt.registerTask('bar', () => {
    console.log('bar working~')
  })

  // å¦‚æœä¸€ä¸ªä»»åŠ¡åˆ—è¡¨ä¸­çš„æŸä¸ªä»»åŠ¡æ‰§è¡Œå¤±è´¥
  // åˆ™åç»­ä»»åŠ¡é»˜è®¤ä¸ä¼šè¿è¡Œ
  // é™¤é grunt è¿è¡Œæ—¶æŒ‡å®š --force å‚æ•°å¼ºåˆ¶æ‰§è¡Œ
  grunt.registerTask('default', ['foo', 'bad', 'bar'])

  // å¼‚æ­¥å‡½æ•°ä¸­æ ‡è®°å½“å‰ä»»åŠ¡æ‰§è¡Œå¤±è´¥çš„æ–¹å¼æ˜¯ä¸ºå›è°ƒå‡½æ•°æŒ‡å®šä¸€ä¸ª false çš„å®å‚
  grunt.registerTask('bad-async', function () {
    const done = this.async()
    setTimeout(() => {
      console.log('async task working~')
      done(false)
    }, 1000)
  })
}
```

## â˜…Grunt çš„é…ç½®æ–¹æ³•

é™¤äº†`registerTask`æ–¹æ³•ä¹‹å¤–ï¼ŒGrunt è¿˜æä¾›äº†ä¸€ä¸ªç”¨äºå»æ·»åŠ ä¸€äº›é…ç½®é€‰é¡¹çš„ API -> `initConfig`

ä¾‹å¦‚æˆ‘ä»¬åœ¨ä½¿ç”¨ Grunt å»ä¸ºæˆ‘ä»¬å‹ç¼©æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹å¼å»é…ç½®æˆ‘ä»¬éœ€è¦å‹ç¼©çš„æ–‡ä»¶è·¯å¾„ã€‚

æˆ‘ä»¬å›åˆ°é¡¹ç›®å½“ä¸­å°è¯•ä½¿ç”¨ä¸€ä¸‹è¿™ä¸ªæ–¹æ³•ã€‚

è¿™ä¸ªæ–¹æ³•å®ƒæ¥æ”¶ä¸€ä¸ªå¯¹è±¡å½¢å¼çš„å‚æ•°ï¼Œå¯¹è±¡çš„å±æ€§åï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¯´çš„é”®ï¼Œå®ƒä¸€èˆ¬ä¸æˆ‘ä»¬çš„ä»»åŠ¡åç§°ä¿æŒä¸€è‡´ -> æˆ‘è¿™å«åš `foo` -> å±æ€§çš„å€¼å®ƒå¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„æ•°æ®ï¼Œæˆ‘ä»¬è¿™å„¿ç»™ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚

æœ‰äº†è¿™ä¸ªé…ç½®å±æ€§è¿‡åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ä¸€ä¸ªä»»åŠ¡å½“ä¸­å»ä½¿ç”¨è¿™ä¸ªé…ç½®å±æ€§ã€‚

æˆ‘ä»¬å»æ³¨å†Œä¸€ä¸ªå«åš `foo` ä»»åŠ¡ã€‚åœ¨è¿™ä¸ª `foo` çš„ä»»åŠ¡å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `grunt` æä¾›çš„ `config` æ–¹æ³•å»è·å–è¿™ä¸ªé…ç½® -> è¿™ä¸ª `config` æ–¹æ³•å®ƒæ¥æ”¶ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°ï¼Œè¿™ä¸ªå­—ç¬¦ä¸²å‚æ•°å°±æ˜¯æˆ‘ä»¬åœ¨ `config` å½“ä¸­æ‰€æŒ‡å®šçš„é‚£ä¸ªå±æ€§çš„åå­—ï¼ˆ`foo`ï¼‰

æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªå€¼å°è¯•ç€æ‰“å°åˆ°æ§åˆ¶å°å½“ä¸­ï¼Œç„¶åå›åˆ°å‘½ä»¤è¡Œè¿è¡Œä¸€ä¸‹è¿™ä¸ªå‘½ä»¤ï¼š

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬æ§åˆ¶å°å½“ä¸­å¯ä»¥å»æ‰“å°å‡ºæ¥`bar`ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬åˆšåˆšè¿™ä¸ªé…ç½®æ˜¯æˆåŠŸçš„ã€‚
 
é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœè¯´ä½ çš„`initConfig`å½“ä¸­å±æ€§çš„å€¼æ˜¯ä¸€ä¸ªå¯¹è±¡çš„è¯ï¼Œé‚£æˆ‘ä»¬çš„ `config` æ–¹æ³•è¿˜æ”¯æŒä¸€ç§é«˜çº§çš„ç”¨æ³•ã€‚

æˆ‘ä»¬å°è¯•ä¸€ä¸‹ï¼Œåœ¨`foo`å±æ€§è¿™ä¸ªåœ°æ–¹ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ª `foo` çš„å±æ€§å€¼æ”¹æˆä¸€ä¸ªå¯¹è±¡ã€‚

è¿™ä¸ªå¯¹è±¡å½“ä¸­æœ‰ä¸€ä¸ª `bar` å±æ€§ï¼Œå€¼æ˜¯ `123`ï¼Œä¿å­˜ä¸€ä¸‹ã€‚

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åœ¨ `config` å½“ä¸­å°±å¯ä»¥é€šè¿‡`foo.bar`çš„è¿™ä¸ªå½¢å¼å»æ‹¿åˆ°å¯¹åº”çš„å±æ€§å€¼ã€‚

è¿™ä¸ªæ—¶å€™æ§åˆ¶å°å½“ä¸­å¯ä»¥æ‰“å°å‡ºæ¥ `123`ï¼Œä¹Ÿå°±æ„å‘³ç€`.`ç‚¹çš„è¿™ç§æ–¹å¼æ˜¯è¢« `config` æ‰€æ”¯æŒçš„ã€‚

å½“ç„¶ï¼Œå…¶å®ä½ ä¸€èˆ¬ä½¿ç”¨çš„æ—¶å€™æ˜¯ä¸éœ€è¦å»ä½¿ç”¨ã€Œç‚¹ã€çš„è¿™ç§æ–¹å¼ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ `config` æŠŠæ•´ä¸ª `foo` å¯¹è±¡æ‹¿åˆ°ï¼Œç„¶ååœ¨è¿™ä¸ªå¯¹è±¡ä¸Šé¢é€šè¿‡ç‚¹çš„æ–¹å¼å»æ‹¿å¯¹åº”çš„ `bar` å±æ€§ -> è¿™ä¹Ÿæ˜¯å¯ä»¥çš„ã€‚

ğŸ’¡ï¼šä»£ç ï¼Ÿ

``` js
module.exports = grunt => {
  // grunt.initConfig() ç”¨äºä¸ºä»»åŠ¡æ·»åŠ ä¸€äº›é…ç½®é€‰é¡¹
  grunt.initConfig({
    // é”®ä¸€èˆ¬å¯¹åº”ä»»åŠ¡çš„åç§°
    // å€¼å¯ä»¥æ˜¯ä»»æ„ç±»å‹çš„æ•°æ®
    foo: {
      bar: 'baz'
    }
  })

  grunt.registerTask('foo', () => {
    // ä»»åŠ¡ä¸­å¯ä»¥ä½¿ç”¨ grunt.config() è·å–é…ç½®
    console.log(grunt.config('foo'))
    // å¦‚æœå±æ€§å€¼æ˜¯å¯¹è±¡çš„è¯ï¼Œconfig ä¸­å¯ä»¥ä½¿ç”¨ç‚¹çš„æ–¹å¼å®šä½å¯¹è±¡ä¸­å±æ€§çš„å€¼
    console.log(grunt.config('foo.bar'))
  })
}
```

## â˜…Grunt å¤šç›®æ ‡ä»»åŠ¡

é™¤äº†æ™®é€šçš„ä»»åŠ¡å½¢å¼ä»¥å¤–ï¼ŒGrunt å½“ä¸­è¿˜æ”¯æŒä¸€ç§å«åšå¤šç›®æ ‡æ¨¡å¼çš„ä»»åŠ¡ -> ä½ å¯ä»¥æŠŠå®ƒç†è§£æˆå­ä»»åŠ¡çš„æ¦‚å¿µã€‚

è¿™ç§å½¢å¼çš„ä»»åŠ¡ï¼Œåœ¨æˆ‘ä»¬åç»­å…·ä½“å»é€šè¿‡ Grunt å®ç°å„ç§æ„å»ºä»»åŠ¡æ—¶éå¸¸æœ‰ç”¨ã€‚

æˆ‘ä»¬å…·ä½“æ¥çœ‹ä¸€ä¸‹ã€‚

å¤šç›®æ ‡æ¨¡å¼çš„ä»»åŠ¡ï¼Œå®ƒéœ€è¦é€šè¿‡ `grunt` å½“ä¸­çš„`registerMultiTask`æ–¹æ³•å»å®šä¹‰ã€‚

è¿™ä¸ªæ–¹æ³•åŒæ ·æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼š

- ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬ä»»åŠ¡çš„åå­—ï¼Œæˆ‘ä»¬è¿™å„¿å« `build`
- ç¬¬äºŒä¸ªå‚æ•°åŒæ ·æ¥æ”¶çš„æ˜¯ä¸€ä¸ªå‡½æ•° -> åœ¨è¿™ä¸ªå‡½æ•°å½“ä¸­ä»ç„¶æ˜¯æˆ‘ä»¬ä»»åŠ¡æ‰§è¡Œè¿‡ç¨‹å½“ä¸­æ‰€éœ€è¦åšçš„ä¸€äº›äº‹æƒ…ã€‚

æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªå‡½æ•°é‡Œè¾¹ï¼Œå…ˆé€šè¿‡ `console.log()` æ‰“å°ä¸€ä¸‹ã€‚

å›åˆ°å‘½ä»¤è¡Œå½“ä¸­ï¼Œæˆ‘ä»¬å†å»è¿è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡

è¿è¡Œçš„è¿‡ç¨‹ï¼Œä½ ä¼šå‘ç°å®ƒçˆ†å‡ºæ¥äº†ä¸€ä¸ªè­¦å‘Šï¼Œè¯´çš„æ˜¯æˆ‘ä»¬æ²¡æœ‰ä¸º `build` ä»»åŠ¡å»è®¾ç½®ä¸€äº› `targets` 

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬åœ¨è®¾ç½®è¿™ç§å¤šç›®æ ‡ä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºè¿™ç§å¤šç›®æ ‡çš„ä»»åŠ¡å»é…ç½®ä¸åŒçš„ç›®æ ‡ã€‚é‚£é…ç½®çš„æ–¹å¼å°±æ˜¯é€šè¿‡ `grunt` çš„ `initConfig`æ–¹æ³•å»é…ç½®ã€‚

è¿™å…·ä½“æ¥çœ‹å°±æ˜¯`grunt.initConfig({})`

åœ¨è¿™ä¸ª `Config` å¯¹è±¡å½“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å»æŒ‡å®šä¸€ä¸ªä¸æˆ‘ä»¬ä»»åŠ¡åç§°åŒåçš„ä¸€ä¸ªå±æ€§ï¼Œä¹Ÿå°±æ˜¯ `build` 

é‚£è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„å±æ€§å€¼å¿…é¡»å¾—æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡å½“ä¸­æ¯ä¸€ä¸ªå±æ€§çš„åå­—å°±æ˜¯æˆ‘ä»¬çš„ç›®æ ‡åç§°ã€‚

æ¯”å¦‚è¯´æˆ‘ä»¬è¿™å„¿ï¼š

``` js
grunt.initConfig({
  build: {
    css: '1',
    js: '2'
  }
})
```

å½“ç„¶ï¼Œè¿™åªæ˜¯ç¤ºä¾‹ä¸€ä¸‹ã€‚

è¿™ä¸ªæ—¶å€™å°±ç›¸å½“äºæ˜¯æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„è¿™ä¸ª `build` ä»»åŠ¡æ·»åŠ äº†ä¸¤ä¸ªç›®æ ‡ï¼Œä¸€ä¸ªå«åš `css`ï¼Œä¸€ä¸ªå«åš`js`

ä¿å­˜ä¸€ä¸‹ï¼Œæˆ‘ä»¬å›åˆ°æˆ‘ä»¬çš„å‘½ä»¤è¡Œç»ˆç«¯å½“ä¸­ï¼Œå†æ¬¡å»è¿è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡ã€‚

æ­¤æ—¶è¿è¡Œè¿™ä¸ªä»»åŠ¡çš„æ—¶å€™ï¼Œä½ ä¼šå‘ç°å®ƒä¼šè¿è¡Œä¸¤ä¸ªå­ä»»åŠ¡ã€‚å®é™…ä¸Šè¿™ä¸ªä¸å«ã€Œå­ä»»åŠ¡ã€ã€‚åœ¨ Grunt å½“ä¸­ï¼Œè¿™ä¸ªå«åšã€Œå¤šç›®æ ‡ã€ -> è¿™ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ `build` ä»»åŠ¡æœ‰ä¸¤ä¸ªç›®æ ‡ï¼Œä¸€ä¸ªæ˜¯ `css` ç›®æ ‡ï¼Œä¸€ä¸ªæ˜¯ `js` ç›®æ ‡ã€‚

ä½ è¿è¡Œ `build` ä»»åŠ¡çš„æ—¶å€™ï¼Œå®ƒä¼šåŒæ—¶å»æ‰§è¡Œè¿™ä¸¤ä¸ªç›®æ ‡ï¼Œä¹Ÿå°±ç›¸å½“äºä»¥ä¸¤ä¸ªå­ä»»åŠ¡çš„å½¢å¼å»è¿è¡Œã€‚

å¦‚æœä½ è¦å»è¿è¡ŒæŒ‡å®šçš„è¿™ä¸ªç›®æ ‡è¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ï¼š

``` js
// å†’å·è·Ÿä¸Šç›®æ ‡åç§°
yarn grunt build:css
```

é‚£è¿™æ—¶å€™å®ƒåªä¼šå»è¿è¡Œå¯¹åº”çš„è¿™ä¸ªç›®æ ‡ã€‚

åœ¨æˆ‘ä»¬çš„è¿™ä¸ª`registerMultiTask`ä»»åŠ¡å‡½æ•°å½“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ `this` å»æ‹¿åˆ°å½“å‰æ‰§è¡Œçš„è¿™ä¸ªç›®æ ‡çš„åç§°ï¼Œè¿˜å¯ä»¥é€šè¿‡ `this` å½“ä¸­çš„ `data` å»æ‹¿åˆ°è¿™ä¸ª`target`æ‰€å¯¹åº”çš„é…ç½®æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç€åšä¸€ä¸ªæ‰“å°ï¼š

``` js
grunt.registerMultiTask('build', function () {
  console.log(`task: build, target: ${this.target}, data: ${this.data}`)
})
```

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†å›åˆ°ç»ˆç«¯å½“ä¸­ï¼Œå°è¯•é‡æ–°æ‰§è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡ã€‚

æˆ‘ä»¬æ‰§è¡Œ`yarn grunt build:css`çš„æ—¶å€™ï¼Œæˆ‘ä»¬æ‹¿åˆ°çš„ `target` å°±æ˜¯ `css`ï¼Œ è€Œ`data` å°±æ˜¯`1` -> è¿™ä¸ª `data` é‡Œé¢çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åˆšåˆšåœ¨ `initConfig` å½“ä¸­æ‰€æŒ‡å®šçš„é‚£ä¸ª `1`

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä»¬åœ¨ `build` å½“ä¸­æŒ‡å®šçš„æ¯ä¸€ä¸ªå±æ€§çš„é”®éƒ½ä¼šæˆä¸ºä¸€ä¸ªç›®æ ‡ã€‚

é™¤äº†æˆ‘ä»¬æŒ‡å®šçš„ `options` ä»¥å¤–ï¼Œåœ¨ `options` å½“ä¸­æŒ‡å®šçš„ä¿¡æ¯ï¼Œå®ƒä¼šä½œä¸ºè¿™ä¸ªä»»åŠ¡çš„é…ç½®é€‰é¡¹å‡ºç°ï¼š

- æˆ‘ä»¬åŠ ä¸€ä¸ª `option` å«åš `foo` -> å€¼æ˜¯`bar`

æ­¤æ—¶æˆ‘ä»¬å†å»å°è¯•ç€å»æ‰§è¡Œä¸€ä¸‹ `build` è¿™ä¸ªä»»åŠ¡ï¼Œä½ ä¼šå‘ç°å®ƒå¹¶æ²¡æœ‰ä¸€ä¸ª `target` å«åš `options`ï¼Œå› ä¸ºè¿™ä¸ª `options` å®ƒä¼šä½œä¸ºä»»åŠ¡çš„é…ç½®é€‰é¡¹å‡ºç°ã€‚

é‚£æˆ‘ä»¬åœ¨ä»»åŠ¡çš„æ‰§è¡Œè¿‡ç¨‹å½“ä¸­ï¼Œå°±å¯ä»¥é€šè¿‡`this.options`æ‹¿åˆ°å®ƒå¯¹åº”çš„é…ç½®é€‰é¡¹ -> `options` æ˜¯ä¸€ä¸ªæ–¹æ³•ï¼Œå®ƒå¯ä»¥å»æ‹¿æˆ‘ä»¬å½“å‰è¿™ä¸ªä»»åŠ¡æ‰€æœ‰çš„é…ç½®é€‰é¡¹çš„é‚£ä¸ªå¯¹è±¡

æˆ‘ä»¬å›åˆ°ç»ˆç«¯å½“ä¸­å†æ¬¡å»æ‰§è¡Œä¸€ä¸‹è¿™ä¸ª `build` 

æ­¤æ—¶å®ƒå°±ä¼šæŠŠæˆ‘ä»¬è¿™ä¸ªä»»åŠ¡çš„é…ç½®é€‰é¡¹æ‰“å°å‡ºæ¥

é™¤äº†æˆ‘ä»¬åœ¨ä»»åŠ¡å½“ä¸­å¯ä»¥å»åŠ è¿™ä¸ªé…ç½®é€‰é¡¹ä¹‹å¤–ï¼Œæˆ‘ä»¬åœ¨è¿™ä¸ªç›®æ ‡å½“ä¸­ -> å¦‚æœè¯´ç›®æ ‡çš„é…ç½®å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡çš„è¯ï¼Œé‚£åœ¨å®ƒçš„è¿™ä¸ªå±æ€§å½“ä¸­ä¹Ÿå¯ä»¥å»æ·»åŠ ä¸€ä¸ª `options` -> åœ¨æ·»åŠ  `option` çš„æ—¶å€™ï¼Œå®ƒä¼šè¦†ç›–æ‰å¯¹è±¡å½“ä¸­çš„ `option`

ä¿å­˜ä¸€ä¸‹å›åˆ°ç»ˆç«¯ï¼Œæˆ‘ä»¬å†æ¥å°è¯•ä¸€ä¸‹ã€‚

æ­¤æ—¶æˆ‘ä»¬å»æ‰§è¡Œ `css` è¿™ä¸ª target çš„æ—¶å€™ï¼Œå®ƒçš„`foo`å€¼å°±æ˜¯ `baz`ï¼Œè€Œæ‰§è¡Œ`js`è¿™ä¸ª target çš„æ—¶å€™ï¼Œå®ƒçš„`foo`å€¼æ˜¯`bar` 

å› ä¸ºè¿™ä¸ªæ—¶å€™`js`å½“ä¸­å¹¶æ²¡æœ‰è¦†ç›–ä»»åŠ¡å½“ä¸­çš„é€‰é¡¹ï¼Œè€Œ`css`çš„ç›®æ ‡å½“ä¸­è¦†ç›–äº†ä»»åŠ¡çš„é€‰é¡¹ã€‚

è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬åœ¨ Grunt å½“ä¸­çš„å¤šç›®æ ‡ä»»åŠ¡ã€‚

ğŸ’¡ï¼šä»£ç ï¼Ÿ

``` js
module.exports = grunt => {
  // å¤šç›®æ ‡æ¨¡å¼ï¼Œå¯ä»¥è®©ä»»åŠ¡æ ¹æ®é…ç½®å½¢æˆå¤šä¸ªå­ä»»åŠ¡

  // grunt.initConfig({
  //   build: {
  //     foo: 100,
  //     bar: '456'
  //   }
  // })

  // grunt.registerMultiTask('build', function () {
  //   console.log(`task: build, target: ${this.target}, data: ${this.data}`)
  // })

  grunt.initConfig({
    build: {
      options: {
        msg: 'task options'
      },
      foo: {
        options: {
          msg: 'foo target options'
        }
      },
      bar: '456'
    }
  })

  grunt.registerMultiTask('build', function () {
    console.log(this.options())
  })
}
```

## â˜…Grunt æ’ä»¶çš„ä½¿ç”¨

åœ¨äº†è§£äº† Grunt çš„åŸºæœ¬ç‰¹æ€§ä¹‹åï¼Œæˆ‘ä»¬å†æ¥äº†è§£ä¸€ä¸‹ Grunt å½“ä¸­æ’ä»¶çš„ä½¿ç”¨ã€‚

æ’ä»¶æœºåˆ¶æ˜¯ Grunt çš„æ ¸å¿ƒï¼Œå®ƒå­˜åœ¨çš„åŸå› ä¹Ÿéå¸¸ç®€å•ï¼Œå› ä¸ºå¾ˆå¤šæ„å»ºä»»åŠ¡å®ƒéƒ½æ˜¯é€šç”¨çš„ã€‚

ä¾‹å¦‚ä½ åœ¨ä½ çš„é¡¹ç›®å½“ä¸­éœ€è¦å»å‹ç¼©ä»£ç ï¼Œåˆ«äººçš„é¡¹ç›®å½“ä¸­åŒæ ·ä¹Ÿä¼šéœ€è¦ -> æ‰€ä»¥è¯´ç¤¾åŒºå½“ä¸­å°±å‡ºç°äº†å¾ˆå¤šé¢„è®¾çš„æ’ä»¶ã€‚è€Œè¿™äº›æ’ä»¶çš„å†…éƒ¨éƒ½å°è£…äº†ä¸€äº›é€šç”¨çš„æ„å»ºä»»åŠ¡ã€‚

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„æ„å»ºè¿‡ç¨‹éƒ½æ˜¯ç”±è¿™äº›é€šç”¨çš„æ„å»ºä»»åŠ¡ç»„æˆçš„ã€‚

é‚£æ¥ä¸‹æ¥æˆ‘ä»¬å°±ä¸€èµ·å­¦ä¹ ä¸€ä¸‹å¦‚ä½•å…·ä½“å»ä½¿ç”¨æ’ä»¶å½“ä¸­æä¾›çš„è¿™äº›æ„å»ºä»»åŠ¡ã€‚

ä½¿ç”¨æ’ä»¶çš„è¿‡ç¨‹éå¸¸ç®€å•ï¼š

- å¤§ä½“ä¸Šå°±æ˜¯å…ˆé€šè¿‡ `npm` å»å®‰è£…è¿™ä¸ªæ’ä»¶
- å†åˆ°`gruntfile.js`å½“ä¸­å»è½½å…¥è¿™ä¸ªæ’ä»¶æä¾›çš„ä¸€äº›ä»»åŠ¡
- æœ€åæˆ‘ä»¬æ ¹æ®è¿™äº›æ’ä»¶çš„æ–‡æ¡£å»å®Œæˆç›¸å…³çš„é…ç½®é€‰é¡¹

æˆ‘ä»¬å›åˆ°é¡¹ç›®å½“ä¸­ã€‚

è¿™é‡Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªéå¸¸å¸¸è§çš„æ’ä»¶æ¥å»å°è¯•ä¸€ä¸‹ï¼Œè¿™ä¸ªæ’ä»¶å«åš `grunt-contrib-clean` -> å®ƒç”¨æ¥è‡ªåŠ¨å»æ¸…é™¤æˆ‘ä»¬åœ¨é¡¹ç›®å¼€å‘è¿‡ç¨‹å½“ä¸­äº§ç”Ÿçš„ä¸€äº›ä¸´æ—¶æ–‡ä»¶ã€‚

é¦–å…ˆæˆ‘ä»¬è¿›å…¥åˆ°å‘½ä»¤è¡Œç»ˆç«¯å»å®‰è£…è¿™ä¸ªæ’ä»¶ï¼š

``` bash
yarn add grunt-contrib-clean
```

ç„¶åæˆ‘ä»¬å›åˆ° `gruntfile.js` å½“ä¸­ï¼Œé€šè¿‡ Grunt çš„`loadNpmTasks`æ–¹æ³•å»åŠ è½½è¿™ä¸ªæ’ä»¶å½“ä¸­æä¾›çš„ä¸€äº›ä»»åŠ¡ã€‚

ç»å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ŒGrunt çš„æ’ä»¶å‘½åè§„èŒƒéƒ½æ˜¯`grunt-contrib-<task name>` -> æ‰€ä»¥è¯´æˆ‘ä»¬è¿™é‡Œçš„ `clean` æ’ä»¶ï¼Œå®ƒæä¾›çš„ä»»åŠ¡åç§°åº”è¯¥å°±å«åš `clean`

æˆ‘ä»¬å›åˆ°å‘½ä»¤è¡Œç»ˆç«¯ï¼Œæˆ‘ä»¬å°è¯•é€šè¿‡ `grunt` è¿è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡

è¿è¡Œçš„è¿‡ç¨‹å½“ä¸­ï¼Œæ§åˆ¶å°ä¼šæ‰“å°ä¸€ä¸ªé”™è¯¯ä¿¡æ¯ï¼Œå‘Šè¯‰æˆ‘ä»¬`clean`ä»»åŠ¡å¹¶æ²¡æœ‰é…ç½®å¯¹åº”çš„ç›®æ ‡ã€‚

ä»è¿™ä¸ªé”™è¯¯ä¿¡æ¯å½“ä¸­æˆ‘ä»¬ä¸éš¾å‘ç°ï¼Œ`clean` ï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯æˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„ä¸€ç§å¤šç›®æ ‡ä»»åŠ¡ -> æˆ‘ä»¬éœ€è¦é€šè¿‡`initConfig`çš„æ–¹å¼å»é…ç½®ä¸åŒçš„ç›®æ ‡ã€‚

æˆ‘ä»¬å†æ¬¡å›åˆ° `gruntfile.js` å½“ä¸­

åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é€šè¿‡`grunt.initConfig`å»ä¸ºæˆ‘ä»¬è¿™ä¸ª `clean` ä»»åŠ¡æ·»åŠ ä¸€ä¸ªç›®æ ‡ -> è¿™ä¸ªç›®æ ‡çš„åå­—æˆ‘ä»¬å«åš `temp` -> ç›®æ ‡çš„å€¼ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬è¿™ä¸ª `temp` ç›®æ ‡å¯¹åº”çš„é…ç½®é€‰é¡¹ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸ºä¸€ä¸ªå­—ç¬¦ä¸² -> åœ¨è¿™ä¸ªå­—ç¬¦ä¸²å½“ä¸­å°±æ˜¯æˆ‘ä»¬è¿™ä¸ª `temp` ç›®æ ‡æ‰€éœ€è¦å»æ¸…é™¤çš„æ–‡ä»¶è·¯å¾„ï¼ˆæˆ‘ä»¬è¿™é‡Œæ˜¯`temp`ä¸‹çš„`app.js`ï¼‰

å†æ¬¡å›åˆ°å‘½ä»¤è¡Œé‡æ–°å»è¿è¡Œä¸€ä¸‹è¿™ä¸ªå‘½ä»¤ã€‚

æ­¤æ—¶ä½ ä¼šå‘ç° `temp` ä¸‹çš„`app.js`å°±ä¼šè¢«åˆ é™¤æ‰ã€‚

é™¤äº†è¿™ç§æŒ‡å®šå…·ä½“æ–‡ä»¶è·¯å¾„ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åœ¨è¿™ä¸ªè·¯å¾„å½“ä¸­ä½¿ç”¨é€šé…ç¬¦çš„æ–¹å¼å»é€šé…ä¸€äº›æ–‡ä»¶ç±»å‹ã€‚

ä¾‹å¦‚æˆ‘ä»¬è¿™å„¿å»åˆ é™¤ä¸€ä¸‹ `temp` ä¸‹é¢æ‰€æœ‰çš„`txt`æ–‡ä»¶

æˆ‘ä»¬é‡æ–°è¿è¡Œ`yarn grunt clean`ã€‚

è¿™ä¸ªæ—¶å€™ `temp` ä¸‹æ‰€æœ‰çš„æ–‡æœ¬æ–‡ä»¶å°±ä¼šè¢«åˆ é™¤æ‰ã€‚

é™¤äº†`*.txt`è¿™ç§æ–¹å¼ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨`**`è¿™ç§ä¸¤ä¸ªæ˜Ÿå·çš„é€šé…ç¬¦æ–¹å¼ -> è¿™ç§é€šé…ç¬¦ä¹Ÿæ˜¯æ¯”è¾ƒå¸¸è§çš„ï¼Œå®ƒä»£è¡¨çš„å°±æ˜¯æˆ‘ä»¬æ‰¾åˆ° `temp` ä¸‹æ‰€æœ‰çš„å­ç›®å½•ä»¥åŠå­ç›®å½•ä¸‹çš„æ–‡ä»¶ -> è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬ `temp` ä¸‹æ‰€æœ‰çš„æ–‡ä»¶å°±ä¼šè¢«æ¸…ç©ºæ‰ã€‚

æˆ‘ä»¬æ€»ç»“ä¸€ä¸‹ä½¿ç”¨ Grunt çš„æ’ä»¶ï¼š

- ç¬¬ä¸€æ­¥å°±æ˜¯æˆ‘ä»¬æ‰¾åˆ°è¿™ä¸ªæ’ä»¶ï¼Œç„¶åæŠŠå®ƒå®‰è£…åˆ°æˆ‘ä»¬çš„ npm æ¨¡å—å½“ä¸­ã€‚
- ç„¶åç¬¬äºŒä»¶äº‹ï¼Œæˆ‘ä»¬å°±æ˜¯åœ¨ `gruntfile.js` å½“ä¸­ï¼Œé€šè¿‡ `grunt` çš„`loadNpmTasks`æ–¹æ³•å»æŠŠè¿™ä¸ªæ’ä»¶å½“ä¸­æä¾›çš„ä¸€äº›ä»»åŠ¡åŠ è½½è¿›æ¥ã€‚
- ç„¶åç¬¬ä¸‰ä»¶äº‹å°±æ˜¯åœ¨`grunt.initConfig`å½“ä¸­å»ä¸ºè¿™ä¸ªä»»åŠ¡æ·»åŠ ä¸€äº›é…ç½®é€‰é¡¹

è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬çš„ä¸€ä¸ªæ’ä»¶å°±å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚

ğŸ’¡ï¼šä»£ç ï¼Ÿ

éœ€è¦å®‰è£…å¼€å‘ä¾èµ–ï¼š`"grunt-contrib-clean": "^2.0.0"`

``` js
module.exports = grunt => {
  grunt.initConfig({
    clean: {
      temp: 'temp/**'
    }
  })
  
  grunt.loadNpmTasks('grunt-contrib-clean')
}
```

## â˜…Grunt å¸¸ç”¨æ’ä»¶åŠæ€»ç»“

æ¥ä¸‹æ¥æˆ‘ä»¬å†æ¥çœ‹å‡ ä¸ªåœ¨ Grunt å½“ä¸­éå¸¸å¸¸ç”¨çš„æ’ä»¶ã€‚

é¦–å…ˆç¬¬ä¸€ä¸ªå°±æ˜¯ `grunt-sass`

è¿™å„¿éœ€è¦æ³¨æ„çš„æ˜¯ Grunt çš„å®˜æ–¹ï¼Œå®ƒä¹Ÿæä¾›äº†ä¸€ä¸ª sass çš„æ¨¡å—ï¼Œä½†æ˜¯é‚£ä¸ªæ¨¡å—å®ƒéœ€è¦ä½ æœ¬æœºå®‰è£… sass ç¯å¢ƒï¼Œä½¿ç”¨èµ·æ¥å¾ˆä¸æ–¹ä¾¿ã€‚

æˆ‘ä»¬è¿™å„¿ä½¿ç”¨çš„ `grunt-sass`ï¼Œå®ƒæ˜¯ä¸€ä¸ª npm çš„æ¨¡å—å„¿ï¼Œå®ƒåœ¨å†…éƒ¨ä¼šé€šè¿‡ npm çš„å½¢å¼å»ä¾èµ– sass -> é‚£è¿™æ ·çš„è¯å®ƒä½¿ç”¨èµ·æ¥å°±ä¸éœ€è¦å¯¹æˆ‘ä»¬çš„æœºå™¨æœ‰ä»»ä½•çš„ç¯å¢ƒè¦æ±‚

æˆ‘ä»¬ç›´æ¥ä½¿ç”¨ `grunt-sass`ï¼Œé‚£ä½¿ç”¨çš„æ–¹å¼å‘¢ï¼Ÿ -> æˆ‘ä»¬å°±å…ˆå»å®‰è£…ä¸€ä¸‹å®ƒ

``` bash
yarn add grunt-sass
```

`grunt-sass`å®ƒéœ€è¦æœ‰ä¸€ä¸ª sass çš„æ¨¡å—æ”¯æŒã€‚æˆ‘ä»¬è¿™å„¿ä½¿ç”¨çš„å°±æ˜¯ sass å®˜æ–¹æä¾›çš„ä¸€ä¸ª npm çš„æ¨¡å—å„¿ -> å°±å«åš `sass`

åŒæ—¶æŠŠè¿™ä¸¤ä¸ªæ¨¡å—å„¿å®‰è£…åˆ°æˆ‘ä»¬çš„å¼€å‘ä¾èµ–å½“ä¸­ã€‚

``` bash
yarn add grunt-sass sass --dev
```

æœ‰äº†è¿™ä¸ªæ¨¡å—çš„å®‰è£…è¿‡åï¼Œæˆ‘ä»¬åˆ° `gruntfile` å½“ä¸­ï¼Œå¯ä»¥é€šè¿‡`grunt.loadNpmTasks`å»è½½å…¥æˆ‘ä»¬çš„`grunt-sass`å½“ä¸­æä¾›çš„ä»»åŠ¡ã€‚

å›åˆ°æˆ‘ä»¬çš„`grunt.initConfig`å½“ä¸­ã€‚å› ä¸º `grunt-sass` å®ƒæ˜¯ä¸€ä¸ªå¤šç›®æ ‡ä»»åŠ¡ï¼Œæˆ‘ä»¬è¿™å„¿è‚¯å®šæ˜¯éœ€è¦é€šè¿‡`grunt.initConfig`çš„æ–¹å¼å»ä¸º `sass` è¿™ä¸ªä»»åŠ¡å»é…ç½®ä¸€äº›ç›®æ ‡ã€‚

æˆ‘ä»¬è¿™å„¿æœ‰ä¸€ä¸ªç›®æ ‡å«åš`main` -> `main` å½“ä¸­å®ƒéœ€è¦å»æŒ‡å®šæˆ‘ä»¬ sass çš„è¾“å…¥æ–‡ä»¶ä»¥åŠæœ€ç»ˆè¾“å‡ºçš„ CSS æ–‡ä»¶çš„è·¯å¾„ã€‚

å…·ä½“çš„æŒ‡å®šæ–¹å¼ï¼Œæˆ‘ä»¬å°±æ˜¯é€šè¿‡ `files` å±æ€§å»æŒ‡å®š -> `files`æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡çš„é”®æ˜¯æˆ‘ä»¬éœ€è¦è¾“å‡ºçš„ CSS è·¯å¾„ï¼Œæˆ‘ä»¬æ”¾åˆ° `dist` ä¸‹é¢çš„ `css` ä¸‹é¢çš„`main.css` -> å€¼å°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„æºè·¯å¾„ï¼Œä¹Ÿå°±æ˜¯ sass æ–‡ä»¶çš„è·¯å¾„`src/scss/main.scss`

ä¿å­˜ä¸€ä¸‹

æœ‰äº†è¿™æ ·ä¸€ä¸ªé…ç½®è¿‡åï¼Œæˆ‘ä»¬å°±å¯ä»¥å›åˆ°å‘½ä»¤è¡Œå½“ä¸­ï¼Œå°è¯•è¿è¡Œä¸€ä¸‹ sass è¿™ä¸ªä»»åŠ¡ -> è¿è¡Œçš„è¿‡ç¨‹å®ƒä¼šæŠ¥ä¸€ä¸ªé”™è¯¯ï¼Œè¯´æˆ‘ä»¬æ²¡æœ‰å»ä¼ å…¥ä¸€ä¸ª `implementation`çš„ä¸€ä¸ªé€‰é¡¹ -> `implementation` å®ƒæ˜¯ç”¨æ¥å»æŒ‡ä»¤æˆ‘ä»¬åœ¨`grunt-sass`å½“ä¸­ä½¿ç”¨å“ªä¸€ä¸ªæ¨¡å—å»å¤„ç† sass çš„ç¼–è¯‘

é‚£è¿™å„¿æˆ‘ä»¬å°±éœ€è¦å›åˆ°æˆ‘ä»¬çš„ä»£ç å½“ä¸­ï¼Œä¸º sass è¿™ä¸ªä»»åŠ¡æ·»åŠ ä¸€ä¸ª option -> åœ¨è¿™ä¸ª `option` å½“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å»æ·»åŠ  `implementation` -> å®ƒçš„å®ç°å°±æ˜¯æˆ‘ä»¬åˆšåˆšæ‰€å®‰è£…çš„é‚£ä¸ª sass æ¨¡å—

æ‰€ä»¥æˆ‘ä»¬å…ˆæŠŠ sass æ¨¡å—ç»™å®ƒ`require`è½½å…¥è¿›æ¥ -> æŠŠè¿™ä¸ª sass æ¨¡å—ä¼ å…¥åˆ°è¿™ä¸ª`implementation`å±æ€§å½“ä¸­

æœ‰äº†è¿™ä¸ªé…ç½®è¿‡åï¼Œæˆ‘ä»¬å¯ä»¥å›åˆ°ç»ˆç«¯å½“ä¸­å†æ¬¡å»è¿è¡Œä¸€ä¸‹ sass è¿™ä¸ªä»»åŠ¡ã€‚

æ­¤æ—¶ä½ å°±ä¼šå‘ç°ï¼Œåœ¨æˆ‘ä»¬çš„é¡¹ç›®æ ¹ç›®å½•ä¸‹å¤šäº†ä¸€ä¸ª `dist` ç›®å½• -> è¿™ä¸ªç›®å½•ä¸‹æœ‰ä¸€ä¸ª `css` æ–‡ä»¶å¤¹ -> é‡Œé¢å°±ä¼šæœ‰ä¸€ä¸ªç¼–è¯‘å®Œæˆçš„ CSS æ–‡ä»¶ã€‚

è¿™ä¸ªå°±æ˜¯æˆ‘ä»¬ `sass` è¿™ä¸€ä¸ªæ’ä»¶åœ¨ Grunt å½“ä¸­çš„ä¸€ä¸ªåŸºæœ¬ä½¿ç”¨ã€‚å½“ç„¶ï¼Œå®ƒè¿˜æœ‰æ›´å¤šçš„é€‰é¡¹ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ ä¸€ä¸ª `sourceMap` ä¸º `true` -> è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åœ¨ç¼–è¯‘è¿‡ç¨‹å½“ä¸­ï¼Œå®ƒå°±ä¼šè‡ªåŠ¨å»ç”Ÿæˆå¯¹åº”çš„ `sourceMap` æ–‡ä»¶

é™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰ä¸€äº›æ›´å¤šçš„é€‰é¡¹ã€‚é‚£è¿™ä¸ªæ—¶å€™ï¼Œä½ å¯ä»¥å»é€šè¿‡`grunt-sass` çš„å®˜æ–¹ä»“åº“é‡Œé¢çš„æ–‡æ¡£æ‰¾åˆ°ä¸€äº›ä¿¡æ¯ -> æˆ‘ä»¬è¿™å„¿åªé’ˆå¯¹äº`grunt-sass`åšä¸€ä¸ªç®€å•çš„ä»‹ç»ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œæˆ‘ä»¬è¿˜æœ‰ä¸€ä¸ªåœ¨ç¼–è¯‘è¿‡ç¨‹å½“ä¸­ç»å¸¸é‡åˆ°çš„éœ€æ±‚ï¼Œé‚£å°±æ˜¯æˆ‘ä»¬éœ€è¦å»ç¼–è¯‘ ES6 çš„è¯­æ³•ã€‚

ES6 çš„è¯­æ³•ç¼–è¯‘å™¨ï¼Œæˆ‘ä»¬ä½¿ç”¨æœ€å¤šçš„å°±æ˜¯ babelï¼Œ é‚£åœ¨ Grunt å½“ä¸­æˆ‘ä»¬è¦å»ä½¿ç”¨ babel çš„è¯ï¼Œä¹Ÿå¯ä»¥å»ä½¿ç”¨ä¸€ä¸ª`grunt-babel`çš„æ’ä»¶ï¼Œæˆ‘ä»¬åˆ°ç»ˆç«¯å½“ä¸­å†æ¥å»å®‰è£…ä¸€ä¸‹è¿™ä¸ªæ’ä»¶ã€‚

``` bash
yarn add grunt-babel --dev
```

`grunt-babel` å®ƒä¹Ÿéœ€è¦æˆ‘ä»¬çš„ babel çš„æ ¸å¿ƒæ¨¡å— -> æˆ‘ä»¬æ ¸å¿ƒæ¨¡å—çš„åå­—æ˜¯ä¸€ä¸ªç§æœ‰åç§°`@babel`ä¸‹é¢çš„`core`ï¼ˆå³`@babel/core`ï¼‰ä»¥åŠ babel çš„ä¸€ä¸ªé¢„è®¾`@babel/preset-env` -> éƒ½æ˜¯å¼€å‘ä¾èµ–

æœ‰äº†è¿™ä¸‰ä¸ªæ¨¡å—è¿‡åï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨æˆ‘ä»¬çš„ `gruntfile` å½“ä¸­å»ä½¿ç”¨ babel é‡Œé¢æä¾›çš„ä¸€äº›ä»»åŠ¡äº†ã€‚

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬åˆéœ€è¦é€šè¿‡`loadNpmTasks`å»åŠ è½½ `grunt-babel`å½“ä¸­æä¾›çš„ä¸€äº›ä»»åŠ¡ã€‚

éšç€ä½ çš„è¿™ä¸ª `gruntfile` è¶Šæ¥è¶Šå¤æ‚ï¼Œä½ è¿™ä¸ª`loadNpmTasks`é‡Œé¢çš„æ“ä½œä¹Ÿä¼šè¶Šæ¥è¶Šå¤šã€‚ -> é‚£è¿™ä¸ªæ—¶å€™ï¼Œç¤¾åŒºå½“ä¸­æœ‰ä¸€ä¸ªæ¨¡å—ï¼Œå®ƒå¯ä»¥å‡å°‘æˆ‘ä»¬`loadNpmTasks` çš„ä½¿ç”¨ -> è¿™å…·ä½“æ€ä¹ˆæ ·å»ç”¨å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥å…ˆå®‰è£…ä¸€ä¸ªå«åš`load-grunt-tasks` çš„ä¸€ä¸ªæ¨¡å—

``` bash
yarn add load-grunt-tasks --dev
```

è¯¥æ¨¡å—åŒæ ·ä¹Ÿæ˜¯å¼€å‘ä¾èµ–ã€‚

å®‰è£…å®Œè¿™ä¸ªæ¨¡å—è¿‡åï¼Œæˆ‘ä»¬å°±å¯ä»¥å…ˆå¯¼å…¥ä¸€ä¸‹è¿™ä¸ªæ¨¡å—ï¼š

``` js
const loadGruntTasks = require('load-grunt-tasks')
```

æœ‰äº†è¿™ä¸ªæ¨¡å—çš„å¯¼å…¥è¿‡åï¼Œæˆ‘ä»¬å°±ä¸éœ€è¦æ¯æ¬¡é‡å¤çš„å»å¯¼å…¥è¿™ä¸ªä¸åŒçš„æ’ä»¶äº†ã€‚æˆ‘ä»¬å¯ä»¥ç›´æ¥é€šè¿‡ `loadGruntTasks` ï¼ˆæŠŠ `grunt` ä¼ è¿›å»ï¼‰æ¥æ

è¿™ä¸ªæ—¶å€™ `loadGruntTasks` å®ƒä¼šè‡ªåŠ¨åŠ è½½æ‰€æœ‰çš„ grunt æ’ä»¶ä»»åŠ¡ -> è¿™ä¸ªå°±æ˜¯ `loadGruntTasks`çš„ä¸€ä¸ªä½œç”¨ã€‚

è¿™ä¸ª`loadGruntTasks`å½“ä¸­ï¼Œå®ƒè‚¯å®šæ˜¯åŠ è½½äº† `grunt-babel`é‡Œé¢æä¾›çš„ä¸€äº›ä»»åŠ¡ -> æ‰€ä»¥ï¼ŒåŒæ ·æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸º`grunt-babel`ä»»åŠ¡æä¾›ä¸€äº›ç›®æ ‡ é…ç½®

è¿™ä¸ªç›®æ ‡æˆ‘ä»¬åŒæ ·ä¹Ÿæ˜¯ç”¨`main` -> åœ¨è¿™ä¸ª`main`é‡Œé¢ä¹Ÿæ˜¯é€šè¿‡ `files` å»æŒ‡å®šä¸€ä¸‹æˆ‘ä»¬çš„è¿™ä¸ªç¼–è¯‘æ–‡ä»¶çš„è¾“å…¥å’Œè¾“å‡º -> è¾“å‡ºæˆ‘ä»¬æ”¾åœ¨`dist/js/app.js` -> è¾“å…¥å°±æ˜¯`src/js/app.js` 

å¯¹äº†ï¼Œå¯¹äº `babel` è¿™ä¸ªä»»åŠ¡ï¼Œå®ƒä¹Ÿéœ€è¦é…ç½®ä¸€ä¸ªé€‰é¡¹ï¼Œå®ƒè¿™ä¸ªé€‰é¡¹éœ€è¦è®¾ç½®ä»€ä¹ˆå‘¢ï¼Ÿ -> å°±æ˜¯è®¾ç½®æˆ‘ä»¬ babel åœ¨è½¬æ¢çš„æ—¶å€™é‚£ä¸ª `preset` -> å› ä¸ºæˆ‘ä»¬çŸ¥é“ babel å®ƒä½œä¸º ES6 çš„è½¬æ¢ï¼Œå®é™…ä¸Šå®ƒä¸æ˜¯ ES6 çš„è½¬æ¢ï¼Œå®ƒåº”è¯¥æ˜¯ ECMAScript æœ€æ–°ç‰¹æ€§çš„ä¸€ä¸ªè½¬æ¢ï¼Œå®ƒé‡Œé¢æ”¯æŒè½¬æ¢éƒ¨åˆ†ç‰¹æ€§ ->  `preset` å®é™…ä¸Šå°±æ˜¯è¯´ä½ éœ€è¦å»è½¬æ¢å“ªäº›ç‰¹æ€§ï¼Œå®ƒæŠŠä¸€ç³»åˆ—çš„ç‰¹æ€§æ‰“äº†ä¸€ä¸ªåŒ…ï¼Œå½¢æˆäº†ä¸€ä¸ªå«åš `preset`

æˆ‘ä»¬è¿™å„¿ä½¿ç”¨çš„ `preset`ï¼Œå®ƒå«åš`env` -> å®ƒä¼šé»˜è®¤æ ¹æ®æœ€æ–°çš„ ES ç‰¹æ€§å»åšå¯¹åº”çš„è½¬æ¢ã€‚

æ‰€ä»¥æˆ‘ä»¬è¿™å„¿éœ€è¦åŠ å¯¹åº”çš„é…ç½® -> è¿™ä¹Ÿæ˜¯é€šè¿‡ `options` æ¥åŠ  -> åœ¨`options`å½“ä¸­å»æŒ‡å®šä¸€ä¸‹ï¼Œæˆ‘ä»¬è¿™å„¿æŠŠè¿™ä¸ªé€‰é¡¹å«åš `presets` -> å®ƒæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„å½“ä¸­æˆ‘ä»¬ä¼ å…¥ä¸€ä¸ª`'@babel/preset-env'`

è¿™æ ·ä¸€æ¥ï¼Œå®ƒå°±ä¼šå¸®æˆ‘ä»¬æŠŠæœ€æ–°çš„ ECMAScript å½“ä¸­çš„ç‰¹æ€§å…¨éƒ¨åŠ è½½è¿›æ¥

æ‰€ä»¥ï¼Œæˆ‘ä»¬ä»£ç å½“ä¸­è¿™ä¸€äº› ES6 çš„ç‰¹æ€§è‚¯å®šä¼šè¢«è½¬æ¢æ‰ã€‚

æˆ‘ä»¬å›åˆ°å’±ä»¬çš„è¿™ä¸ªå‘½ä»¤è¡Œå½“ä¸­ï¼Œæˆ‘ä»¬å»æ‰§è¡Œä¸€ä¸‹`babel`ä»»åŠ¡ã€‚

æ­¤æ—¶æˆ‘ä»¬åœ¨ `dist` ç›®å½•ä¸‹å°±ä¼šå¤šå‡ºæ¥ä¸€ä¸ª `js` æ–‡ä»¶å¤¹ï¼Œæ–‡ä»¶å¤¹é‡Œé¢ä¼šæœ‰ä¸€ä¸ª`js`æ–‡ä»¶ï¼Œé‚£è¿™ä¸ªæ–‡ä»¶å½“ä¸­å°±å¸®æˆ‘ä»¬è‡ªåŠ¨çš„æŠŠåŸæ¥æˆ‘ä»¬å†™çš„ä¸€äº› ES6 ä»£ç è‡ªåŠ¨çš„å»è½¬æ¢æˆäº† ES5 çš„æ–¹å¼ã€‚

åœ¨`options`é‡Œè¾¹ï¼Œbabel å®ƒä¹Ÿæ”¯æŒ `sourceMap` é€‰é¡¹ï¼Œè¿™ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨ `options` é‡Œé¢å»æ·»åŠ ä¸€ä¸ª `sourceMap`

æœ‰äº†å®ƒè¿‡åï¼Œæˆ‘ä»¬å†å›åˆ°å‘½ä»¤è¡Œç»ˆç«¯å½“ä¸­å»è¿è¡Œä¸€ä¸‹ babel è¿™ä¸ªå‘½ä»¤ã€‚

æ­¤æ—¶æˆ‘ä»¬çš„è¿™ä¸ª`js`æ–‡ä»¶ä¹Ÿä¼šç”Ÿæˆå¯¹åº”çš„ `sourceMap`æ–‡ä»¶

è¿™ä¸ªæ˜¯`grunt-babel`è¿™æ ·ä¸€ä¸ªæ’ä»¶çš„åŸºæœ¬ä½¿ç”¨ã€‚

è¿˜æœ‰ä¸€ä¸ªæˆ‘ä»¬åœ¨ä½¿ç”¨åƒè¿™ç§æ„å»ºç³»ç»Ÿç»å¸¸é‡åˆ°çš„ä¸€ä¸ªéœ€æ±‚å°±æ˜¯ï¼š

> å½“æ–‡ä»¶ä¿®æ”¹äº†å®Œäº†è¿‡åï¼Œæˆ‘ä»¬éœ€è¦è‡ªåŠ¨çš„å»ç¼–è¯‘ã€‚é‚£è¿™ä¸ªæ—¶å€™åœ¨ grunt å½“ä¸­æˆ‘ä»¬éœ€è¦å¦å¤–ä¸€ä¸ªæ’ä»¶â€”â€”`grunt-contrib-watch`

æˆ‘ä»¬å®‰è£…ä¸€ä¸‹è¿™ä¸ªæ¨¡å—ï¼š

``` bash
yarn add grunt-contrib-watch --dev
```

å®‰è£…å®Œè¿™ä¸ªæ¨¡å—è¿‡åï¼Œæˆ‘ä»¬çš„`loadGruntTasks`ä¼šè‡ªåŠ¨çš„å»æŠŠ `watch` è¿™ä¸ªä»»åŠ¡ä¹Ÿç»™å®ƒåŠ è½½è¿›æ¥ã€‚

æ‰€ä»¥è¯´æˆ‘ä»¬ä¸éœ€è¦å†å»`loadNpmTasks`äº†ï¼Œç„¶åæˆ‘ä»¬ç›´æ¥å»ä¸º `watch` è¿™ä¸ªä»»åŠ¡å»æ·»åŠ é…ç½®é€‰é¡¹å°±å¥½äº†ã€‚

å¯¹äºï¼Œ`watch` è¿™ä¸ªä»»åŠ¡ï¼Œæˆ‘ä»¬éœ€è¦å»æ·»åŠ ä¸åŒçš„ç›®æ ‡ã€‚é‚£æˆ‘ä»¬è¿™å¯ä»¥æœ‰ä¸€ä¸ª JS çš„ç›®æ ‡ï¼Œå»ä¸“é—¨ç”¨æ¥å»ç›‘è§† JS æ–‡ä»¶çš„å˜åŒ– -> é‚£è¿™ä¸ªé‡Œé¢æˆ‘ä»¬é€šè¿‡ `files` å»æŒ‡å®šæˆ‘ä»¬éœ€è¦ç›‘è§†çš„æ–‡ä»¶ï¼Œå¯¹äºè¿™ä¸ª `files` å®ƒå°±ç›´æ¥è®¾ç½®ä¸ºä¸€ä¸ªæ•°ç»„å°±å¥½äº†ï¼Œå› ä¸ºå®ƒä¸éœ€è¦è¾“å‡ºä»»ä½•çš„æ–‡ä»¶ï¼Œå®ƒåªæ˜¯éœ€è¦ç›‘è§†ç‰¹å®šçš„æºæ–‡ä»¶å°±å¥½äº† -> æˆ‘ä»¬çš„æºæ–‡ä»¶åº”è¯¥æ˜¯`src/js/app.js`

å½“ç„¶ï¼Œä½ å®é™…å»ç”¨çš„æ—¶å€™ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šç”¨é€šé…ç¬¦å»é€šé…`js`ä¸‹é¢æ‰€æœ‰çš„ JS æ–‡ä»¶

è¿™æ ·åšå®Œäº†è¿‡åï¼Œæˆ‘ä»¬è¿˜éœ€è¦å»æ·»åŠ ä¸€ä¸ªé€‰é¡¹ï¼Œè¿™ä¸ªé€‰é¡¹å«åš `tasks`ï¼Œä¹Ÿå°±æ˜¯å½“ä½ è¿™äº›æ–‡ä»¶å‘ç”Ÿæ”¹å˜è¿‡åï¼Œä½ éœ€è¦å»æ‰§è¡Œä»€ä¹ˆä»»åŠ¡ï¼Ÿ

é‚£æˆ‘ä»¬è¿™å„¿éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡å«åš`'babel'` -> è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬åœ¨ `watch` é‡Œé¢æœ‰ä¸€ä¸ªå¯¹ JS çš„ `watch`

ä»¥æ­¤ç±»æ¨ï¼Œæˆ‘ä»¬å¯ä»¥å†æ·»åŠ ä¸€ä¸ªå¯¹æ ·å¼æ–‡ä»¶çš„ `watch` -> è¿™ä¸ªæ ·å¼æ–‡ä»¶æˆ‘ä»¬ç›‘è§†çš„æ˜¯`src/scss/*.scss` -> æˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡å«åš `sass`

å…³äºè¿™ä¸ª`scss`å’Œ`sass`è¯´æ˜ä¸€ä¸‹ï¼Œ sass æœ€æ—©çš„è¿™ä¸ªæ‰©å±•åå°±æ˜¯ `sass`ï¼Œä½†æ˜¯å®ƒçš„é‚£ä¸ªè¯­æ³•è§„èŒƒä¸å¤ªå®¹æ˜“è¢«äººæ¥å—ï¼Œæ‰€ä»¥è¯´å®ƒåæ¥å‡ºäº†ä¸€ä¸ªæ–°çš„è¯­æ³•è§„èŒƒ -> é‚£ä¸ªæ–°çš„è¯­æ³•è§„èŒƒå°±ç”¨`scss`ä½œä¸ºæ‰©å±•åï¼Œæ‰€ä»¥`src/scss/*.scss`è¿™é‡Œï¼Œæˆ‘ä»¬è¯´çš„`scss`å®é™…ä¸Šå°±æ˜¯ sass çš„æ–°æ‰©å±•åè€Œå·²ã€‚

æˆ‘ä»¬å›åˆ°ä»»åŠ¡å½“ä¸­ã€‚

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†å»è¿è¡Œä»»åŠ¡çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥è¿è¡Œä¸€ä¸‹ `watch` è¿™ä¸ªä»»åŠ¡ã€‚

`watch` è¿™ä¸ªä»»åŠ¡å¯åŠ¨è¿‡åï¼Œå®ƒå¹¶ä¸ä¼šç›´æ¥å»æ‰§è¡Œ `babel` å’Œ `sass` å¯¹åº”çš„ä¸€äº›ä»»åŠ¡ï¼Œå®ƒåªæ˜¯ä¼šå»ç›‘è§†æ–‡ä»¶ã€‚ä¸€æ—¦å½“æ–‡ä»¶å‘ç”Ÿå˜åŒ–è¿‡åï¼Œå®ƒæ‰ä¼šå»ä¿®æ”¹ï¼Œæ‰ä¼šå»æ‰§è¡Œå¯¹åº”çš„ä»»åŠ¡ã€‚

ä¾‹å¦‚æˆ‘ä»¬åœ¨`app.js`é‡Œè¾¹éšä¾¿å»åšä¸€äº›è°ƒæ•´ï¼Œä¿å­˜ä¸€ä¸‹

é‚£ä½ ä¼šå‘ç°è¿™ä¸ª `babel` ä»»åŠ¡ä¼šè‡ªåŠ¨è‡ªåŠ¨è¢«æ‰§è¡Œ -> é‚£ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨è¿™ä¸ª `watch` ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œå®ƒå¹¶ä¸æ‰§è¡Œæˆ‘ä»¬çš„ `sass` å’Œ `babel`

æ‰€ä»¥è¯´æˆ‘ä»¬ä¸€èˆ¬ä¼šç»™ `watch` åšä¸€ä¸ªæ˜ å°„

é‚£è¿™ä¸ªæ˜ å°„è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ

``` js
grunt.registerTask('default', ['sass', 'babel', 'watch'])
```

`grunt.registerTask`ç„¶åç»™ä¸€ä¸ªæ¯”å¦‚ `default` ä»»åŠ¡ã€‚

åœ¨è¿™ä¸ª `default` å½“ä¸­ï¼Œæˆ‘ä»¬å…ˆå»æ‰§è¡Œä¸€ä¸‹ `sass` å’Œ `babel`ï¼Œæœ€åæˆ‘ä»¬å†å»æ‰§è¡Œä¸€ä¸‹ `watch`

é‚£è¿™æ ·çš„è¯ï¼Œå°±ç¡®ä¿æˆ‘ä»¬åœ¨å¯åŠ¨çš„é‚£ä¸€ç¬é—´å°±ä¼šå…ˆæ‰§è¡Œä¸€æ¬¡ç¼–è¯‘æ“ä½œï¼Œç„¶åå†å»å¯åŠ¨ç›‘å¬ -> è¿™æ ·åšå¯èƒ½ä¼šæ›´åˆç†ä¸€äº›ã€‚

å›åˆ°å‘½ä»¤è¡Œç»ˆç«¯ï¼Œæˆ‘ä»¬è¿è¡Œä¸€ä¸‹ `default`ï¼š

``` bash
yarn grunt
```

`default` è¿™ä¸ªä»»åŠ¡æ˜¯ä¸éœ€è¦å»æŒ‡å®šä»»åŠ¡çš„åç§°çš„ï¼Œæˆ‘ä»¬ç›´æ¥è¿è¡Œ `grunt` å°±å¥½äº†ã€‚

æ­¤æ—¶å®ƒä¼šå…ˆåšä¸€æ¬¡ç¼–è¯‘æ“ä½œï¼Œç„¶åç´§æ¥ç€å¯åŠ¨è¿™ä¸ªç›‘å¬ -> å†æœ‰æ–‡ä»¶çš„å˜åŒ–è¯ï¼Œå®ƒä¼šè‡ªåŠ¨å»ç¼–è¯‘ã€‚

ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬ä»‹ç»çš„ä¸‰ä¸ªå°æ’ä»¶ï¼Œè¿™ä¸‰ä¸ªå°æ’ä»¶ï¼Œå®é™…ä¸Šç®—æˆ‘ä»¬åœ¨ä½¿ç”¨ Grunt è¿™æ ·çš„å·¥å…·æœ€å¸¸ç”¨çš„å‡ ä¸ªæ’ä»¶ã€‚å½“ç„¶ï¼Œé™¤æ­¤ä¹‹å¤–ï¼Œå®ƒè¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„æ’ä»¶ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨è¿™å„¿å°±ä¸è¿‡å¤šçš„å»ä»‹ç»äº†ï¼ŒåŸå› å¾ˆç®€å•ï¼Œå› ä¸º Grunt åŸºæœ¬ä¸Šå·²ç»é€€å‡ºå†å²èˆå°äº†ã€‚

æˆ‘ä»¬è¿™å„¿ä»‹ç» Grunt çš„ä¸€ä¸ªæœ€ä¸»è¦åŸå› æ˜¯å› ä¸ºå®ƒç®—æ˜¯æœ€æ—©çš„é¼»ç¥–äº†ï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬å…ˆä»‹ç»ä¸€ä¸‹å®ƒã€‚

å¦å¤–ä¸€ä¸ªï¼Œæˆ‘ä»¬ä»‹ç»å®ƒè¿˜æœ‰ä¸€ä¸ªæœ€ä¸»è¦çš„ç‚¹ï¼Œå°±æ˜¯ä¸ºåé¢ä¸€ä¸ªä¸œè¥¿åšä¸€ä¸ªé“ºå«ï¼Œæœ‰äº†å®ƒçš„ä½¿ç”¨ä¸Šè¯¸å¤šä¸ä¾¿ï¼Œåé¢æˆ‘ä»¬åœ¨ä½¿ç”¨ Glup çš„æ—¶å€™å°±ä¼šæœ‰æ›´å¥½çš„ä½“éªŒã€‚

è‡³äºå®ƒå…¶ä»–çš„ä¸€äº›æ’ä»¶ï¼Œå¤§å®¶å¯ä»¥é¡ºè—¤æ‘¸ç“œä»å®˜ç½‘ä¸Šæ‰¾åˆ°ä¸€äº›è¯´æ˜ï¼Œæˆ‘ä»¬å°±ä¸å†è¿‡å¤šçš„å»ä»‹ç»äº†ã€‚

åæ­£ä»¥å¤§å®¶ç°åœ¨äº†è§£çš„è¿™ä¸ªç¨‹åº¦æ¥è®²çš„è¯ï¼Œå¯¹äºæ‹¿åˆ°åˆ«äººé¡¹ç›®å½“ä¸­çš„ `gruntfile.js` ç„¶åå»åˆ†æå®ƒï¼Œæ˜¯ä¸ä¼šå—ä»»ä½•å½±å“çš„ã€‚

è¿™å°±æ˜¯æˆ‘ä»¬é’ˆå¯¹äº Grunt ä»‹ç»çš„æ‰€æœ‰çš„å†…å®¹ã€‚

ğŸ’¡ï¼šä»£ç ï¼Ÿ

ç›®å½•ç»“æ„ï¼š

![ç»“æ„](assets/img/2021-10-27-17-04-45.png)

å¼€å‘ä¾èµ–ï¼š

``` json
{
  "devDependencies": {
    "@babel/core": "^7.5.5",
    "@babel/preset-env": "^7.5.5",
    "grunt": "^1.0.4",
    "grunt-babel": "^8.0.0",
    "grunt-contrib-watch": "^1.1.0",
    "grunt-sass": "^3.1.0",
    "load-grunt-tasks": "^5.1.0",
    "sass": "^1.22.10"
  }
}
```

`gruntfile.js`ï¼š

``` js
const sass = require('sass')
const loadGruntTasks = require('load-grunt-tasks')

module.exports = grunt => {
  grunt.initConfig({
    sass: {
      options: {
        sourceMap: true,
        implementation: sass
      },
      main: {
        files: {
          'dist/css/main.css': 'src/scss/main.scss'
        }
      }
    },
    babel: {
      options: {
        sourceMap: true,
        presets: ['@babel/preset-env']
      },
      main: {
        files: {
          'dist/js/app.js': 'src/js/app.js'
        }
      }
    },
    watch: {
      js: {
        files: ['src/js/*.js'],
        tasks: ['babel']
      },
      css: {
        files: ['src/scss/*.scss'],
        tasks: ['sass']
      }
    }
  })

  // grunt.loadNpmTasks('grunt-sass')
  loadGruntTasks(grunt) // è‡ªåŠ¨åŠ è½½æ‰€æœ‰çš„ grunt æ’ä»¶ä¸­çš„ä»»åŠ¡

  grunt.registerTask('default', ['sass', 'babel', 'watch'])
}
```

