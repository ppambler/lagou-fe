### âœï¸ Tangxt â³ 2021-10-27 ðŸ·ï¸ å·¥ç¨‹åŒ–

# 08-Gulp çš„åŸºæœ¬ä½¿ç”¨ã€Gulp çš„ç»„åˆä»»åŠ¡ã€Gulp çš„å¼‚æ­¥ä»»åŠ¡ã€Gulp æž„å»ºè¿‡ç¨‹æ ¸å¿ƒå·¥ä½œåŽŸç†ã€Gulp æ–‡ä»¶æ“ä½œ API

## â˜…Gulp çš„åŸºæœ¬ä½¿ç”¨

gulp ä½œä¸ºå½“ä¸‹æœ€æµè¡Œçš„å‰ç«¯æž„å»ºç³»ç»Ÿï¼Œå…¶æ ¸å¿ƒç‰¹ç‚¹å°±æ˜¯é«˜æ•ˆã€æ˜“ç”¨ã€‚

å› ä¸ºä½¿ç”¨ gulp çš„è¿‡ç¨‹éžå¸¸ç®€å•ï¼Œå¤§ä½“çš„è¿‡ç¨‹å°±æ˜¯å…ˆåœ¨é¡¹ç›®ä¸­å®‰è£…ä¸€ä¸ªå«åš `gulp` çš„å¼€å‘ä¾èµ–ã€‚ç„¶åŽåœ¨æˆ‘ä»¬çš„é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œä¹Ÿå°±æ˜¯`package.json` æ‰€åœ¨çš„ç›®å½•å½“ä¸­åŽ»æ·»åŠ ä¸€ä¸ª `gulpfile.js`æ–‡ä»¶ -> ç”¨äºŽåŽ»ç¼–å†™æˆ‘ä»¬éœ€è¦ gulp è‡ªåŠ¨æ‰§è¡Œçš„ä¸€äº›æž„å»ºä»»åŠ¡ã€‚

å®Œæˆè¿‡åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨å‘½ä»¤è¡Œç»ˆç«¯å½“ä¸­ä½¿ç”¨ gulp è¿™ä¸ªæ¨¡å—æä¾›çš„ CLI åŽ»è¿è¡Œè¿™äº›æž„å»ºä»»åŠ¡ã€‚

æˆ‘ä»¬å›žåˆ°ä¸€ä¸ªç©ºé¡¹ç›®å½“ä¸­å…·ä½“æ¥çœ‹ï¼š

é¦–å…ˆæˆ‘ä»¬å…ˆé€šè¿‡`yarn init`åŽ»åˆå§‹åŒ–ä¸€ä¸‹æˆ‘ä»¬é¡¹ç›®çš„ `package.json`

æœ‰äº†è¿™ä¸ªæ–‡ä»¶è¿‡åŽï¼Œæˆ‘ä»¬å†é€šè¿‡`yarn`å®‰è£…è¿™ä¸ª `gulp` æ¨¡å—ï¼ŒæŠŠå®ƒä½œä¸ºä¸€ä¸ªå¼€å‘ä¾èµ–å®‰è£…ã€‚

``` bash
yarn add gulp --dev
```

å®‰è£… gulp çš„åŒæ—¶å®ƒä¼šåŒæ—¶å®‰è£…ä¸€ä¸ªå«åš`gulp-cli`çš„æ¨¡å— -> ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬æ­¤æ—¶åœ¨`node_modules`å½“ä¸­ä¼šå‡ºçŽ°ä¸€ä¸ª gulp çš„å‘½ä»¤ã€‚

æœ‰äº†è¿™ä¸ªå‘½ä»¤è¿‡åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨åŽç»­é€šè¿‡è¿™ä¸ªå‘½ä»¤åŽ»è¿è¡Œæˆ‘ä»¬çš„ä¸€äº›æž„å»ºä»»åŠ¡ã€‚

æ­¤æ—¶æˆ‘ä»¬å†å›žåˆ°é¡¹ç›®çš„æ ¹ç›®å½•å½“ä¸­åŽ»åˆ›å»ºä¸€ä¸ª `gulpfile.js`æ–‡ä»¶ã€‚

åœ¨è¿™ä¸ªæ–‡ä»¶å½“ä¸­ï¼Œæˆ‘ä»¬åŽ»å®šä¹‰ä¸€äº›éœ€è¦ gulp æ‰§è¡Œçš„ä¸€äº›æž„å»ºä»»åŠ¡ã€‚é‚£ä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªæ–‡ä»¶ä¼šæ˜¯ gulp çš„å…¥å£æ–‡ä»¶ï¼Œå› ä¸ºè¿™ä¸ªæ–‡ä»¶æ˜¯è¿è¡Œåœ¨ Node.js çš„çŽ¯å¢ƒå½“ä¸­ï¼Œæ‰€ä»¥è¯´æˆ‘ä»¬å¯ä»¥åœ¨è¿™ä¸ªæ–‡ä»¶å½“ä¸­ä½¿ç”¨ CommonJS  çš„è§„èŒƒã€‚

åœ¨è¿™ä¸ªæ–‡ä»¶å½“ä¸­åŽ»å®šä¹‰æž„å»ºä»»åŠ¡çš„æ–¹å¼ï¼Œå°±æ˜¯é€šè¿‡å¯¼å‡ºå‡½æ•°æˆå‘˜çš„æ–¹å¼åŽ»å®šä¹‰ã€‚

é‚£å…·ä½“çš„æ–¹å¼å°±æ˜¯é€šè¿‡ `export` å¯¼å‡ºä¸€ä¸ªæˆå‘˜

æˆ‘ä»¬è¿™å„¿å¯¼å‡ºä¸€ä¸ªå«åš `foo` çš„æˆå‘˜ -> è¿™ä¸ªæˆå‘˜çš„å€¼å®ƒæ˜¯ä¸€ä¸ªå‡½æ•° -> åœ¨è¿™ä¸ªå‡½æ•°ä½“å½“ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡`console.log()`åŽ»è¡¨ç¤ºä¸€ä¸‹å‡½æ•°çš„æ‰§è¡Œã€‚

é‚£è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„ `gulpfile.js` å½“ä¸­å°±ç›¸å½“äºŽå®šä¹‰äº†ä¸€ä¸ªå«åš `foo` çš„ä»»åŠ¡ã€‚

æˆ‘ä»¬å¯ä»¥å›žåˆ°å‘½ä»¤è¡Œç»ˆç«¯ï¼Œé€šè¿‡ gulp æä¾›çš„ CLI åŽ»è¿è¡Œè¿™ä¸ªä»»åŠ¡ã€‚æˆ‘ä»¬è¿™å„¿é€šè¿‡`yarn`è¿è¡Œ gulp è¿™ä¸ªå‘½ä»¤ï¼Œç„¶åŽç»™å®ƒä¼ å…¥ä¸€ä¸ª `foo` å‚æ•°ï¼Œç”¨äºŽä»£è¡¨æˆ‘ä»¬æŒ‡å®šæ‰§è¡Œ `foo` è¿™ä¸ªä»»åŠ¡ï¼š

``` bash
yarn gulp foo
```

å›žè½¦ã€‚

æ­¤æ—¶å‘½ä»¤è¡Œç»ˆç«¯å½“ä¸­ç¡®å®žå¸®æˆ‘ä»¬æ‰§è¡Œäº† `foo` è¿™ä¸ªä»»åŠ¡ï¼Œè€Œä¸” `foo` çš„ `console.log()`ä¹Ÿæ­£å¸¸æ‰“å°å‡ºæ¥äº†ï¼Œä½†æ˜¯è¿™ä¸ªåœ°æ–¹ä¼šæŠ¥å‡ºä¸€ä¸ªé”™è¯¯ï¼Œé”™è¯¯ä¿¡æ¯å¤§ä½“çš„å«ä¹‰å°±æ˜¯è¯´ï¼š

> æˆ‘ä»¬çš„ `foo` ä»»åŠ¡æ‰§è¡Œæ²¡æœ‰å®Œæˆï¼Œé—®æˆ‘ä»¬æ˜¯å¦å¿˜è®°åŽ»æ ‡è¯†è¿™ä¸ªä»»åŠ¡çš„ç»“æŸ

ä¸ºå•¥ä¼šæœ‰è¿™ä¸ªé”™è¯¯å‘¢ï¼Ÿ -> è¿™æ˜¯å› ä¸ºåœ¨æœ€æ–°çš„ gulp å½“ä¸­ï¼Œå®ƒå–æ¶ˆäº†åŒæ­¥ä»£ç æ¨¡å¼ï¼Œçº¦å®šæˆ‘ä»¬æ¯ä¸€ä¸ªä»»åŠ¡éƒ½å¿…é¡»æ˜¯ä¸€ä¸ªå¼‚æ­¥çš„ä»»åŠ¡ã€‚

å½“æˆ‘ä»¬çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆè¿‡åŽï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡è°ƒç”¨å›žè°ƒå‡½æ•°æˆ–è€…å…¶ä»–çš„æ–¹å¼åŽ»æ ‡è®°è¿™ä¸ªä»»åŠ¡å·²ç»å®Œæˆã€‚

æ‰€ä»¥è¯´æˆ‘ä»¬åœ¨è§£å†³è¿™ä¸ªé—®é¢˜è¿™å—éœ€è¦åšçš„äº‹æƒ…å°±æ˜¯æ‰‹åŠ¨çš„åŽ»è°ƒç”¨ä¸€ä¸ªå›žè°ƒå‡½æ•° -> è¿™ä¸ªå›žè°ƒå‡½æ•°æˆ‘ä»¬å¯ä»¥åœ¨ä»£ç å½“ä¸­é€šè¿‡ `foo` è¿™ä¸ªå‡½æ•°çš„å½¢å¼å‚æ•°å¾—åˆ°ã€‚

æˆ‘ä»¬è¿™å„¿æŽ¥æ”¶ä¸€ä¸ªå«åš `done` çš„å‚æ•° -> è¿™ä¸ª `done` å®ƒå°±æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä»»åŠ¡æ‰§è¡Œå®Œæˆè¿‡åŽï¼ŒåŽ»è°ƒç”¨ä¸€ä¸‹è¿™ä¸ªå‡½æ•° -> æ ‡è¯†ä¸€ä¸‹ä»»åŠ¡å®Œæˆã€‚

æ­¤æ—¶æˆ‘ä»¬å†æ¬¡å›žåˆ°å‘½ä»¤è¡Œç»ˆç«¯ï¼Œé‡æ–°åŽ»è¿è¡Œè¿™ä¸ªå‘½ä»¤ï¼š

``` bash
yarn gulp foo
```

æ­¤æ—¶ä½ ä¼šå‘çŽ° `foo` è¿™ä¸ªä»»åŠ¡æ­£å¸¸å¯åŠ¨ï¼Œæ­£å¸¸ç»“æŸï¼Œå¹¶ä¸”è¿™ä¸ªè¿‡ç¨‹ä¹Ÿæ˜¯æ‰“å°äº†æˆ‘ä»¬å¯¹åº”çš„ä»»åŠ¡æ¶ˆæ¯ã€‚

ä»¥ä¸Šå°±æ˜¯æˆ‘ä»¬åœ¨ gulp å½“ä¸­åŽ»å®šä¹‰ä¸€ä¸ªä»»åŠ¡çš„æ“ä½œæ–¹å¼ã€‚

å¦‚æžœè¯´ä½ çš„ä»»åŠ¡åç§°æ˜¯ `default` çš„è¯ï¼Œé‚£å®ƒä¼šä½œä¸º gulp çš„é»˜è®¤ä»»åŠ¡å‡ºçŽ°ã€‚

ä¾‹å¦‚æˆ‘ä»¬è¿™å„¿é€šè¿‡ `export` å¯¼å‡ºä¸€ä¸ªå«åš `default` çš„æˆå‘˜ -> è¿™ä¸ªæˆå‘˜å®ƒä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œåœ¨è¿™ä¸ªå‡½æ•°å½“ä¸­æˆ‘ä»¬ä¹ŸåŒæ ·æ‰“å°ä¸€ä¸ªæ¶ˆæ¯ã€‚é‚£è¿™ä¸ªæ—¶å€™ä»»åŠ¡å®Œæˆè¿‡åŽï¼Œæˆ‘ä»¬åŒæ ·éœ€è¦è°ƒç”¨è¿™ä¸ª `done` çš„å›žè°ƒå‡½æ•°ã€‚

æœ‰äº†è¿™ä¸ª `default` ä»»åŠ¡è¿‡åŽï¼Œæˆ‘ä»¬å†åˆ°å‘½ä»¤è¡Œå½“ä¸­åŽ»è¿è¡Œä¸€ä¸‹è¿™ä¸ª `default`ã€‚

``` bash
yarn gulp
```

æ­¤æ—¶å› ä¸ºè¿™ä¸ª `default` å®ƒä¼šä½œä¸º gulp çš„é»˜è®¤ä»»åŠ¡å‡ºçŽ°ï¼Œæˆ‘ä»¬å†åŽ»è¿è¡Œå®ƒçš„æ—¶å€™å°±ä¸éœ€è¦åŽ»æŒ‡å®šä»»åŠ¡åçš„é‚£ä¸ªå‚æ•°äº†ï¼Œæˆ‘ä»¬ç›´æŽ¥è¿è¡Œ `gulp` -> æ­¤æ—¶å®ƒä¼šè‡ªåŠ¨åŽ»è¿è¡Œ `default` è¿™ä¸ªä»»åŠ¡ -> è¿™æ˜¯æˆ‘ä»¬ä»»åŠ¡åå¦‚æžœè¯´æ˜¯ `default` çš„è¯ï¼Œå®ƒçš„è¿™ä¹ˆä¸€ä¸ªå°ç‰¹ç‚¹ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªéœ€è¦å¤§å®¶æ³¨æ„çš„å°±æ˜¯ï¼Œåœ¨ gulp 4.0 ä»¥å‰ï¼Œæˆ‘ä»¬åŽ»æ³¨å†Œ gulp çš„ä»»åŠ¡æ˜¯éœ€è¦é€šè¿‡ gulp æ¨¡å—é‡Œé¢çš„ä¸€ä¸ªæ–¹æ³•åŽ»å®žçŽ°ã€‚

è¿™å…·ä½“æ¥çœ‹å°±æ˜¯æˆ‘ä»¬é€šè¿‡ `require` çš„æ–¹å¼å…ˆè½½å…¥ gulp è¿™ä¸ªæ¨¡å—ã€‚æœ‰äº†è¿™ä¸ªæ¨¡å—å„¿è¿‡åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥å€ŸåŠ©äºŽè¿™ä¸ªæ¨¡å—å„¿é‡Œé¢æä¾›çš„ `task` æ–¹æ³•åŽ»æ³¨å†Œä¸€ä¸ªä»»åŠ¡ã€‚

ä¾‹å¦‚æˆ‘ä»¬è¿™å„¿æ³¨å†Œä¸€ä¸ªå«åš `bar` çš„ä»»åŠ¡ã€‚

åŒæ ·ï¼Œè¿™ä¸ªä»»åŠ¡ä¹Ÿéœ€è¦åŽ»æŽ¥æ”¶ä¸€ä¸ªä»»åŠ¡çš„å‡½æ•°ã€‚åœ¨è¿™ä¸ªä»»åŠ¡å‡½æ•°å½“ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å½¢å‚åŽ»æŽ¥æ”¶ä»»åŠ¡å®Œæˆè¿‡åŽçš„å›žè°ƒå‡½æ•°`done`ã€‚

åœ¨è¿™ä¸ªä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬åŒæ ·æ‰“å°ä¸€ä¸ªä»»åŠ¡æ¶ˆæ¯ï¼Œå®Œæˆè¿‡åŽï¼Œæˆ‘ä»¬åŒæ ·åŽ»è°ƒç”¨ä¸€ä¸‹å›žè°ƒå‡½æ•°`done`ã€‚

æ­¤æ—¶æˆ‘ä»¬å†å›žåˆ°å‘½ä»¤è¡Œç»ˆç«¯ï¼Œæˆ‘ä»¬å°è¯•ç€åŽ»è¿è¡Œä¸€ä¸‹è¿™ä¸ª `bar` ä»»åŠ¡ï¼š

``` bash
yarn gulp bar
```

æ­¤æ—¶ä½ ä¼šå‘çŽ° `bar` ä»»åŠ¡ä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œ -> è¿™æ˜¯å› ä¸ºåœ¨ gulp 4.0 ä»¥åŽçš„ç‰ˆæœ¬å½“ä¸­ä¿ç•™äº†è¿™ä¸ª APIï¼Œè™½ç„¶è¯´æˆ‘ä»¬çŽ°åœ¨è¿˜å¯ä»¥ç›´æŽ¥ä½¿ç”¨è¿™ä¸ª APIï¼Œä½†æ˜¯è¿™ç§æ–¹å¼å·²ç»ä¸è¢«æŽ¨èäº†ã€‚

æˆ‘ä»¬æ›´æŽ¨èå¤§å®¶ä½¿ç”¨çš„æ–¹å¼å°±æ˜¯é€šè¿‡å¯¼å‡ºå‡½æ•°æˆå‘˜çš„æ–¹å¼åŽ»å®šä¹‰æˆ‘ä»¬çš„ gulp ä»»åŠ¡ã€‚

ðŸ’¡ï¼šä»£ç ï¼Ÿ

`gulpfile.js`ï¼š

``` js
// // å¯¼å‡ºçš„å‡½æ•°éƒ½ä¼šä½œä¸º gulp ä»»åŠ¡
// exports.foo = () => {
//   console.log('foo task working~')
// }

// gulp çš„ä»»åŠ¡å‡½æ•°éƒ½æ˜¯å¼‚æ­¥çš„
// å¯ä»¥é€šè¿‡è°ƒç”¨å›žè°ƒå‡½æ•°æ ‡è¯†ä»»åŠ¡å®Œæˆ
exports.foo = done => {
  console.log('foo task working~')
  done() // æ ‡è¯†ä»»åŠ¡æ‰§è¡Œå®Œæˆ
}

// default æ˜¯é»˜è®¤ä»»åŠ¡
// åœ¨è¿è¡Œæ˜¯å¯ä»¥çœç•¥ä»»åŠ¡åå‚æ•°
exports.default = done => {
  console.log('default task working~')
  done()
}

// v4.0 ä¹‹å‰éœ€è¦é€šè¿‡ gulp.task() æ–¹æ³•æ³¨å†Œä»»åŠ¡
const gulp = require('gulp')

gulp.task('bar', done => {
  console.log('bar task working~')
  done()
})
```

## â˜…Gulp çš„ç»„åˆä»»åŠ¡

é™¤äº†åˆ›å»ºæ™®é€šçš„ä»»åŠ¡ä»¥å¤–ï¼Œgulp çš„æœ€æ–°ç‰ˆæœ¬è¿˜æä¾›äº† `series` å’Œ `parallel` è¿™ä¸¤ä¸ªç”¨æ¥åˆ›å»ºç»„åˆä»»åŠ¡çš„ API

æœ‰äº†è¿™ä¸¤ä¸ª API è¿‡åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾ˆè½»æ¾åœ°åŽ»åˆ›å»ºå¹¶è¡Œä»»åŠ¡å’Œä¸²è¡Œä»»åŠ¡ã€‚

å…·ä½“æ¥çœ‹ï¼Œæˆ‘ä»¬è¿™å„¿æœ‰ä¸‰ä¸ªå‡½æ•°ï¼š

``` js
const task1 = done => {
  setTimeout(() => {
    console.log('task1 working~')
    done()
  }, 1000)
}

const task2 = done => {
  setTimeout(() => {
    console.log('task2 working~')
    done()
  }, 1000)  
}

const task3 = done => {
  setTimeout(() => {
    console.log('task3 working~')
    done()
  }, 1000)  
}
```

æˆ‘ä»¬å¯ä»¥æŠŠè¿™ç§æœªè¢«å¯¼å‡ºçš„æˆå‘˜å‡½æ•°ç†è§£æˆç§æœ‰çš„ä»»åŠ¡ã€‚é‚£ä»–ä»¬å„è‡ªæ¨¡æ‹Ÿäº†ä¸€ä¸ªéœ€è¦æ‰§è¡Œä¸€ç§’çš„ä»»åŠ¡ã€‚

è¿™é‡Œæˆ‘ä»¬å¹¶ä¸èƒ½é€šè¿‡ gulp ç›´æŽ¥åŽ»è¿è¡Œå®ƒä»¬ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ gulp æ¨¡å—æä¾›çš„ series å’Œ parallel è¿™ä¸¤ä¸ª API æŠŠå®ƒä»¬ç»„åˆæˆä¸€ä¸ªç»„åˆä»»åŠ¡ã€‚

æˆ‘ä»¬è¿™å„¿å…ˆé€šè¿‡ `require` çš„æ–¹å¼è½½å…¥è¿™ä¸¤ä¸ª APIï¼Œå®Œäº†è¿‡åŽï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå«åš `foo` çš„ä»»åŠ¡ -> è¿™ä¸ªä»»åŠ¡æˆ‘ä»¬é€šè¿‡ series åŽ»åˆ›å»ºã€‚

`series` æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥æŽ¥å—ä»»æ„ä¸ªæ•°çš„å‚æ•° -> æ¯ä¸ªå‚æ•°éƒ½å¯ä»¥æ˜¯ä¸€ä¸ªä»»åŠ¡ -> `series` ä¼šè‡ªåŠ¨çš„åŽ»æŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚

æˆ‘ä»¬å›žåˆ°å‘½ä»¤è¡Œå½“ä¸­åŽ»å°è¯•ä½¿ç”¨ä¸€ä¸‹å®ƒä»¬ï¼š

``` bash
yarn gulp foo
```

è¿™æ—¶å€™ä½ ä¼šå‘çŽ° `foo` è¿™ä¸ªä»»åŠ¡å¯åŠ¨è¿‡åŽï¼Œå®ƒä¼šä¾æ¬¡æ‰§è¡Œ task1ã€ task2 å’Œ task3ã€‚

é™¤äº†åˆ›å»ºè¿™ç§ä¸²è¡Œçš„ä»»åŠ¡ç»“æž„ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥åŽ»åˆ›å»ºä¸€ç§å¹¶è¡Œçš„ä»»åŠ¡ç»“æž„ -> è¿™ç§æ–¹å¼æˆ‘ä»¬éœ€è¦é€šè¿‡ gulp æ¨¡å—é‡Œé¢æä¾›çš„ `parallel` è¿™ä¸ª API åŽ»å®žçŽ°ã€‚

æˆ‘ä»¬è¿™å„¿å¯¼å‡ºä¸€ä¸ª `bar` æˆå‘˜ -> è¿™ä¸ªæˆå‘˜æˆ‘ä»¬é€šè¿‡ `parallel` åŽ»åŒ…è£…ä¸€ä¸‹ task1ã€task2ã€task3

æœ‰äº†è¿™ä¸ª `parallel`çš„ä¸€ä¸ªä»»åŠ¡è¿‡åŽï¼Œæˆ‘ä»¬é€šè¿‡å‘½ä»¤è¡Œå½“ä¸­åŽ»è¿è¡Œä¸€ä¸‹ `bar` è¿™ä¸ªä»»åŠ¡ï¼š

``` bash
yarn gulp bar
```

æ­¤æ—¶ä½ ä¼šå‘çŽ°ï¼Œåœ¨ `bar` ä¸€å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸‰ä¸ªä»»åŠ¡ä¼šè¢«åŒæ—¶å¯åŠ¨ -> è¿™ç§æ–¹å¼å°±æ˜¯åŒæ­¥åŽ»æ‰§è¡Œè¿™ä¸‰ä¸ªä»»åŠ¡ã€‚

æ€»çš„æ¥è¯´ï¼Œåˆ›å»ºå¹¶è¡Œä»»åŠ¡ï¼Œæˆ–è€…è¯´åˆ›å»ºä¸²è¡Œä»»åŠ¡ï¼Œå®ƒåœ¨æˆ‘ä»¬å®žé™…åˆ›å»ºæž„å»ºå·¥ä½œæµæ—¶éžå¸¸æœ‰ç”¨ã€‚

ä¾‹å¦‚æˆ‘ä»¬åŽ»ç¼–è¯‘ CSS å’Œç¼–è¯‘ JS çš„ä»»åŠ¡ï¼Œå®ƒä»¬æ˜¯äº’ä¸å¹²æ‰°çš„ã€‚é‚£è¿™ä¸¤ä¸ªä»»åŠ¡æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å¹¶è¡Œçš„æ–¹å¼åŽ»æ‰§è¡Œ -> è¿™æ ·ä¼šæé«˜ä¸€äº›æž„å»ºæ•ˆçŽ‡ã€‚

å†æ¯”å¦‚æˆ‘ä»¬åŽ»éƒ¨ç½²ï¼Œé‚£éƒ¨ç½²çš„ä»»åŠ¡éœ€è¦å…ˆæ‰§è¡Œç¼–è¯‘ä»»åŠ¡ã€‚é‚£è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦é€šè¿‡ `series` è¿™ç§ä¸²è¡Œçš„æ¨¡å¼åŽ»æ‰§è¡Œè¿™ä¸¤ä¸ªä»»åŠ¡ã€‚

ðŸ’¡ï¼šä»£ç ï¼Ÿ

``` js
const { series, parallel } = require('gulp')

const task1 = done => {
  setTimeout(() => {
    console.log('task1 working~')
    done()
  }, 1000)
}

const task2 = done => {
  setTimeout(() => {
    console.log('task2 working~')
    done()
  }, 1000)  
}

const task3 = done => {
  setTimeout(() => {
    console.log('task3 working~')
    done()
  }, 1000)  
}

// è®©å¤šä¸ªä»»åŠ¡æŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œ
exports.foo = series(task1, task2, task3)

// è®©å¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œ
exports.bar = parallel(task1, task2, task3)
```

## â˜…Gulp çš„å¼‚æ­¥ä»»åŠ¡

æ­£å¦‚æˆ‘ä»¬ä¸€å¼€å§‹æ‰€è¯´çš„ï¼Œ gulp å½“ä¸­çš„ä»»åŠ¡éƒ½æ˜¯å¼‚æ­¥ä»»åŠ¡ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åœ¨ JS å½“ä¸­ç»å¸¸æåˆ°çš„å¼‚æ­¥å‡½æ•°ã€‚

é‚£æˆ‘ä»¬åº”è¯¥çŸ¥é“ï¼Œæˆ‘ä»¬åŽ»è°ƒç”¨ä¸€ä¸ªå¼‚æ­¥å‡½æ•°æ—¶ï¼Œæ˜¯æ²¡æœ‰åŠžæ³•ç›´æŽ¥åŽ»æ˜Žç¡®è¿™ä¸ªè°ƒç”¨æ˜¯å¦å®Œæˆçš„ï¼Œéƒ½æ˜¯åœ¨å‡½æ•°å†…éƒ¨é€šè¿‡å›žè°ƒæˆ–è€…äº‹ä»¶çš„æ–¹å¼åŽ»é€šçŸ¥å¤–éƒ¨ã€Œè¿™ä¸ªå‡½æ•°æ‰§è¡Œå®Œæˆäº†ã€ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨å¼‚æ­¥ä»»åŠ¡å½“ä¸­åŒæ ·é¢ä¸´è¿™ä¸ªã€Œå¦‚ä½•åŽ»é€šçŸ¥ gulp æˆ‘ä»¬çš„å®Œæˆæƒ…å†µã€è¿™æ ·ä¸€ä¸ªé—®é¢˜ã€‚

é’ˆå¯¹äºŽè¿™ä¸ªé—®é¢˜ï¼Œgulp å½“ä¸­æœ‰å¾ˆå¤šè§£å†³æ–¹æ³•ã€‚æŽ¥ä¸‹æ¥æˆ‘ä»¬å°±ä¸€èµ·äº†è§£ä¸€ä¸‹å‡ ä¸ªæœ€å¸¸ç”¨çš„æ–¹å¼ã€‚

é¦–å…ˆç¬¬ä¸€ç§è‡ªç„¶æ˜¯é€šè¿‡å›žè°ƒçš„æ–¹å¼åŽ»è§£å†³ã€‚

é‚£æˆ‘ä»¬åœ¨è¿™ä¸ªä»»åŠ¡çš„å‡½æ•°å½“ä¸­åŽ»æŽ¥æ”¶ä¸€ä¸ªå›žè°ƒå‡½æ•°å½¢å‚ï¼Œç„¶åŽåœ¨ä»»åŠ¡å®Œæˆè¿‡åŽï¼Œæˆ‘ä»¬åŽ»è°ƒç”¨ä¸€ä¸‹è¿™ä¸ªå›žè°ƒå‡½æ•°ï¼Œä»Žè€ŒåŽ»é€šçŸ¥ gulpï¼šã€Œæˆ‘ä»¬è¿™ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæˆäº†ã€

æˆ‘ä»¬å›žåˆ°å‘½ä»¤è¡Œå½“ä¸­å°è¯•ä½¿ç”¨ä¸€ä¸‹è¿™ä¸ªä»»åŠ¡ï¼š

``` bash
yarn gulp callback
```

OKï¼Œè¿™æ²¡æœ‰é—®é¢˜ã€‚

è¿™ä¸ªå›žè°ƒå‡½æ•°ï¼Œå®ƒä¸Ž node å½“ä¸­çš„å›žè°ƒå‡½æ•°æ˜¯åŒæ ·çš„æ ‡å‡† -> éƒ½æ˜¯ä¸€ç§å«åš**é”™è¯¯ä¼˜å…ˆ**çš„å›žè°ƒå‡½æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´å½“æˆ‘ä»¬æƒ³åœ¨æ‰§è¡Œè¿‡ç¨‹å½“ä¸­åŽ»æŠ¥å‡ºä¸€ä¸ªé”™è¯¯ï¼ŒåŽ»é˜»æ­¢å‰©ä¸‹çš„ä»»åŠ¡æ‰§è¡Œçš„æ—¶å€™ï¼Œé‚£è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥é€šè¿‡ç»™å›žè°ƒå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°åŽ»æŒ‡å®šä¸€ä¸ªé”™è¯¯å¯¹è±¡å°±å¯ä»¥äº†ã€‚

æˆ‘ä»¬è¿™å„¿åŽ»æŒ‡å®šä¸€ä¸ªé”™è¯¯ä¿¡æ¯å«åš`task failed`, ç„¶åŽæˆ‘ä»¬å†å›žåˆ°å‘½ä»¤è¡Œå½“ä¸­ï¼Œå°è¯•åŽ»æ‰§è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡ï¼š

``` bash
yarn gulp callback_error
```

æ­¤æ—¶ï¼Œå‘½ä»¤è¡Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹å½“ä¸­ä¼šçˆ†å‡ºè¿™æ ·ä¸€ä¸ªé”™è¯¯`Error: task failed!`ï¼Œè€Œä¸”å¦‚æžœè¯´ä½ æ˜¯å¤šä¸ªä»»åŠ¡åŒæ—¶æ‰§è¡Œè¯ï¼Œé‚£åŽç»­çš„ä»»åŠ¡ä¹Ÿå°±ä¸ä¼šå†åŽ»å·¥ä½œäº†ã€‚

é‚£è¿™ä¸ªæ˜¯æˆ‘ä»¬åœ¨é”™è¯¯ä¼˜å…ˆå›žè°ƒå‡½æ•°å½“ä¸­éœ€è¦åŽ»æ³¨æ„çš„ä¸€ä¸ªå°ç‚¹ã€‚

æœ‰äº†å›žè°ƒå‡½æ•°ï¼Œæˆ‘ä»¬è‡ªç„¶ä¼šè”æƒ³åˆ° ES6 å½“ä¸­æä¾›çš„ä¸€ä¸ªå«åš promise çš„æ–¹æ¡ˆã€‚

ç›¸å¯¹äºŽå›žè°ƒæ¥è¯´ï¼Œpromise æ˜¯ä¸€ä¸ªç›¸å¯¹æ¯”è¾ƒå¥½çš„æ›¿ä»£æ–¹æ¡ˆï¼Œå› ä¸ºå®ƒé¿å…äº†æˆ‘ä»¬ä»£ç å½“ä¸­å›žè°ƒåµŒå¥—è¿‡æ·±çš„é—®é¢˜ã€‚

é‚£åœ¨ gulp å½“ä¸­åŒæ ·æ”¯æŒ promise çš„æ–¹å¼ã€‚

é‚£å…·ä½“çš„ä½¿ç”¨è¯ï¼Œæˆ‘ä»¬å°±éœ€è¦åœ¨ä»»åŠ¡çš„æ‰§è¡Œå‡½æ•°å½“ä¸­åŽ» `return` ä¸€ä¸ª promise å¯¹è±¡ -> åœ¨`promise`ä»»åŠ¡é‡Œè¾¹ï¼Œæˆ‘ä»¬é€šè¿‡`return Promise.resolve()`ç›´æŽ¥åŽ»è¿”å›žä¸€ä¸ªæˆåŠŸçš„ promise

ä¸€æ—¦å½“æˆ‘ä»¬è¿”å›žçš„ promise å¯¹è±¡ `resolve` äº†ï¼Œé‚£ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬è¿™ä¸ªä»»åŠ¡ç»“æŸäº†ã€‚

è¿™éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ `resolve` çš„æ—¶å€™æˆ‘ä»¬ä¸éœ€è¦åŽ»è¿”å›žä»»ä½•çš„å€¼ï¼Œå› ä¸º gulp å½“ä¸­å®ƒä¼šå¿½ç•¥æŽ‰è¿™ä¸ªå€¼ã€‚

è¿™æ—¶å€™æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œå½“ä¸­é‡æ–°åŽ»æ‰§è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡ï¼š

``` bash
yarn gulp promise
```

æ­¤æ—¶è¿™ä¸ªä»»åŠ¡ä»ç„¶æ˜¯å¯ä»¥å¼€å§‹ã€æ­£å¸¸ç»“æŸçš„ã€‚

å½“ç„¶ï¼Œä½¿ç”¨ promise è‡ªç„¶ä¹Ÿä¼šæ¶‰åŠåˆ° promise çš„ `reject`ï¼Œä¹Ÿå°±æ˜¯ promise å¤±è´¥ã€‚

ä¸€æ—¦å½“ä½  `return` çš„æ˜¯ä¸€ä¸ªå¤±è´¥çš„ promise çš„è¯`Promise.reject(new Error('task failed'))`ï¼š

``` bash
yarn gulp promise_error
```

é‚£æˆ‘ä»¬çš„ gulp ä¼šè®¤ä¸ºè¿™æ˜¯ä¸€ä¸ªå¤±è´¥çš„ä»»åŠ¡ï¼Œå®ƒåŒæ ·ä¼šç»“æŸåŽç»­æ‰€æœ‰çš„ä»»åŠ¡çš„æ‰§è¡Œã€‚

ç”¨åˆ°äº† promise è¿‡åŽï¼Œæˆ‘ä»¬è‡ªç„¶åˆä¼šæƒ³åˆ° ES7 å½“ä¸­æä¾›çš„ `async` å’Œ `await`

`async/await` å®ƒå®žé™…ä¸Šæ˜¯ promise çš„ä¸€ç§è¯­æ³•ç³–ï¼Œå®ƒå¯ä»¥è®©æˆ‘ä»¬ä½¿ç”¨ promise çš„ä»£ç æ›´åŠ å®¹æ˜“ç†è§£ -> å¦‚æžœè¯´ä½ çš„ node çŽ¯å¢ƒæ˜¯ 8 ä»¥ä¸Šçš„ç‰ˆæœ¬çš„è¯ï¼Œé‚£ä½ å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚

è¿™å…·ä½“çš„å°±æ˜¯å°†æˆ‘ä»¬çš„ä»»åŠ¡å‡½æ•°å®šä¹‰ä¸ºä¸€ä¸ªå¼‚æ­¥çš„å‡½æ•°ã€‚

åœ¨è¿™ä¸ªå‡½æ•°å½“ä¸­ï¼Œæˆ‘ä»¬åŽ» `await` ä¸€ä¸ªå¼‚æ­¥çš„ä»»åŠ¡ã€‚å…¶å®žæˆ‘ä»¬ `await` çš„å°±æ˜¯ä¸€ä¸ª promise å¯¹è±¡ã€‚åœ¨`timeout`è¿™å‡½æ•°é‡Œè¾¹æˆ‘ä»¬é€šè¿‡å®šä¹‰ä¸€ä¸ªå•ç‹¬çš„ promise å‡½æ•°ï¼Œæˆ‘ä»¬åŽ»åšä¸€ä¸ªå°è¯• -> è¿™ä¸ª promise å‡½æ•°å½“ä¸­åªæ˜¯æŠŠ `setTimeout` åŒ…è£…æˆäº†ä¸€ä¸ª promise çš„æ–¹å¼ã€‚

æœ‰äº†è¿™ä¸ªå‡½æ•°è¿‡åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ `async` å½“ä¸­åŽ» await è¿™ä¸ªå‡½æ•°ã€‚é‚£è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬åœ¨æ‰§è¡Œè¿™ä¸ª `async` å‡½æ•°çš„æ—¶å€™ï¼Œå®ƒå°±ä¼šåœ¨`await timeout(1000)`è¿™ä¸ªä½ç½®åŽ»ç­‰å¾…è¿™ä¸ª promise çš„ `resolve`ï¼Œç„¶åŽä¸€æ—¦ `resolve` å®Œæˆè¿‡åŽï¼Œæ‰ä¼šåŽ»æ‰§è¡ŒåŽç»­çš„ä»£ç  -> è¿™ä¸ªå®žé™…ä¸Šå°±æ˜¯ä¸€ç§è¯­æ³•ç³–ï¼Œå®ƒçš„å†…éƒ¨å®žé™…ä¸Šè¿˜æ˜¯ promise 

è¿™ç§æ–¹å¼å®ƒåªå—é™åˆ¶äºŽä½ çš„ node çŽ¯å¢ƒï¼Œåªè¦ä½  node çŽ¯å¢ƒæ”¯æŒ `async/await`ï¼Œé‚£ä½ å°±å¯ä»¥ä½¿ç”¨è¿™ç§æ–¹å¼ã€‚

ä»¥ä¸Šè¿™å‡ ç§éƒ½æ˜¯æˆ‘ä»¬åœ¨ JavaScript å½“ä¸­åŽ»å¤„ç†å¼‚æ­¥çš„å¸¸è§æ–¹å¼ -> è¿™äº›æ–¹å¼åœ¨ gulp å½“ä¸­éƒ½è¢«æ”¯æŒã€‚

é™¤äº†è¿™äº›æ–¹å¼ä»¥å¤–ï¼Œgulp å½“ä¸­è¿˜æ”¯æŒå¦å¤–å‡ ç§æ–¹å¼ã€‚

å…¶ä¸­é€šè¿‡ `stream` çš„æ–¹å¼æ˜¯æœ€ä¸ºå¸¸è§çš„ï¼Œå› ä¸ºæˆ‘ä»¬çš„æž„å»ºç³»ç»Ÿå¤§éƒ½æ˜¯åœ¨å¤„ç†æ–‡ä»¶ï¼Œæ‰€ä»¥è¿™ç§æ–¹å¼ä¹Ÿæ˜¯æœ€å¸¸ç”¨åˆ°çš„ä¸€ç§ã€‚

è¿™å…·ä½“æ¥çœ‹å°±æ˜¯æˆ‘ä»¬åœ¨æˆ‘ä»¬çš„è¿™ä¸ªä»»åŠ¡å‡½æ•°å½“ä¸­éœ€è¦åŽ»è¿”å›žä¸€ä¸ª `stream` å¯¹è±¡ã€‚

ä¾‹å¦‚æˆ‘ä»¬è¿™å„¿é€šè¿‡ `fs` æ¨¡å—å„¿å½“ä¸­æä¾›çš„ `createReadStream` æ–¹æ³•åŽ»åˆ›å»ºä¸€ä¸ªè¯»å–æ–‡ä»¶çš„æ–‡ä»¶æµ -> æˆ‘ä»¬å°è¯•ç€è¯»å–ä¸€ä¸‹`package.json`

``` js
const readStream = fs.createReadStream('yarn.lock')
```

é‚£è¿™ä¸ªæ—¶å€™ï¼Œè¿™ä¸ª`readStream`ï¼Œå®ƒå°±æ˜¯ä¸€ä¸ªæ–‡ä»¶æµå¯¹è±¡ã€‚

æˆ‘ä»¬è¿˜éœ€è¦åŽ»åˆ›å»ºä¸€ä¸ªå†™å…¥æ–‡ä»¶çš„æ–‡ä»¶æµ -> è¿™ä¸ªæˆ‘ä»¬å†™å…¥åˆ°ä¸€ä¸ª`temp.txt`æ–‡ä»¶ã€‚

``` js
const writeStream = fs.createWriteStream('a.txt')
```

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å¯ä»¥æŠŠ `readstream` é€šè¿‡ `pipe` çš„æ–¹å¼å¯¼åˆ° `writeStream` å½“ä¸­ï¼š

``` js
readstream.pipe(writeStream)
```

é‚£è¿™æ ·çš„è¯ï¼Œä½ å°±å¯ä»¥æŠŠå®ƒç†è§£æˆä»Žä¸€ä¸ªæ°´æ± å­å¾€å¦å¤–ä¸€ä¸ªæ°´æ³¥æ± å­é‡Œé¢åŽ»å€’æ°´ -> è¿™å°±ä¼šèµ·åˆ°ä¸€ä¸ªæ–‡ä»¶å¤åˆ¶çš„ä½œç”¨ã€‚

æœ€åŽæˆ‘ä»¬æŠŠè¿™ä¸ª `readStream` ç»™å®ƒ `return` å‡ºåŽ»ã€‚

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†åˆ°å‘½ä»¤è¡Œå½“ä¸­åŽ»è¿è¡Œä¸€ä¸‹ `stream` è¿™ä¸ªä»»åŠ¡ï¼š

``` bash
yarn gulp stream
```

ä½ ä¼šå‘çŽ°è¿™ä¸ªä»»åŠ¡ä¹Ÿæ˜¯å¯ä»¥å¼€å§‹ã€æ­£å¸¸ç»“æŸçš„ã€‚

é‚£å®ƒç»“æŸçš„æ—¶æœºå®žé™…ä¸Šå°±æ˜¯æˆ‘ä»¬è¿™ä¸ª `readStream` end çš„æ—¶å€™ï¼Œå› ä¸ºæˆ‘ä»¬ stream å½“ä¸­éƒ½æœ‰ä¸€ä¸ªäº‹ä»¶ï¼Œå°±æ˜¯`end`äº‹ä»¶ -> ä¸€æ—¦å½“è¿™ä¸ªè¯»å–çš„æ–‡ä»¶æµè¯»å–å®Œæˆè¿‡åŽï¼Œé‚£å°±ä¼šè§¦å‘`end`äº‹ä»¶ï¼Œä»Žè€Œ gulp å°±çŸ¥é“äº†ä½ è¿™ä¸ªä»»åŠ¡å·²ç»å®Œæˆäº†ã€‚

é‚£æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡ä»¥ä¸‹è¿™ä¸ªä»£ç åŽ»æ¨¡æ‹Ÿä¸€ä¸‹ gulp å½“ä¸­åšçš„äº‹æƒ…ã€‚

``` js
exports.stream = done => {
  const read = fs.createReadStream('yarn.lock')
  const write = fs.createWriteStream('a.txt')
  read.pipe(write)
  read.on('end', () => {
    done()
  })
}
```

åœ¨ gulp å½“ä¸­ï¼ŒæŽ¥æ”¶åˆ°ä½ è¿™ä¸ª stream è¿‡åŽï¼Œåªæ˜¯ä¸ºå®ƒæ³¨å†Œäº†ä¸€ä¸ª`end`äº‹ä»¶ã€‚åœ¨è¿™ä¸ª`end`äº‹ä»¶å½“ä¸­åŽ»ç»“æŸäº†æˆ‘ä»¬è¿™ä¸ªä»»åŠ¡çš„æ‰§è¡Œã€‚

æˆ‘ä»¬è¿™é€šè¿‡ `end`äº‹ä»¶åŽ»è°ƒç”¨ä¸€ä¸‹ `done` è¿™ä¸ªå‡½æ•°ï¼ŒåŽ»æ¨¡æ‹Ÿä¸€ä¸‹ gulp å½“ä¸­åŽ»ç»“æŸè¿™ä¸ªä»»åŠ¡çš„æ“ä½œã€‚

æˆ‘ä»¬å›žåˆ°å‘½ä»¤è¡Œå½“ä¸­é‡æ–°åŽ»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ã€‚

``` bash
yarn gulp stream
```

é‚£è¿™ä¸ªæ—¶å€™ä½ ä¼šå‘çŽ°è¿™ä¸ªä»»åŠ¡ä¹Ÿå¯ä»¥æ­£å¸¸ç»“æŸ -> è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œå…¶å®ž gulp å½“ä¸­åªæ˜¯åŽ»æ³¨å†Œäº†è¿™ä¹ˆä¸€ä¸ªäº‹ä»¶ï¼ŒåŽ»ç›‘å¬è¿™ä¸ªä»»åŠ¡çš„ç»“æŸç½¢äº†ã€‚

ä»¥ä¸Šè¿™ä¸€äº›å°±æ˜¯æˆ‘ä»¬åœ¨ gulp å½“ä¸­ç»å¸¸ä¼šç”¨åˆ°çš„ä¸€äº›å¤„ç†å¼‚æ­¥æµç¨‹çš„æ“ä½œã€‚

ðŸ’¡ï¼šä»£ç ï¼Ÿ

``` js
const fs = require('fs')

exports.callback = done => {
  console.log('callback task')
  done()
}

exports.callback_error = done => {
  console.log('callback task')
  done(new Error('task failed'))
}

exports.promise = () => {
  console.log('promise task')
  return Promise.resolve()
}

exports.promise_error = () => {
  console.log('promise task')
  return Promise.reject(new Error('task failed'))
}

const timeout = time => {
  return new Promise(resolve => {
    setTimeout(resolve, time)
  })
}

exports.async = async () => {
  await timeout(1000)
  console.log('async task')
}

exports.stream = () => {
  const read = fs.createReadStream('yarn.lock')
  const write = fs.createWriteStream('a.txt')
  read.pipe(write)
  return read
}

// exports.stream = done => {
//   const read = fs.createReadStream('yarn.lock')
//   const write = fs.createWriteStream('a.txt')
//   read.pipe(write)
//   read.on('end', () => {
//     done()
//   })
// }
```

## â˜…Gulp æž„å»ºè¿‡ç¨‹æ ¸å¿ƒå·¥ä½œåŽŸç†

åœ¨äº†è§£äº† gulp å½“ä¸­å®šä¹‰ä»»åŠ¡çš„æ–¹å¼è¿‡åŽï¼Œé‚£æŽ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·é‡ç‚¹å­¦ä¹ ä¸€ä¸‹è¿™äº›ä»»åŠ¡ä¸­æˆ‘ä»¬éœ€è¦åŽ»åšçš„ä¸€äº›å…·ä½“çš„å·¥ä½œï¼Œè¿™ä¹Ÿå°±æ˜¯æ‰€è°“çš„æž„å»ºè¿‡ç¨‹ã€‚

æž„å»ºè¿‡ç¨‹å¤§å¤šæ•°æƒ…å†µä¸‹éƒ½æ˜¯å°†æ–‡ä»¶è¯»å‡ºæ¥ï¼Œç„¶åŽè¿›è¡Œä¸€äº›è½¬æ¢ï¼Œæœ€åŽåŽ»å†™å…¥åˆ°å¦å¤–ä¸€ä¸ªä½ç½® -> ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ï¼Œåœ¨æ²¡æœ‰æž„å»ºç³»ç»Ÿçš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¹Ÿéƒ½æ˜¯äººå·¥æŒ‰ç…§è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹åŽ»åšçš„ã€‚

ä¾‹å¦‚æˆ‘ä»¬åŽ»åŽ‹ç¼©ä¸€ä¸ª CSS æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦æŠŠä»£ç å¤åˆ¶å‡ºæ¥ï¼Œç„¶åŽåˆ°ä¸€ä¸ªåŽ‹ç¼©å·¥å…·å½“ä¸­åŽ»åŽ‹ç¼©ä¸€ä¸‹ï¼Œæœ€åŽå°†åŽ‹ç¼©è¿‡åŽçš„ç»“æžœç²˜è´´åˆ°ä¸€ä¸ªæ–°çš„æ–‡ä»¶å½“ä¸­ï¼Œé‚£è¿™æ˜¯ä¸€ä¸ªæ‰‹åŠ¨çš„è¿‡ç¨‹ -> å…¶å®žé€šè¿‡ä»£ç çš„æ–¹å¼åŽ»è§£å†³ä¹Ÿæ˜¯ç±»ä¼¼çš„ã€‚

![è¯»å–åŽ‹ç¼©å†™å…¥](assets/img/2021-10-28-12-29-57.png)

æŽ¥ä¸‹æ¥æˆ‘ä»¬å°±ä¸€èµ·å›žåˆ°ä»£ç å½“ä¸­ï¼Œé€šè¿‡æœ€åŽŸå§‹çš„åº•å±‚ node çš„æ–‡ä»¶æµ API åŽ»æ¨¡æ‹Ÿå®žçŽ°ä¸€ä¸‹è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ã€‚

æˆ‘ä»¬å›žåˆ°é¡¹ç›®å½“ä¸­çš„ `gulpfile.js`æ–‡ä»¶ -> åœ¨è¿™ä¸ªæ–‡ä»¶å½“ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡`export.default`çš„æ–¹å¼åŽ»å¯¼å‡ºä¸€ä¸ªé»˜è®¤çš„ä»»åŠ¡ã€‚

åœ¨è¿™ä¸ªä»»åŠ¡å½“ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡åŽŸå§‹çš„ API åŽ»æ¨¡æ‹Ÿä¸€ä¸‹æˆ‘ä»¬åˆšåˆšæ‰‹åŠ¨å®Œæˆçš„é‚£æ ·ä¸€ä¸ªæž„å»ºè¿‡ç¨‹ã€‚

æˆ‘ä»¬å…ˆå¯¼å…¥ `fs` æ¨¡å—ï¼Œç„¶åŽæˆ‘ä»¬åŽ»åˆ›å»ºä¸€ä¸ªæ–‡ä»¶çš„è¯»å–æµï¼Œæˆ‘ä»¬é€šè¿‡ `fs` çš„`createReadStream`çš„æ–¹å¼åŽ»åˆ›å»ºï¼š

``` js
const readStream = fs.createReadStream('normalize.css')
```

æˆ‘ä»¬ä¸º`createReadStream`æŒ‡å®šçš„è¿™ä¸ªå‚æ•°ï¼Œå°±æ˜¯æˆ‘ä»¬éœ€è¦è¯»å–çš„è¿™ä¸ªæ–‡ä»¶çš„è·¯å¾„ï¼Œä¹Ÿå°±æ˜¯ `normalize.css`

ç„¶åŽæˆ‘ä»¬å†åŽ»åˆ›å»ºä¸€ä¸ªæ–‡ä»¶çš„å†™å…¥æµï¼Œè¿™ä¸ªå†™å…¥æµçš„åˆ›å»ºæ–¹å¼å°±æ˜¯é€šè¿‡`fs.createWriteStream`çš„æ–¹å¼ -> æˆ‘ä»¬æŒ‡å®šä¸€ä¸‹å…¶å‚æ•°`'normalize.min.css'`

``` js
const writeStream = fs.createWriteStream('normalize.min.css')
```

æœ‰äº†æ–‡ä»¶çš„è¯»å–æµå’Œæ–‡ä»¶å†™å…¥æµè¿‡åŽï¼Œæˆ‘ä»¬å°±éœ€è¦æŠŠè¯»å–å‡ºæ¥çš„æ–‡ä»¶æµå¯¼å…¥åˆ°å†™å…¥æµå½“ä¸­ã€‚é‚£è¿™æ ·æˆ‘ä»¬å¯ä»¥é€šè¿‡ `readStream` çš„ `pipe` æ–¹æ³•åŽ»å¯¼å…¥åˆ° `writeStream` å½“ä¸­ -> æœ€åŽæˆ‘ä»¬éœ€è¦é€šè¿‡ `return` çš„æ–¹å¼æŠŠè¿™ä¸ª `readStream` ç»™å®ƒ `return` å‡ºåŽ» -> å› ä¸ºè¿™æ ·çš„è¯ï¼Œ gulp å°±å¯ä»¥æ ¹æ®è¿™ä¸ªæµçš„çŠ¶æ€åŽ»åˆ¤å®šè¿™ä¸ªä»»åŠ¡æ˜¯å¦æ‰§è¡Œå®Œæˆã€‚

æˆ‘ä»¬å›žåˆ°å‘½ä»¤è¡Œå½“ä¸­åŽ»æ‰§è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡ã€‚

``` bash
yarn gulp
```

å®Œæˆè¿™ä¸ªä»»åŠ¡è¿‡åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨`normalize.min.css`å½“ä¸­åŽ»çœ‹åˆ°ä¸€ä¸ªä¸Ž`normalize.css`ç›¸åŒçš„å†…å®¹ -> è¿™ä¸ªä¹Ÿå°±æ„å‘³ç€æ–‡ä»¶å·²ç»è¢«å¤åˆ¶äº†ã€‚

ä½†æ˜¯ï¼Œæˆ‘ä»¬è¿™å„¿è¦åšçš„æ˜¯æŠŠæ–‡ä»¶çš„å†…å®¹è¯»å‡ºæ¥ï¼Œç„¶åŽç»è¿‡è½¬æ¢è¿‡åŽå†åŽ»å†™å…¥æ–‡ä»¶ï¼Œå¹¶ä¸æ˜¯ç›´æŽ¥å†™å…¥ã€‚

æ‰€ä»¥è¯´æˆ‘ä»¬è¿™å„¿éœ€è¦åŽ»å¯¼å…¥ä¸€ä¸‹ `stream` è¿™ä¸ªæ¨¡å—å„¿å½“ä¸­çš„ `Transform` è¿™ä¸ªç±»åž‹ -> æœ‰äº†è¿™ä¸ªç±»åž‹è¿‡åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™ä¸ªç±»åž‹åŽ»åˆ›å»ºä¸€ä¸ªæ–‡ä»¶è½¬æ¢æµå¯¹è±¡ã€‚

``` js
const transform = new Transform({})
```

åœ¨è¿™å„¿æˆ‘ä»¬é€šè¿‡ä¸€ä¸ª `Transform`ï¼Œæˆ‘ä»¬åŽ» `new` ä¸€ä¸ª `transformer`ï¼Œè¿™ä¸ª `transform` å½“ä¸­æˆ‘ä»¬éœ€è¦åŽ»æŒ‡å®šä¸€ä¸ª `transform` å±žæ€§ -> è¿™ä¸ªå±žæ€§å°±æ˜¯æˆ‘ä»¬è½¬æ¢æµçš„æ ¸å¿ƒè½¬æ¢è¿‡ç¨‹ã€‚

æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ªå‡½æ•°å½“ä¸­çš„ `chunk` æ‹¿åˆ°æˆ‘ä»¬æ–‡ä»¶è¯»å–æµå½“ä¸­è¯»å–åˆ°çš„æ–‡ä»¶å†…å®¹ -> æˆ‘ä»¬é€šè¿‡ `toString`çš„æ–¹å¼æŠŠå®ƒè½¬æ¢æˆå­—ç¬¦ä¸²ï¼Œå› ä¸ºå®ƒè¯»å‡ºæ¥æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ -> æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª `input` è®©å®ƒç­‰äºŽ `chunk` çš„ `toString`

å®Œæˆè¿‡åŽæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ `input` æ‹¿åˆ°è¿™ä¸ªæ–‡ä»¶çš„æ–‡æœ¬å†…å®¹ã€‚

ç„¶åŽæˆ‘ä»¬å†é€šè¿‡ `replace` çš„æ–¹å¼ï¼Œå…ˆåŽ»æŠŠç©ºç™½å­—ç¬¦å…¨éƒ¨æ›¿æ¢æŽ‰ï¼Œç„¶åŽæˆ‘ä»¬å†åŽ»æ›¿æ¢æŽ‰è¿™ä¸ªä»£ç å½“ä¸­çš„ CSS æ³¨é‡Š -> æˆ‘ä»¬å°†è¿™ä¸ªè½¬æ¢å®Œçš„ç»“æžœæ”¾åˆ°ä¸€ä¸ª `output` å˜é‡å½“ä¸­ -> æœ€åŽæˆ‘ä»¬åœ¨ `callback` çš„æ—¶å€™å°†è¿™ä¸ª `output` ç»™å®ƒè¿”å›žå‡ºåŽ» -> è¿™æ ·çš„è¯æˆ‘ä»¬å°±å®Œæˆäº†ä¸€ä¸ªè½¬æ¢çš„è¿‡ç¨‹ã€‚

æ³¨æ„è¿™ä¸ª `callback` å‡½æ•°å®ƒæ˜¯ä¸€ä¸ªé”™è¯¯ä¼˜å…ˆçš„å›žè°ƒå‡½æ•° -> é‚£ç¬¬ä¸€ä¸ªå‚æ•°æˆ‘ä»¬åº”è¯¥ä¼ å…¥é”™è¯¯å¯¹è±¡ã€‚å¦‚æžœè¯´ä½ æ²¡æœ‰å‘ç”Ÿé”™è¯¯çš„è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ `null` -> è¿™ä¸ª `output` å°±ä¼šä½œä¸ºæˆ‘ä»¬è½¬æ¢å®Œçš„ä¸€ä¸ªç»“æžœï¼ŒæŽ¥ç€å¾€åŽåŽ»å¯¼å‡ºã€‚

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å†å°†è¿™ä¸ª `read.pipe(write)` æ“ä½œçš„ä¸­é—´åŽ»æ·»åŠ ä¸€æ­¥ `pipe`ï¼š

``` js
read.pipe(transform).pipe(write)
```

æˆ‘ä»¬è®© `read` å…ˆåŽ» `pipe` åˆ°è¿™ä¸ª `transform` è½¬æ¢æµå½“ä¸­åŽ»å®Œæˆè¿™ä¸ªè½¬æ¢ -> å°†è½¬æ¢å®Œçš„è¿™ä¸ªç»“æžœï¼Œåœ¨ `pipe` åˆ°å†™å…¥æµå½“ä¸­ï¼Œä»Žè€Œèµ·åˆ°æ–‡ä»¶çš„è¿™æ ·ä¸€ä¸ªè½¬æ¢æž„å»ºè¿‡ç¨‹ã€‚

æˆ‘ä»¬å›žåˆ°å‘½ä»¤è¡Œå½“ä¸­é‡æ–°åŽ»è¿è¡Œä¸€ä¸‹è¿™ä¸ªå‘½ä»¤ã€‚

``` bash
yarn gulp
```

æ­¤æ—¶æˆ‘ä»¬å†æ¥çœ‹åˆ° `normalize.min.css` å½“ä¸­å°±æ˜¯ä¸€ä¸ªè¢«è½¬æ¢åŽ‹ç¼©è¿‡åŽçš„ä¸€ä¸ªç»“æžœäº†ã€‚

è¿™å°±æ˜¯ gulp å½“ä¸­ä¸€ä¸ªå¸¸è§„çš„æž„å»ºä»»åŠ¡çš„æ ¸å¿ƒå·¥ä½œè¿‡ç¨‹ã€‚

è¿™ä¸ªè¿‡ç¨‹å½“ä¸­æœ‰ä¸‰ä¸ªæ ¸å¿ƒçš„æ¦‚å¿µï¼š

![è¯»å–æµã€è½¬æ¢æµã€å†™å…¥æµ](assets/img/2021-10-28-12-30-30.png)

åˆ†åˆ«æ˜¯è¯»å–æµã€è½¬æ¢æµå’Œå†™å…¥æµã€‚

- æˆ‘ä»¬é€šè¿‡è¯»å–æµæŠŠæˆ‘ä»¬éœ€è¦è½¬æ¢çš„æ–‡ä»¶ç»™å®ƒè¯»å‡ºæ¥
- ç„¶åŽç»è¿‡è½¬æ¢æµçš„è½¬æ¢é€»è¾‘è½¬æ¢æˆæˆ‘ä»¬æƒ³è¦çš„ç»“æžœ
- å†é€šè¿‡å†™å…¥æµåŽ»å†™å…¥åˆ°æŒ‡å®šçš„æ–‡ä»¶ä½ç½®ã€‚

é‚£è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹å°±å®Œæˆäº†æˆ‘ä»¬æ—¥å¸¸åœ¨æž„å»ºè¿‡ç¨‹å½“ä¸­æ‰€éœ€è¦çš„å·¥ä½œã€‚

gulp å®˜æ–¹å®ƒçš„å®šä¹‰å°±æ˜¯ï¼š

> The streaming building system

![æµ](assets/img/2021-10-28-12-31-04.png)

ä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯åŸºäºŽæµçš„æž„å»ºç³»ç»Ÿã€‚

è‡³äºŽåœ¨ gulp å½“ä¸­ï¼Œæž„å»ºè¿‡ç¨‹ä¸ºä»€ä¹ˆé€‰æ‹©ä½¿ç”¨æ–‡ä»¶æµçš„æ–¹å¼ -> é‚£è¿™æ˜¯å› ä¸º gulp å®ƒå¸Œæœ›å®žçŽ°ä¸€ä¸ªæž„å»ºç®¡é“çš„æ¦‚å¿µï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬åœ¨åŽç»­åŽ»åšä¸€äº›æ‰©å±•æ’ä»¶çš„æ—¶å€™ï¼Œå°±å¯ä»¥æœ‰ä¸€ä¸ªå¾ˆç»Ÿä¸€çš„æ–¹å¼ -> å¯¹äºŽè¿™äº›ä¸œè¥¿ï¼Œæˆ‘ä»¬ä¼šåœ¨åŽç»­åŽ»æŽ¥è§¦åˆ°æ’ä»¶çš„ä½¿ç”¨è¿‡åŽå°±ä¼šæœ‰æ˜Žç¡®çš„ä½“ä¼šäº†ã€‚


ðŸ’¡ï¼šä»£ç ï¼Ÿ

ç›®å½•ï¼š

![ç›®å½•](assets/img/2021-10-28-13-45-39.png)

`gulpfile.js`ï¼š

``` js
const fs = require('fs')
const { Transform } = require('stream')

exports.default = () => {
  // æ–‡ä»¶è¯»å–æµ
  const readStream = fs.createReadStream('normalize.css')

  // æ–‡ä»¶å†™å…¥æµ
  const writeStream = fs.createWriteStream('normalize.min.css')

  // æ–‡ä»¶è½¬æ¢æµ
  const transformStream = new Transform({
    // æ ¸å¿ƒè½¬æ¢è¿‡ç¨‹
    transform: (chunk, encoding, callback) => {
      const input = chunk.toString()
      const output = input.replace(/\s+/g, '').replace(/\/\*.+?\*\//g, '')
      callback(null, output)
    }
  })

  return readStream
    .pipe(transformStream) // è½¬æ¢
    .pipe(writeStream) // å†™å…¥
}
```

## â˜…Gulp æ–‡ä»¶æ“ä½œ API

![æ’ä»¶çš„ä½¿ç”¨](assets/img/2021-10-28-13-38-00.png)

gulp ä¸­ä¸ºæˆ‘ä»¬æä¾›äº†ä¸“é—¨ç”¨äºŽåŽ»åˆ›å»ºè¯»å–æµå’Œå†™å…¥æµçš„ API -> ç›¸æ¯”äºŽåº•å±‚ node çš„ APIï¼Œgulp çš„ API å®ƒæ›´å¼ºå¤§ï¼Œä¹Ÿæ›´å®¹æ˜“ä½¿ç”¨ã€‚

è‡³äºŽè´Ÿè´£æ–‡ä»¶åŠ å·¥çš„è½¬æ¢æµï¼Œç»å¤§å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬éƒ½æ˜¯é€šè¿‡ç‹¬ç«‹çš„æ’ä»¶æ¥æä¾›ã€‚é‚£è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬åœ¨å®žé™…åŽ»é€šè¿‡ gulp åˆ›å»ºæž„å»ºä»»åŠ¡æ—¶çš„æµç¨‹ï¼Œå°±æ˜¯å…ˆé€šè¿‡ `src` æ–¹æ³•åŽ»åˆ›å»ºä¸€ä¸ªè¯»å–æµï¼Œç„¶åŽå†å€ŸåŠ©äºŽæ’ä»¶æä¾›çš„è½¬æ¢æµæ¥å®žçŽ°æ–‡ä»¶åŠ å·¥ï¼Œæœ€åŽæˆ‘ä»¬å†é€šè¿‡ gulp æä¾›çš„ `dest` æ–¹æ³•åŽ»åˆ›å»ºä¸€ä¸ªå†™å…¥æµï¼Œä»Žè€Œå†™å…¥åˆ°ç›®æ ‡æ–‡ä»¶ã€‚

é‚£æˆ‘ä»¬å…·ä½“æ¥çœ‹ã€‚

æˆ‘ä»¬è¿™é‡Œå…ˆé€šè¿‡ `require` çš„æ–¹å¼åŽ»è½½å…¥ gulp æ¨¡å—å½“ä¸­æä¾›çš„ `src` æ–¹æ³•å’Œ `dest` æ–¹æ³•ã€‚ç„¶åŽæˆ‘ä»¬åœ¨é»˜è®¤çš„è¿™ä¸ªä»»åŠ¡å½“ä¸­ï¼Œé€šè¿‡ `src` æ–¹æ³•åŽ»åˆ›å»ºä¸€ä¸ªæ–‡ä»¶çš„è¯»å–æµã€‚

æˆ‘ä»¬è¿™å„¿è¯»å–çš„æ–‡ä»¶è·¯å¾„æ˜¯ `src` ä¸‹é¢çš„ `normalize.css` -> æˆ‘ä»¬åŒæ ·é€šè¿‡ `pipe` çš„æ–¹å¼æŠŠå®ƒå¯¼å‡ºåˆ° `dest` æ‰€åˆ›å»ºçš„ä¸€ä¸ªå†™å…¥æµå½“ä¸­ -> è¿™ä¸ª`dest`æ–¹æ³•æˆ‘ä»¬åªéœ€è¦åŽ»æŒ‡å®šä¸€ä¸ªå†™å…¥ç›®æ ‡ç›®å½•å°±å¯ä»¥äº†ï¼Œæˆ‘ä»¬è¿™å„¿æ˜¯`dist`è¿™ä¸ªç›®å½•ã€‚

``` js
exports.default = () => {
  return src('src/normalize.css').pipe(dest('dist'))
}
```

æœ€åŽæˆ‘ä»¬éœ€è¦é€šè¿‡ `return` çš„æ–¹å¼å°†è¿™ä¸ªåˆ›å»ºçš„è¯»å–æµ `return` å‡ºåŽ»ã€‚è¿™æ ·çš„è¯ï¼Œ gulp å°±å¯ä»¥æŽ§åˆ¶æˆ‘ä»¬çš„è¿™ä¸ªä»»åŠ¡å®Œæˆï¼Œæˆ‘ä»¬å›žåˆ°å‘½ä»¤è¡ŒåŽ»å°è¯•è¿è¡Œä¸€ä¸‹è¿™æ ·ä¸€ä¸ªä»»åŠ¡ã€‚

``` bash
yarn gulp
```

é‚£æ­¤æ—¶ä½ ä¼šå‘çŽ° `dist` ç›®å½•ä¸‹ä¼šå¤šå‡ºæ¥ä¸€ä¸ª `normalize.css`æ–‡ä»¶ï¼Œé‚£ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬è¿™ä¸ªæ–‡ä»¶çš„è¯»å–æµå’Œå†™å…¥æµæ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œçš„ã€‚

æ­£å¦‚æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„ï¼Œç›¸æ¯”äºŽåŽŸå§‹çš„ APIï¼Œgulp æ¨¡å—å„¿æ‰€æä¾›çš„ API å®ƒè¦æ›´ä¸ºå¼ºå¤§ä¸€äº›ï¼Œå› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨é€šé…ç¬¦çš„æ–¹å¼åŽ»åŒ¹é…æ‰¹é‡çš„æ–‡ä»¶ã€‚

ä¾‹å¦‚æˆ‘ä»¬å°†`normalize`æ”¹æˆ`*`æ˜Ÿå· -> è¿™æ ·ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬è¦åŽ»é€šé… `src` ç›®å½•ä¸‹æ‰€æœ‰çš„ CSS æ–‡ä»¶

æˆ‘ä»¬é‡æ–°è¿è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡

``` bash
yarn gulp
```

æ­¤æ—¶ä½ ä¼šå‘çŽ°é™¤äº†`normalize.css`æ–‡ä»¶ï¼Œ`src`ä¸‹çš„å…¶ä»– CSS æ–‡ä»¶ï¼ˆ`bootstrap.css`ï¼‰ä¹Ÿä¼šè¢«å¤åˆ¶åˆ° `dist` ç›®å½•ã€‚

å½“ç„¶ï¼Œæž„å»ºçš„è¿‡ç¨‹æœ€é‡è¦çš„å°±æ˜¯æ–‡ä»¶çš„è½¬æ¢ã€‚é‚£æˆ‘ä»¬è¿™é‡Œå¦‚æžœéœ€è¦åŽ»å®Œæˆæ–‡ä»¶çš„åŽ‹ç¼©è½¬æ¢ï¼Œæˆ‘ä»¬å¯ä»¥åŽ»å®‰è£…ä¸€ä¸ªå«åš`gulp-clean-css`è¿™æ ·ä¸€ä¸ªæ’ä»¶ã€‚

è¿™ä¸ªæ’ä»¶æä¾›äº†åŽ‹ç¼© CSS ä»£ç çš„è½¬æ¢æµï¼Œæˆ‘ä»¬é€šè¿‡`yarn`åŽ»å®‰è£…ä¸€ä¸‹è¿™ä¸ªæ’ä»¶ï¼š

``` bash
yarn add gulp-clean-css --dev
```

å®‰è£…å®Œæˆè¿‡åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥å›žåˆ°ä»£ç å½“ä¸­ï¼Œé€šè¿‡ `require` çš„æ–¹å¼åŽ»è½½å…¥è¿™ä¸ªæ’ä»¶ã€‚

``` js
const cleanCSS = require('gulp-clean-css')
```

æœ‰äº†è¿™ä¸ªæ’ä»¶è¿‡åŽï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨ `dest` ä¹‹å‰å…ˆåŽ» `pipe` åˆ°æˆ‘ä»¬`cleanCss`æ‰€æä¾›çš„è½¬æ¢æµå½“ä¸­ -> é‚£è¿™æ ·çš„è¯ï¼Œå®ƒå°±ä¼šå…ˆç»è¿‡è½¬æ¢ï¼Œæœ€åŽå†è¢«å†™å…¥åˆ°å†™å…¥æµå½“ä¸­

æˆ‘ä»¬é‡æ–°è¿è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡ã€‚

``` bash
yarn gulp
```

æ­¤æ—¶æˆ‘ä»¬çš„ `normalize.css` å’Œ `bootstrap.css`å°±æ˜¯åŽ‹ç¼©è¿‡åŽçš„æ ·å¼ä»£ç äº†ã€‚

å½“ç„¶ï¼Œå¦‚æžœä½ è¿˜éœ€è¦åœ¨è¿™ä¸ªè¿‡ç¨‹å½“ä¸­æ‰§è¡Œå¤šä¸ªè½¬æ¢çš„è¯ï¼Œé‚£ä½ å¯ä»¥ç»§ç»­åœ¨`src`å’Œ`dest`ä¸­é—´åŽ»æ·»åŠ é¢å¤–çš„ `pipe` æ“ä½œã€‚

ä¾‹å¦‚æˆ‘ä»¬å†åŽ»æ·»åŠ ä¸€ä¸ªå«åš`gulp-rename`çš„æ’ä»¶ã€‚

å®‰è£…å®Œè¿™ä¸ªæ’ä»¶è¿‡åŽï¼Œæˆ‘ä»¬å†é€šè¿‡ `require` çš„æ–¹å¼åŽ»è½½å…¥è¿™ä¸ªæ’ä»¶ï¼š

``` js
const rename = require('gulp-rename')
```

ç„¶åŽæˆ‘ä»¬åœ¨`cleanCSS` å®Œæˆè¿‡åŽï¼Œæˆ‘ä»¬æŽ¥ç€åŽ» `pipe` åˆ°è¿™ä¸ª `rename` çš„è½¬åŒ–æµå½“ä¸­ -> è¿™ä¸ª `rename` æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªå«`extname`å‚æ•° -> è¿™ä¸ªå‚æ•°ç”¨äºŽåŽ»æŒ‡å®šæˆ‘ä»¬é‡å‘½åçš„è¿™ä¸ªæ‰©å±•åä¸º`.min.css`

æˆ‘ä»¬é‡æ–°è¿è¡Œä¸€ä¸‹è¿™ä¸ªä»»åŠ¡ï¼š

``` bash
yarn gulp
```

æ­¤æ—¶ä½ ä¼šå‘çŽ° `dist` ç›®å½•ä¸‹ä¼šå‡ºçŽ°`bootstrap.min.css` å’Œ `normalize.min.css` -> è¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬ç¬¬äºŒä¸ªè½¬æ¢æµçš„è¿™ä¸ªæ’ä»¶å®ƒä¹Ÿæ­£å¸¸å·¥ä½œäº†ã€‚

ä»¥ä¸Šè¿™ç§é€šè¿‡ `src` åŽ» `pipe` åˆ°ä¸€äº›æ’ä»¶è½¬æ¢æµï¼Œå†åŽ» `pipe` åˆ°ä¸€ä¸ªå†™å…¥æµçš„è¿™æ ·ä¸€ä¸ªè¿‡ç¨‹ï¼Œå°±æ˜¯æˆ‘ä»¬ä½¿ç”¨ gulp çš„å¸¸è§„è¿‡ç¨‹ã€‚

ðŸ’¡ï¼šä»£ç ï¼Ÿ

ç›®å½•ç»“æž„ï¼š

![ç›®å½•](assets/img/2021-10-28-13-46-57.png)

å®‰è£…çš„å¼€å‘ä¾èµ–ï¼š

``` json
{
  "devDependencies": {
    "gulp": "^4.0.2",
    "gulp-clean-css": "^4.2.0",
    "gulp-rename": "^1.4.0"
  }
}
```

`gulpfile.js`ï¼š

``` js
const { src, dest } = require('gulp')
const cleanCSS = require('gulp-clean-css')
const rename = require('gulp-rename')

exports.default = () => {
  return src('src/*.css')
    .pipe(cleanCSS())
    .pipe(rename({ extname: '.min.css' }))
    .pipe(dest('dist'))
}
```