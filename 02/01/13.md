### âœï¸ Tangxt â³ 2021-11-01 ğŸ·ï¸ å·¥ç¨‹åŒ–

# 13-å°è£…å·¥ä½œæµ - è§£å†³æ¨¡å—ä¸­çš„é—®é¢˜

## â˜…å°è£…å·¥ä½œæµ - è§£å†³æ¨¡å—ä¸­çš„é—®é¢˜

![è§£å†³æ¨¡å—ä¸­çš„é—®é¢˜](assets/img/2021-11-01-14-22-05.png)

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¦åšçš„äº‹æƒ…å°±æ˜¯å» -> æŠŠæˆ‘ä»¬æå–çš„è¿™ä¸ªå…¬å…±æ¨¡å—å„¿å½“ä¸­é‚£äº›ä¸åº”è¯¥è¢«æå–çš„ä¸œè¥¿å…¨éƒ¨ç»™å®ƒæŠ½å‡ºæ¥ã€‚

é¦–å…ˆç¬¬ä¸€ä¸ªå‘ç°çš„å°±æ˜¯è¿™ä¸ª `data` -> é‚£è¿™ä¸ª `data` æ€ä¹ˆè§£å†³å‘¢ï¼Ÿ

æˆ‘ä»¬åˆšåˆšè¯´äº†ï¼Œå°±æ˜¯é€šè¿‡**çº¦å®šå¤§äºé…ç½®**çš„æ–¹å¼ -> åœ¨æˆ‘ä»¬çš„é¡¹ç›®`zce-gulp-demo`çš„æ ¹ç›®å½•ä¸‹å»åˆ›å»ºä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶ååœ¨æˆ‘ä»¬è¿™ä¸ªæ¨¡å—å„¿`zce-pages`å½“ä¸­å»å°è¯•è¯»å–é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„é…ç½®æ–‡ä»¶ -> è¿™ä¸ªé…ç½®æ–‡ä»¶æˆ‘ä»¬å¯ä»¥æœ‰ä¸€ä¸ªåå­—çš„çº¦å®šï¼Œæ¯”å¦‚æˆ‘ä»¬å«åš`pages.config.js`

è¿™ä¸ªå…¶å®ä¹Ÿæ˜¯å¾ˆå¤šæˆ‘ä»¬å¸¸è§çš„é‚£äº›æˆç†Ÿçš„è¿™ç§è‡ªåŠ¨åŒ–æ„å»ºå·¥ä½œæµï¼Œæˆ–è€…è¯´è‡ªåŠ¨åŒ–çš„ä¸€äº›åº“çš„é…ç½®æ–‡ä»¶çš„å®ç° -> å¤§éƒ¨åˆ†éƒ½æ˜¯è¿™ç§æƒ…å†µã€‚ä¾‹å¦‚åƒé‚£ä¸ª `vue-cli` -> å®ƒåœ¨å…¬å¸ƒçš„æ—¶å€™å°±ä¼šå»è¯»å–ä½ é¡¹ç›®æ ¹æœ¬å½•ä¸‹çš„è¿™ä¸ª `vue.config.js` -> è¿™é“ç†å®é™…ä¸Šæ˜¯ä¸€æ ·çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬åœ¨å­¦ä¹ ä¸€ä¸ªä¸œè¥¿çš„è¿‡ç¨‹å½“ä¸­ï¼Œä¸€å®šè¦å­¦ä¼šä¸¾ä¸€åä¸‰ï¼Œé‚£è¿™æ ·çš„è¯ -> ä½ çš„**æ”¶è·ä¼šåŠ å€**ã€‚

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹ -> é¡¹ç›®è¿™è¾¹æˆ‘ä»¬çº¦å®šäº†æœ‰ä¸€ä¸ª `pages.config.js` -> æˆ‘ä»¬åœ¨è¿™ä¸ªæ–‡ä»¶å½“ä¸­å»æŠ½è±¡ä¸€ä¸‹é‚£äº›ä¸åº”è¯¥åœ¨å…¬å…±æ¨¡å—é‡Œé¢å‡ºç°çš„ä¸œè¥¿

é¦–å…ˆç¬¬ä¸€ä¸ªéœ€è¦å¯¼å‡ºçš„æ˜¯ä¸€ä¸ªæ•°æ®æˆå‘˜ -> æˆ‘ä»¬å¯¼å‡ºä¸€ä¸ª `data` -> è¿™ä¸ª `data` ç­‰äºæˆ‘ä»¬åŸæœ¬è¿™ä¸ªé¡¹ç›®å½“ä¸­ `data` çš„æˆå‘˜ã€‚ 

![data](assets/img/2021-11-01-15-20-52.png)

> å›¾ä¸­è¿™ä¸ªé…ç½®æ”¾çš„ä½ç½®æ˜¯é¡¹ç›®`zce-gulp-demo`é‡Œè¾¹ï¼Œå¯ä¸æ˜¯`t9o-pages`è¿™ä¸ªæ¨¡å—é‡Œè¾¹

`pages.config.js`é‡Œè¾¹çš„å…³äº`data`è¿™ä¸€æ®µä»£ç å®ƒä¼šå‡ºç°çš„æ˜¯æˆ‘ä»¬å½“å‰è¿™ä¸ªé¡¹ç›®ç›®å½•ä¸‹é¢ï¼Œæ‰€ä»¥`pages.config.js`å»æ‰¾å½“å‰ç›®å½•ä¸‹çš„è¿™ä¸ª `package.json` æ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„

ä¸ºå•¥è¦æŠŠ`data`è¿™æ”¾åˆ°`pages.config.js`è¿™é‡Œé¢ï¼Ÿ

ä¸€æ¥æ˜¯è¿è¡Œèƒ½è¿‡å¾—å»ã€‚äºŒæ¥æ˜¯è¿™äº›`data`æ•°æ®å®ƒæœ¬åº”è¯¥å±äºæˆ‘ä»¬è¿™ä¸ªé¡¹ç›®`zce-gulp-demo`ï¼Œè€Œä¸åº”è¯¥å±äºè¿™ä¸ªå…¬å…±çš„æ¨¡å—`zce-pages`ã€‚

æ‰€ä»¥åŸºäºè¿™ä¸¤ä¸ªåŸå› ï¼Œæˆ‘ä»¬æŠŠå®ƒæå–å‡ºæ¥äº†ã€‚

æå‡ºæ¥è¿‡åï¼Œæˆ‘ä»¬å›åˆ°æˆ‘ä»¬è¿™ä¸ªæ¨¡å—é‡Œé¢æ¥ -> è¿™ä¸ªæ—¶å€™è¿™ä¸ªæ¨¡å—é‡Œé¢å°±ç¼ºå°‘ä¸€ä¸ª `data` -> æ‰€ä»¥è¿™ä¸ª `data` å¯ä»¥æ€ä¹ˆæ¥å‘¢ï¼Ÿ

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬å°±éœ€è¦åŠ¨æ€çš„å» `require` ä¸€ä¸‹å½“å‰é¡¹ç›®ä¸‹çš„é‚£ä¸ª`pages.config.js` äº†

åšæ³•ä¹Ÿå¾ˆç®€å•ï¼Œæˆ‘ä»¬å…ˆå»å®šä¸€ä¸ªå˜é‡ï¼Œå«åš`cwd` -> è®©å®ƒç­‰äº`process.cwd`æ–¹æ³•çš„ä¸€ä¸ªè¿”å›å€¼ã€‚

`cwd` è¿™ä¸ªæ–¹æ³•å®ƒä¼šå»è¿”å›ä½ å½“å‰è¿™ä¸ªå‘½ä»¤è¡Œå®ƒæ‰€åœ¨çš„å·¥ä½œç›®å½• -> ä¾‹å¦‚æˆ‘ä»¬æ­¤æ—¶å»é€šè¿‡æˆ‘ä»¬åˆšåˆšé‚£ä¸ªå‘½ä»¤`yarn build`å»è¿è¡Œ -> è¿™ä¸ªæ—¶å€™å¯¹äº node æ¥è®²çš„è¯ï¼Œæˆ‘ä»¬çš„å‘½ä»¤è¡Œçš„å½“å‰å·¥ä½œç›®å½•ï¼Œå°±æ˜¯`zce-gulp-demo`è¿™ä¸ªç›®å½•

![cwd](assets/img/2021-11-01-15-31-08.png)

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸ª`process.cwd()`å»æ‹¿åˆ°å½“å‰å·¥ä½œç›®å½•ã€‚

æœ‰äº†è¿™ä¸ªå·¥ä½œç›®å½•è¿‡åï¼Œè¿™ä¸ªå·¥ä½œç›®å½•ä¸‹é¢å°±åº”è¯¥æœ‰ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•ç€å»è½½å…¥ä¸€ä¸‹è¿™ä¸ªé…ç½®æ–‡ä»¶ã€‚

åœ¨`index.js`é‡Œè¾¹æˆ‘ä»¬å¯ä»¥å» `let` ä¸€ä¸‹ -> ä¸ºä»€ä¹ˆç”¨ `let` å‘¢ï¼Ÿ

åŸå› å¾ˆç®€å•ï¼Œä½ å¾…ä¼šå»è¯»è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œä½ å¯ä»¥å»å°è¯•è¯»ã€‚ä½†æ˜¯ä¸‡ä¸€è¿™ä¸ªé¡¹ç›®æ²¡æœ‰é…ç½®æ–‡ä»¶çš„è¯ï¼Œé‚£ä½ è¿™ä¸ªä»£ç ä¸åº”è¯¥æŠ¥é”™ï¼Œä½ å¯ä»¥æœ‰ä¸€äº›é»˜è®¤çš„é…ç½®å‡ºç°ï¼Œé‚£è¿™æ ·è¯è‚¯å®šæ˜¯æ›´å¥å£®ä¸€äº›ã€‚

![é…ç½®æ–‡ä»¶](assets/img/2021-11-01-15-34-27.png)

æ‰€ä»¥è¯´æˆ‘ä»¬ `let` ä¸€ä¸ª `config` ç„¶ååœ¨ä¸‹é¢å» try ä¸€ä¸‹ -> é‚£ try ä»€ä¹ˆå‘¢ï¼Ÿ

try çš„å®é™…ä¸Šå°±æ˜¯ `require` çš„é‚£ä¸ªé…ç½®æ–‡ä»¶çš„æ“ä½œ

`require` ä¸€ä¸ªä¸å­˜åœ¨çš„åœ°å€çš„è¯ï¼Œé‚£å®ƒä¼šæŠ¥é”™ã€‚æ€»ä¹‹æˆ‘ä»¬ç”¨ `try catch` å»åŒ…è£…ä¸€ä¸‹ï¼š

![try catch](assets/img/2021-11-01-15-39-11.png)

è¿™é‡Œ`require`ä¸€ä¸ªé…ç½®æ–‡ä»¶çš„æœ€å¥½çš„æ–¹å¼ -> è¿˜æ˜¯åº”è¯¥ç”¨ `path.join` çš„æ–¹å¼å»æŠŠè¿™ä¸¤ä¸ªè·¯å¾„è¿æ¥åˆ°ä¸€èµ· -> æˆ‘ä»¬è¿™å„¿å°±ç›´æ¥é€šè¿‡è¿™ç§å­—ç¬¦ä¸²æ‹¼æ¥çš„æ–¹å¼å»èµ°äº†ã€‚ 

æœ‰äº†è¿™ä¸ªæ“ä½œè¿‡åï¼Œæ¥åˆ°`catch` -> è¿™é”™è¯¯æˆ‘ä»¬å®é™…ä¸Šæ˜¯ä¸éœ€è¦å»å¤„ç†çš„ã€‚å› ä¸ºä½ å¦‚æœèµ°äº†`try`ï¼Œ`try`å¤±è´¥äº†çš„è¯ï¼Œé‚£å®ƒè¿™ä¸ª`config`å¯¹è±¡å®é™…ä¸Šå°±æ˜¯ä¸€ä¸ªç©ºçš„å¯¹è±¡äº† -> å¦‚æœè¯´ä½ è¦æœ‰ä¸€äº›é»˜è®¤çš„é€‰é¡¹ï¼Œä½ å¯ä»¥æ”¾åˆ°`config`è¿™ä¸ªå¯¹è±¡é‡Œè¾¹ï¼Œç„¶åä½ å†é€šè¿‡è¿™ä¸ª `require` çš„æ–¹å¼å»è½½å…¥ã€‚

å½“ç„¶ï¼Œå¦‚æœè¯´ä½ æœ‰é»˜è®¤çš„é…ç½®è¯ï¼Œé‚£æœ€å¥½çš„æ–¹å¼è¿˜æ˜¯é€šè¿‡å¦å¤–ä¸€ç§æ–¹å¼ -> ä»€ä¹ˆæ ·çš„æ ·å¦å¤–ä¸€ç§æ–¹å¼å‘¢ï¼Ÿæˆ‘ç»™å¤§å®¶çœ‹ä¸€ä¸‹ã€‚

![åˆå¹¶é…ç½®](assets/img/2021-11-01-15-44-33.png)

> `Object.assign({}, {age: 18}, null)` -> `{age: 18}`

ä½ å¦‚æœæœ‰é»˜è®¤çš„é…ç½®ï¼Œé‚£è¿™ä¸ª`try`é‡Œé¢çš„é…ç½®åº”è¯¥è·Ÿæˆ‘ä»¬çš„é»˜è®¤é…ç½®åšä¸€ä¸ªåˆå¹¶ï¼Œè€Œä¸æ˜¯å»æŠŠå®ƒè¦†ç›–æ‰

æ‰€ä»¥æˆ‘ä»¬æœ€å¥½çš„æ–¹å¼åº”è¯¥æ˜¯é€šè¿‡`Object.assign`æ–¹æ³•å»åˆå¹¶ä¸¤ä¸ªå¯¹è±¡ã€‚æˆ‘ä»¬å…ˆä¼ ä¸€ä¸ªç©ºå¯¹è±¡ï¼Œè¿™æ ·çš„è¯ï¼Œè¿™å¤åˆ¶å‡ºæ¥å°±æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åæŠŠ `config` æ”¾åœ¨å‰é¢ï¼Œç„¶å `loadConfig` æ”¾åœ¨åé¢ -> é‚£è¿™æ ·çš„è¯ï¼Œ`loadConfig`å°±ä¼šè¦†ç›–æ‰ `config` é‡Œé¢çš„æˆå‘˜ï¼Œç„¶åå¾—åˆ°ä¸€ä¸ªæ–°çš„å¯¹è±¡ -> è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬è¿™ä¸ª `config` å°±æ˜¯ä¸€ä¸ªè¢«åˆå¹¶è¿‡åçš„ç»“æœäº†ã€‚

æ­¤æ—¶è¿™ä¸ª `config` é‡Œé¢å°±åº”è¯¥æœ‰ `data` -> é‚£æˆ‘ä»¬å°±å¯ä»¥æŠŠåé¢çš„è¿™ä¸ª `data` æ¢æˆ `config` çš„ `data`

æˆ‘ä»¬æ‰¾åˆ° `data` æ‰€åœ¨çš„ä½ç½®ï¼š

![data](assets/img/2021-11-01-15-49-11.png)

è¿™ä¸ªåœ°æ–¹å°±ä¸èƒ½å†ç”¨ç®€å†™çš„æ–¹å¼å»å†™äº†ï¼Œæˆ‘ä»¬å¿…é¡»è¦ç”¨ `data` ç­‰äº`config.data`

![config.data](assets/img/2021-11-01-15-50-51.png)

è¿™ä¸€æ­¥çš„æ”¹æ­£å·²ç»å®Œæˆäº†ï¼Œæˆ‘ä»¬å›åˆ°ç»ˆç«¯ï¼Œæˆ‘ä»¬å°è¯•ç€è¿è¡Œä¸€ä¸‹è¿™ä¸ª `build`

![error](assets/img/2021-11-01-15-55-21.png)

è¿™ä¸ªæ—¶å€™ä½ ä¼šå‘ç° `build` è¿™ä¸ªä»»åŠ¡å…¶å®å°±ä¸ä¼šå†å»æŠ¥åˆšåˆšé‚£æ ·ä¸€ä¸ªé”™è¯¯äº†ã€‚

ä½†æ˜¯å®ƒåˆæŠ¥äº†å¦å¤–ä¸€ä¸ªé”™è¯¯ï¼Œè¿™ä¸ªé”™è¯¯çš„ä¿¡æ¯æ˜¯ï¼š

> PluginError: Cannot find module '@babel/preset-env'

`@babel/preset-env`è¿™ä¸ªåå­—å…¶å®æˆ‘ä»¬åº”è¯¥å¾ˆç†Ÿæ‚‰ï¼Œå› ä¸ºæˆ‘ä»¬åˆšåˆšåˆ›å»ºè¿™ä¸ªå·¥ä½œæµçš„æ—¶å€™ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†è¿™ä¸ªæ¨¡å—ï¼Œè¿™ä¸ªæ¨¡å—å…¶å®å°±æ˜¯æˆ‘ä»¬åœ¨ä½¿ç”¨ babel çš„æ—¶å€™å»æŒ‡å®šçš„ä¸€ä¸ª `presets`

![presets](assets/img/2021-11-01-15-57-17.png)

è¿™ä¸ªé—®é¢˜å…¶å®ä¹Ÿå¥½è§£é‡Šï¼Œå¤§å®¶è¿™æ ·å»æƒ³ï¼š

ä¹‹å‰æˆ‘ä»¬å»åˆ›å»ºé‚£ä¸ªå·¥ä½œæµçš„æ—¶å€™æ²¡æœ‰é—®é¢˜ -> æˆ‘ä»¬åœ¨ `gulpfile` é‡Œé¢å»å®šä¹‰çš„é‚£ä¸ª babel çš„è½¬æ¢ -> å®ƒä¼šé€šè¿‡ `presets` å»æ‰¾å¯¹åº”çš„é‚£ä¸ª `preset` æ¨¡å—ï¼Œç„¶åé€šè¿‡è¿™ä¸ª `preset` å»è½¬æ¢æˆ‘ä»¬çš„é‚£ä¸ª ECMAScript çš„ä»£ç  -> è¿™ä¸ªæ—¶å€™å®ƒæ‰¾çš„è§„åˆ™æ˜¯åˆ°ä½ é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹çš„ `node_modules` é‡Œé¢å»æ‰¾ä¸€ä¸ªå«åš `@babel` ç„¶å `preset-env`è¿™ä¸ªæ¨¡å—ï¼Œä½†æ˜¯æ­¤æ—¶ä½ è¿™ä¸ªé¡¹ç›®ä¸‹é¢å¹¶æ²¡æœ‰ä¸€ä¸ª`@babel/preset-env`æ¨¡å—

è¿™ä¸ªæ¨¡å—å®ƒå·²ç»è¢«ä½ åˆšåˆšæå–çš„è¿™ä¸ªå…¬å…±æ¨¡å—`zce-pages`åŒ…è£…è¿›å»ï¼Œé‚£è¿™ä¸ªæ—¶å€™ä½ åœ¨é¡¹ç›®è¿™è¾¹å»ä½¿ç”¨çš„è¯ï¼Œå®ƒè‡ªç„¶è€Œç„¶å°±å‡ºäº†é—®é¢˜ã€‚

è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹å¼å¾ˆç®€å•ï¼Œæˆ‘ä»¬æŠŠè¿™ä¸ª `presets` é…ç½®åšä¸€ä¸ªä¿®æ”¹ -> `presets` å®ƒæœ€ç®€å•çš„æ–¹å¼æ˜¯ä¼ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œé‚£ babel å·¥ä½œçš„æ—¶å€™ä¼šè‡ªåŠ¨å» `node_modules`é‡Œé¢æ‰¾ã€‚

è¿˜æœ‰ä¸€ç§æ–¹å¼å°±æ˜¯ç›´æ¥å»è½½å…¥ä¸€ä¸ª `preset` å¯¹è±¡ -> é€šè¿‡ `require` çš„æ–¹å¼å»è½½å…¥å®ƒå°±å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚

![preset](assets/img/2021-11-01-16-12-18.png)

è¿™åŸå› å¾ˆç®€å•ï¼Œå› ä¸º `require` çš„æ–¹å¼å»æ‰¾è¿™ä¸ªæ¨¡å—ï¼Œå®ƒæ˜¯å…ˆåˆ°å½“å‰è¿™ä¸ª`index.js`æ–‡ä»¶æ‰€åœ¨çš„è¿™ä¸ªç›®å½•ï¼ˆ`lib`ç›®å½•ï¼‰

åœ¨ `lib` ç›®å½•ä¸‹å»æ‰¾æœ‰æ²¡æœ‰è¿™ä¸ª`@babel/preset-env`è¿™ä¸ªæ¨¡å— -> æ˜¾ç„¶ï¼Œè¿™è‚¯å®šæ˜¯æ²¡æœ‰çš„ -> æ¥ç€å®ƒä¼šä¾æ¬¡å¾€ä¸Šæ‰¾ï¼Œå¾€ä¸Šæ‰¾å°±æ˜¯`zce-pages`çš„æ ¹ç›®å½•äº†ã€‚

`zce-pages`æ¨¡å—çš„æ ¹ç›®å½•ä¸‹ -> `node_modules`æ——ä¸‹æœ‰ä¸€ä¸ª`@babel`ç›®å½•ï¼Œè¯¥ç›®å½•æ——ä¸‹ä½ å°±å¯ä»¥æ‰¾åˆ°è¿™ä¸ª`preset-env`æ¨¡å—ï¼š

![preset-env](assets/img/2021-11-01-16-15-09.png)

è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬è¿™ä¸ª`babel`æ“ä½œå°±å¯ä»¥æ­£å¸¸å»å·¥ä½œäº†ã€‚

å›åˆ°å‘½ä»¤è¡Œï¼Œæˆ‘ä»¬å†æ¥æ‰§è¡Œä¸€ä¸‹ `build`ï¼š

è¿™ä¸ªæ—¶å€™æˆ‘ä»¬çš„è¿™ä¸ª `build` ä»»åŠ¡å®ƒå°±å¯ä»¥æ­£å¸¸å¯åŠ¨ -> ç¨å¾®ç­‰å®ƒä¸€ä¸‹ï¼Œç­‰å®ƒç»“æŸ

![ç»„åˆä»»åŠ¡](assets/img/2021-11-01-16-19-20.png)

å¯èƒ½ä¼šæœ‰äººç–‘é—® -> ä¸ºä»€ä¹ˆè¿™ä¸ªåœ°æ–¹å®ƒå¯åŠ¨çš„æ—¶å€™æœ‰ `build` åå­—ï¼Œä½†æ˜¯ä¸­é—´é‚£äº›ç»„åˆä»»åŠ¡çš„å­åå­—å°±æ²¡æœ‰å‡ºç°å‘¢ï¼Ÿ

![zce-pages](assets/img/2021-11-01-16-21-24.png)

å› ä¸º gulp åœ¨å·¥ä½œçš„æ—¶å€™ï¼Œå®ƒæ˜¯æ ¹æ®ä½ çš„ `gulpfile` æ¨æ–­å‡ºä½ çš„è¿™äº›ä»»åŠ¡çš„åå­— -> è€Œä½ åˆšåˆšæ˜¯æŠŠè¿™äº›ä»»åŠ¡å…¨éƒ¨åŒ…è£…åˆ°äº†`zce-pages`é‡Œé¢ã€‚

è¿™å¯¹äºè¿™ä¸ª `gulpfile` æ¥è®²çš„è¯ï¼Œgulp å®ƒå°±çœ‹ä¸åˆ°é‚£ä¸ªä»»åŠ¡çš„åå­—ï¼Œå®ƒå”¯ä¸€çŸ¥é“çš„ä»»åŠ¡åå­—å°±æ˜¯ä½ å¯åŠ¨çš„è¿™ä¸ªä»»åŠ¡åå­—ï¼Œæ‰€ä»¥è¯´å®ƒå°±æ²¡æœ‰æ‰“å°é‚£äº›æ—¥å¿—ã€‚

å½“ç„¶ï¼Œé‚£äº›ä»»åŠ¡åå­—ï¼Œå…¶å®å¯¹å¤§å®¶æ¥è®²æœ‰æ„ä¹‰ï¼Œä½†ä¹Ÿæ²¡æœ‰æ„ä¹‰ã€‚

ä½ è¦æƒ³è¦å®ƒè¯ï¼Œä½ å¯ä»¥ç®€å•çš„é€šè¿‡è§£æ„çš„æ–¹å¼å»è§£æ„é‚£äº›ä»»åŠ¡ï¼Œç„¶åå†å•ç‹¬å»å¯¼å‡ºè¿™äº›ä»»åŠ¡ã€‚

``` js
const { taskName } = require('zce-pages')
```

è¿™æ ·çš„è¯ `gulpfile` å°±å¯ä»¥æ¨æ–­å‡ºè¿™äº›ä»»åŠ¡çš„åå­—äº†ã€‚ä½†æ˜¯è¿™å¯¹äºæˆ‘ä»¬æ¥è®²çš„è¯ï¼Œè¿™æ²¡æœ‰ä»€ä¹ˆå¤ªå¤§æ„ä¹‰ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™å°±ä¸ç”¨å»åšè¿™ä¸ªæ“ä½œäº†ã€‚

æ­¤æ—¶æˆ‘ä»¬é‡ç‚¹éœ€è¦å»å…³æ³¨ä¸€ä¸‹çš„å°±æ˜¯åˆšåˆšæå‡ºæ¥è¿™ä¸ªæ¨¡å—ï¼Œå®ƒèƒ½ä¸èƒ½å»æ»¡è¶³æˆ‘ä»¬çš„è¦æ±‚

æˆ‘ä»¬çœ‹ä¸€ä¸‹æœ€ç»ˆç”Ÿæˆçš„ `dist` é‡Œé¢ã€‚

é¦–å…ˆ `index` è¢«å‹ç¼©äº†æ˜¯æ­£å¸¸çš„ï¼š

![index](assets/img/2021-11-01-16-27-49.png)

ç„¶åå®Œäº†è¿‡åï¼Œæˆ‘ä»¬å†å»çœ‹ä¸€ä¸‹é‚£äº›æ•°æ®æœ‰æ²¡æœ‰è¢«æ›¿æ¢è¿›æ¥ã€‚

![cwd](assets/img/2021-11-01-16-55-07.png)

æ·»åŠ `cwd`åçš„æµ‹è¯•ï¼š

é¦–å…ˆè¿™ä¸ª`index`çš„æ ‡é¢˜é¡µæ˜¯æ²¡æœ‰ä»»ä½•é—®é¢˜çš„ï¼š

![index](assets/img/2021-11-01-16-58-27.png)

å¯¹äºæ ‡é¢˜æˆ‘ä»¬åœ¨ `layouts` é‡Œé¢æ˜¯è¿™æ ·å®šä¹‰çš„ï¼š

![layouts](assets/img/2021-11-01-17-00-12.png)

è¿™ä¸ªæ ‡é¢˜è¯»å–çš„æ˜¯`package.json`å½“ä¸­çš„ `name` ->  ç„¶ååé¢è¿™ä¸ªæ˜¯æ¨¡æ¿å¼•æ“çš„æ›¿æ¢è¯­æ³• -> æŠŠé‚£ç§ä¸­åˆ’çº¿å’Œä¸‹åˆ’çº¿æ›¿æ¢æˆç©ºæ ¼ -> æœ€åæŠŠå®ƒç”¨ `title` è¿™ç§æ–¹å¼å°±æ˜¯æ‰‹å†™å­—æ¯å¤§å†™çš„è¿™ç§æ–¹å¼å»è½¬æ¢äº†ä¸€ä¸‹ã€‚

![ç®¡é“ç¬¦](assets/img/2021-11-01-17-07-17.png)

å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ¨¡æ¿å¡«å……ä¹Ÿæ˜¯æ²¡æœ‰é—®é¢˜çš„ -> è¿™ä¹Ÿå°±æ„å‘³ç€æˆ‘ä»¬å¯¹è¿™ä¸ª `gulpfile` æå–æ˜¯ OK çš„ã€‚

---

å…³äºé‚£ä¸ª`imagemin`çš„é—®é¢˜ï¼Œæˆ‘å®‰è£…äº†æœ€æ–°çš„å®ƒ`^8.0.0`ï¼Œç»“æœåœ¨`yarn build`çš„æ—¶å€™ï¼š

![import](assets/img/2021-11-01-17-20-05.png)

åŸå…ˆçš„æ˜¯`"gulp-imagemin": "^6.1.0"`ç‰ˆæœ¬

![gulp-imagemin](assets/img/2021-11-01-17-32-41.png)

å¦‚ä½•ç”¨`import`ï¼Ÿ

![type](assets/img/2021-11-01-17-42-49.png)

æµ‹è¯•ï¼š

![æµ‹è¯•](assets/img/2021-11-01-17-43-40.png)

åŸå› ï¼š

![åŸå› ](assets/img/2021-11-01-17-47-14.png)

æœ€ç»ˆï¼Œæˆ‘è¿˜æ˜¯æ”¹ä¸º`^6.1.0`è¿™ä¸ªç‰ˆæœ¬

æ€»ä¹‹ï¼Œåœ¨ node åº”ç”¨é‡Œè¾¹ï¼Œé»˜è®¤çš„`js`æ–‡ä»¶ï¼Œé»˜è®¤ç”¨ `require`çš„ï¼Œæ˜¯ä¸èƒ½ç”¨ `import` çš„ï¼

å¦‚ä½•æ‰èƒ½å®‰è£…è¿™å››ä¸ªåŒ…ï¼Ÿ

* [gifsicle](https://github.com/imagemin/imagemin-gifsicle) â€” å‹ç¼© GIF å›¾åƒ
* [jpegtran](https://github.com/imagemin/imagemin-jpegtran) â€” å‹ç¼© JPEG å›¾åƒ
* [optipng](https://github.com/imagemin/imagemin-optipng) â€” å‹ç¼© PNG å›¾åƒ
* [svgo](https://github.com/imagemin/imagemin-svgo) â€” å‹ç¼© SVG å›¾åƒ

é…ç½®ä»£ç† -> ç›´æ¥åœ¨å‘½ä»¤è¡Œç»ˆç«¯æ‰§è¡Œè¿™ä¸ªï¼ˆè¿™ç§åšæ³•åªä½œç”¨äºå½“å‰ç»ˆç«¯ä¸­ï¼Œä¸ä¼šå½±å“ç¯å¢ƒï¼Œè€Œä¸”å‘½ä»¤æ¯”è¾ƒç®€å•ï¼‰ï¼š

``` bash
export http_proxy=http://127.0.0.1:1080;export https_proxy=http://127.0.0.1:1080;
```

> æ°¸ä¹…åšæ³•æ˜¯æ”¾åˆ°`.bashrc`é‡Œè¾¹

![ä»£ç†](assets/img/2021-11-01-18-43-07.png)

ç„¶åå®‰è£…è¿™å››ä¸ªåŒ…ï¼š

``` bash
yarn add imagemin-jpegtran imagemin-svgo imagemin-gifsicle imagemin-optipng
```

![å››ä¸ªåŒ…](assets/img/2021-11-01-18-44-15.png)

æ•ˆæœï¼š

![æ•ˆæœ](assets/img/2021-11-01-18-46-58.png)

äº†è§£æ›´å¤šï¼š

- [æŒ‰é”® requireï¼Œimport åŒºåˆ«ï¼Ÿ - å¯¸å¿—çš„å›ç­” - çŸ¥ä¹](https://www.zhihu.com/question/56820346/answer/150724784)
- [Node.js å¦‚ä½•å¤„ç† ES6 æ¨¡å— - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—](https://www.ruanyifeng.com/blog/2020/08/how-nodejs-use-es6-module.html)
- [sindresorhus/gulp-imagemin: Minify PNG, JPEG, GIF and SVG images](https://github.com/sindresorhus/gulp-imagemin)
- [è®° gulp-imagemin å®‰è£…æ—¶é‡åˆ°çš„é—®é¢˜ Â· Issue #8 Â· frmachao/frmachao.github.io](https://github.com/frmachao/frmachao.github.io/issues/8)
- [node-gyp çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ- çŸ¥ä¹](https://www.zhihu.com/question/36291768)
- [å…³äº NPM å®‰è£…æ¨¡å—å¤±è´¥çš„é—®é¢˜_çš®è›‹å¾ˆç™½çš„åšå®¢-CSDN åšå®¢_npm å®‰è£…å¤±è´¥](https://blog.csdn.net/u012961419/article/details/117926800)
- [NodeJS Imagemin - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/91035613)
- [gulp å¸¸ç”¨æ’ä»¶ä¹‹ gulp-imagemin ä½¿ç”¨](https://www.shuzhiduo.com/A/obzbPaq65E/)
- [gulp å¸¸ç”¨æ’ä»¶æ±‡æ€»](https://www.cnblogs.com/jiaoshou/p/12003709.html)
- [Linux è®©ç»ˆç«¯èµ°ä»£ç†çš„å‡ ç§æ–¹æ³• - çŸ¥ä¹](https://zhuanlan.zhihu.com/p/46973701)
