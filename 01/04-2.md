### ✍️ Tangxt ⏳ 2021-06-03 🏷️ functional programming

# 04-2-高阶函数（函数作为参数）、高阶函数（函数作为返回值）、高阶函数的意义、常用的高阶函数

## ★一些简单的认识

- `arr.forEach(()=>{})` -> 面向对象+函数式混合来搞，它们都有各自适合的场景，而且混合起来使用也不是不可以的！
- `forEach` -> 这个方法给我的感觉是，遍历一个数组里边所有的元素，每次我们只拿一个元素交给`callback`去处理，而不是多个元素 -> 其实为了符合数学中函数的定义，我们把`arguments`当作是一个输入，而不是多个输入然后输出一个值

## ★高阶函数（函数作为参数）

回顾 JS 中关于 FP 的第二个概念：高阶函数

讲什么？

1. 介绍一下什么是高阶函数
2. 介绍一下使用它的意义

1）介绍一下什么是高阶函数以及它的语法

高阶函数的英文名叫做「Higher-Order Function」

如果你学过 React，你就会知道 React 中的高阶组件叫做「[Higher-Order Component](https://reactjs.org/docs/higher-order-components.html)」

它们的名字很像，其实 React 提供的高阶组件本质上就是高阶函数

回过头来，高阶函数的定义非常简单：

- 可以把函数作为参数传递给另一个函数 -> 这个函数参数被称为「Callback function」
- 可以把函数作为另一个函数的返回结果 -> 这是函数是一等公民的特性

只要满足其中之一，那么这「另一个函数」就是一个高阶函数

语法示例：

``` js
// Pass a function as an Argument
function sayHello() {
   return "Hello, ";
}
function greeting(helloMessage, name) {
  console.log(helloMessage() + name);
}
// Pass `sayHello` as an argument to `greeting` function
greeting(sayHello, "JavaScript!");

// Return a function
function sayHello1() {
   return function() {
      console.log("Hello!");
   }
}
```

`greeting`和`sayHello1`都是高阶函数

2）函数作为参数的示例

在函数式编程的学习过程中，我们会写很多的函数，我们需要测试这些功能函数的运行结果，但是我们并不需要操作 DOM，所以我们使用 node 的环境来进行测试，总之，我们并不需要创建一个页面来去测试，毕竟用 node 来测试要更方便一些！

数组中其实有很多方法，而它们的参数就是一个函数，比如`forEach`、`filter`、`map`、`sort`等等

接下来通过模拟数组的`forEach`和`filter`来演示函数作为参数

1、forEach

`forEach`的功能是遍历数组当中的每一个元素，然后对每一个元素来进行相应的处理

模拟这个`forEach`函数：

1. 要接受几个参数
2. 每个参数分别是什么

我们要遍历数组，所以它会有一个数组参数，由于我们遍历这个数组，所以我们需要对数组的每一项做处理，但是每次调用`forEach`的时候，我们处理的方式是不同的，如：

1. 有可能要打印数组中的每一项
2. 也有可能把数组中的每一项赋给页面上指定的元素

所以我们还需要**传一个变化的内容** -> 所以它就是一个函数类型的值

因此，这个`forEach`有两个参数：

- `array`
- `fn`

``` js
function forEach (array, fn) {
  // 遍历数组，用函数处理数组中的每一个元素
  for (let i = 0; i < array.length; i++) {
    fn(array[i])
  }
}

// 测试
let arr = [1, 3, 4, 7, 8]

// 遍历数组 -> 打印数组中的每一个元素
forEach(arr, function (item) {
  console.log(item)
})

// 1
// 3
// 4
// 7
// 8
```

如果我们没有封装这个`forEach`，那么我们要完成这么一个需求就得这样来：

``` js
function fn(item) {
  console.log(item)
}
let array = [1, 3, 4, 7, 8]
for (let i = 0; i < array.length; i++) {
  fn(array[i])
}
```

可以看到，遍历一个数组是很麻烦的，需要使用`for`循环之类的，而现在直接就是调用一个`forEach`然后再进行相应的处理就完事儿了！

用了`forEach`后：

- 不需要使用`for`循环
- 不需要定义循环变量
- 语义也更直观一些，而且代码也更简洁一些

💡：`forEach`可以使用`break`退出循环吗？

> 什么是循环？ -> 循环编程解决了一个非常常见的问题：我需要对所有的这些数据运行相同的代码。 -> 即「一遍又一遍（循环）重复相同的代码，直到达到定义的结束状态。」

`for`循环是可以用`break`的，那`forEach`可以吗？

![break](assets/img/2021-06-07-09-14-33.png)

用了`break`就会报错：`SyntaxError: Illegal break statement`

为啥不能用`break`呢？ -> 因为`break`在`callback`，而`callback`每次执行都会返回一个结果，所以这并不会中断循环，因此，`break`或`continue`对于`forEach`而言，并不是有效语句

---

![The table I wish I had when I learned JavaScript iteration methods.](assets/img/2021-06-07-10-06-33.png)

> The table I wish I had when I learned JavaScript iteration methods.

有很多不同类型的循环，它们都有各种不同的目的，总之，你并不是总是需要`forEach`循环的！ -> `for...in`、`for...of`……

如`forEach`和`map`，`map`会返回一个新的`Array`，而 `forEach`则不会！

> 当你用函数式编程时，`every`或者`some`可以处理你用`break`这种场景 -> `every` 碰到`return false`的时候，循环中止 -> `some` 碰到`return ture`的时候，循环中止

ps：外国似乎都把`map, filter, forEach, reduce + loops`看作是 iteration methods

➹：[Why you can’t break a forEach loop in JavaScript](https://javascript.plainenglish.io/why-you-cant-break-a-foreach-loop-in-javascript-83f270269e1c)

➹：[JavaScript Quiz - can break statement work on array forEach method](https://jsstartup.com/can-break-statement-javascript-array-foreach-method/)

➹：[如何在 Array.forEach 的循环里 break](https://jser.me/2014/04/02/%E5%A6%82%E4%BD%95%E5%9C%A8Array.forEach%E7%9A%84%E5%BE%AA%E7%8E%AF%E9%87%8Cbreak.html)

➹：[Comparing JS iteration methods (map, filter, forEach, reduce + loops) - DEV Community 👩‍💻👨‍💻](https://dev.to/manumagalhaes/comparing-js-iteration-methods-map-filter-foreach-reduce-loops-le)

💡：`for`和`forEach`的性能比较？

我们真得需要考虑它们的性能吗？

> 除非是写引擎一类的性能要求极高的代码，否则用`map`，`filter`，`reduce` 这些可读性高，支持链调用的方法才是更佳选择。

> 首先这种性能测试方法可不可靠太难说了，一般情况下我是首选使用 `forEach/map/find/filter` 的，相比性能，我更在乎代码的语义是否更强， 而 `forEach/map/filter` 很容易让别人知道我是在做遍历、转换、筛选。

➹：[JavaScript Performance: For vs ForEach](https://www.symphonious.net/2010/10/09/javascript-performance-for-vs-foreach/)

➹：[Performance of JavaScript .forEach, .map and .reduce vs for and for..of](https://leanylabs.com/blog/js-forEach-map-reduce-vs-for-for_of/)

➹：[为什么普通 for 循环的性能远远高于 forEach 的性能？](https://juejin.cn/post/6844904159938887687)

💡：`map`、`filter`、`reduce`？

![map、filter、reduce](assets/img/2021-06-07-10-08-43.png)

![map、filter](assets/img/2021-06-07-10-14-06.png)

➹：[The JavaScript reduce Method - Nick McCullum](https://nickmccullum.com/javascript/javascript-reduce-method/)

➹：[How to use map, filter, and collect methods of Java Stream API](https://medium.com/javarevisited/how-to-use-streams-map-filter-and-collect-methods-in-java-1e13609a318b)

2、filter

![filter](assets/img/2021-06-07-10-16-49.png)

- `filter`的功能：过滤数组中满足条件的那些元素 -> `filter`内部也有对数组中的每一个元素进行循环遍历，并且把满足条件的那些元素先存储起来，最后再返回
- 如何实现？ -> 同样需要两个参数
  - 第一个参数：要去过滤的数组 -> `array`
  - 第二个参数：要满足什么样的条件 -> `fn`
    - 可能要去找这个数组中所有偶数项的数据
    - 也有可能去找奇数项的数据
    - 还有可能找这个数组中年龄超过 18 的那些人
    - ……
    - 所以我们需要让这个`filter`变得通用？ -> 然如何才能让这个函数变得通用呢？ -> 很简单，在变化的位置传一个函数就可以了，总之，怎么找满足条件的哪些元素？每次调用`filter`的时候是不一样的，因此传入一个函数`fn`就可以自定义条件化来过滤了……在`fn`中，你可以指定满足啥条件都行……

``` js
function filter(array, fn) {
  // 定义一个数组用来存储结果：寻找数组中满足条件的那些元素，然后把它们存储起来
  let results = [];
  // 遍历 array
  for (let i = 0; i < array.length; i++) {
    // 数组的每一项是否满足 fn 指定的条件？
    if (fn(array[i])) {
      results.push(array[i]);
    }
  }
  // 把满足条件的元素都返回出去，就像返回过滤后的东西，颗粒大的就不要了……
  return results;
}

// 测试
let arr = [1, 3, 4, 7, 8]

// 寻找数组中所有偶数的元素
// 要寻找的目标 + 找元素的条件
let r = filter(arr, function (item) {
  return item % 2 === 0
})

console.log(r) // [ 4, 8 ]
```

3）总结

高阶函数中，把函数作为参数的一个好处：

- 可以让我们的`forEach`函数变得更灵活 -> `callback`的不同，可以实现不同的效果
- 调用`forEach`时，不需要考虑它内部是如何实现的，`forEach`这个函数把内部实现的细节帮我们给屏蔽了，而且函数的名字是有实际意义的，如`forEach`由名字可知「它就是要去遍历」，而`filter`就是过滤

## ★高阶函数（函数作为返回值）

