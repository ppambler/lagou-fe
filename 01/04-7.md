### âœï¸ Tangxt â³ 2021-06-30 ðŸ·ï¸ functional programming

# 04-7-å‡½æ•°ç»„åˆ-ç»“åˆå¾‹ã€å‡½æ•°ç»„åˆ-è°ƒè¯•ã€Lodash-fp æ¨¡å—ã€Lodash-map æ–¹æ³•çš„å°é—®é¢˜

## â˜…å‡½æ•°ç»„åˆ-ç»“åˆå¾‹

å‡½æ•°ç»„åˆæ»¡è¦æ»¡è¶³ä¸€ä¸ªç‰¹ç‚¹â€”â€”**ç»“åˆå¾‹**ï¼ˆassociativityï¼‰

å•¥æ„æ€ï¼Ÿ -> æ•°å­¦ä¸­çš„ [ç»“åˆå¾‹](https://www.shuxuele.com/associative-commutative-distributive.html) æ˜¯å•¥æ„æ€ï¼Œå®ƒå°±æ˜¯å•¥æ„æ€

![ç»“åˆå¾‹](assets/img/2021-06-30-10-04-22.png)

ç®€å•æ¥è¯´å°±æ˜¯ï¼š

> æˆ‘ä»¬æ—¢å¯ä»¥æŠŠ `g` å’Œ `h` ç»„åˆï¼Œè¿˜å¯ä»¥æŠŠ `f` å’Œ `g` ç»„åˆï¼Œç»“æžœéƒ½æ˜¯ä¸€æ ·çš„

``` js
// ç»“åˆå¾‹ï¼ˆassociativityï¼‰
let f = compose(f, g, h);
let associative = compose(compose(f, g), h) == compose(f, compose(g, h));
// true
```

ðŸ‘‡ï¼šç”¨ Lodash é‡Œè¾¹çš„ API æ¼”ç¤ºè¿™ä¸ªç»“åˆå¾‹

![ç»“åˆå¾‹](assets/img/2021-06-30-10-11-46.png)

è¿™ä¸ªç»“åˆå¾‹å…¶å®žå°±æ˜¯æ•°å­¦ä¸­çš„ç»“åˆå¾‹ -> å…ˆç»“åˆå‰ä¸¤ä¸ªæ•°æˆ–è€…å…ˆç»“åˆåŽä¸¤ä¸ªæ•° -> ç»“æžœéƒ½æ˜¯ä¸€æ ·çš„

## â˜…å‡½æ•°ç»„åˆ-è°ƒè¯•

ç›®å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç»„åˆè§£å†³ä¸€äº›ç®€å•çš„é—®é¢˜

é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨å‡½æ•°ç»„åˆçš„æ—¶å€™ï¼Œå¦‚æžœå‡½æ•°æ‰§è¡Œçš„ç»“æžœè·Ÿæˆ‘ä»¬é¢„æœŸçš„ä¸ä¸€è‡´ï¼Œé‚£è¿™ä¸ªæ—¶å€™æˆ‘ä»¬è¯¥å¦‚ä½•è°ƒè¯•å‘¢ï¼Ÿ

![è°ƒè¯•](assets/img/2021-06-30-17-36-48.png)

ðŸ‘‡ï¼šæ¼”ç¤ºå¦‚ä½•è°ƒè¯•ç»„åˆå‡½æ•°

éœ€æ±‚ï¼š`'NEVER SAY DIE' --> 'never-say-die'`

æ€è·¯ï¼šæ ¹æ®ç©ºæ ¼åˆ†å‰²å®ƒï¼Œå°å†™åŒ–ï¼Œå†ç”¨`-`è¿žæŽ¥

ç”¨å¾ˆå¤šç§åšæ³•ï¼Œå¯ä»¥åšåˆ°ï¼Œå¦‚ï¼š

``` js
'NEVER SAY DIE'.split(' ').map((v,k)=>{ return v.toLowerCase() }).join('-') // "never-say-die"
```

ä½†åœ¨è¿™é‡Œæˆ‘ä»¬å…ˆæ¼”ç¤ºä¸€ä¸ªæœ‰ bug çš„ç‰ˆæœ¬ï¼š

> æ³¨æ„ï¼šåœ¨å‡½æ•°ç»„åˆçš„æ—¶å€™ -> éœ€è¦çš„æ˜¯ä¸€äº›åªæœ‰ä¸€ä¸ªå‚æ•°çš„çº¯å‡½æ•°

Step 1ï¼šç¡®å®šå°å‡½æ•°

- `_.split`éœ€è¦æŽ¥æ”¶å¤šä¸ªå‚æ•°ï¼Œæˆ‘ä»¬è¦æŠŠå®ƒæ”¹é€ æˆåªæŽ¥å—ä¸€ä¸ªå‚æ•°çš„å‡½æ•°ï¼Œè€Œä¸”æ•°æ®æ¯”éœ€è¦æ”¾åœ¨æœ€åŽä¸€ä½ï¼Œé»˜è®¤çš„`split`ï¼Œæ•°æ®æ˜¯ç¬¬ä¸€ä½ï¼Œè€Œåˆ†å‰²ç¬¦æ˜¯ç¬¬äºŒä½ -> éœ€è¦ç”¨æŸ¯é‡ŒåŒ–
  
  ![split](assets/img/2021-06-30-19-19-19.png)
  
- `_.toLower`æ˜¯å•å‚æ•°çš„å‡½æ•°ï¼Œä¸éœ€è¦æŸ¯é‡ŒåŒ–å®ƒ
- `_.join`éœ€è¦ä¸¤ä¸ªå‚æ•° -> ç¬¬ä¸€ä¸ªæ˜¯æ•°ç»„ï¼Œç¬¬äºŒä¸ªæ˜¯åˆ†éš”ç¬¦ -> å°è£…å®ƒï¼Œè®©è¿™ä¸¤ä¸ªå‚æ•°çš„ä½ç½®äº¤æ¢ä¸€ä¸‹ï¼Œæ¯•ç«Ÿæˆ‘ä»¬è¦æœ€åŽä¼ é€’æ•°æ®

``` js
// _.split()
const split = _.curry((sep, str) => _.split(str, sep))

// _.toLower()
const join = _.curry((sep, array) => _.join(array, sep))
```

ðŸ‘‡ï¼šæŠŠè¿™äº›å°å‡½æ•°ç»„åˆæˆä¸€ä¸ªæ–°çš„å‡½æ•°æ¥æ»¡è¶³æˆ‘ä»¬çš„éœ€æ±‚

Step 2ï¼šæŠŠå°å‡½æ•°ç»„åˆèµ·æ¥

![ç»„åˆå°å‡½æ•°](assets/img/2021-06-30-19-30-57.png)

å¯ä»¥çœ‹åˆ°è¾“å‡ºç»“æžœè·Ÿæˆ‘ä»¬é¢„æœŸçš„ç»“æžœç›¸å·®å¾ˆè¿œ

æ‰€ä»¥è¿™é—®é¢˜æ˜¯å‡ºåœ¨å“ªå„¿å‘¢ï¼Ÿæ˜¯`split`çš„é—®é¢˜ï¼Ÿ`toLower`çš„é—®é¢˜ï¼Ÿè¿˜æ˜¯`join`çš„é—®é¢˜ï¼Ÿ -> ä¸çŸ¥é“ï¼Œè€Œä¸”ç›®å‰ä¹Ÿä¸çŸ¥é“å¦‚ä½•è°ƒè¯•â€¦â€¦

å¦‚ä½•è°ƒè¯•ï¼Ÿ

![debugger](assets/img/2021-06-30-20-27-17.png)

``` js
console.log([ 'NEVER', 'SAY', 'DIE' ].toString().toLowerCase())
console.log(Array.from('never,say,die'))
console.log(Array.from('never,say,die').join('-'))

// never,say,die
// [
//   'n', 'e', 'v', 'e',
//   'r', ',', 's', 'a',
//   'y', ',', 'd', 'i',
//   'e'
// ]
// n-e-v-e-r-,-s-a-y-,-d-i-e
```

å¦‚ä½•è§£å†³è¿™ä¸ª bugï¼Ÿ -> è®©`toLower`çš„è¿”å›žå€¼æ˜¯ä¸€ä¸ªæ•°ç»„å‘—ï¼ -> ä½¿ç”¨`map`å‡½æ•°éåŽ†ï¼Œä¸ºæ¯ä¸ªå…ƒç´ `toLower`ä¸€ä¸‹

åšæ³•ï¼š

`_.map` -> éœ€è¦æŽ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼ˆæ•°ç»„å’Œ`callback`ï¼‰ -> å‚æ•°ä½ç½®äº’æ¢ã€äºŒæ¬¡å°è£…ã€æŸ¯é‡ŒåŒ–å®ƒ -> åœ¨ç»„åˆæ—¶å›ºå®šä¸€ä¸ª`callback`

![map](assets/img/2021-06-30-20-49-29.png)

> `array.map(function(currentValue, index, arr), thisValue)`

æ€»ä¹‹ï¼Œæˆ‘ä»¬é€šè¿‡`log`è¿™ä¸ªè¾…åŠ©å‡½æ•°ï¼Œå¯ä»¥è§‚å¯Ÿåˆ°æ¯ä¸€ä¸ªä¸­é—´å‡½æ•°æ‰§è¡Œçš„ç»“æžœ

ç„¶è€Œï¼ŒçŽ°åœ¨è¿˜æ˜¯æœ‰ä¸€ä¸ªé—®é¢˜çš„ï¼Œé‚£å°±æ˜¯å¦‚æžœç»„åˆçš„å‡½æ•°æ¯”è¾ƒå¤šï¼Œè¿™ä¸­é—´ç»“æžœå°±æ¯”è¾ƒå¤šäº†ï¼Œè¿™æ—¶å€™çœ‹`log`ä¼šåˆ†ä¸æ¸…è¿™ä¸ªå€¼æ˜¯å±žäºŽå“ªä¸ªä¸­é—´å‡½æ•°çš„è¾“å‡ºäº†ï¼

å®šä¹‰ä¸€ä¸ª`trace`å‡½æ•°ï¼š

![trace](assets/img/2021-06-30-20-59-35.png)

å¯ä»¥çœ‹åˆ°ç”¨äº†è¿™ä¸ª`trace`å‡½æ•°åŽï¼Œè°ƒè¯•ç»“æžœæ›´æ¸…æ™°äº† -> å…¶å®žå¦‚æžœæœ‰ä¸€ä¸ªç±»ä¼¼ Vue è°ƒè¯•å·¥å…·å°±å¥½äº†ï¼Œæˆ‘ä»¬ä¸ç”¨å†™`trace`ï¼Œå°±èƒ½é€šè¿‡å°å·¥å…·çŸ¥é“æ¯ä¸ªå°å‡½æ•°çš„è¾“å‡ºç»“æžœæ˜¯ä»€ä¹ˆäº†â€¦â€¦

å°ç»“ï¼š

- Lodash ä¸­çš„å°å‡½æ•°ç¬¦åˆæˆ‘ä»¬å¹³æ—¶ä½¿ç”¨å‡½æ•°çš„ä¹ æƒ¯ï¼Œä½†æ˜¯åœ¨ç”¨ç»„åˆçš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸èƒ½è¿™æ ·ç›´æŽ¥çš„ä½¿ç”¨å®ƒä»¬ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯¹å®ƒä»¬è¿›è¡Œäº†æ”¹é€  -> ä¹Ÿè®¸ä½ ä¼šæ„Ÿåˆ°å¾ˆä¸æ–¹ä¾¿ï¼Œæ¯•ç«Ÿéœ€è¦äºŒæ¬¡å°è£…ç„¶åŽ`curry`å®ƒä»¬ -> Lodash ä¸­æä¾›çš„ `fp` æ¨¡å—é‡Œè¾¹ï¼Œä¹Ÿæœ‰è¿™äº›å°å‡½æ•°ï¼Œæˆ‘ä»¬åœ¨ç»„åˆçš„æ—¶å€™ï¼Œå¯ä»¥ç›´æŽ¥ä½¿ç”¨å®ƒä»¬ï¼Œæ— é¡»äºŒæ¬¡å°è£…å†`curry`

## â˜…Lodash-fp æ¨¡å—

åœ¨ä½¿ç”¨å‡½æ•°ç»„åˆçš„æ—¶å€™ï¼Œä¼šä½¿ç”¨åˆ° Lodash ä¸­æä¾›çš„ä¸€äº›æ–¹æ³•ï¼Œä½†æ˜¯ï¼Œè¿™äº›æ–¹æ³•å¦‚æžœæœ‰å¤šä¸ªå‚æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦å¯¹è¿™äº›æ–¹æ³•è¿›è¡ŒæŸ¯é‡ŒåŒ–çš„å¤„ç†äº† -> è¿™äº›æ–¹æ³•æˆ‘ä»¬éœ€è¦é‡æ–°åŒ…è£…ï¼Œè€Œä¸”ç¨å¾®æœ‰äº›éº»çƒ¦

å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Ÿ -> Lodash ä¸­çš„`fp`æ¨¡å—å¯ä»¥è§£å†³ï¼

1ï¼‰lodash/fp

- Lodash çš„ `fp` æ¨¡å—æä¾›äº†å®žç”¨çš„å¯¹å‡½æ•°å¼ç¼–ç¨‹æ›´åŠ å‹å¥½çš„æ–¹æ³•
- æä¾›äº†`immutable auto-curried iteratee-first data-last` çš„æ–¹æ³• -> å¦‚æžœä¸€ä¸ªæ–¹æ³•çš„å‚æ•°æ˜¯å‡½æ•°ï¼Œé‚£å°±ä¼šè¦æ±‚å‡½æ•°ä¼˜å…ˆï¼Œæ•°æ®æ»žåŽ

ðŸ‘‡ï¼šç”¨ä»£ç æ¼”ç¤º`fp`æ¨¡å—ä¸‹æ–¹æ³•çš„ç‰¹ç‚¹

ðŸ’¡ï¼šlodash æ¨¡å— vs lodash/fp æ¨¡å—

![fp æ¨¡å—](assets/img/2021-07-01-10-48-05.png)

ç»™`fp.split`ä¼ é€’äº†ä¸€ä¸ªå‚æ•°ï¼Œå…¶è¿”å›žå€¼ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°`fp.split`æ˜¯ä¸€ä¸ªå·²ç»æŸ¯é‡ŒåŒ–åŽçš„å‡½æ•°

è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»äº†è§£åˆ° lodash/fp æ¨¡å—ä¸­æä¾›çš„è¿™äº›æ–¹æ³•è¯¥å¦‚ä½•åŽ»ä½¿ç”¨ä»¥åŠ`auto-curried iteratee-first data-last`è¿™ä¸‰ä¸ªç‰¹æ€§ï¼

ðŸ‘‡ï¼šä½¿ç”¨ lodash/fp æ¨¡å—ä¸­çš„æ–¹æ³•åšä¸€ä¸ªæ¡ˆä¾‹

ðŸ’¡ï¼š'NEVER SAY DIE' --> 'never-say-die'

åŽŸå…ˆçš„åšæ³• -> å¾ˆéº»çƒ¦ -> éœ€è¦äºŒæ¬¡å°è£…æ–¹æ³•ï¼Œæ”¹é€ æˆå‡½æ•°ä¼˜å…ˆï¼Œæ•°æ®ç½®åŽï¼Œè€Œä¸”è¿˜å¾—æŸ¯é‡ŒåŒ–è¿™ä¸ªå°è£…çš„æ–¹æ³•

çŽ°åœ¨çš„åšæ³• -> ç›´æŽ¥æ‹¿å°å‡½æ•°åŽ»ç»„åˆå°±å®Œäº‹äº†ï¼

![ç»„åˆ](assets/img/2021-07-01-11-01-51.png)

å°ç»“ï¼š

- `fp`æ¨¡å—
  - æä¾›äº†å¯¹å‡½æ•°å¼ç¼–ç¨‹å‹å¥½çš„æ–¹æ³•
  - æä¾›çš„è¿™äº›æ–¹æ³•éƒ½æ˜¯å·²ç»è¢«æŸ¯é‡ŒåŒ–çš„
  - å¦‚æžœå‚æ•°æ˜¯å¤šä¸ªçš„ï¼Œéƒ½æ˜¯å‡½æ•°ä¼˜å…ˆï¼Œæ•°æ®ç½®åŽ
  - è¿™äº›æ–¹æ³•éƒ½å¯ä»¥åœ¨å‡½æ•°ç»„åˆçš„æ—¶å€™ï¼Œç›´æŽ¥ä½¿ç”¨

## â˜…Lodash-map æ–¹æ³•çš„å°é—®é¢˜

ðŸ’¡ï¼š`parsetInt`ï¼Ÿ

- ä½œç”¨ï¼šè§£æžç»™å®šçš„å­—ç¬¦ä¸² -> è¿”å›žä¸€ä¸ªæŒ‡å®šåŸºæ•°çš„åè¿›åˆ¶æ•´æ•°
- è¯­æ³•ï¼š`parseInt(string)`ã€`parseInt(string, radix)`
  - `string`ï¼šè¦è§£æžçš„å€¼ï¼Œéžå­—ç¬¦ä¸²å†…éƒ¨ä¼šå…ˆè½¬åŒ–ä¸ºå­—ç¬¦ä¸²å¤„ç†ï¼Œå¼€å¤´ç»“å°¾çš„ç©ºæ ¼ä¼šè¢«å¿½ç•¥
  - `radix`ï¼šå¯é€‰å‚æ•°ï¼Œæ•°å­—åŸºæ•°ï¼Œå¯ä»¥ç†è§£ä¸ºè¿›åˆ¶ï¼ŒèŒƒå›´ä¸º`2~36`

``` js
parseInt("123", 6)  //51 æŠŠå­—ç¬¦ä¸²çœ‹ä½œæ˜¯ 6 è¿›åˆ¶ï¼Œ6 è¿›åˆ¶è½¬ 10 è¿›åˆ¶
parseInt("123", 10) //123 æŒ‰åè¿›åˆ¶å¤„ç†
parseInt("123", 16) //291 æŒ‰åå…­è¿›åˆ¶å¤„ç†
```

å¦‚æžœï¼š

- `radix`ä¸å¡«ï¼Œåˆ™é»˜è®¤æŠŠå­—ç¬¦ä¸²çœ‹ä½œæ˜¯ 10 è¿›åˆ¶ï¼Œæ³¨æ„`10`å¹¶ä¸æ˜¯é»˜è®¤å€¼ï¼Œå› ä¸ºå¦‚æžœå­—ç¬¦ä¸²æ˜¯ä»¥`0x`å¼€å¤´çš„ï¼Œé‚£ä¹ˆæ­¤æ—¶é»˜è®¤å€¼å°±æ˜¯`16`äº† -> `parseInt("123", 16) === parseInt("0x123")`
- å­—ç¬¦ä¸²ä»¥`0`å¼€å¤´ï¼Œä»Ž ES5 å¼€å§‹éƒ½å¤„ç†ä¸º `10` è¿›åˆ¶ï¼ŒçŽ°åœ¨å¤§éƒ¨åˆ†æµè§ˆå™¨éƒ½å¤„ç†ä¸º `10` è¿›åˆ¶
- `radix`ä¸º`x`ï¼Œå­—ç¬¦ä¸²ä¸­çš„æ•°å­—æœ‰è¶…è¿‡äº† `radix` å¡«å†™çš„è¿›åˆ¶æ•°å­—`x`ï¼Œå¦‚`x`ä¸º`2`ï¼Œé‚£å­—ç¬¦ä¸­å‡ºçŽ°äº†å¤§äºŽ`1`çš„å­—ç¬¦ï¼Œé‚£è¿™è¯¥å¦‚ä½•å¤„ç†å‘¢ï¼Ÿ -> ä»Žç¬¬ä¸€ä½å¼€å§‹çœ‹ï¼Œä¸€ç›´çœ‹åˆ°ä¸æ˜¯å¤§äºŽ`1`çš„å­—ç¬¦ï¼Œå¦‚æžœç¬¬ä¸€ä½å°±ä¸æ»¡è¶³äº†ï¼Œé‚£å°±è¿”å›ž`NaN`
  - `parseInt("123", 2) // 1`
  - `parseInt("213", 2) // NaN`
  - `parseInt("113", 2) // 3`
- `radix`è¶…è¿‡èŒƒå›´
  - å¦‚`37`ï¼Œä¸ç®¡å­—ç¬¦ä¸²å¦‚ä½•ï¼Œéƒ½è¿”å›ž`NaN`
    - `parseInt("123", 37) // NaN`
  - å¦‚`1`ï¼ŒåŒä¸Š
    - `parseInt("123", 1) // NaN`
  - `0`æ˜¯ç‰¹æ®Šæƒ…å†µï¼Œä¼šæŠŠ`123`çœ‹ä½œæ˜¯`10`è¿›åˆ¶ï¼Œå¦‚æžœæ˜¯`0x`å¼€å¤´ï¼Œé‚£å°±`16`è¿›åˆ¶
    - `parseInt("123", 0) // 123`
    - `parseInt("0x123", 0) // 291`
  - å¦‚`undefined`æˆ–`null` -> è·Ÿä¸å†™ç¬¬äºŒä¸ªå‚æ•°æ²¡å•¥åŒºåˆ«ï¼Œå½“ç„¶`0`ä¹Ÿæ˜¯å¦‚æ­¤
    - `parseInt("123", undefined) // 123`
    - `parseInt("0x123", undefined) // 291`
    - `parseInt("123", null) // 123`
    - `parseInt("0x123", null) // 291`

`["1", "2", "3"].map(parseInt)`çš„è¾“å‡ºï¼š`[1, NaN, NaN]`

åŽŸå› ï¼š[å¯é€‰å‚æ•°](http://www.wirfs-brock.com/allen/posts/166) æ˜¯å±é™©çš„

``` js
// parseInt -> (string,radix) => {}
// map å®šä¹‰çš„ callback -> (currentValue[, index[, array]]) => {}

["1", "2", "3"].map(parseInt)
// <=> 
["1", "2", "3"].map((string,radix) => { })
```
