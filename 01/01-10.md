### ✍️ Tangxt ⏳ 2021-05-24 🏷️ es6

# 01-10-for...of 循环、可迭代接口、实现可迭代接口、迭代器模式、生成器、生成器应用

## ★循环、迭代、遍历、递归

> loop、iterate、traversal、recursion，都于重复（repeat）有关，但它们又不是完全存粹地的重复

- 遍历：遍历是对数据结构的一种操作。它是访问数据结构（如数组、链表或任何数据结构）中出现的每个元素的**过程** -> 爷爷去玩具大厦遍历玩具店集合为孙子买最好的玩具，做法可有从 1 楼到三楼这样的顺序去买，也可以有先去二楼再去三楼最后再到一楼去买，总之不管怎么逛，只要保证每家店都去过一次、不重复去，就完成了整个遍历的过程了！ -> **依次**对集合中的每个元素**做且仅做**一次访问
- 循环：是遍历的一种手段 -> 从容器里边一次又一次**连续不断地**拿元素 -> 不断地重复操作 -> 爷爷去 A 店为孙子买玩具，买回去一个，孙子说不喜欢，爷爷再去 A 店买，买回来了，孙子又说不喜欢……如此循环……直到孙子说喜欢 -> **每次去买玩具的目标、行为都一样，这叫循环**
- 迭代：是遍历的一种手段 -> 从容器里边一次又一次**非要间断地**拿元素 -> 存在变化地重复操作 -> 爷爷去**小卖铺**为孙子买玩具，买回去一个，孙子说不喜欢，询问得知，孙子喜欢「乐高的玩具」，于是爷爷去了**大超市**买，买回去后，孙子又说不喜欢，再次询问得知「孙子喜欢乐高玩具中最贵的那个玩具」，于是爷爷就去了**奢侈品商店**给他买了乐高限量版玩具，拿回家后孩子很满意 -> **每次去买玩具都跟上一次不一样，或是有了新的目标，或是缩小了搜寻范围，这叫迭代**
- 递归：自己调用自己 -> 生成它的代码是迭代，分形的效果是递归 -> 先递后归 -> 面前有 1000 个爷爷手工制作的玩具，爷爷往这中间挑了 500 个认为孙子可能喜欢的，爸爸从这 500 个里边，挑了 50 个认为儿子可能喜欢的，儿子从 50 个里边挑了一个自己最喜欢的，儿子告诉爸爸「我要几个，叫爷爷寄过来」，爸爸告诉爷爷「您孙子喜欢那个机器猫玩具」 -> **都是为了缩小范围，找到合适的玩具**

➹：[「递归」和「迭代」有哪些区别？ - CyrusCao 的回答 - 知乎](https://www.zhihu.com/question/20278387/answer/109266159)

➹：[js 迭代和遍历有什么区别？ - 知乎](https://www.zhihu.com/question/39854900)

➹：[What is traversing? - Quora](https://www.quora.com/What-is-traversing)

➹：[xdmala/02.md ppambler/xdmala](https://github.com/ppambler/xdmala/blob/dc00620a2e986a64edc6d14d28412fbab7eeba40/12-%E7%A2%8E%E7%89%87%E7%9F%A5%E8%AF%86/02.md)

➹：[基本计算规则 vs 程序 vs 机器？](https://ppambler.github.io/icourse163/freshman/01-%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%93%E4%B8%9A%E5%AF%BC%E8%AE%BA/01-%E8%AE%A1%E7%AE%97%E6%9C%BA%E3%80%81%E8%AE%A1%E7%AE%97%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%80%9D%E7%BB%B4/04-%E4%BA%BA%E8%AE%A1%E7%AE%97%E4%B8%8E%E6%9C%BA%E5%99%A8%E8%87%AA%E5%8A%A8%E8%AE%A1%E7%AE%97-%E4%B8%8B.html)

## ★for...of 循环

1）概述

在 ES 中，遍历数据有很多种方法

比如：

1. 最基本的`for`循环 -> 它比较适用于去遍历普通的数组
2. `for...in`循环 -> 它比较适合去遍历键值对
3. 一些函数式的遍历方法（一些对象的遍历方法） -> 数组对象的`forEach`方法

这些各种各样遍历数据的方式都会有一定的局限性

所以 ES2015 借鉴了很多其它的语言，引入了一种全新的遍历方式——`for...of`循环

**这种循环方式以后会作为遍历所有数据结构的统一方式**

换句话说，只要你明白`for...of`内部的工作原理，那你就可以使用这种循环去遍历任何一种自定义的数据结构

在介绍`for...of`原理之前，先来了解`for of`的基本用法

2）基本用法

> `for...of`：for...of
> 
> xx：for...in

💡：定义一个数组，通过 `for...of` 去遍历一下这个数组当中的每一个元素

``` js
const arr = [100, 200, 300, 400]

for (const item of arr) {
  console.log(item)
}

// 100
// 200
// 300
// 400

// 把 of 改为 in ，那么 log 就是
// 0
// 1
// 2
// 3
```

不同于传统的 `for...in` 循环，`for...of` 循环拿到的是数组当中的每一个元素，而不是对应的下标

而这种循环方式就可以取代我们之前常用的数组实例当中的`forEach`方法，而且相比于`forEach`方法，`for...of` 可以使用`break`关键词随时去终止循环，而`forEach`方法是无法去终止遍历的（也就是说无法跳出循环）

``` js
// for...of 循环可以替代 数组对象的 forEach 方法

const arr = [100, 200, 300, 400]

arr.forEach(item => {
  console.log(item)
})

// 100
// 200
// 300
// 400

for (const item of arr) {
  console.log(item)
  if (item > 100) {
    break
  }
}

// 100
// 200
```

以前我们为了能够随时终止遍历，我们必须要去使用数组实例的`some`方法或者是`every`方法

- 在`some`方法的回调函数当中返回`true`
- 在`every`方法的回调函数当中返回`false`

都可以去终止遍历！

``` js
// forEach 无法跳出循环，必须使用 some 或者 every 方法

const arr = [100, 200, 300, 400]

// arr.forEach() // 不能跳出循环

arr.some((item)=>{
  console.log(item)
  if(item > 100) {
    return true
  }
  // return item > 100
})
console.log(arr)
console.log('---')
arr.every((item)=>{
  console.log(item)
  if(item > 100) {
    return false
  }
  // return true
})
console.log(arr)

// 100
// 200
// [ 100, 200, 300, 400 ]
// ---
// 100
// [ 100, 200, 300, 400 ]
```

> `every`方法不返回，也就是返回`undefined` -> `falsy`值 -> 终止循环，如果你返回一个`true`，那么这就表示继续下一轮循环
> 
> 这两个方法都没有副作用！

而`forEach`的回调函数当中，无论返回`true`还是`false`，这都无法去终止遍历！

而这个 `for...of` 当中，我们直接就可以使用`break`关键词去随时终止循环了！

除了数组可以被我们的 `for...of` 去遍历，一些伪数组对象也是可以直接使用 `for...of` 去遍历的

比如：

- 在函数当中的`arguments`对象
- 在 DOM 操作时，一些元素节点的列表
- ……

遍历这些东西都跟普通的数组遍历没有任何的区别……

💡：遍历 ES2015 新增的 Set/Map 对象？

遍历 Set 对象：

``` js
// 遍历 Set 与遍历数组相同

// 通过一个数组去初始化 Set 当中的一些初始数据
const s = new Set(['foo', 'bar'])

// 用 for...of 循环遍历这个 Set
for (const item of s) {
  console.log(item)
}

// foo
// bar
```

遍历 Set 跟遍历数组没啥区别，每次迭代所拿到都是当前元素本身

---

遍历 Map 对象：

``` js
// 遍历 Map 可以配合数组解构语法，直接获取键值

// 创建 Map 对象
const m = new Map()

// 设置键值
m.set('foo', '123')
m.set('bar', '345')

// 遍历 Map 对象
// 每次遍历都会得到一个数组，而且这个数组当中总是两个成员
// 这两个成员分别是当前被遍历的键和值
// 遍历的是一个键值结构，一般在循环体当中都需要用到键和值，因此它是以数组的形式来提供键和值的！
for (const item of m) {
  console.log(item)
}

// [ 'foo', '123' ]
// [ 'bar', '345' ]

// 配合数组的解构语法，直接拿到这个数组当中的键和值
// 这样一来，在遍历 Map 对象时就可以使用对应的键值了
// 而这也是遍历 Map 和遍历数组之间的细微差异……
for (const [key, value] of m) {
  console.log(key, value)
}

// foo 123
// bar 345
```

💡：遍历最普通的对象？

``` js
// 普通对象不能被直接 for...of 遍历

// 定义一个普通对象，并随意添加一些属性
const obj = { foo: 123, bar: 456 }

// 遍历这个 obj 对象
for (const item of obj) {
  console.log(item)
}

// TypeError: obj is not iterable
```

可以看到报错了 -> `obj`对象是不可被迭代的

我们之前说过 `for...of` 可以作为遍历所有数据结构的统一方式，然现在通过实验发现，它连最基本的普通对象都没有办法去遍历，所以这究竟是为什么呢？

![why](assets/img/2021-05-26-21-07-09.png)

## ★可迭代接口
