### âœï¸ Tangxt â³ 2021-05-24 ğŸ·ï¸ es6

# 01-10-for...of å¾ªç¯ã€å¯è¿­ä»£æ¥å£ã€å®ç°å¯è¿­ä»£æ¥å£ã€è¿­ä»£å™¨æ¨¡å¼ã€ç”Ÿæˆå™¨ã€ç”Ÿæˆå™¨åº”ç”¨

## â˜…å¾ªç¯ã€è¿­ä»£ã€éå†ã€é€’å½’

> loopã€iterateã€traversalã€recursionï¼Œéƒ½äºé‡å¤ï¼ˆrepeatï¼‰æœ‰å…³ï¼Œä½†å®ƒä»¬åˆä¸æ˜¯å®Œå…¨å­˜ç²¹åœ°çš„é‡å¤

- éå†ï¼šéå†æ˜¯å¯¹æ•°æ®ç»“æ„çš„ä¸€ç§æ“ä½œã€‚å®ƒæ˜¯è®¿é—®æ•°æ®ç»“æ„ï¼ˆå¦‚æ•°ç»„ã€é“¾è¡¨æˆ–ä»»ä½•æ•°æ®ç»“æ„ï¼‰ä¸­å‡ºç°çš„æ¯ä¸ªå…ƒç´ çš„**è¿‡ç¨‹** -> çˆ·çˆ·å»ç©å…·å¤§å¦éå†ç©å…·åº—é›†åˆä¸ºå­™å­ä¹°æœ€å¥½çš„ç©å…·ï¼Œåšæ³•å¯æœ‰ä» 1 æ¥¼åˆ°ä¸‰æ¥¼è¿™æ ·çš„é¡ºåºå»ä¹°ï¼Œä¹Ÿå¯ä»¥æœ‰å…ˆå»äºŒæ¥¼å†å»ä¸‰æ¥¼æœ€åå†åˆ°ä¸€æ¥¼å»ä¹°ï¼Œæ€»ä¹‹ä¸ç®¡æ€ä¹ˆé€›ï¼Œåªè¦ä¿è¯æ¯å®¶åº—éƒ½å»è¿‡ä¸€æ¬¡ã€ä¸é‡å¤å»ï¼Œå°±å®Œæˆäº†æ•´ä¸ªéå†çš„è¿‡ç¨‹äº†ï¼ -> **ä¾æ¬¡**å¯¹é›†åˆä¸­çš„æ¯ä¸ªå…ƒç´ **åšä¸”ä»…åš**ä¸€æ¬¡è®¿é—®
- å¾ªç¯ï¼šæ˜¯éå†çš„ä¸€ç§æ‰‹æ®µ -> ä»å®¹å™¨é‡Œè¾¹ä¸€æ¬¡åˆä¸€æ¬¡**è¿ç»­ä¸æ–­åœ°**æ‹¿å…ƒç´  -> ä¸æ–­åœ°é‡å¤æ“ä½œ -> çˆ·çˆ·å» A åº—ä¸ºå­™å­ä¹°ç©å…·ï¼Œä¹°å›å»ä¸€ä¸ªï¼Œå­™å­è¯´ä¸å–œæ¬¢ï¼Œçˆ·çˆ·å†å» A åº—ä¹°ï¼Œä¹°å›æ¥äº†ï¼Œå­™å­åˆè¯´ä¸å–œæ¬¢â€¦â€¦å¦‚æ­¤å¾ªç¯â€¦â€¦ç›´åˆ°å­™å­è¯´å–œæ¬¢ -> **æ¯æ¬¡å»ä¹°ç©å…·çš„ç›®æ ‡ã€è¡Œä¸ºéƒ½ä¸€æ ·ï¼Œè¿™å«å¾ªç¯**
- è¿­ä»£ï¼šæ˜¯éå†çš„ä¸€ç§æ‰‹æ®µ -> ä»å®¹å™¨é‡Œè¾¹ä¸€æ¬¡åˆä¸€æ¬¡**éè¦é—´æ–­åœ°**æ‹¿å…ƒç´  -> å­˜åœ¨å˜åŒ–åœ°é‡å¤æ“ä½œ -> çˆ·çˆ·å»**å°å–é“º**ä¸ºå­™å­ä¹°ç©å…·ï¼Œä¹°å›å»ä¸€ä¸ªï¼Œå­™å­è¯´ä¸å–œæ¬¢ï¼Œè¯¢é—®å¾—çŸ¥ï¼Œå­™å­å–œæ¬¢ã€Œä¹é«˜çš„ç©å…·ã€ï¼Œäºæ˜¯çˆ·çˆ·å»äº†**å¤§è¶…å¸‚**ä¹°ï¼Œä¹°å›å»åï¼Œå­™å­åˆè¯´ä¸å–œæ¬¢ï¼Œå†æ¬¡è¯¢é—®å¾—çŸ¥ã€Œå­™å­å–œæ¬¢ä¹é«˜ç©å…·ä¸­æœ€è´µçš„é‚£ä¸ªç©å…·ã€ï¼Œäºæ˜¯çˆ·çˆ·å°±å»äº†**å¥¢ä¾ˆå“å•†åº—**ç»™ä»–ä¹°äº†ä¹é«˜é™é‡ç‰ˆç©å…·ï¼Œæ‹¿å›å®¶åå­©å­å¾ˆæ»¡æ„ -> **æ¯æ¬¡å»ä¹°ç©å…·éƒ½è·Ÿä¸Šä¸€æ¬¡ä¸ä¸€æ ·ï¼Œæˆ–æ˜¯æœ‰äº†æ–°çš„ç›®æ ‡ï¼Œæˆ–æ˜¯ç¼©å°äº†æœå¯»èŒƒå›´ï¼Œè¿™å«è¿­ä»£**
- é€’å½’ï¼šè‡ªå·±è°ƒç”¨è‡ªå·± -> ç”Ÿæˆå®ƒçš„ä»£ç æ˜¯è¿­ä»£ï¼Œåˆ†å½¢çš„æ•ˆæœæ˜¯é€’å½’ -> å…ˆé€’åå½’ -> é¢å‰æœ‰ 1000 ä¸ªçˆ·çˆ·æ‰‹å·¥åˆ¶ä½œçš„ç©å…·ï¼Œçˆ·çˆ·å¾€è¿™ä¸­é—´æŒ‘äº† 500 ä¸ªè®¤ä¸ºå­™å­å¯èƒ½å–œæ¬¢çš„ï¼Œçˆ¸çˆ¸ä»è¿™ 500 ä¸ªé‡Œè¾¹ï¼ŒæŒ‘äº† 50 ä¸ªè®¤ä¸ºå„¿å­å¯èƒ½å–œæ¬¢çš„ï¼Œå„¿å­ä» 50 ä¸ªé‡Œè¾¹æŒ‘äº†ä¸€ä¸ªè‡ªå·±æœ€å–œæ¬¢çš„ï¼Œå„¿å­å‘Šè¯‰çˆ¸çˆ¸ã€Œæˆ‘è¦å‡ ä¸ªï¼Œå«çˆ·çˆ·å¯„è¿‡æ¥ã€ï¼Œçˆ¸çˆ¸å‘Šè¯‰çˆ·çˆ·ã€Œæ‚¨å­™å­å–œæ¬¢é‚£ä¸ªæœºå™¨çŒ«ç©å…·ã€ -> **éƒ½æ˜¯ä¸ºäº†ç¼©å°èŒƒå›´ï¼Œæ‰¾åˆ°åˆé€‚çš„ç©å…·**

â¹ï¼š[ã€Œé€’å½’ã€å’Œã€Œè¿­ä»£ã€æœ‰å“ªäº›åŒºåˆ«ï¼Ÿ - CyrusCao çš„å›ç­” - çŸ¥ä¹](https://www.zhihu.com/question/20278387/answer/109266159)

â¹ï¼š[js è¿­ä»£å’Œéå†æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ - çŸ¥ä¹](https://www.zhihu.com/question/39854900)

â¹ï¼š[What is traversing? - Quora](https://www.quora.com/What-is-traversing)

â¹ï¼š[xdmala/02.md ppambler/xdmala](https://github.com/ppambler/xdmala/blob/dc00620a2e986a64edc6d14d28412fbab7eeba40/12-%E7%A2%8E%E7%89%87%E7%9F%A5%E8%AF%86/02.md)

â¹ï¼š[åŸºæœ¬è®¡ç®—è§„åˆ™ vs ç¨‹åº vs æœºå™¨ï¼Ÿ](https://ppambler.github.io/icourse163/freshman/01-%E8%AE%A1%E7%AE%97%E6%9C%BA%E4%B8%93%E4%B8%9A%E5%AF%BC%E8%AE%BA/01-%E8%AE%A1%E7%AE%97%E6%9C%BA%E3%80%81%E8%AE%A1%E7%AE%97%E4%B8%8E%E8%AE%A1%E7%AE%97%E6%80%9D%E7%BB%B4/04-%E4%BA%BA%E8%AE%A1%E7%AE%97%E4%B8%8E%E6%9C%BA%E5%99%A8%E8%87%AA%E5%8A%A8%E8%AE%A1%E7%AE%97-%E4%B8%8B.html)

## â˜…for...of å¾ªç¯

1ï¼‰æ¦‚è¿°

åœ¨ ES ä¸­ï¼Œéå†æ•°æ®æœ‰å¾ˆå¤šç§æ–¹æ³•

æ¯”å¦‚ï¼š

1. æœ€åŸºæœ¬çš„`for`å¾ªç¯ -> å®ƒæ¯”è¾ƒé€‚ç”¨äºå»éå†æ™®é€šçš„æ•°ç»„
2. `for...in`å¾ªç¯ -> å®ƒæ¯”è¾ƒé€‚åˆå»éå†é”®å€¼å¯¹
3. ä¸€äº›å‡½æ•°å¼çš„éå†æ–¹æ³•ï¼ˆä¸€äº›å¯¹è±¡çš„éå†æ–¹æ³•ï¼‰ -> æ•°ç»„å¯¹è±¡çš„`forEach`æ–¹æ³•

è¿™äº›å„ç§å„æ ·éå†æ•°æ®çš„æ–¹å¼éƒ½ä¼šæœ‰ä¸€å®šçš„å±€é™æ€§

æ‰€ä»¥ ES2015 å€Ÿé‰´äº†å¾ˆå¤šå…¶å®ƒçš„è¯­è¨€ï¼Œå¼•å…¥äº†ä¸€ç§å…¨æ–°çš„éå†æ–¹å¼â€”â€”`for...of`å¾ªç¯

**è¿™ç§å¾ªç¯æ–¹å¼ä»¥åä¼šä½œä¸ºéå†æ‰€æœ‰æ•°æ®ç»“æ„çš„ç»Ÿä¸€æ–¹å¼**

æ¢å¥è¯è¯´ï¼Œåªè¦ä½ æ˜ç™½`for...of`å†…éƒ¨çš„å·¥ä½œåŸç†ï¼Œé‚£ä½ å°±å¯ä»¥ä½¿ç”¨è¿™ç§å¾ªç¯å»éå†ä»»ä½•ä¸€ç§è‡ªå®šä¹‰çš„æ•°æ®ç»“æ„

åœ¨ä»‹ç»`for...of`åŸç†ä¹‹å‰ï¼Œå…ˆæ¥äº†è§£`for...of`çš„åŸºæœ¬ç”¨æ³•

2ï¼‰åŸºæœ¬ç”¨æ³•

> `for...of`ï¼šfor...of
> 
> `for...of`ï¼šfor...in

ğŸ’¡ï¼šå®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œé€šè¿‡ `for...of` å»éå†ä¸€ä¸‹è¿™ä¸ªæ•°ç»„å½“ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ 

``` js
const arr = [100, 200, 300, 400]

for (const item of arr) {
  console.log(item)
}

// 100
// 200
// 300
// 400

// æŠŠ of æ”¹ä¸º in ï¼Œé‚£ä¹ˆ log å°±æ˜¯
// 0
// 1
// 2
// 3
```

ä¸åŒäºä¼ ç»Ÿçš„ `for...in` å¾ªç¯ï¼Œ`for...of` å¾ªç¯æ‹¿åˆ°çš„æ˜¯æ•°ç»„å½“ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ï¼Œè€Œä¸æ˜¯å¯¹åº”çš„ä¸‹æ ‡

è€Œè¿™ç§å¾ªç¯æ–¹å¼å°±å¯ä»¥å–ä»£æˆ‘ä»¬ä¹‹å‰å¸¸ç”¨çš„æ•°ç»„å®ä¾‹å½“ä¸­çš„`forEach`æ–¹æ³•ï¼Œè€Œä¸”ç›¸æ¯”äº`forEach`æ–¹æ³•ï¼Œ`for...of` å¯ä»¥ä½¿ç”¨`break`å…³é”®è¯éšæ—¶å»ç»ˆæ­¢å¾ªç¯ï¼Œè€Œ`forEach`æ–¹æ³•æ˜¯æ— æ³•å»ç»ˆæ­¢éå†çš„ï¼ˆä¹Ÿå°±æ˜¯è¯´æ— æ³•è·³å‡ºå¾ªç¯ï¼‰

``` js
// for...of å¾ªç¯å¯ä»¥æ›¿ä»£ æ•°ç»„å¯¹è±¡çš„ forEach æ–¹æ³•

const arr = [100, 200, 300, 400]

arr.forEach(item => {
  console.log(item)
})

// 100
// 200
// 300
// 400

for (const item of arr) {
  console.log(item)
  if (item > 100) {
    break
  }
}

// 100
// 200
```

ä»¥å‰æˆ‘ä»¬ä¸ºäº†èƒ½å¤Ÿéšæ—¶ç»ˆæ­¢éå†ï¼Œæˆ‘ä»¬å¿…é¡»è¦å»ä½¿ç”¨æ•°ç»„å®ä¾‹çš„`some`æ–¹æ³•æˆ–è€…æ˜¯`every`æ–¹æ³•

- åœ¨`some`æ–¹æ³•çš„å›è°ƒå‡½æ•°å½“ä¸­è¿”å›`true`
- åœ¨`every`æ–¹æ³•çš„å›è°ƒå‡½æ•°å½“ä¸­è¿”å›`false`

éƒ½å¯ä»¥å»ç»ˆæ­¢éå†ï¼

``` js
// forEach æ— æ³•è·³å‡ºå¾ªç¯ï¼Œå¿…é¡»ä½¿ç”¨ some æˆ–è€… every æ–¹æ³•

const arr = [100, 200, 300, 400]

// arr.forEach() // ä¸èƒ½è·³å‡ºå¾ªç¯

arr.some((item)=>{
  console.log(item)
  if(item > 100) {
    return true
  }
  // return item > 100
})
console.log(arr)
console.log('---')
arr.every((item)=>{
  console.log(item)
  if(item > 100) {
    return false
  }
  // return true
})
console.log(arr)

// 100
// 200
// [ 100, 200, 300, 400 ]
// ---
// 100
// [ 100, 200, 300, 400 ]
```

> `every`æ–¹æ³•ä¸è¿”å›ï¼Œä¹Ÿå°±æ˜¯è¿”å›`undefined` -> `falsy`å€¼ -> ç»ˆæ­¢å¾ªç¯ï¼Œå¦‚æœä½ è¿”å›ä¸€ä¸ª`true`ï¼Œé‚£ä¹ˆè¿™å°±è¡¨ç¤ºç»§ç»­ä¸‹ä¸€è½®å¾ªç¯
> 
> è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ²¡æœ‰å‰¯ä½œç”¨ï¼

è€Œ`forEach`çš„å›è°ƒå‡½æ•°å½“ä¸­ï¼Œæ— è®ºè¿”å›`true`è¿˜æ˜¯`false`ï¼Œè¿™éƒ½æ— æ³•å»ç»ˆæ­¢éå†ï¼

è€Œè¿™ä¸ª `for...of` å½“ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥å°±å¯ä»¥ä½¿ç”¨`break`å…³é”®è¯å»éšæ—¶ç»ˆæ­¢å¾ªç¯äº†ï¼

é™¤äº†æ•°ç»„å¯ä»¥è¢«æˆ‘ä»¬çš„ `for...of` å»éå†ï¼Œä¸€äº›ä¼ªæ•°ç»„å¯¹è±¡ä¹Ÿæ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨ `for...of` å»éå†çš„

æ¯”å¦‚ï¼š

- åœ¨å‡½æ•°å½“ä¸­çš„`arguments`å¯¹è±¡
- åœ¨ DOM æ“ä½œæ—¶ï¼Œä¸€äº›å…ƒç´ èŠ‚ç‚¹çš„åˆ—è¡¨
- â€¦â€¦

éå†è¿™äº›ä¸œè¥¿éƒ½è·Ÿæ™®é€šçš„æ•°ç»„éå†æ²¡æœ‰ä»»ä½•çš„åŒºåˆ«â€¦â€¦

ğŸ’¡ï¼šéå† ES2015 æ–°å¢çš„ Set/Map å¯¹è±¡ï¼Ÿ

éå† Set å¯¹è±¡ï¼š

``` js
// éå† Set ä¸éå†æ•°ç»„ç›¸åŒ

// é€šè¿‡ä¸€ä¸ªæ•°ç»„å»åˆå§‹åŒ– Set å½“ä¸­çš„ä¸€äº›åˆå§‹æ•°æ®
const s = new Set(['foo', 'bar'])

// ç”¨ for...of å¾ªç¯éå†è¿™ä¸ª Set
for (const item of s) {
  console.log(item)
}

// foo
// bar
```

éå† Set è·Ÿéå†æ•°ç»„æ²¡å•¥åŒºåˆ«ï¼Œæ¯æ¬¡è¿­ä»£æ‰€æ‹¿åˆ°éƒ½æ˜¯å½“å‰å…ƒç´ æœ¬èº«

---

éå† Map å¯¹è±¡ï¼š

``` js
// éå† Map å¯ä»¥é…åˆæ•°ç»„è§£æ„è¯­æ³•ï¼Œç›´æ¥è·å–é”®å€¼

// åˆ›å»º Map å¯¹è±¡
const m = new Map()

// è®¾ç½®é”®å€¼
m.set('foo', '123')
m.set('bar', '345')

// éå† Map å¯¹è±¡
// æ¯æ¬¡éå†éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªæ•°ç»„ï¼Œè€Œä¸”è¿™ä¸ªæ•°ç»„å½“ä¸­æ€»æ˜¯ä¸¤ä¸ªæˆå‘˜
// è¿™ä¸¤ä¸ªæˆå‘˜åˆ†åˆ«æ˜¯å½“å‰è¢«éå†çš„é”®å’Œå€¼
// éå†çš„æ˜¯ä¸€ä¸ªé”®å€¼ç»“æ„ï¼Œä¸€èˆ¬åœ¨å¾ªç¯ä½“å½“ä¸­éƒ½éœ€è¦ç”¨åˆ°é”®å’Œå€¼ï¼Œå› æ­¤å®ƒæ˜¯ä»¥æ•°ç»„çš„å½¢å¼æ¥æä¾›é”®å’Œå€¼çš„ï¼
for (const item of m) {
  console.log(item)
}

// [ 'foo', '123' ]
// [ 'bar', '345' ]

// é…åˆæ•°ç»„çš„è§£æ„è¯­æ³•ï¼Œç›´æ¥æ‹¿åˆ°è¿™ä¸ªæ•°ç»„å½“ä¸­çš„é”®å’Œå€¼
// è¿™æ ·ä¸€æ¥ï¼Œåœ¨éå† Map å¯¹è±¡æ—¶å°±å¯ä»¥ä½¿ç”¨å¯¹åº”çš„é”®å€¼äº†
// è€Œè¿™ä¹Ÿæ˜¯éå† Map å’Œéå†æ•°ç»„ä¹‹é—´çš„ç»†å¾®å·®å¼‚â€¦â€¦
for (const [key, value] of m) {
  console.log(key, value)
}

// foo 123
// bar 345
```

ğŸ’¡ï¼šéå†æœ€æ™®é€šçš„å¯¹è±¡ï¼Ÿ

``` js
// æ™®é€šå¯¹è±¡ä¸èƒ½è¢«ç›´æ¥ for...of éå†

// å®šä¹‰ä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œå¹¶éšæ„æ·»åŠ ä¸€äº›å±æ€§
const obj = { foo: 123, bar: 456 }

// éå†è¿™ä¸ª obj å¯¹è±¡
for (const item of obj) {
  console.log(item)
}

// TypeError: obj is not iterable
```

å¯ä»¥çœ‹åˆ°æŠ¥é”™äº† -> `obj`å¯¹è±¡æ˜¯ä¸å¯è¢«è¿­ä»£çš„

æˆ‘ä»¬ä¹‹å‰è¯´è¿‡ `for...of` å¯ä»¥ä½œä¸ºéå†æ‰€æœ‰æ•°æ®ç»“æ„çš„ç»Ÿä¸€æ–¹å¼ï¼Œç„¶ç°åœ¨é€šè¿‡å®éªŒå‘ç°ï¼Œå®ƒè¿æœ€åŸºæœ¬çš„æ™®é€šå¯¹è±¡éƒ½æ²¡æœ‰åŠæ³•å»éå†ï¼Œæ‰€ä»¥è¿™ç©¶ç«Ÿæ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

![why](assets/img/2021-05-26-21-07-09.png)

## â˜…å¯è¿­ä»£æ¥å£

> Iterable

ä¹‹å‰è¯´åˆ°ï¼Œ`for...of` æ˜¯ ES2015 ä¸­æœ€æ–°æ¨å‡ºçš„ä¸€ç§å¾ªç¯è¯­æ³•ï¼Œå®ƒæ˜¯ä¸€ç§éå†æ‰€æœ‰æ•°æ®ç»“æ„çš„ç»Ÿä¸€æ–¹å¼

![`for...of`](assets/img/2021-05-26-23-20-02.png)

ä½†ç»è¿‡æˆ‘ä»¬çš„å®é™…å°è¯•ï¼Œæˆ‘ä»¬å‘ç°å®ƒåªèƒ½å¤Ÿå»éå†æ•°ç»„ä¹‹ç±»çš„æ•°æ®ç»“æ„ï¼Œè€Œå¯¹äºæ™®é€šå¯¹è±¡ï¼Œå¦‚æœç›´æ¥å»éå†å®ƒï¼Œé‚£å°±ä¼šæŠ¥ä¸€ä¸ªé”™è¯¯

æ‰€ä»¥è¿™ç©¶ç«Ÿæ˜¯ zce è¯´é”™äº†ï¼Ÿè¿˜æ˜¯æœ‰ä»€ä¹ˆç‰¹æ®ŠåŸå› å‘¢ï¼Ÿ

1ï¼‰åŸå› 

ES ä¸­èƒ½å¤Ÿç”¨äºå»è¡¨ç¤ºæœ‰ç»“æ„çš„æ•°æ®ç±»å‹è¶Šæ¥è¶Šå¤šäº†ï¼Œä»æœ€æ—©çš„æ•°æ®å’Œå¯¹è±¡ï¼Œåˆ°ç°åœ¨æ–°å¢çš„ Setã€Mapï¼Œè€Œä¸”æˆ‘ä»¬å¼€å‘è€…è¿˜å¯ä»¥ç»„åˆä½¿ç”¨è¿™äº›ç±»å‹å»å®šä¹‰ä¸€äº›ç¬¦åˆè‡ªå·±ä¸šåŠ¡éœ€æ±‚çš„æ•°æ®ç»“æ„

ä¸ºäº†æä¾›ä¸€ç§ç»Ÿä¸€çš„éå†æ–¹å¼ï¼ŒES2015 å°±æå‡ºäº†ä¸€ä¸ªå«åšã€ŒIterableã€æ¥å£ -> å…¶æ„æ€å°±æ˜¯ã€Œå¯è¿­ä»£çš„ã€

![Iterable](assets/img/2021-05-26-23-31-11.png)

å¦‚æœä½ ä¸å¤ªç†è§£ç¼–ç¨‹è¯­è¨€å½“ä¸­çš„ã€Œæ¥å£ã€æ¦‚å¿µï¼Œé‚£ä¹ˆä½ å¯ä»¥æŠŠå®ƒç†è§£æˆä¸€ç§è§„æ ¼æ ‡å‡†ï¼Œå¦‚åœ¨ ES ä¸­ï¼Œä»»æ„ä¸€ç§æ•°æ®ç±»å‹ï¼Œå®ƒéƒ½æœ‰`toString`æ–¹æ³•ï¼Œè€Œè¿™å°±æ˜¯å› ä¸ºå®ƒä»¬éƒ½å®ç°äº†ç»Ÿä¸€çš„è§„æ ¼æ ‡å‡†

è€Œåœ¨ç¼–ç¨‹è¯­è¨€å½“ä¸­ï¼Œæ›´ä¸“ä¸šçš„è¯´æ³•å°±æ˜¯å®ƒä»¬éƒ½å®ç°äº†ç»Ÿä¸€çš„æ¥å£

è€Œæ‰€è°“çš„**å¯è¿­ä»£æ¥å£å°±æ˜¯ä¸€ç§å¯ä»¥è¢« `for...of` å¾ªç¯ç»Ÿä¸€éå†è®¿é—®çš„è§„æ ¼æ ‡å‡†**ï¼Œæ¢è¨€ä¹‹ï¼Œåªè¦è¿™ä¸ªæ•°æ®ç»“æ„å®ƒå®ç°äº†å¯è¿­ä»£æ¥å£ï¼Œé‚£ä¹ˆå®ƒå°±èƒ½å¤Ÿè¢« `for...of` å¾ªç¯å»éå†

![æ¥å£](assets/img/2021-05-26-23-40-46.png)

è¿™æ„å‘³ç€æˆ‘ä»¬ä¹‹å‰æ‰€å°è¯•çš„é‚£äº›èƒ½å¤Ÿç›´æ¥è¢« `for...of` å¾ªç¯å»éå†çš„æ•°æ®ç±»å‹ï¼Œå®ƒéƒ½å·²ç»åœ¨å†…éƒ¨å®ç°äº†è¿™ä¸ªæ¥å£

> å…¶å®å°±æ˜¯ä½ éµå®ˆäº†ã€ŒIteration protocolsã€ï¼Œé‚£ä¹ˆä½ å°±æ‹¥æœ‰äº†ä»€ä¹ˆèƒ½åŠ›â€¦â€¦ -> æœ‰ä¸¤ç§åè®®ï¼šã€Œiterable protocol ã€ã€ã€Œiterator protocolã€

è„±ç¦»æ‰ `for...of` å¾ªç¯çš„è¡¨è±¡ -> çœ‹çœ‹è¿™ä¸ªå«åšã€ŒIterableã€çš„æ¥å£åˆ°åº•çº¦å®šäº†å“ªäº›å†…å®¹â€¦â€¦

2ï¼‰Iterable æ¥å£æ‰€çº¦å®šçš„å†…å®¹

ğŸ’¡ï¼šå¦‚ä½•åœ¨ VSCode é‡Œè¾¹ä½¿ç”¨æµè§ˆå™¨çš„æ§åˆ¶å°ï¼Ÿ

ä¸ºå•¥è¦è¿™æ ·åšï¼Ÿ -> å› ä¸ºåœ¨æµè§ˆå™¨çš„æ§åˆ¶å°å½“ä¸­å¯ä»¥æ›´å®¹æ˜“çš„çœ‹åˆ°å¯¹è±¡å†…éƒ¨çš„ç»“æ„

å¦‚ä½•åˆ‡æ¢ -> `Help -> Toggle Developer Tools`

VSCode æœ¬èº«å°±æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨æµè§ˆå™¨æ ¸å½“ä¸­çš„ä¸€ä¸ª Web åº”ç”¨ï¼Œæ‰€ä»¥è¿™ä¸ªå¼€å‘è€…å·¥å…·è·Ÿ Chrome é‡Œè¾¹çš„å¼€å‘è€…å·¥å…·æ˜¯å®Œå…¨ç›¸åŒçš„ï¼ è€Œæˆ‘ä»¬ä¹‹æ‰€ä»¥ä¸ç”¨æµè§ˆå™¨ï¼Œæ˜¯å› ä¸ºé¿å…æµè§ˆå™¨å’Œç¼–è¾‘å™¨æ¥å›åˆ‡æ¢ï¼

ğŸ’¡ï¼šæ‰“å°ä¸€ä¸‹å¯ä»¥è¢« `for...of` å¾ªç¯éå†çš„å‡ ç§ä¸åŒç±»å‹çš„æ•°æ®ï¼Ÿ

å®ƒä»¬éƒ½å®ç°äº†ç›¸åŒçš„è§„æ ¼æ ‡å‡†ï¼Œé‚£å®ƒä»¬çš„å†…éƒ¨è‚¯å®šä¼šä¸€äº›å…±åŒçš„å±æ€§

![å…±æœ‰çš„å±æ€§](assets/img/2021-05-27-10-58-53.png)

æ•°ç»„å¯¹è±¡æœ¬èº«æ²¡å•¥å±æ€§ï¼Œå°±ä¸€ä¸ª`length`ï¼Œè€Œå®ƒçš„åŸå‹å¯¹è±¡ä¸Šæœ‰å¾ˆå¤šå±æ€§ï¼Œå…¶ä¸­æœ‰ä¸ªå«`Symbol(Symbol.iterator)`çš„å±æ€§ï¼Œè¯¥å±æ€§çš„åå­—å«åš`iterator`ï¼Œæ ¹æ®è¿™ä¸ªåå­—ï¼Œä¼¼ä¹è·Ÿæˆ‘ä»¬æ‰€è¯´çš„ã€Œè¿­ä»£ã€æœ‰ç‚¹å…³ç³» -> å®ƒçš„å€¼æ˜¯ä¸€ä¸ªå‡½æ•°

ç”¨åŒæ ·åœ°å§¿åŠ¿æŸ¥æ‰¾ï¼Œå‘ç°`Set`å¯¹è±¡ã€`Map`å¯¹è±¡ä¹Ÿæœ‰ä¸€ä¸ªç›¸åŒçš„è¿­ä»£å™¨æ–¹æ³•

æ ¹æ®è¿™ä¸¤ä¸ªç†ç”±ï¼š

1. è¿™ä¸‰ä¸ªå¯ä»¥ç›´æ¥è¢« `for...of` å¾ªç¯éå†çš„å¯¹è±¡å½“ä¸­éƒ½æœ‰è¿™ä¹ˆä¸€ä¸ªæ–¹æ³•
2. è¿™ä¸ªæ–¹æ³•çš„åå­—å«`iterator`

æˆ‘ä»¬å¯ä»¥åŸºæœ¬ç¡®å®šï¼Œ**Iterable æ¥å£çº¦å®šçš„å°±æ˜¯æˆ‘ä»¬å¯¹è±¡å½“ä¸­å¿…é¡»è¦å»æŒ‚è½½ä¸€ä¸ªå«åš`iterator`çš„æ–¹æ³•**

è¯è¯´ï¼Œè¿™ä¸ªæ–¹æ³•åˆ°åº•æ˜¯å¹²ä»€ä¹ˆçš„å‘¢ï¼Ÿ

ğŸ’¡ï¼šå®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œæ‰‹åŠ¨è°ƒç”¨å®ƒçš„`iterator`æ–¹æ³•ï¼Œçœ‹çœ‹å®ƒè¿”å›çš„åˆ°åº•æ˜¯ä¸ªå•¥ï¼Ÿ

è¿™ä¸ªæ–¹æ³•æˆå‘˜çš„åå­—æ˜¯ä¸€ä¸ªå…¨å±€çš„`Symbol`å¸¸é‡ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡`Symbol`çš„`iterable`å±æ€§ç›´æ¥æ‹¿åˆ° -> æ‹¿åˆ°åå°±ç›´æ¥è°ƒç”¨å‘—ï¼

![Array Iterable](assets/img/2021-05-27-11-12-33.png)

è¿™ä¸ªã€Œæ•°ç»„çš„è¿­ä»£å™¨å¯¹è±¡ã€å½“ä¸­æœ‰ä¸€ä¸ª`next`æ–¹æ³•ï¼Œæ‰‹åŠ¨è°ƒç”¨è¿™ä¸ªè¿™ä¸ª`next`æ–¹æ³•ï¼Œçœ‹çœ‹å®ƒåˆ°åº•æ˜¯å¹²å˜›çš„ï¼š

![next](assets/img/2021-05-27-11-16-50.png)

æˆ‘ä»¬å®šä¹‰ä¸€ä¸ª`iterator`å˜é‡å»æ¥æ”¶è¿”å›çš„è¿­ä»£å™¨å¯¹è±¡ï¼Œç„¶åè°ƒç”¨è¿™ä¸ªè¿­ä»£å™¨å¯¹è±¡çš„`next`æ–¹æ³• -> `iterator.next()`

æ­¤æ—¶è¿™ä¸ªæ–¹æ³•è¿”å›çš„åˆæ˜¯ä¸€ä¸ªå¯¹è±¡`{value: "foo", done: false}` -> è¿™ä¸ªå¯¹è±¡å½“ä¸­æœ‰ä¸¤ä¸ªæˆå‘˜ï¼Œåˆ†åˆ«æ˜¯`value`å’Œ`done`ï¼Œè€Œä¸”`value`å½“ä¸­çš„å€¼å°±æ˜¯æ•°ç»„å½“ä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œè€Œ`done`å€¼æ˜¯ä¸€ä¸ª`false`

æˆ‘ä»¬å†è°ƒç”¨è¿­ä»£å™¨çš„`next`æ–¹æ³• -> ç»“æœå¾—åˆ°ä¹Ÿæ˜¯ä¸€ä¸ªç›¸åŒç»“æ„çš„å¯¹è±¡ï¼Œåªä¸è¿‡æ­¤æ—¶`value`å½“ä¸­å€¼å˜æˆäº†æ•°ç»„å½“ä¸­çš„ç¬¬äºŒä¸ªå…ƒç´ ï¼Œè€Œ`done`å€¼è¿˜æ˜¯ä¸€ä¸ª`false`

â€¦â€¦

ä»è°ƒç”¨`next`æ‰€è¿”å›çš„ç»“æœæ¥çœ‹ï¼Œæˆ‘ä»¬å¯ä»¥æƒ³åˆ°åœ¨è¿™ä¸ªè¿­ä»£å™¨å½“ä¸­ï¼Œå…¶**å†…éƒ¨åº”è¯¥æ˜¯ç»´æŠ¤äº†ä¸€ä¸ªæ•°æ®æŒ‡é’ˆï¼Œæˆ‘ä»¬æ¯è°ƒç”¨ä¸€æ¬¡`next`ï¼Œè¿™æŒ‡é’ˆéƒ½ä¼šå¾€åç§»ä¸€ä½**ï¼Œè€Œ`done`å±æ€§çš„ä½œç”¨åº”è¯¥å°±æ˜¯**è¡¨ç¤ºå†…éƒ¨æ‰€æœ‰çš„æ•°æ®æ˜¯å¦å…¨éƒ¨è¢«éå†å®Œäº†**

---

æ ¹æ®ä»¥ä¸Šå°è¯•ï¼Œæˆ‘ä»¬æ¨æ–­å‡ºå®ç° Iterable æ¥å£çš„æ•°æ®ç±»å‹çš„ä¸€äº›ç‰¹ç‚¹ï¼Œè‡³æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºï¼š

- æ‰€æœ‰å¯ä»¥ç›´æ¥è¢« `for...of` å¾ªç¯éå†çš„æ•°æ®ç±»å‹ï¼Œå®ƒéƒ½å¿…é¡»è¦å®ç°è¿™ä¸ªå«åš Iterable çš„æ¥å£ -> å³è¿™ä¸ªæ•°æ®çš„å†…éƒ¨å¿…é¡»è¦æŒ‚è½½ä¸€ä¸ªå«`iterable`çš„æ–¹æ³•
- è¿™ä¸ª`iterable`æ–¹æ³•éœ€è¦è¿”å›ä¸€ä¸ªå¸¦æœ‰`next`æ–¹æ³•çš„å¯¹è±¡ï¼Œæˆ‘ä»¬ä¸æ–­è°ƒç”¨è¿™ä¸ª`next`æ–¹æ³•å°±å¯ä»¥å®ç°å¯¹å†…éƒ¨æ‰€æœ‰æ•°æ®çš„éå†

3ï¼‰æµ‹è¯• Set å¯¹è±¡

> æŠŠä¸Šè¾¹çš„å°è¯•è½å®åˆ° `Set` å¯¹è±¡ï¼Œçœ‹çœ‹ä¸Šè¾¹çš„ç»“è®ºæ˜¯å¦æ­£ç¡®

``` js
// è¿­ä»£å™¨ï¼ˆIteratorï¼‰

// æ–°å»ºä¸€ä¸ª Set å¯¹è±¡ï¼Œå¹¶ä¸”åˆå§‹åŒ–ä¸€äº›åŸºæœ¬çš„å€¼
const set = new Set(['foo', 'bar', 'baz'])

// è°ƒç”¨è¿™ä¸ª set å¯¹è±¡ iterator æ–¹æ³•ï¼Œå¾—åˆ°è¿™ä¸ªå¯¹è±¡çš„è¿­ä»£å™¨
const iterator = set[Symbol.iterator]()

// é€šè¿‡è¿­ä»£å™¨çš„ next æ–¹æ³•å»è¿­ä»£ set å½“ä¸­çš„æ•°æ®
// å¤šæ¬¡è°ƒç”¨ next 
console.log(iterator.next())
console.log(iterator.next())
console.log(iterator.next())
console.log(iterator.next())
console.log(iterator.next())

// { value: 'foo', done: false }
// { value: 'bar', done: false }
// { value: 'baz', done: false }
// { value: undefined, done: true }
// { value: undefined, done: true }
```

å¯ä»¥çœ‹åˆ° `set` ä¸­çš„æ•°æ®ç¡®å®è¢«æ­£å¸¸éå†äº†ï¼Œè€Œè¿™ä¹Ÿå°±è¿›ä¸€æ­¥è¯å®äº†æˆ‘ä»¬ä¸Šè¾¹æ¨æ–­çš„æ˜¯æ­£ç¡®çš„

è€Œè¿™å…¶å®å°±æ˜¯ `for...of` å¾ªç¯å†…éƒ¨çš„å·¥ä½œåŸç†

`for...of` å¾ªç¯å†…éƒ¨å°±æ˜¯æŒ‰ç…§æˆ‘ä»¬è¿™é‡Œçš„`next`æ‰§è¡Œè¿‡ç¨‹å®ç°äº†éå†ï¼Œå…¶å®æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨`while`å¾ªç¯æ¥å®ç°ç›¸åŒçš„éå†

## â˜…å®ç°å¯è¿­ä»£æ¥å£
